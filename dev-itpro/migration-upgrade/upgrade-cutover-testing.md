---
title: "Тестирование переключения при обновлении"
description: "В этой теме описывается, как протестировать задачи, которые происходят после отключения AX 2012, но до включения Dynamics 365 for Finance and Operations, Enterprise edition."
author: tariqbell
manager: AnnBe
ms.date: 05/29/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-platform
ms.technology: 
audience: Developer, IT Pro
ms.reviewer: margoc
ms.search.scope: Operations, UnifiedOperations, Platform
ms.search.region: Global
ms.author: tabell
ms.search.validFrom: 2017-06-16
ms.dyn365.ops.version: Platform update 8
ms.translationtype: Human Translation
ms.sourcegitcommit: 6816e3820ab77c71bbf9bde4a068375448331671
ms.openlocfilehash: 711ad5cc3aafacf209704349effb4e08019205ac
ms.contentlocale: ru-ru
ms.lasthandoff: 06/15/2017

---

# <a name="upgrade-cutover-testing"></a>Тестирование переключения при обновлении

[!include[banner](../includes/banner.md)]

[!include[upgrade banner](../includes/upgrade-banner.md)]

*Переключение* — это термин, под которым мы понимаем окончательный процесс ввода новой системы в эксплуатацию. Этот процесс переключения состоит из задач, возникающих после отключения Microsoft Dynamics AX 2012, но до включения Microsoft Dynamics 365 for Finance and Operations, Enterprise edition. Назначение тестирования переключения при обновлении — отработать процесс переключения, чтобы гарантировать отсутствие проблем для всех, кто будет участвовать в фактическом переключении в рамках ввода в эксплуатацию.

Переключение включает в себя два основных рабочих потока:

- **Технический рабочий поток** — это рабочий поток включает в себя процесс выполнения обновления данных. Ваша компания установит ограничение на допустимую длительность простоя. Простой означает, что ни AX 2012, ни Finance and Operations не будут доступны. Этому рабочему потоку может потребоваться откорректировать процедуру обновления данных в соответствии с установленным компанией ограничением на длительность простоя.
- **Функциональный рабочий поток** — это рабочий поток включает в себя задачи конфигурирования, которые выполняются после завершения обновления данных. Все эти задачи должны быть документированы и оценены количественно, и им должен быть назначен ресурс, поскольку и функциональный рабочий поток, и технический рабочий поток должны уложиться в ограничение по простою, установленное компанией.

На следующем рисунке показан весь процесс переключения для ввода в эксплуатацию, как он будет происходить в рабочей среде.

![Процесс переключения](./media/cutover_1.png)

Этот процесс переключения отличается от базового обновления данных в песочнице следующим образом:

- База данных AX 2012 не копируется; создается только ее резервная копия, после чего вносятся изменения в исходную базу данных. Такой подход является более быстрым, а резервная копия обеспечивает возможность отката, если откат потребуется.
- Поскольку доступ к рабочей среде Finance and Operations ограничен, задачи, которые ранее выполнялись в экземпляре Application Object Server (AOS) в песочнице, теперь будут выполняться группой DSE Майкрософт. Эти задачи включают загрузку и импорта BACPAC-файла и запуск пакета MajorversionDataUpgrade.zip.
- Мы добавили следующие задачи:

    - Проведение теста состояния.
    - Выполнение задач по настройке приложения. Этот шаг может быть объемным, в зависимости от того, какая функциональность используется. На этом шаге функциональная группа конфигурирует новые функциональные возможности приложения, чтобы оно было готово для использования в обновленной системе.
    - Восстановление доступа пользователей. Сообщите своей пользовательской базе, что обновление завершено и они могут снова пользоваться системой.

## <a name="technical-workstream"></a>Технический рабочий поток

В техническом рабочем потоке участвуют различные технические специалисты: администратор базы данных (DBA), системный администратор AX 2012, администраторы серверов и разработчики, знакомые с AX 2012 и Finance and Operations. В этом разделе поясняется, какие специалисты выполняют те или иные задачи.

Во время тестирования переключения технические специалисты должны сосредоточиться на тестировании производительности и надежности процесса обновления данных, чтобы убедиться, что он соответствует установленному компанией ограничению на длительность простоя. В этом процессе задействуется множество элементов оборудования и программного обеспечения. Некоторые из этих элементов являются локальными, а другие находятся в облаке Майкрософт. Кроме того, задействуются многие элементы пользовательского кода приложения и стандартного кода. Результатом этого тестирования должна быть уверенность в том, что процесс переключения в вашей среде пройдет без проблем.

### <a name="turn-off-the-ax-2012-aos-instances"></a>Отключение экземпляров AX 2012 AOS

Эта задача требует участия системного администратора AX 2012 и администраторов серверов.

Необходимо проверить следующие аспекты:

- **Пакетные задания, которые выполняются во время переключения** — длительное пакетное задание, выполнение которого уже началось, будет препятствовать остановке системы. Необходимо планировать наперед, чтобы вы могли остановить свои экземпляры AOS в нужный момент. Возможно, имеет смысл запланировать пакетные задания так, чтобы они завершились за некоторое время до отключения AX 2012.
- **Интегрированные системы** — возможно, у вас есть другие системы, которые интегрированы со средой AX 2012. При планировании отключения AX 2012 необходимо учитывать эти системы. Например, может потребоваться отключить интегрированные системы за некоторое время до отключения AX 2012, чтобы можно было завершить все оставшиеся незавершенными транзакции. Требования в отношении интегрированных систем могут сильно отличаться от одной компании к другой. Следовательно, ваши специалисты должны самостоятельно спланировать этот сценарий.

### <a name="create-a-backup-of-the-ax-2012-database"></a>Создание резервной копии базы данных AX 2012

Эта задача требует участия администратора базы данных. Резервная копия будет использоваться, если потребуется откат. Кроме того, она будет использоваться в качестве отправной точки, сохраняемой в течение определенного периода, и демонстрировать состояние системы в момент переключения.

Необходимо проверить следующие аспекты:

- Получите конкретные временные параметры процесса резервного копирования.
- Настройте используемые параметры резервного копирования (например, со сжатием или без сжатия), чтобы обеспечить максимально быстрое создание резервной копии.

### <a name="export-the-database-to-bacpac"></a>Экспорт базы данных в BACPAC-файл

Эта задача требует участия администратора базы данных. Результатом выполнения этой задачи является файл экспорта, который будет отправлен в Microsoft Azure для новой системы.

Необходимо проверить следующие аспекты:

- Получите конкретные временные параметры процесса резервного копирования.
- Оптимизируйте процесс экспорта, чтобы обеспечить максимально быстрое его выполнение. Оптимизация может потребовать выполнения следующих задач:

    - Измерение системных ресурсов во время экспорта, таких как ЦП, память и дисковый ввод-вывод.
    - В случае обнаружения "узких мест" ресурсов необходимо создать план для их устранения. Как правило, устранение узких мест производится путем увеличения требуемого ресурса.

### <a name="upload-the-bacpac-file-to-azure-storage"></a>Отправка BACPAC-файла в хранилище Azure

Эта задача требует участия администраторов базы данных или администраторов серверов. В ходе этой задачи BACPAC-файл перемещается в Azure.

Необходимо проверить следующие аспекты:

- Выберите компьютер, который будет использоваться для отправки, и убедитесь, что обозреватель хранилищ Azure настроен и готов к использованию.
- Получите конкретные временные параметры процесса отправки, замерив его несколько раз. Время отправки будет варьироваться в зависимости от скорости вашего интернет-подключения и географического местонахождения центра данных Azure по отношению к вашему местонахождению.

### <a name="download-and-import-the-bacpac-file-to-the-azure-sql-database"></a>Загрузка и импорт BACPAC-файла в базу данных Azure SQL

При вводе в эксплуатацию эта задача выполняется группой DSE Майкрософт. Во время тестирования переключения, однако, она требует участия вашего администратора базы данных. Результатом выполнения этой задачи является файл экспорта, который будет отправлен в Azure для новой системы.

Необходимо проверить следующие аспекты:

- Получите конкретные временные параметры процесса импорта.
- Оптимизируйте процесс экспорта, чтобы обеспечить максимально быстрое его выполнение. Оптимизация может потребовать выполнения следующих задач:

    - Измерьте системные ресурсы в процессе экспорта. Далее приводятся некоторые примеры.

        - **На компьютере с AOS:** ЦП, память и дисковый ввод-вывод
        - **В экземпляре базы данных SQL Azure:** пропускную способность базы данных SQL (DTU) Контролировать DTU Azure SQL можно из Microsoft SQL Server Management Studio на компьютере с AOS путем просмотра системного представления sys.dm_resource_stats.

    - В случае обнаружения "узких мест" ресурсов необходимо создать план для их устранения. Как правило, устранение узких мест производится путем увеличения требуемого ресурса. Так как этот компьютер размещен у Майкрософт, необходимо будет отправить запрос в корпорацию Майкрософт, чтобы увеличить ресурсы, если вы выясните, что они являются узким местом.

### <a name="run-the-majorversiondataupgradezip-package"></a>Запуск пакета MajorVersionDataUpgrade.zip

При вводе в эксплуатацию эта задача выполняется группой DSE Майкрософт. Во время тестирования переключения, однако, она требует участия разработчиков. В ходе этой задачи старая структура базы данных преобразуется в структуру новой системы.

Процесс синхронизации баз данных выполняется в рамках этой задачи. Синхронизация базы данных может занять значительное время в некоторых ситуациях, например при изменении кластеризованного индекса в таблице, поскольку эта операция является ресурсоемкой с точки зрения SQL.

Настоятельно рекомендуется сначала выполнить анализ и отладку в среде разработки. В песочнице набор вариантов, доступных для отладки и анализа, более ограничен. Цель этой задачи — свести к минимуму количество проблем, которые придется решать при тестировании переключения, либо устранить их вовсе.

Необходимо проверить следующие аспекты:

- Получите конкретные временные параметры процесса импорта.
- Оптимизируйте процесс, чтобы обеспечить максимально быстрое его выполнение. Оптимизация может потребовать выполнения следующих задач:

    - Проведите мониторинг производительности отдельных сценариев обновления посредством таблицы ReleaseUpdateScriptsExecution.
    - Откорректируйте сценарии, чтобы оптимизировать их производительность. Эта задача может потребовать внесения индивидуальных изменений в код X ++ сценария с целью оптимизации его для вашего набора данных.
    - Проведите мониторинг DTU Azure SQL с помощью мониторинга Microsoft Dynamics Lifecycle Services (LCS) или системного представления sys.dm_resources_stats в Management Studio. Если ресурсы близки к исчерпанию, возможно, необходимо запросить более высокий уровень базы данных у группы DSE Майкрософт.

### <a name="roll-back-to-ax-2012"></a>Откат к AX 2012

Цель этой задачи — восстановить базу данных с использованием резервной копии, сделанной после отключения AX 2012, а затем снова включить AX 2012. Возможно, понадобится также восстановить состояние интегрированных систем. Тем не менее, поскольку интегрированные системы различаются от компании к компании, этот сценарий вам необходимо спланировать самостоятельно, исходя из ваших конкретных обстоятельств. Хотя вероятность того, что вам придется выполнять откат, невелика, очень важно, чтобы у вас был протестированный процесс на случай, если это все же понадобится.

## <a name="functional-workstream"></a>Функциональный рабочий поток

После обновления данных потребуется выполнить несколько задач по конфигурированию в новой среде. Цель этого рабочего потока — документировать и количественно оценить все задачи по конфигурированию, а также назначить каждой задаче ресурс, чтобы гарантировать, что эти задачи можно будет выполнять параллельно с техническим рабочим потоком в период, отведенный на простой.

Как правило, функциональные задачи предполагают изменение значений конкретных системных параметров или других данных конфигурации. Эти задачи выявляются путем проведения полного функционального тестирования, которое представляет собой мероприятие, отдельное от тестирования переключения. При выявлении задачи такого типа ее необходимо проанализировать вместе с функциональным ресурсом и разработчиком.

Более объемные изменения могут потребовать написания нового пользовательского сценария для обновления данных в процессе обновления данных. В то же время функциональный ресурс может вручную внести менее масштабные изменения в новую систему после обновления данных.

Более объемные изменения, требующие написания новых сценариев для обновления данных, необходимо протестировать. Следовательно, понадобится выполнить одну или несколько дополнительных итераций пакета MajorVersionDataUpgrade.zip. Важно сравнить затраты на повторный запуск пакета и затраты на ввод данных вручную.

Для каждого вносимого вручную изменения необходимо добавить соответствующую задачу в документ с планом переключения. В этой задаче должны быть указаны следующие сведения:

-   Что представляет задача, и что именно необходимо сделать?
-   Кто должен это делать?
-   Сколько времени это занимает?


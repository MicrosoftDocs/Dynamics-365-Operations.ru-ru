---
title: "Финансовая интеграция канала розничной торговли"
description: "В этом разделе содержится обзор финансовой интеграции для Retail POS."
author: josaw
manager: annbe
ms.date: 11/01/2018
ms.topic: article
ms.prod: 
ms.service: dynamics-365-retail
ms.technology: 
ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
ms.search.region: Global
ms.search.industry: Retail
ms.author: v-kikozl
ms.search.validFrom: 2018-11-1
ms.dyn365.ops.version: 8.1.1
ms.translationtype: HT
ms.sourcegitcommit: 0450326dce0ba6be99aede4ebc871dc58c8039ab
ms.openlocfilehash: c852d095505abecbd44d29e9e7b53875e9069def
ms.contentlocale: ru-ru
ms.lasthandoff: 11/01/2018

---
# <a name="fiscal-integration-for-retail-channel"></a>Финансовая интеграция канала розничной торговли

[!include [banner](../includes/banner.md)]

В этом разделе приводится обзор функции финансовой интеграции, доступной в Microsoft Dynamics 365 for Retail. Функция финансовой интеграции — это структура, предназначенная для поддержки местного финансового законодательства, предназначенного для исключения мошенничества в сфере розничной торговли. Типичные сценарии, которые могут охватываться с помощью финансовой интеграции:

- Печать финансового отчета и предоставление его клиенту.
- Защита отправки сведений, связанных с продажами и возвратами, выполняемые в POS, во внешнюю службу, предоставляемую властями.
- Использование защиты данных с помощью цифровой подписи, авторизованной уполномоченной организацией.

В этом разделе приводятся рекомендации по настройке финансовой интеграции, чтобы пользователи могли выполнять следующие задачи. 

- Настройка финансовых соединителей, являющихся финансовыми устройствами или службами, используемыми для целей финансовой регистрации, таких как сохранение, цифровые подписи и защищенная отправка финансовых данных.
- Настройка поставщика документов, который определяет метод вывода и алгоритм создания финансового документа.
- Настройка процесса финансовой регистрации, который определяет последовательность шагов и группы соединителей, используемые на каждом шаге.
- Назначение процессов финансовой регистрации профилям функциональности POS.
- Назначение технических профилей соединителя, либо профилям оборудования (для локальных финансовых соединителей), либо профилям функциональности POS (для других типов финансовых соединителей).

## <a name="fiscal-integration-execution-flow"></a>Поток выполнения финансовой интеграции
Следующий сценарий показывает общий поток выполнения финансовой интеграции.

1. Инициализация процесса финансовой регистрации.
  
   После выполнения некоторых действий, требующих финансовой регистрации, например после завершения проводки розничной торговли, процесс финансовой регистрации связан с текущим профилем функциональности POS.

1. Поиск финансового соединителя.
   
   Для каждого шага финансовой регистрации, включенного в процесс финансовой регистрации, система сопоставляет список финансовых соединителей. Эти соединители имеют функциональной профиль, включенный в указанную группу соединителей, со списком соединителей, которые имеют технический профиль, связанный с текущим профилем оборудования (только для типа соединителя, равного **Локальный**) или с текущим профилем функциональности POS (для других типов соединителей).
   
1. Выполнение финансовой интеграции.

   Система выполняет все необходимые действия, определенные сборкой, связанной с найденным соединителем. Это выполняется в соответствии с параметрами функционального профиля и технического профиля, которые были найдены на предыдущем шаге для этого соединителя.

## <a name="setup-needed-before-using-fiscal-integration"></a>Настройка, необходимая перед использованием финансовой интеграции
Прежде чем использовать функцию финансовой интеграции, следует определить следующие параметры:

- Определите номерную серию на странице **Параметры Retail** для номера финансового функционального профиля.
  
- Определите номерные серии на странице **Общие параметры розничной торговли** для следующих ссылок:
  
  - Номер финансового технического профиля
  - Номер группы финансовых соединителей
  - Номер процесса регистрации

- Создайте **Финансовый соединитель** в пункте **Retail > Настройка канала > Финансовая интеграция > Финансовые соединители** для каждого устройства или службы, которые планируется использовать в целях финансовой интеграции.

-  Создайте **Поставщик финансовых документов** в пункте **Retail > Настройка канала > Финансовая интеграция > Поставщики финансовых документов** для всех финансовых соединителей. Сопоставление данных считается частью поставщика финансовых документов. Чтобы настроить сопоставления различных данных для одного соединителя (например, специфичных для государства правил), следует создать различных поставщиков финансовых документов.

- Создайте **Функциональный профиль соединителя** в **Retail > Настройка канала > Финансовая интеграция > Функциональные профили соединителей** для каждого поставщика финансовых документов.
  - Выберите название соединителя.
  - Выберите поставщика документов.
  - Укажите параметры ставки НДС на вкладке **Настройка службы**.
  - Укажите коды сопоставления НДС и сопоставление типов платежных средств на вкладке **Сопоставление данных**.

  #### <a name="examples"></a>Примеры 

  |  | Форматировать | Пример | 
  |--------|--------|--------|
  | Настройки ставок НДС | значение : VATrate | 1 : 2000, 2 : 1800 |
  | Сопоставление кодов НДС | VATcode : значение | vat20 : 1, vat18 : 2 |
  | Сопоставление типов платежных средств | TenderTyp : значение | Наличные : 1, Карта : 2 |

- Создайте **Группы финансовых соединителей** в **Retail > Настройка канала > Финансовая интеграция > Группа финансовых соединителей**. Группа соединителей является подмножеством функциональных профилей, связанных с финансовыми соединителями, которые выполняют одинаковые функции и используются на одной стадии в процессе финансовой регистрации.

   - Добавление функциональных профилей в группу соединителей. Щелкните **Добавить** на странице **Функциональные профили** и выберите номер профиля.
   - Если нужно приостановить использование функционального профиля, установите для параметра **Отключить** значение **Да**. 
   
     Это изменение затрагивает только текущую группу соединителей. Можно продолжить использовать этот же функциональный профиль в других группах соединителей.

     >[!NOTE]
     > В группе соединителей каждый финансовый соединитель может иметь только один функциональный профиль.

- Создайте **Технический профиль соединителя** в **Retail > Настройка канала > Финансовая интеграция > Технические профили соединителей** для каждого финансового соединителя.
  - Выберите название соединителя.
  - Выберите тип соединителя: 
      - **Локальный** — задавайте этот тип для физических устройств или приложений, установленных на локальном компьютере.
      - **Внутренний** — задавайте этот тип для финансовых устройств и служб, подключенных к Retail Server.
      - **Внешний** — для внешних финансовых служб, таких как веб-портал, предоставленный налоговым органом.
    
  - Укажите параметры на вкладке **Подключение**.

      
 >[!NOTE]
 > Обновленная версия конфигурации, которая была загружена ранее, будет загружена для функциональных и технических профилей. Если соответствующий соединитель или поставщик документов уже используется, вы будете оповещены. По умолчанию все изменения, сделанные вручную в функциональных и технических профилях, будут сохранены. Чтобы переопределить эти профили с набором параметров по умолчанию из конфигурации, нажмите кнопку **Обновить** на странице **Функциональные профили соединителей** и **Технические профили соединителей**.
 
- Создайте **Процесс финансовой регистрации** в пункте **Retail > Настройка канала > Финансовая интеграция > Процессы финансовой регистрации** для каждого уникального процесса финансовой интеграции. Процесс регистрации определяется последовательностью шагов регистрации и группой соединителей, используемых на каждом шаге. 
  
  - Добавьте шаги регистрации в процесс:
      - Нажмите кнопку **Добавить**.
      - Выберите тип соединителя.
      
      >[!NOTE]
      > Это поле определяет, где система будет искать технический профиль для соединителя, в аппаратных профилях для типа соединителя **Локальный** или в функциональных профилях POS для других типов финансовых соединителей.
      
   - Выберите группу соединителей.
   
     >[!NOTE]
     > Щелкните **Проверить** для проверки целостности структуры процесса регистрации. Рекомендуется, чтобы проверки осуществлялись в следующих случаях:
       >- Для нового процесса регистрации после всех заполненных настроек, включая привязки к профилям функциональности POS и профилям оборудования.
       >- После выполнения обновления существующего процесса регистрации.

-  Свяжите процессы финансовой регистрации с профилями функциональности POS в **Retail > Настройка канала > Настройка POS > Профили POS > Профили функциональности**.
   - Щелкните **Изменить** и выберите **Номер процесса** на вкладке **Процесс финансовой регистрации**.
- Свяжите технические профили соединителей с профилями оборудования в пункте **Retail > Настройка канала > Настройка POS > Профили POS > Профили оборудования**.
   - Щелкните **Изменить**, затем щелкните **Создать** на вкладке **Финансовый технический профиль**.
   - Выберите технический профиль соединителя в поле **Номер профиля**.
   
     >[!NOTE]
     > Можно добавить несколько технических профилей к профилю оборудования. Однако это не поддерживается, если профиль оборудования имеет более одного пересечение с любой из групп соединителей. Чтобы избежать неверных настроек, рекомендуется проверить процесс регистрации после обновления всех профилей оборудования.


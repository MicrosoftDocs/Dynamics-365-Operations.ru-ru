---
title: Обмен электронными сообщениями
description: В этом разделе содержится обзор и сведения о настройке для обмена электронными сообщениями в Microsoft Dynamics 365 for Finance and Operations.
author: ShylaThompson
manager: AnnBe
ms.date: 11/16/2018
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
audience: Application User
ms.reviewer: shylaw
ms.search.scope: Core, Operations
ms.search.region: Global
ms.author: shylaw
ms.search.validFrom: 2018-10-28
ms.dyn365.ops.version: 8.0999999999999996
ms.openlocfilehash: 2753f2828b4890d9893a1538e905bd7061e1bc33
ms.sourcegitcommit: 2b890cd7a801055ab0ca24398efc8e4e777d4d8c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2019
ms.locfileid: "1536879"
---
# <a name="electronic-messaging"></a>Электронные сообщения

[!include [banner](../includes/banner.md)]
[!include [preview-banner](../includes/preview-banner.md)]

В этом разделе содержится обзор и сведения о настройке для обмена электронными сообщениями в Microsoft Dynamics 365 for Finance and Operations.

В последнее время государственные и законодательные органы в различных странах и регионах по всему миру реализовали требования к отчетности для компаний, которые зарегистрированы в этих странах или регионах. Цель этих требований — обеспечить получение данных от таких компаний в электронном формате непосредственно из систем, где они учитываются, хранятся и обрабатываются.

Функция электронных сообщений в Finance and Operations поддерживает различные процессы для электронного взаимодействия между Finance and Operations и системами, которые государственные и законодательные органы предлагают для подготовки отчетов, отправки и получения официальной информации.

Функция электронных сообщений интегрирована с модулем **Электронная отчетность** (ER). Таким образом, можно настроить форматы ER для электронных сообщений. Дополнительные сведения см. в разделе [Электронная отчетность (ER)](https://docs.microsoft.com/dynamics365/unified-operations/dev-itpro/analytics/general-electronic-reporting).

Обмен электронными сообщениями основан на следующих объектах:

- **Электронное сообщение** — отчет или декларация, которые должны быть поданы и/или переданы внутри. Примером является отчет, который отправляется в налоговый орган.
- **Элементы электронного сообщения** — записи, которые должны быть включены в сообщение, включенное в отчет.
- **Обработка электронного сообщения** — цепочка действий, которые должны запускаться для сбора необходимых данных, создания отчетов, сохранения данных в хранилище BLOB-объектов Microsoft Azure, передачи отчетов за пределы системы, получения ответов извне системы и, на основе полученных данных, обновления базы данных. Действия в цепочке может быть связанными или несвязанными

На следующем рисунке показан поток данных для обмена электронными сообщениями.

![Поток данных обмена электронными сообщениями](media/electronic-messaging-data-flow.png)

Функция электронных сообщений поддерживает следующие сценарии:

- Ручное создание сообщений и формирование отчетов, основанных на связанных форматах экспорта ER различных типов: Microsoft Excel, XML, JavaScript Object Notation (JSON), PDF, текст и Microsoft Word.
- Автоматическое создание и обработка сообщений, основанных на сведениях, которые были запрошены и получены от уполномоченного органа через связанный формат импорта ER.
- Сбор и обработка сведений из источника данных в качестве элементов сообщения. Источник данных представляет собой таблицу Finance and Operations.
- Сохранение дополнительных сведений и оценка различных значений путем вызова специально определенных исполняемых классов относительно сообщений или элементов сообщений.
- Агрегированные данные, собираемые в элементах сообщений, разделяют эти сведений по сообщениям и формируют отчеты в связанных форматах экспорта электронной отчетности.
- Передача сформированных отчетов в веб-службу с использованием сведений о безопасности, которые хранятся в хранилище Azure Key Vault.
- Получение ответа от веб-службы, интерпретация ответа и обновление данных в Finance and Operations соответствующим образом.
- Хранение и просмотр всех созданных отчетов.
- Хранение и просмотр всех сведений журналов, которые относятся к действиям, которые выполняются для сообщения или элемента сообщения.
- Управление обработкой через различные статусы сообщений и статусы элементов сообщений.

## <a name="set-up-electronic-messaging"></a>Настройка обмена электронными сообщениями

Обмен электронными сообщениями помогает поддерживать различные процессы электронной отчетности для различных типов документов. В некоторых сложных сценариях обмен электронными сообщениями настраивается таким образом, чтобы он имел сочетание большого количества статусов сообщений, статусов элементов сообщений, действий, дополнительных полей и исполняемых классов. Для этих сценариев пакеты информационных объектов доступны для импорта. Если вы используете эти пакеты информационных объектов, их следует импортировать в юридическое лицо при помощи средства управления данными. Дополнительные сведения о том, как использовать средство управления данными, см. в разделе [Управление данными](../../dev-itpro/data-entities/data-entities-data-packages.md).

Если не импортировать пакет информационных объектов, можно вручную настроить функцию электронных сообщений. В этом случае необходимо настроить следующие элементы:

- [Номерные серии](#number-sequences)
- [Типы и статусы элементов сообщений](#message-item-types-and-statuses)
- [Статусы сообщения](#message-statuses)
- [Дополнительные поля](#additional-fields)
- [Параметры исполняемого класса](#executable-class-settings)
- [Действия заполнения записей](#populate-records-actions)
- [Веб-приложения](#web-applications)
- [Параметры веб-службы](#web-service-settings)
- [Действия обработки сообщения](#message-processing-actions)
- [Обработка электронного сообщения](#electronic-message-processing)

В следующих разделах приведены дополнительные сведения о каждом из этих элементов.

### <a name="number-sequences"></a>Номерные серии

Настройте номерные серии для сообщений и элементов сообщений. Номерные серии используются для автоматической нумерации сообщений и элементов сообщений. Номера, которые назначены, будут служить уникальными кодами для сообщений и элементов сообщений в системе. Можно настроить номерные серии для электронных сообщений на странице **Параметры главной книги** (**Главная книга** \> **Настройка главной книги** \> **Параметры главной книги**).

### <a name="message-item-types-and-statuses"></a>Типы и статусы элементов сообщений

Типы элементов сообщений определяют типы записей, которые будут использоваться в электронных сообщениях. Типы элементов сообщений можно настроить на странице **Типы элементов сообщения** (**Налог** \> **Настройка** \> **Электронные сообщения** \> **Типы элементов сообщения**).

Статусы элементов сообщений указывают статусы, которые применяются к элементам сообщений в обработке, которую вы настраиваете. Типы элементов сообщений можно настроить на странице **Статусы элемента сообщения** (**Налог** \> **Настройка** \> **Электронные сообщения** \> **Статусы элемента сообщения**).

Параметр **Разрешено удаление** статуса элемента сообщения определяет, могут ли пользователи удалять элементы сообщения с этим статусом на странице **Электронные сообщения** или странице **Элементы электронного сообщения**.

### <a name="message-statuses"></a>Статусы сообщения

Настройте статусы сообщений, которые должны быть доступны при обработке сообщений. Статусы сообщений можно настроить на странице **Статусы сообщения** (**Налог** \> **Настройка** \> **Электронные сообщения** \> **Статусы сообщения**).

В следующей таблице описаны поля на странице **Статусы сообщения**.

| Имя поля          | Описание |
|---------------------|-------------|
| Состояние сообщения      | Введите уникальное имя для статуса сообщения. Статусы сообщения используются для задания характеристики состояния электронного сообщения в каждый момент. Введенное название отображается на странице **Электронные сообщения** и в журнале, который относится к электронным сообщениям. |
| Описание         | Введите описание статуса сообщения. |
| Тип отклика       | Выберите тип ответа для статуса сообщений. Некоторые действия в обработке могут давать более одного типа отклика. Например, действия типа **Веб-служба** могут приводить к откликам типа **Выполнено успешно** или **Техническая ошибка**, в зависимости от результатов их выполнения. В этом случае необходимо определить статусы сообщений для обоих типов откликов. Дополнительные сведения о типах действий и связанных с ними типах ответов см. в разделе [Типы действий обработки сообщений](#message-processing-action-types). |
| Статус элемента сообщения | В некоторых случаях статус электронного сообщения должен влиять на статус связанных элементов сообщения. Выберите статус элемента сообщения в этом поле, чтобы связать его со статусом сообщения. |
| Разрешено удаление        | Этот флажок следует установить, если пользователи должны иметь возможность удалять электронные сообщения с этим статусом на странице **Электронные сообщения**. |

### <a name="additional-fields"></a>Дополнительные поля

Функции электронных сообщений позволяет заполнять записи из таблицы транзакций. Таким образом, можно подготовить эти записи для отчетности, а затем сообщить их. Тем не менее таблицы проводок иногда не имеют достаточно сведений для заполнения записей в соответствии с требованиями отчетности. Чтобы заполнить всю информацию, которая должна сообщаться для записи, необходимо настроить дополнительные поля. Дополнительные поля можно связать как с сообщениями, так и с элементами сообщений. Можно настроить дополнительные поля на странице **Дополнительные поля** (**Налог** \> **Настройка** \> **Электронные сообщения** \> **Дополнительные поля**).

В следующей таблице описаны общие поля на странице **Дополнительные поля**.

| Поле       | Описание |
|-------------|-------------|
| Имя поля  | Введите имя дополнительного атрибута элементов сообщений, которые относятся к процессу. Это имя отображается в пользовательском интерфейсе (UI) во время работы с процессом. Оно может также использоваться в конфигурациях электронной отчетности, которые относятся к процессу. |
| Описание | Введите описание дополнительного поля. |
| Изменение пользователя   | Установите для этого параметра значение **Да**, если пользователи должны иметь возможность изменить значение дополнительного поля в пользовательском интерфейсе. |
| Счетчик     | Установите для этого параметра значение **Да**, если дополнительное поле должно содержать номерную серию в электронном сообщении. Значение дополнительного поля будет заполнено автоматически при выполнении действия **Экспорт электронной отчетности**. |
| Скрыто      | Установите для этого параметра значение **Да**, если дополнительное поле должно быть скрыто в интерфейсе пользователя. |

Каждое дополнительное поле может иметь различные значения для обработки. Эти значения задаются на экспресс-вкладке **Значения**. В следующей таблице приводится описание полей.

| Поле                | Описание |
|----------------------|-------------|
| Значение поля          | Введите значение поля для использования для сообщения или элемента сообщения во время отчетности. |
| Описание          | Введите описание значения поля. |
| Тип счета         | Некоторые значения поля могут быть ограничены определенными типами счетов. Выберите одно из следующих значений: **Все**, **Клиент** или **Поставщик**. |
| Код счета         | Если выбрано значение **Клиент** или **Поставщик** в поле **Тип счета**, можно дополнительно ограничить использование значения поля до определенной группы или таблицы. |
| Номер счета/группы | Если выбрано значение **Клиент** или **Поставщик** в поле **Тип счета** и введена группа или таблица в поле **Код счета**, в это поле можно ввести определенную группу или контрагента. |
| Действует            | Укажите дату, с которой это значение будет учитываться. |
| Истечение срока           | Укажите дату, с которой это значение перестанет учитываться. |

По умолчанию сочетания условий, определенных в полях **Номер счета/группы**, **Код счета**, **Действует** и **Истечение срока** не влияет на выбор значений для дополнительных полей. Тем не менее эти комбинации могут использоваться в исполняемом классе для реализации определенной логики, которая вычисляет значения дополнительных полей.

### <a name="executable-class-settings"></a>Параметры исполняемого класса

Исполняемый класс — это метод или класс X++, который обработка электронных сообщений может вызывать в отношении действия, если некоторая оценка требуется для процесса.

Можно вручную настроить исполняемый класс на странице **Параметры исполняемого класса** (**Налог** \> **Настройка** \> **Электронные сообщения** \> **Параметры исполняемого класса**). Создайте строку и задайте следующие поля.

| Поле                 | описание |
|-----------------------|-------------|
| Исполняемый класс      | Введите имя, которое будет использоваться при настройке действия обработки сообщений, в отношении которого вызывается этот класс. |
| описание           | Введите описание исполняемого класса. |
| Имя исполняемого класса | Выберите исполняемый класс X++. |
| Уровень выполнения       | Это поле устанавливается автоматически, потому что значение должно быть заранее определено для выбранного используемого класса. Это поле ограничивает уровень, для которого выполняется соответствующая оценка. |
| Описание класса     | Это поле устанавливается автоматически, потому что значение должно быть заранее определено для выбранного используемого класса. |

Некоторые исполняемые классы могут иметь обязательные параметры, которые должны быть определены до первого запуска исполняемого класса. Чтобы определить эти параметры, выберите **Параметры** в области действий, установите значения полей в появившемся диалоговом окне, затем выберите **ОК**. Важно выбрать **ОК**. В противном случае параметры не сохраняются в базе данных, и исполняемый класс не будет вызываться правильно.

### <a name="populate-records-actions"></a>Действия заполнения записей

Действия заполнения записей используется для настройки действий, которые добавляют записи в таблицу элементов сообщений, чтобы их можно было добавить в электронное сообщение. Например, если электронное сообщение должно содержать отчет о накладных клиента, необходимо настроить действие заполнения записей, которое связано с полем **Источник данных** в таблице журнала накладных клиента. Можно настроить действия заполнения записей на странице **Действие заполнения записей** (**Налог** \> **Настройка** \> **Электронные сообщения** \> **Действие заполнения записей**). Создайте новую запись для каждого действия, которое должно добавлять записи в таблицу, и задайте следующие поля.

| Поле       | Описание |
|-------------|-------------|
| Название        | Введите имя для действия, которое заполняет записи в процессе. |
| Описание | Введите описание действия заполнения записей. |

На экспресс-вкладке **Настройка источников данных** добавьте строку для каждого источника данных, который используется для обработки, и настройте следующие поля.

| Поле                  | описание |
|------------------------|-------------|
| Наименование                   | Введите имя источника данных. |
| Тип элемента сообщения      | Выберите тип элементов сообщений, который должен использоваться при создании записей для источника данных. |
| Тип счета           | Выберите тип счета, который должен быть связан с записями из источника данных. |
| Имя главной таблицы      | Выберите таблицу в Finance and Operations, которая должна быть источником данных. |
| Поле номера документа  | Выберите поле, из которого должен браться номер документа, в выбранной таблице. |
| Поле даты документа    | Выберите поле, из которого должна браться дата документа, в выбранной таблице. |
| Поле счета документа | Выберите поле, из которого должен браться счет документа, в выбранной таблице. |
| Пользовательский запрос             | Если этот флажок установлен, можно настроить запрос путем выбора **Изменить запрос** над сеткой. В противном случае все записи будут заполнены из выбранного источника данных. |

### <a name="web-applications"></a>Веб-приложения

Вы используете параметры веб-приложения, чтобы настроить веб-приложение таким образом, чтобы оно поддерживало открытую авторизацию (OAuth) 2.0. OAuth является открытым стандартом, который позволяет пользователям предоставлять "безопасный делегированный доступ" в приложение от их имени без совместного использования своих учетных данных для доступа. Можно также выполнить процесс авторизации путем получения кода авторизации и маркера доступа. Можно настроить параметры веб-приложения на странице **Веб-приложения** (**Налог** \> **Настройка** \> **Электронные сообщения** \> **Веб-приложения**).

В следующей таблице описаны поля на странице **Веб-приложения**.

| Поле                        | Описание |
|------------------------------|-------------|
| Имя приложения             | Введите имя для веб-приложения. |
| Описание                  | Введите описание веб-приложения. |
| Базовый URL-адрес                     | Введите базовый интернет-адрес веб-приложения. |
| URL-путь авторизации       | Укажите путь, который используется для составления URL-адреса для авторизации. |
| URL-путь маркера               | Укажите путь, который используется для составления URL-адреса для токена. |
| URL-адрес перенаправления                 | Введите URL-адрес перенаправления. |
| Код клиента                    | Введите идентификатор клиента веб-приложения. |
| Секрет клиента                | Введите секрет клиента веб-приложения. |
| Маркер сервера                 | Введите маркер сервера веб-приложения. |
| Сопоставление формата авторизации | Выберите формат электронной отчетности, который используется для создания запроса для авторизации. |
| Сопоставление модели маркера импорта   | Выберите сопоставление модели импорта электронной отчетности, которое используется для хранения маркера доступа. |
| Предоставленная область                | Область, которая предоставляется для запросов к приложению. Это поле обновляется автоматически. |
| Маркер доступа истекает через  | Оставшееся время до истечения срока действия маркер доступа. | 
| Принять                       | Укажите свойство **Принять** веб-запроса. Например, введите **application/vnd.hmrc.1.0+json**. |
| Тип содержимого                 | Укажите тип содержимого. Например, введите **application/json**. |

Кроме того, доступны следующие кнопки на панели операций страницы **Веб-приложения** для поддержки процесса авторизации:

- **Получить код авторизации** — инициализация авторизации веб-приложения.
- **Получить маркер доступа** — инициализация процесса получения маркера доступа.
- **Обновить маркер доступа** — обновление маркера доступа.

Если маркер доступа к веб-приложению хранится в базе данных системы в зашифрованном формате, он может использоваться для запросов к веб-службе. Для целей безопасности доступ к маркеру доступа должен быть ограничен ролями безопасности, которым необходимо разрешить обрабатывать эти запросы. Если пользователи, находящиеся вне группы безопасности, пытаются обработать запрос, они получат сообщение об ошибке с извещением, что они не могут взаимодействовать через выбранное веб-приложение. Чтобы настроить роли безопасности, которые должны иметь доступ к маркеру доступа, используйте экспресс-вкладку **Роли безопасности** на странице **Веб-приложения**. Если роли безопасности для веб-приложения не определены, только системный администратор может взаимодействовать через это веб-приложение.

### <a name="web-service-settings"></a>Параметры веб-службы

Параметры веб-службы используются для настройки прямой передачи данных к веб-службу. Можно настроить параметры веб-службы на странице **Параметры веб-службы** (**Налог** \> **Настройка** \> **Электронные сообщения** \> **Параметры веб-службы**).

В следующей таблице описаны поля на странице **Параметры веб-службы**.

| Поле                          | описание |
|--------------------------------|-------------|
| Веб-служба                    | Введите имя для веб-службы. |
| описание                    | Введите описание веб-службы. |
| Веб-адрес               | Введите интернет-адрес веб-службы. Если указано веб-приложение для веб-службы и если интернет-адрес веб-службы должен быть такой же, как интернет-адрес, который определен для этого веб-приложения, выберите **Копировать базовый URL-адрес**, чтобы скопировать базовый URL-адрес веб-приложения в это поле. |
| Сертификат                    | Выберите сертификат хранилища ключей, который ранее был настроен. |
| Веб-приложение                | Выберите сертификат хранилища ключей, который ранее был настроен. |
| Тип отклика — XML        | Установите для этого параметра значение **Да** в случае типа отклика XML. |
| Метод запроса                 | Укажите способ запроса. HTTP определяет набор методов запроса, который указывает действие, которое должно быть выполнено для определенного ресурса. Этот метод запроса может быть **GET**, **POST** или другой метод HTTP. |
| Заголовки запроса                | Укажите заголовки запросов. Заголовок запроса — это заголовок HTTP, который может быть использован в запросе HTTP и который не связан с содержимым сообщения. |
| Принять                         | Укажите свойство **Принять** веб-запроса. |
| Принять кодирование                | Укажите значение **Accept-Encoding**. Заголовок запроса HTTP Accept-Encoding объявляет кодировку содержимого, которую клиент может понять. Эта кодировка содержимого обычно является алгоритмом сжатия. |
| Тип содержимого                   | Укажите тип содержимого. HTTP-заголовок объекта Content-Type указывает тип носителя для ресурса. |
| Код успешного ответа       | Укажите код статуса HTTP, который указывает, что запрос выполнен успешно. |
| Сопоставление формата заголовков запроса | Выберите формат электронной отчетности, который используется для создания заголовков веб-запросов. |

### <a name="message-processing-actions"></a>Действия обработки сообщения

Действия обработки сообщений используются для создания действий для процессов и настройки их параметров. Действия обработки сообщений можно настроить на странице **Действия обработки сообщения** (**Налог** \> **Настройка** \> **Электронные сообщения** \> **Действия обработки сообщения**).

В следующей таблице описаны поля на странице **Действия обработки сообщения**.

#### <a name="general-fasttab"></a>Экспресс-вкладка "Общее"

| Поле                       | описание |
|-----------------------------|-------------|
| Тип действия                 | Выберите тип действия. Сведения о доступных параметрах см. в разделе [Типы действий обработки сообщений](#message-processing-action-types). |
| Сопоставление формата              | Выберите формат электронной отчетности, который должен вызываться для действия. Это поле доступно только для действий типов **Экспорт электронной отчетности**, **Импорт электронной отчетности** и **Сообщение экспорта электронной отчетности**. |
| Сопоставление формата для URL-пути | Выберите формат электронной отчетности, который должен вызываться для действия. Это поле доступно только для действий типа **Веб-служба**. Оно используется для составления пути URL-адреса, который будет добавляться к базовому интернет-адресу, указанному для выбранного веб-сервера. |
| Тип элемента сообщения           | Выберите тип записей, для которых должно оцениваться это действие. Это поле доступно для действий типов **Уровень выполнения элемента сообщения**, **Экспорт электронной отчетности**, **Импорт электронной отчетности** и **Веб-служба**, а также для некоторых других типов. Если оставить это поле пустым, вычисляются все типы элементов сообщений, определенные для обработки сообщений. |
| Исполняемый класс            | Выберите параметры исполняемого класса, которые были ранее созданы. Это поле доступно только для действий типов **Уровень выполнения элемента сообщения** и **Уровень выполнения элемента сообщения**. |
| Действие заполнения записей     | Выберите действие заполнение записей, которое было настроено ранее. Это поле доступно только для действий типа **Заполнить записи**. |
| Веб-служба                 | Выберите веб-службу, которая была настроена ранее. Это поле доступно только для действий типа **Веб-служба**. |
| Имя файла                   | Укажите имя файла, который будет результатом действия. Этот файл может быть ответом от веб-сервера или отчетом, который генерируется. Это поле доступно только для действий типов **Веб-служба** и **Сообщение экспорта электронной отчетности**. |
| Показать диалоговое окно                 | Установите для этого параметра значение **Да**, если необходимо показывать диалоговое окно пользователям перед созданием отчета. Это поле доступно только для действий типа **Сообщение экспорта электронной отчетности**. |

##### <a name="message-processing-action-types"></a>Типы действий обработки сообщений

В поле **Тип действия** доступны следующие варианты:

- **Создать сообщение** — используйте этот тип действия, чтобы пользователи могли вручную создавать сообщения на странице **Электронное сообщение**. Исходный статус не может быть настроен для данного типа действия.
- **Заполнить записи** — действие типа **Заполнить записи** необходимо предварительно настроить. Свяжите этот тип действия с действием заполнения записей, чтобы это действие можно было включить в обработку. Предполагается, что этот тип действия используется либо для первого действия в обработке сообщения (когда электронные сообщения не были созданы заранее) или для действие, добавляющего элементы сообщения в сообщение, созданное ранее действием типа **Создать сообщение**. Таким образом, для действий этого типа статус результата может быть настроен только для элементов сообщения. Начальный статус можно настроить только для сообщений.
- **Уровень выполнения сообщения** — этот тип действий используется для настройки исполняемого класса, который должен вычисляться на уровне сообщений.
- **Уровень выполнения элемента сообщения** — этот тип действий используется для настройки исполняемого класса, который должен вычисляться на уровне элементов сообщений.
- **Экспорт электронной отчетности** — этот тип действий используется для действий, которые должны создавать отчет, основанный на конфигурации экспорта электронной отчетности на уровне элементов сообщений.
- **Сообщение экспорта электронной отчетности** — этот тип действий используется для действий, которые должны создавать отчет, основанный на конфигурации экспорта электронной отчетности на уровне сообщений (например, когда сообщение не содержит никаких элементов сообщений).
- **Импорт электронной отчетности** — этот тип действий используется для действий, которые должны создавать отчет, основанный на конфигурации импорта электронной отчетности.
- **Пользовательская обработка на уровне сообщения** — этот тип действий используется для действий, которые предполагают некоторое действие, выполняемые пользователем вручную на уровне сообщения. Например, пользователь может обновлять статус сообщений.
- **Пользовательская обработка** — этот тип действий используется для действий, которые предполагают некоторое действие, выполняемые пользователем вручную на уровне элемента сообщения. Например, пользователь может обновлять статус элементов сообщений.
- **Веб-служба** — этот тип действий используется для действий, которые должны передавать формируемый отчет в веб-службу. Этот тип действия не используется для отчетности сообщения о счетах продажи и покупки для Италии. Для действий типа **Веб-служба** страница **Действия обработки сообщения** включает экспресс-вкладку **Прочие подробные сведения**, где можно указать текст подтверждения. Этот текст подтверждения будет показан пользователям перед тем, как запросы будут направлены в выбранную веб-службу.
- **Запрос проверки** — используйте этот тип действий для запроса проверки от сервера.

#### <a name="initial-statuses-fasttab"></a>Экспресс-вкладка "Начальные статусы"

> [!NOTE]
> Экспресс-вкладка **Начальные статусы** недоступна для действий, которые имеют начальный тип действий **Создать сообщение**.

| Поле               | Описание |
|---------------------|-------------|
| Статус элемента сообщения | Выберите статус элемента сообщения, для которого должно вычисляться выбранное действие обработки сообщения. |
| описание         | Описание выбранного статуса элемента сообщения. |

#### <a name="result-statuses-fasttab"></a>Экспресс-вкладка "Полученные статусы"

| Поле               | описание |
|---------------------|-------------|
| Статус сообщения      | Выберите статус сообщения, для которого должно вычисляться выбранное действие обработки сообщения. Это поле доступно только для действий обработки сообщений, которые вычисляются на уровне сообщений. Например, оно доступно для действий типов **Экспорт электронной отчетности** и **Импорт электронной отчетности**, но недоступно для действий типов **Обработка пользователя** и **Уровень выполнения элемента сообщения**. |
| описание         | Описание выбранного статуса сообщения. |
| Тип отклика       | Тип ответа выбранного статуса сообщений. |
| Статус элемента сообщения | Выберите полученные статусы, которые должны быть доступны после вычисления выбранного действия обработки сообщения. Это поле доступно только для действий обработки сообщений, которые вычисляются на уровне элементов сообщений. Например, оно доступно для действий типов **Обработка пользователя** и **Уровень выполнения элемента сообщения**. Для действий обработки сообщений, которые вычисляются на уровне сообщений, это поле показывает статус элемента сообщения, который был настроен для статуса выбранного сообщения. |

В следующей таблице показаны статусы результатов, которые необходимо настроить для различных типов действий и типов откликов.

| Тип действия электронного сообщения/Тип отклика | Выполнено успешно | Бизнес-ошибка | Техническая ошибка | Определено пользователем | Отменить |
|----------------------------------------------|-----------------------|----------------|-----------------|--------------|--------|
| Создать сообщение                               | Х                     |                |                 |              |        |
| Экспорт электронной отчетности                  | Х                     |                |                 |              |        |
| Импорт электронной отчетности                  |                       |                |                 |              |        |
| Веб-служба                                  | Х                     |                | Х               |              |        |
| Обработка пользователя                              |                       |                |                 |              |        |
| Уровень выполнения сообщения                      |                       |                |                 |              |        |
| Заполнить записи                             |                       |                |                 |              |        |
| Уровень выполнения элемента сообщения                 |                       |                |                 |              |        |
| Запрос проверки                         | Х                     | Х              | Х               |              |        |
| Сообщение экспорта электронной отчетности          | Х                     |                |                 |              |        |
| Пользовательская обработка на уровне сообщения                |                       |                |                 |              |        |

### <a name="electronic-message-processing"></a>Обработка электронного сообщения

Обработка электронных сообщений является основным принципом функции электронных сообщений. Она объединяет действия, которые должны вычисляться для электронного сообщения. Действия могут быть связаны через начальный статус и статус результата. Кроме того, действия типа **Обработка пользователя** могут запускаться независимо. На странице **Обработка электронного сообщения** (**Налог** \> **Настройка** \> **Электронные сообщения** \> **Обработка электронного сообщения**) можно также выбрать дополнительные поля, которые должны поддерживаться для обработки на уровне сообщения или на уровне элементов сообщения.

Экспресс-вкладка **Действие** позволяет добавлять предопределенные действия к обработке. Можно указать, должно ли действие выполняться отдельно или оно может быть запущено обработкой. Чтобы указать, что действие в обработке может быть инициализировано только пользователем, установите в поле **Выполнить отдельно** значение **Да** для этого действия. Если требуется, чтобы действие запускалось путем обработки для сообщений или элементов сообщений, имеющих статус, который определен как начальный статус для этого действия, задайте для параметра **Выполнить отдельно** значение **Нет**. Действия типа **Действие пользователя** должны всегда выполняться отдельно.

В некоторых случаях несколько действий должны быть агрегированы в последовательность, несмотря на то, что первое действие настроено для выполнения отдельно. Например, пользователь должен инициировать создание отчета, но сразу же после создания отчета он должен отправляться в веб-службу, и ответ от веб-службы должен быть отражен в системе. В этой ситуации можно создать неделимую последовательность действий, которые должны всегда выполняться вместе. На экспресс-вкладке **Действие** выберите **Неделимые последовательности** над сеткой и создайте последовательность. Затем для всех действий, которые должны выполняться одновременно, выберите последовательность в поле **Неделимая последовательность**. В этом случае в поле **Выполнить отдельно** должно быть задано значение **Да** для первого действия в последовательности, но значение **Нет** для всех других действий.

Экспресс-вкладка **Дополнительные поля элемента сообщения** позволяет добавить предварительно определенные дополнительные поля, которые относятся к элементам сообщений. Необходимо добавить дополнительные поля для каждого типа элемента сообщений, с которыми связаны эти поля.

Экспресс-вкладка **Дополнительные поля сообщения** позволяет добавить предварительно определенные дополнительные поля, которые относятся к сообщениям.

Экспресс-вкладка **Роли безопасности** позволяет настроить роли безопасности, которые заранее определены в системе для определенной обработки. Пользователи, имеющие определенную роль, будут видеть только обработку, определенную для этой роли.

Экспресс-вкладка **Пакет** позволяет настроить обработку для работы в пакетном режиме.

## <a name="work-with-the-electronic-messages-functionality"></a>Работа с функцией электронных сообщений

При работе на уровне сообщений страница **Электронные сообщения** (**Налог** \> **Запросы и отчеты** \> **Электронные сообщения** \> **Электронные сообщения**) является более полезной. При работе на уровне сбора данных (элемент сообщения) страница **Элементы электронного сообщения** (**Налог** \> **Запросы и отчеты** \> **Электронные сообщения** \> **Элементы электронного сообщения**) является более полезной.

### <a name="electronic-messages"></a>Электронные сообщения

Страница **Электронные сообщения** представляет действия, которые доступны для вас на основе вашей роли. Роли безопасности связаны с обработкой в настройке этой обработки. Для каждой обработки, которая вам доступна, эта страница отображает электронные сообщения и сведения, относящиеся к ним.

На экспресс-вкладке **Сообщения** отображаются электронные сообщения для выбранной обработки. В зависимости от статуса выбранного сообщения и заранее определенной обработки, можно выполнять некоторые действия, используя кнопки над сеткой:

- **Создать** — эта кнопка связана с действиями типа **Создать сообщение**.
- **Удалить** — эта кнопка доступна, если флажок **Разрешено удаление** выбран для текущего статуса выбранного сообщения.
- **Собрать данные** — эта кнопка связана с действиями типа **Заполнить записи**.
- **Создать отчет** — эта кнопка связана с действиями типа **Сообщение экспорта электронной отчетности**.
- **Отправить отчет** — эта кнопка связана с действиями типа **Веб-служба**.
- **Импорт ответа** — эта кнопка связана с действиями типа **Импорт электронной отчетности**.
- **Обновить статус** — эта кнопка связана с действиями типа **Пользовательская обработка на уровне сообщения**.
- **Элементы сообщения** — открытие страницы **Элементы электронного сообщения**.

На экспресс-вкладке **Журнала действий** отображаются сведения обо всех действиях, которые были выполнены для выбранного сообщения. Если действие вызвало ошибку, сведения об ошибке присоединяются к связанной строке в сетке. Для просмотра сведений об ошибке выберите строку в сетке, затем выберите кнопку **Вложение** (символ скрепки) в верхнем правом углу страницы.

На экспресс-вкладке **Дополнительные поля сообщения** отображаются все дополнительные поля, которые определены для сообщений в настройке обработки. Она также показывает значения этих дополнительных полей.

На экспресс-вкладке **Элементы сообщения** отображаются все элементы сообщения, связанные с выбранным сообщением. В зависимости от статуса выбранного элемента сообщения можно выполнять некоторые действия, используя кнопки над сеткой:

- **Удалить** — эта кнопка доступна, если флажок **Разрешено удаление** выбран для текущего статуса выбранного элемента сообщения.
- **Обновить статус** — эта кнопка связана с действиями типа **Обработка пользователя**.
- **Исходный документ** — открытие страницы, на которой отображается исходный документ для выбранного элемента сообщения.

Все отчеты, которые уже созданы и получены для сообщения, присоединяются к этому сообщению. Для просмотра вложений, которые связаны с сообщением, выберите сообщение, затем выберите кнопку **Вложение** (символ скрепки) в верхнем правом углу страницы.

![Кнопка вложений](media/attachment-icon.png)

На странице **Вложения** отображаются все вложения, которые относятся к выбранному сообщению. Чтобы просмотреть файл, выберите его в списке слева, затем выберите **Открыть** в области действий.

![Кнопка "Открыть"](media/open-button.png)

Можно также просмотреть вложения, связанные с определенным действием, которое было ранее выполнено для сообщения. На странице **Электронные сообщения** выберите сообщение на экспресс-вкладке **Сообщения**, выберите действие на экспресс-вкладке **Журнал действий**, затем выберите кнопку **Вложение** в верхнем правом углу страницы.

Также можно выполнить полную обработку или только определенное действие, выбрав **Выполнить обработку** в области действий.

### <a name="electronic-message-items"></a>Элементы электронного сообщения

На странице **Элементы электронного сообщения** представлены все элементы сообщения и журнал действий, которые были выполнены для каждого элемента сообщения. Она также показывает дополнительные поля, которые определены для элементов сообщения, и значения этих дополнительных полей.

В следующей таблице описаны поля на вкладке **Элементы сообщения**.

<table>
<thead>
<tr>
<th>Поле</th>
<th>описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>Обработка</td>
<td>Имя обработки, которая использовалась при создании элемента сообщения.</td>
</tr>
<tr>
<td>Элемент сообщения</td>
<td>Идентификатор элемента сообщения. Этот код присваивается автоматически на основе номерной серии <strong>Элемент сообщения</strong>, которая определена на странице <strong>Параметры главной книги</strong>.</td>
</tr>
<tr>
<td>Дата элемента сообщения</td>
<td>Дата создания элемента сообщения.</td>
</tr>
<tr>
<td>Тип элемента сообщения</td>
<td>Тип элемента сообщения. Можно настроить несколько типов элементов сообщений для этой и той же обработки (например, <strong>Входящие накладные</strong> и <strong>Исходящее накладные</strong>). Это поле может заполняться автоматически только в том случае, когда накладная добавляется в таблицу элементов сообщения.</td>
</tr>
<tr>
<td>Статус элемента сообщения</td>
<td>Фактический статус элемента сообщения. Доступные статусы зависят от типа элемента сообщения. Далее приводятся некоторые примеры.
<ul>
<li><strong>Заполнен</strong> — запись была добавлена в таблицу элементов сообщения.</li>
<li><strong>Вычислен</strong> — дополнительные атрибуты были рассчитаны для элемента сообщения.</li>
<li><strong>Сообщен</strong> — элемент сообщения был успешно добавлен в отчет.</li>
<li><strong>Исключен</strong> — этот статус может быть полезен, если необходимо исключить некоторые элементы сообщения из отчета до его экспорта.</li>
</ul>
</td>
</tr>
<tr>
<td>Дата передачи</td>
<td>Для обработки, которая автоматически передает сформированный отчета за пределы системы, это дата передачи элемента сообщения.</td>
</tr>
<tr>
<td>Номер документа</td>
<td>Это поле заполняется автоматически на основе настройки действия заполнения записей. Это поле может заполняться автоматически только в том случае, когда накладная добавляется в таблицу элементов сообщения.</td>
</tr>
<tr>
<td>Расчетный счет</td>
<td>Номер счета клиента или поставщика (или другое значение поля, в зависимости от поля, которое определено в действии заполнения записей). Это поле может заполняться автоматически только в том случае, когда накладная добавляется в таблицу элементов сообщения.</td>
</tr>
<tr>
<td>Сообщение</td>
<td>Номер сообщения. Этот номер присваивается автоматически на основе номерной серии <strong>Сообщение</strong>, которая определена на странице <strong>Параметры главной книги</strong>.</td>
</tr>
<tr>
<td>Статус сообщения</td>
<td>Фактический статус электронного сообщения.</td>
</tr>
<tr>
<td>Следующее действие</td>
<td>Следующие действия, которые могут быть запущены для текущего статуса элемента сообщения.</td>
</tr>
</tbody>
</table>

На вкладке **Дополнительные поля** отображаются дополнительные поля для выбранного элемента сообщения и их значения.

#### <a name="run-processing"></a>Выполнить обработку

Выберите **Выполнить обработку** в области действий для выполнения обработки для элементов сообщения. Чтобы выполнить определенное действие, в диалоговом окне **Выполнить обработку** задайте для параметра **Выберите действие** значение **Да**, затем выберите действие. Для выполнения всей обработки оставьте для параметра **Выберите действие** значение **Нет**.

#### <a name="generate-report"></a>Создать отчет

Выберите **Создать отчет** в области действий, чтобы создать отчет. Эта кнопка связана с действиями типа **Экспорт электронной отчетности**.

#### <a name="update-status"></a>Изменить статус

Выберите **Изменить статус** в области действий для обновления статуса одного или нескольких элементов сообщения. В диалоговом окне **Изменить статус** используйте экспресс-вкладку **Включаемые записи**, чтобы выбрать элементы сообщения для обновления. Убедитесь, что вы правильно определили критерии выбора, так как статусы элементов сообщения будут обновлены в соответствии с этими критериями, начальным статусом выбранного действия и указанным значением **Новый статус**. После завершения обновления статуса будет сложно определить, какие элементы были обновлены. Таким образом будет сложно выполнить откат обновления статуса.

#### <a name="electronic-messages"></a>Электронные сообщения

Выберите **Электронные сообщения** в области действий, чтобы просмотреть электронное сообщение, которое связано с выбранным элементом сообщения.

Можно также просмотреть все файлы, которые связаны с определенным элементом сообщения. Выберите поле **Сообщение** для элемента сообщения или выберите **Электронные сообщения** в области действий. Затем на странице **Электронное сообщение** выберите сообщение, для которого требуется просмотреть файлы, затем выберите кнопку **Вложение** (символ скрепки) в верхнем правом углу страницы.

![Кнопка вложений](media/attachment-icon.png)

На странице **Вложения** отображаются все вложения, которые относятся к сообщению. Чтобы просмотреть файл, выберите его в списке слева, затем выберите **Открыть** в области действий.

![Кнопка "Открыть"](media/open-button.png)

#### <a name="original-document"></a>Исходный документ

Выберите **Исходный документ** в области действий, чтобы открыть исходный документ для выбранного элемента сообщения.

## <a name="example-set-up-and-run-processing-to-call-a-simple-er-exporting-format-to-generate-an-excel-report"></a>Пример. Настройка и выполнение обработки для вызова простого формата экспорта электронной отчетности для создания отчета в формате Excel

После того как вы создали ваш формат электронной отчетности, сопоставили его с источниками данных и завершили его, его можно запустить с помощью рабочей области **Электронная отчетность**. Создается отчет, и его можно сохранить локально.

Чтобы контролировать следующие аспекты процесса отчетности, необходимо настроить обработку электронных сообщений:

- Регистрация сведений о том, кто создал отчет.
- Регистрация сведений о том, когда был создан отчет.
- Сохранение отчетов, которые были созданы для предыдущих периодов.

В этом разделе представлен пример, показывающий, каким образом можно настроить обмен электронными сообщениями для создания отчета на основе формата экспорта электронной отчетности для Excel. Если требуется выполнить этот пример, формат экспорта Excel электронной отчетности, должен быть уже создан, сопоставлен с источниками данных и завершен. Кроме того, номерная серия должна быть уже настроена для электронных сообщений.

При построении обработки полезно сначала определить действия обработки и статусы, которые будут настроены. На следующем рисунке показано, как выглядит обработка для этого примера.

![Схема обработки](media/processing-scheme.png)

#### <a name="create-message-statuses"></a>Создание статусов сообщений

1. Откройте **Налог \> Настройка \> Электронные сообщения \> Статусы сообщения**.
2. Создайте следующие статусы сообщения:

    - Новое
    - Подготовлено
    - Создано

    ![Статусы сообщения](media/message-statuses.png)

3. В строке для статуса **Новый** выберите флажок **Разрешено удаление**, чтобы разрешить пользователям удалять сообщения с этим статусом.

#### <a name="create-additional-fields"></a>Создать дополнительные поля

1. Откройте **Налог \> Настройка \> Электронные сообщения \> Дополнительные поля**.
2. Добавьте дополнительное поле и его значения. Рассмотрим пример:

    ![Дополнительные поля](media/additional-fields.png)

3. Задайте для параметра **Изменение пользователя** значение **Да**, чтобы пользователи могли изменять это поле.

#### <a name="create-message-processing-actions"></a>Создание действий обработки сообщения

В этом примере будут созданы следующие действия:

- **Создать сообщение**
- **Обновить до подготовленного**
- **Создать отчет**
- **Обновить до начального статуса** (необязательно)

1. Откройте **Налог \> Настройка \> Электронные сообщения \> Действия обработки сообщения**.
2. Создайте действие, которое называется **Создать сообщение**. На экспресс-вкладке **Общее** в поле **Тип действия** выберите **Создать сообщение**.
3. Создайте действие, которое называется **Обновить до подготовленного**, и задайте следующие поля:

    - На экспресс-вкладке **Общее** в поле **Тип действия** выберите **Пользовательская обработка на уровне сообщения**.
    - На экспресс-вкладке **Начальные статусы** в поле **Статус сообщения** выберите **Создать**.
    - На экспресс-вкладке **Полученные статусы** в поле **Статус сообщения** выберите **Подготовлено**. В поле **Тип отклика** введите **Выполнено успешно**.

4. Создайте действие, которое называется **Создать отчет**, и задайте следующие поля:

    - На экспресс-вкладке **Общее** в поле **Тип действия** выберите **Экспорт электронной отчетности**. В поле **Сопоставление формата** выберите формат экспорта электронной отчетности. Доступными вариантами являются **Excel**, **XML**, **JSON**, **Текст** и **Прочие**.
    - На экспресс-вкладке **Начальные статусы** в поле **Статус сообщения** выберите **Подготовлено**.
    - На экспресс-вкладке **Полученные статусы** в поле **Статус сообщения** выберите **Создано**. В поле **Тип отклика** введите **Выполнено успешно**.

    ![Действие "Создать отчет"](media/generate-report-action.png)

5. Необязательно: чтобы позволить пользователям повторно формировать отчет несколько раз, можно создать действие **Обновить до начального статуса** и задайте значения следующих полей:

    - На экспресс-вкладке **Общее** в поле **Тип действия** выберите **Пользовательская обработка на уровне сообщения**.
    - На экспресс-вкладке **Начальные статусы** в поле **Статус сообщения** выберите **Создано**.
    - На экспресс-вкладке **Статусы результатов** добавьте отдельную строку для каждого из двух статусов сообщений (**Подготовлено** и **Новое**). Для обеих строк установите в поле **Тип отклика** значение **Выполнено успешно**.

#### <a name="electronic-message-processing"></a>Обработка электронного сообщения

В этом примере все действия должны быть настроены таким образом, чтобы они выполнялись отдельно. Предполагается, что пользователь будет инициализировать каждое действие.

1. Откройте **Налог \> Настройка \> Электронные сообщения \> Обработка электронного сообщения**.
2. Добавьте запись для обработки, и добавьте все ранее определенные действия и дополнительное поле.
3. Необязательно: на экспресс-вкладке **Роли безопасности** определите роли безопасности для обработки, чтобы ограничить доступ к определенной отчетности.
4. Откройте **Налог \> Запросы и отчеты \> Электронные сообщения \> Электронные сообщения**.
5. Выберите **Создать**, чтобы создать сообщение. На этом этапе можно добавить даты и описание. Можно также обновить значение дополнительного поля до требуемого.

    ![Создание электронного сообщения](media/create-electronic-message.png)

Сетка на экспресс-вкладке **Журнал действий** автоматически заполняется с использованием журнала всех действий, выполненных для сообщения.

Теперь можно либо удалить, либо обновить статус сообщения. Чтобы обновить статус сообщения, выберите **Изменить статус**. В поле **Новый статус** выберите **Подготовлено**, затем выберите **OK**.

![Обновление статуса сообщения](media/update-status.png)

Статус сообщения обновляется до **Подготовлено**, и теперь можно создать отчет, выбрав **Создать отчет**. Создается отчет, и обновляются статус сообщения и журнал действий. Для просмотра созданного отчета выберите кнопку **Вложение** (символ скрепки) в верхнем правом углу страницы.

---
title: "Синхронизация оценок по проекту из Project Service Automation непосредственно с прогнозами по проекту Finance and Operations"
description: "В этой теме обсуждаются шаблоны и базовые задачи, которые используются для синхронизации оценок часов и оценок расходов по проекту непосредственно из Microsoft Dynamics 365 for Project Service Automation с Microsoft Dynamics 365 for Finance and Operations."
author: KimANelson
manager: AnnBe
ms.date: 04/02/2018
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-applications
ms.technology: 
audience: Application User
ms.reviewer: twheeloc
ms.search.scope: Core, Operations
ms.custom: 87983
ms.assetid: b454ad57-2fd6-46c9-a77e-646de4153067
ms.search.region: Global
ms.author: knelson
ms.search.validFrom: 2016-11-28
ms.dyn365.ops.version: AX 7.3.0
ms.translationtype: HT
ms.sourcegitcommit: bd8feff598cf80ca675c7d2b5dda636799b19e29
ms.openlocfilehash: 90501f40da0fdc66ad087b3bd746c908cc25711b
ms.contentlocale: ru-ru
ms.lasthandoff: 05/29/2018

---
# <a name="synchronize-project-estimates-from-project-service-automation-directly-to-project-forecasts-in-finance-and-operations"></a>Синхронизация оценок по проекту из Project Service Automation непосредственно с прогнозами по проекту Finance and Operations

В этой теме обсуждаются шаблоны и базовые задачи, которые используются для синхронизации оценок часов и оценок расходов по проекту непосредственно из Microsoft Dynamics 365 for Project Service Automation с Microsoft Dynamics 365 for Finance and Operations.

> [!NOTE]
> Dynamics 365 for Finance and Operations версии 8.0. доступна интеграция задач проекта, категорий проводок расходов, оценки часов, оценки затрат и блокировка функциональности.


## <a name="data-flow-for-project-service-automation-to-finance-and-operations"></a>Поток данных для Project Service Automation для Finance and Operations

Решение по интеграции Project Service Automation в Finance and Operations использует функцию интеграции данных для синхронизации данных между экземплярами Project Service Automation и Finance and Operations. Шаблоны интеграции, доступные при использовании функции интеграции данных, включают поток данных по оценкам часов и оценкам расходов по проекту из Project Service Automation в Finance and Operations.

На следующем рисунке показано, как данные синхронизируются между Project Service Automation и Finance and Operations.

[![Поток данных для интеграции Project Service Automation с Finance and Operations](./media/ProjectEstimatesFlow.png)](./media/ProjectEstimatesFlow.png)


## <a name="templates-and-tasks"></a>Шаблоны и задачи

Для доступа к доступным шаблонам в центре администрирования Microsoft PowerApps выберите **Проекты**и выберите в правом верхнем углу **Новый проект** для выбора общих шаблонов.

Следующий шаблон и базовые задачи используются для синхронизации оценок часов из Project Service Automation в Finance and Operations:

-  **Имя шаблона в интеграции данных:** Оценки часов по проекту (PSA в Fin and Ops)

-  **Имя задач в проекте:** 
    - Связи транзакции 
    - Оценки расходов

## <a name="entity-set"></a>Набор объектов

| Project Service Automation      | Finance and Operations                          |
|---------------------------------|-------------------------------------------------|
| Задачи по проекту                   | Объект интеграции для оценки часов проекта   |

## <a name="entity-flow"></a>Поток объектов

Оценки часов проекта управляются в Project Service Automation и синхронизируются с Finance and Operations как прогнозы часов проекта.

## <a name="preconditions"></a>Предварительные условия

Прежде чем синхронизация оценок часа проекта может произойти, вы должны синхронизировать проекты, проектные задачи и категории проводок затрат по проекту.

## <a name="power-query"></a>Power Query

Необходимо использовать Microsoft Power Query в шаблоне обновления оценок часов проекта:
- Установите **Код модели прогноза**, который будет использоваться, когда интеграции будет создавать новые прогнозы часов.
- Отфильтруйте любые записи, относящиеся к определенному ресурсу, в рамках задачи, которая не сможет осуществить интегграцию в прогнозы часов
- Отфильтруйте все строки категории пустой транзакции. Несоблюдение этого может привести к неправильным прогнозам часов.

### <a name="forecast-model-id"></a>Код прогнозной модели
Чтобы обновить вставленный в шаблон код прогнозной модели по умолчанию, щелкните стрелку **Сопоставить**, чтобы открыть соответствие. Выберите, чтобы открыть расширенный запрос и фильтрацию
- При использовании шаблона по умолчанию для шаблона оценок часов (PSA и Fin and Ops) выберите **Вставленное условие** в разделе **Примененные действия**. Выбрав **Функции**, замените **O_forecast** на имя **Код прогнозной модели**, которое должно использоваться при интеграции. Шаблон по умолчанию содержит код прогнозной модели в демонстрационных данных.
- При создании нового шаблона необходимо добавить этот столбец. Выберите **Добавить столбец с условиями** и присвойте столбцу имя, например ModelID. Введите условие для столбца где если Задача по проекту не null, то тогда<enter the forecast model ID>; еще равен null.

### <a name="filter-out-resource-specific-records"></a>Отфильтровать определенные записи ресурсов
Шаблон (PSA и Fin and Ops) оценок часов по проекту имеет фильтр по умолчанию, который удаляет любую конкретную запись ресурса предположительно создаваемого проекта. При создании собственного шаблона, необходимо добавить этот фильтр. В форме расширенный запрос и фильтрацию выберите фильтр по столбцу **msdyn_islinetask** для включения только записей **Ложь**.

### <a name="filter-out-empty-transaction-category-rows"></a>Отфильтруйте все строки категории пустой транзакции.
Необходимо добавить фильтр, чтобы удалить все строки, содержащие категории пустых проводок. Это необходимо независимо от того, используете ли вы шаблон по умолчанию или создали свой собственный шаблон. Этот фильтр удалит любые сводные строки, поступающие из Project Service Automation, которые могут привести к неверным прогнозам часов в Finance and Operations. В форме расширенного запроса и фильтрация чтобы отфильтровать записи со значением null в столбце выберите **msdyn_transactioncategory_value**.

## <a name="template-mapping-in-data-integration"></a>Сопоставление шаблона в интеграции данных

На следующем рисунке показан пример соответствия задания шаблона при интеграции данных. Соответствие показывает, какие данные полей будут синхронизированы из Project Service Automation в Finance and Operations.

[![Соответствие шаблона](./media/ProjectHourEstimatesMapping.jpg)](./media/ProjectHourEstimatesMapping.jpg)

Следующий шаблон и базовая задача используются для синхронизации оценок расходов из Project Service Automation в Finance and Operations:

-  **Имя шаблона в интеграции данных:** Оценки расходов по проекту (PSA в Fin and Ops)
-  **Имя задач в проекте:** 
     - Связи транзакции 
     - Оценки расходов

## <a name="entity-set"></a>Набор объектов

| Project Service Automation      | Finance and Operations                                     |
|---------------------------------|------------------------------------------------------------|
| Связи проводок         | Объект интеграции для связей проводок по проекту.   |
| Строки оценки                  | Объект интеграции для оценок расходов проекта.           |

## <a name="entity-flow"></a>Поток объектов

Оценки расходов проекта управляются в Project Service Automation и синхронизируются с Finance and Operations как прогнозы расходов проекта.

## <a name="prerequisites"></a>Необходимые условия

Прежде чем синхронизация оценок расходов проекта может произойти, вы должны синхронизировать проекты, проектные задачи и категории проводок затрат по проекту.

## <a name="power-query"></a>Power Query

Необходимо использовать Microsoft Power Query в шаблоне обновления оценок расходов проекта:
- Отфильтруйте для включения только записей оценки расходов
- Установите **Код модели прогноза**, который будет использоваться, когда интеграции будет создавать новые прогнозы часов.
- Преобразование типов выставления счетов.
- Преобразование типов проводок.

### <a name="filter-to-include-only-expense-estimate-lines"></a>Отфильтруйте для включения только строк оценки расходов
Шаблон (СРП Fin и Ops) оценки расходов проекта имеет фильтр по умолчанию для включения только строк расходов в интеграции. При создании собственного шаблона, необходимо добавить этот фильтр. Выберите задачу связи транзакции и щелкните стрелку **Сопоставление**. Выберите **Расширенная фильтрация и запросы**. Отфильтруйте столбец **msdyn_transactiontype1** для включения только **msdyn_estimateline**.

### <a name="forecast-model-id"></a>Код прогнозной модели
Чтобы обновить вставленный в шаблон код прогнозной модели по умолчанию, щелкните стрелку **Сопоставить** для задачи оценки расходов. Выберите, чтобы открыть расширенный запрос и фильтрацию
- При использовании шаблона по умолчанию для оценок расходов по проекту Microsoft (PSA и Fin and Ops) выберите сначала **Вставленное условие** в разделе **Примененные действия**. Выбрав **Функции**, замените **O_forecast** на имя **Код прогнозной модели**, которое должно использоваться при интеграции. Шаблон по умолчанию содержит код прогнозной модели в демонстрационных данных.
- При создании нового шаблона необходимо добавить этот столбец. Выберите **Добавить столбец с условиями** и присвойте столбцу имя, например ModelID. Введите условие для столбца, где код строки оценки не равен null, а затем < Введите код прогнозной модели >; еще равен null.

### <a name="transform-the-billing-types"></a>Преобразование типов выставления счетов
Шаблон оценки расходов проекта (PSA и Fin and Opss) имеет столбец с условиями, добавленный для преобразования типов выставления счетов, полученных от Project Service Automation во время интеграции.
- При создании собственного шаблона, необходимо добавить этот столбец с условиями. В форме расширенного запроса и фильтрации, выберите **Добавить столбец с условиями**. Назвать столбец, например «BillingType». Вставить следующее условие:

    Если **msdyn_billingtype** = 192350000, тогда **NonChargeable** и если **msdyn_billingtype** = 192350001, тогда **Включаемые в накладную** и если **msdyn_billingtype** = 192350002, тогда **благодарности** еще **NotAvailable**

### <a name="transform-the-transaction-types"></a>Преобразование типов проводок
Шаблон оценки расходов проекта (PSA и Fin and Opss) имеет столбец с условиями, добавленный для преобразования типов проводок, полученных от Project Service Automation во время интеграции.
- При создании собственного шаблона, необходимо добавить этот столбец с условиями. В форме расширенного запроса и фильтрации, выберите **Добавить столбец с условиями**. Назвать столбец, например «TransactionType». Условие для ввода является следующим: Если **msdyn_transactiontypecode** = 192350000, тогда **Затраты** и если **msdyn_transactiontypecode** = 192350005, то **Продажи** еще **null**

## <a name="template-mapping-in-data-integration"></a>Сопоставление шаблона в интеграции данных

На следующих рисунках показаны примеры соответствия задания шаблона при интеграции данных. Соответствие показывает, какие данные полей будут синхронизированы из Project Service Automation в Finance and Operations.

[![Соответствие шаблона](./media/ExpenseEstimateTransactionRelationshipsMapping.jpg)](./media/ExpenseEstimateTransactionRelationshipsMapping.jpg)

[![Соответствие шаблона](./media/ExpenseEstimatesMapping.jpg)](./media/ExpenseEstimatesMapping.jpg)





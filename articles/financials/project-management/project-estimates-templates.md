---
title: Синхронизация оценок по проекту напрямую из Project Service Automation в Finance and Operations
description: В этой теме обсуждаются шаблоны и базовые задачи, которые используются для синхронизации оценок часов и оценок расходов по проекту непосредственно из Microsoft Dynamics 365 for Project Service Automation в Microsoft Dynamics 365 for Finance and Operations.
author: KimANelson
manager: AnnBe
ms.date: 07/20/2018
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
audience: Application User
ms.reviewer: shylaw
ms.search.scope: Core, Operations
ms.custom: 87983
ms.assetid: b454ad57-2fd6-46c9-a77e-646de4153067
ms.search.region: Global
ms.author: knelson
ms.search.validFrom: 2016-11-28
ms.dyn365.ops.version: AX 7.3.0
ms.openlocfilehash: 21338b889e0377dbfd5adfd461ea81b39a75baf8
ms.sourcegitcommit: 9d4c7edd0ae2053c37c7d81cdd180b16bf3a9d3b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "1556560"
---
# <a name="synchronize-project-estimates-directly-from-project-service-automation-to-finance-and-operations"></a>Синхронизация оценок по проекту напрямую из Project Service Automation в Finance and Operations

[!include[banner](../includes/banner.md)]

В этой теме обсуждаются шаблоны и базовые задачи, которые используются для синхронизации оценок часов и оценок расходов по проекту непосредственно из Microsoft Dynamics 365 for Project Service Automation в Dynamics 365 for Finance and Operations.

> [!NOTE]
> - В Microsoft Dynamics 365 for Finance and Operations версии 8.0 доступна интеграция задач проекта, категорий проводок расходов, оценки часов, оценки затрат и блокировка функциональности.
> - Интеграция фактических данных доступна в Microsoft Dynamics 365 for Finance and Operations версии 8.0.1 или новее.
> - При использовании Microsoft Dynamics 365 for Finance and Operations, Enterprise edition 7.3.0, после установки обновлений КБ 4132657 и 4132660 КБ, можно использовать шаблоны для интеграции задачи проекта, категорий транзакций расходов, оценок часов, оценок расходов и фактических данных и для настройки функции блокировки. Если необходимо сбросить распределения по бухгалтерским счетам, рекомендуется также установить КБ 4131710.

## <a name="data-flow-for-project-service-automation-to-finance-and-operations"></a>Поток данных для Project Service Automation для Finance and Operations

Решение по интеграции Project Service Automation в Finance and Operations использует функцию интеграции данных для синхронизации данных между экземплярами Project Service Automation и Finance and Operations. Шаблоны интеграции, доступные при использовании функции интеграции данных, включают поток данных по оценкам часов и оценкам расходов по проекту из Project Service Automation в Finance and Operations.

На следующем рисунке показано, как данные синхронизируются между Project Service Automation и Finance and Operations.

[![Поток данных для интеграции Project Service Automation с Finance and Operations](./media/ProjectEstimatesFlow.png)](./media/ProjectEstimatesFlow.png)

## <a name="project-hour-estimates"></a>Оценки часов по проекту

### <a name="template-and-tasks"></a>Шаблон и задачи

Для доступа к доступным шаблонам в центре администрирования Microsoft PowerApps выберите **Проекты** и выберите в правом верхнем углу **Новый проект** для выбора общих шаблонов.

Следующий шаблон и базовые задачи используются для синхронизации оценок часов из Project Service Automation в Finance and Operations:

- **Имя шаблона в интеграции данных:** Оценки часов по проекту (PSA в Fin and Ops)
- **Имя задач в проекте:**

    - Связи транзакции
    - Оценки расходов

### <a name="entity-set"></a>Набор объектов

| Project Service Automation | Finance and Operations                        |
|----------------------------|-----------------------------------------------|
| Задачи по проекту              | Объект интеграции для оценки часов проекта |

### <a name="entity-flow"></a>Поток объектов

Оценки часов проекта управляются в Project Service Automation и синхронизируются с Finance and Operations как прогнозы часов проекта.

### <a name="prerequisites"></a>Необходимые условия

Прежде чем синхронизация оценок часа проекта может произойти, вы должны синхронизировать проекты, проектные задачи и категории проводок затрат по проекту.

### <a name="power-query"></a>Power Query

В шаблоне оценок часов проекта необходимо использовать Microsoft Power Query для Excel для выполнения следующих задач:

- Установите код модели прогноза по умолчанию, который будет использоваться, когда интеграции будет создавать новые прогнозы часов.
- Отфильтруйте любые записи, относящиеся к определенному ресурсу, в рамках задачи, которая не сможет осуществить интеграцию в прогнозы часов.
- Отфильтруйте все строки категории пустой транзакции. Невыполнение этой задачи может привести к неправильным прогнозам часов.

#### <a name="set-the-default-forecast-model-id"></a>Задание кода прогнозной модели по умолчанию

Чтобы обновить вставленный в шаблон код прогнозной модели по умолчанию, щелкните стрелку **Сопоставить**, чтобы открыть соответствие. Затем выберите ссылку **Расширенный запрос и фильтрация**.

- При использовании шаблона по умолчанию для шаблона оценок часов проекта (PSA и Fin and Ops) выберите **Вставленное условие** в списке **Примененные действия**. В записи **Функция** замените **O\_forecast** на имя код прогнозной модели, которое должно использоваться при интеграции. Шаблон по умолчанию содержит код прогнозной модели в демонстрационных данных.
- При создании нового шаблона необходимо добавить этот столбец. В Power Query выберите **Добавить столбец с условиями** и введите имя для нового столбца, такое как **ModelID**. Введите условие для столбца, где, если задача проекта не равна null, затем \<введите код прогнозной модели\>; в противном случае null.

#### <a name="filter-out-resource-specific-records"></a>Отфильтровать определенные записи ресурсов

Шаблон (PSA и Fin and Ops) оценок часов по проекту имеет фильтр по умолчанию, который удаляет любую конкретную запись ресурса предположительно создаваемого проекта. При создании собственного шаблона, необходимо добавить этот фильтр. Выберите ссылку **Расширенный запрос и фильтрация** для фильтрации по столбцу **msdyn\_islinetask**, чтобы только записи **False** (Ложь) были включены.

#### <a name="filter-out-empty-transaction-category-rows"></a>Отфильтруйте все строки категории пустой транзакции.

Необходимо добавить фильтр, чтобы удалить все строки, которые содержат категории пустых проводок. Эта задача обязательна, независимо от того, используете ли вы шаблон по умолчанию или создали свой собственный шаблон. Этот фильтр удаляет любые сводные строки, поступающие из Project Service Automation, которые могут привести к неверным прогнозам часов в Finance and Operations. Выберите ссылку **Расширенный запрос и фильтрация**, чтобы отфильтровать записи со значением null в столбце **msdyn\_transactioncategory\_value**.

### <a name="template-mapping-in-data-integration"></a>Сопоставление шаблона в интеграции данных

На следующем рисунке показан пример соответствия задания шаблона при интеграции данных. Соответствие показывает, какие данные полей будут синхронизированы из Project Service Automation в Finance and Operations.

[![Соответствие шаблона](./media/ProjectHourEstimatesMapping.jpg)](./media/ProjectHourEstimatesMapping.jpg)

## <a name="project-expense-estimates"></a>Оценки расходов по проектам

### <a name="template-and-tasks"></a>Шаблон и задачи

Следующий шаблон и базовые задачи используются для синхронизации оценок расходов из Project Service Automation в Finance and Operations:

- **Имя шаблона в интеграции данных:** Оценки расходов по проекту (PSA в Fin and Ops)
- **Имя задач в проекте:**

    - Связи транзакции 
    - Оценки расходов

### <a name="entity-set"></a>Набор объектов

| Project Service Automation | Finance and Operations                                   |
|----------------------------|----------------------------------------------------------|
| Связи проводок    | Объект интеграции для связей проводок по проекту |
| Строки оценки             | Объект интеграции для оценок расходов проекта         |

### <a name="entity-flow"></a>Поток объектов

Оценки расходов проекта управляются в Project Service Automation и синхронизируются с Finance and Operations как прогнозы расходов проекта.

### <a name="prerequisites"></a>Необходимые условия

Прежде чем синхронизация оценок расходов проекта может произойти, вы должны синхронизировать проекты, проектные задачи и категории проводок затрат по проекту.

### <a name="power-query"></a>Power Query

В шаблоне оценок расходов по проекту необходимо использовать Power Query для выполнения следующих задач:

- Отфильтруйте для включения только записей оценки расходов.
- Установите код модели прогноза по умолчанию, который будет использоваться, когда интеграции будет создавать новые прогнозы часов.
- Преобразование типов выставления счетов.
- Преобразование типов проводок.

#### <a name="filter-to-include-only-expense-estimate-lines"></a>Отфильтруйте для включения только строк оценки расходов

Шаблон (СРП Fin и Ops) оценки расходов проекта имеет фильтр по умолчанию, который включает только строки расходов в интеграцию. При создании собственного шаблона, необходимо добавить этот фильтр. Выберите задачу **Связи транзакции**, затем щелкните стрелку **Сопоставление**, чтобы открыть сопоставление. Выберите ссылку **Расширенный запрос и фильтрация**. Отфильтруйте столбец **msdyn\_transactiontype1**, чтобы он включал только **msdyn\_estimateline**.

#### <a name="set-the-default-forecast-model-id"></a>Задание кода прогнозной модели по умолчанию

Чтобы обновить вставленный в шаблон код прогнозной модели по умолчанию, выберите задачу **Оценки расходов**, затем щелкните стрелку **Сопоставить**, чтобы открыть сопоставление. Выберите ссылку **Расширенный запрос и фильтрация**.

- При использовании шаблона по умолчанию для оценок расходов по проекту (PSA и Fin and Ops) в Power Query выберите сначала **Вставленное условие** в разделе **Примененные действия**. В записи **Функция** замените **O\_forecast** на имя код прогнозной модели, которое должно использоваться при интеграции. Шаблон по умолчанию содержит код прогнозной модели в демонстрационных данных.
- При создании нового шаблона необходимо добавить этот столбец. В Power Query выберите **Добавить столбец с условиями** и введите имя для нового столбца, такое как **ModelID**. Введите условие для столбца, где код строки оценки не равен null, а затем \<введите код прогнозной модели\>; в противном случае null.

#### <a name="transform-the-billing-types"></a>Преобразование типов выставления счетов

Шаблон оценки расходов проекта (PSA и Fin and Opss) включает столбец с условиями, который используется для преобразования типов выставления счетов, полученных от Project Service Automation во время интеграции. При создании собственного шаблона, необходимо добавить этот столбец с условиями. Выберите ссылку **Расширенный запрос и фильтрация**, затем выберите **Добавить столбец с условиями**. Введите имя для нового столбца, например **BillingType**. Затем введите следующее условие:

If **msdyn\_billingtype** = 192350000, then **NonChargeable**  
else if **msdyn\_billingtype** = 192350001, then **Chargeable**  
else if **msdyn\_billingtype** = 192350002, then **Complimentary**  
else **NotAvailable**

#### <a name="transform-the-transaction-types"></a>Преобразование типов проводок

Шаблон оценки расходов проекта (PSA и Fin and Opss) включает столбец с условиями, который используется для преобразования типов проводки, полученных от Project Service Automation во время интеграции. При создании собственного шаблона, необходимо добавить этот столбец с условиями. Выберите ссылку **Расширенный запрос и фильтрация**, затем выберите **Добавить столбец с условиями**. Введите имя для нового столбца, например **TransactionType**. Затем введите следующее условие:

If **msdyn\_transactiontypecode** = 192350000, then **Cost**  
else if **msdyn\_transactiontypecode** = 192350005, then **Sales**  
else **null**

### <a name="template-mapping-in-data-integration"></a>Сопоставление шаблона в интеграции данных

На следующих рисунках показаны примеры соответствия задания шаблона при интеграции данных. Соответствие показывает, какие данные полей будут синхронизированы из Project Service Automation в Finance and Operations.

[![Соответствие шаблона](./media/ExpenseEstimateTransactionRelationshipsMapping.jpg)](./media/ExpenseEstimateTransactionRelationshipsMapping.jpg)

[![Соответствие шаблона](./media/ExpenseEstimatesMapping.jpg)](./media/ExpenseEstimatesMapping.jpg)

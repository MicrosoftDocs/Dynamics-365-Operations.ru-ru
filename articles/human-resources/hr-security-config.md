---
title: Основные понятия настройки безопасности для интеграций на основе виртуальных таблиц
description: В этой статье описывается архитектура для создания интеграции между Microsoft Dynamics 365 Human Resources и другими системами.
author: twheeloc
ms.date: 11/19/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: CDSIntegrationAdministration
audience: Application User
ms.custom: 7521
ms.assetid: ''
ms.search.region: Global
ms.author: twheeloc
ms.search.validFrom: 2020-10-05
ms.dyn365.ops.version: Human Resources
ms.openlocfilehash: 219ceb0adae0cee5f74a39140ab74af9fdac1eb6
ms.sourcegitcommit: ea79bf014bbf495ac8e28db29502c8bd85a75f32
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/11/2022
ms.locfileid: "9759659"
---
# <a name="security-configuration-concepts-for-virtual-table-based-integrations"></a>Основные понятия настройки безопасности для интеграций на основе виртуальных таблиц

[!include [Applies to Human Resources](../includes/applies-to-hr.md)]

В этой статье описывается архитектура использования [виртуальных таблиц (сущностей) Microsoft Dataverse](/dev-itpro/power-platform/virtual-entities-overview) для создания интеграции между Dynamics 365 Human Resources и системой третьей стороны. Основной темой статьи является конфигурация безопасности, а также аспекты проверки подлинности и авторизации, которые необходимы между границами системы для создания функциональной защищенной системы.

## <a name="prerequisite-reference-articles"></a>Статьи, с которыми рекомендуется ознакомиться

В следующих статьях представлены дополнительные сведения о концепциях из этой статьи:

- [Обзор виртуальных объектов](/dev-itpro/power-platform/virtual-entities-overview)
- [Начало работы с виртуальными таблицами (сущностями)](/developer/data-platform/virtual-entities/get-started-ve)
- [Использование аутентификации сервер-сервер в нескольких клиентах (Microsoft Dataverse)](/developer/data-platform/use-multi-tenant-server-server-authentication)
- [Использование проверки подлинности OAuth с Microsoft Dataverse (Dataverse)](/developer/data-platform/authenticate-oauth)
- [Поток учетных данных клиента OAuth 2.0 на платформе Microsoft Identity](/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow)
- [Проверка подлинности и авторизация](/dev-itpro/power-platform/authentication-and-authorization)

## <a name="architecture"></a>Архитектура 

На следующей архитектурной схеме показаны основные понятия, связанные с интеграцией, использующей виртуальные таблицы (сущности).

![Интеграция на основе виртуальных таблиц.](./media/Hosts.jpg)

Вот объяснение некоторых элементов в предыдущей диаграмме:

- **Microsoft** — Microsoft размещает и работает с различными продуктами Dynamics 365 от имени клиентов.

    - **Клиент C Azure Active Directory (Azure AD)** — клиент Azure AD, принадлежащий Microsoft. Это клиент, в котором зарегистрированы приложения Dynamics 365.

- **Партнер по интеграции**

    - **Интегрируемая система** – система, интегрируемая с Dynamics 365. Это может быть система зарплаты или любая система, которая использует данные, хранящиеся в Dynamics 365.
    - **Адаптер** — программное обеспечение или услуга, которые являются ответственными за взаимодействие с Dynamics 365 и интегрируемой системой.

        > [!NOTE]
        > Если адаптер предназначен для использования несколькими клиентами Dynamics 365, предполагается, что он будет зарегистрирован как приложение нескольких клиентов в Azure AD.

    - **Клиент A Azure AD** — клиент Azure AD, который принадлежит партнеру интегрирования. Это клиент, в котором зарегистрирован ИД приложения адаптера.

- **Взаимный клиент** — клиент, который реализует Dynamics 365 Human Resources и решение интегрируемого партнера.

    - **Dynamics 365 Finance или Human Resources** — клиентский экземпляр Dynamics 365 Finance или Human Resources, который содержит данные клиента, необходимые для интегрируемой системы.
    - **Dataverse** — зависящая от клиента среда Dataverse, которая связана с Finance или Human Resources. Dataverse предоставляет веб-API для взаимодействия с данными Dynamics 365.
    - **Клиент B Azure AD** — клиент Azure AD клиента. Он выступает в качестве поставщика удостоверений (сервер авторизации) и выдает маркеры, которые позволяют вызывающим объектам вызывать экземпляр Dataverse клиента.

## <a name="basic-request-flow"></a>Основной поток запросов

В этом разделе описывается основной поток типичного запроса, который участвует в интеграции. Он ссылается на архитектурную схему, приведенную ранее в этой статье.

Для обычного запроса требуется, чтобы адаптер запрашивал данные в Dynamics 365, затем сохранял и синхронизировал эти данные в интегрируемой системе.

1. Адаптер вызывает веб-API Dataverse для запроса необходимых данных.

    > [!NOTE]
    > Проверка подлинности является необходимым условием, и основной частью процесса является получение маркера. Проверка подлинности будет описана в разделе [Проверка подлинности и авторизация на границах системы](#authentication-and-authorization-at-system-boundaries).

    Этот вызов осуществляется веб-API Dataverse для запроса данных приложения, предоставляемых через виртуальную таблицу. (См. "2. Начальная синхронизация" и "3. Дельта-синхронизация" в схеме.)

2. Dataverse обрабатывает запрос путем запроса виртуальной таблицы через подключаемый модуль виртуальных сущностей ("Прокси-сервер виртуальной таблицы" на схеме). Запрос Dataverse направляется в службу виртуальных сущностей Finance или Human Resources, чтобы запросить данные, физически хранящиеся в базе данных Finance или Human Resources.
3. Служба виртуальных сущностей Finance или Human Resources переводит запрос по виртуальной сущности в запрос относительно сущности Finance или Human Resources, которая лежит в основе виртуальной сущности Dataverse. Данные извлекаются из базы данных, переводятся обратно в представление сущности Dataverse и возвращаются вызывающему объекту.
4. Адаптер выполняет все необходимые функции сопоставления и переноса данных и выполняет вызов интегрируемой системы для сохранения данных в базе данных интегрируемой системы. (См. "4. Сохранение данных" в схеме.)

## <a name="authentication-and-authorization-at-system-boundaries"></a>Проверка подлинности и авторизация на границах системы

*Проверка подлинности* удостоверяет, что удостоверение пользователя или приложения было проверено, и подтверждает, что пользователь или приложение действительно являются теми, за кого они себя выдают. *Авторизация* предоставляет пользователю или приложению право доступа к отдельным разрешениям уровня приложения. Дополнительные сведения см. в разделе [Проверка подлинности и авторизация](/azure/active-directory/develop/authentication-vs-authorization).

Большинство вызовов между системами на архитектурной схеме, приведенной ранее в этой статье, требуют адаптера. Адаптер должен удостоверять свою подлинность, чтобы выполнить следующие вызовы:

- Вызов в Dataverse
- Вызов в интегрируемую систему

Посмотрите на границы системы на схеме. Для каждого веб-запроса между системами должна быть выполнена проверка подлинности, а перед возвратом данных вызывающему объекту должны быть переданы проверки авторизации на уровне приложения. Для запроса виртуальной таблицы Dynamics 365, в основе которой лежит Finance или Human Resources, проверки подлинности и авторизации применяются на следующих границах системы:

- Вызов между адаптером и конечной точкой веб-интерфейса Dataverse (OData)
- Вызов между подключаемым модулем виртуальных сущностей Dataverse и службой виртуальной сущности Finance или Human Resources

В обоих случаях проверки подлинности выполняются первыми. Затем выполняются проверки авторизации на уровне приложений, чтобы гарантировать, что пользователь или приложение, прошедшее проверку подлинности, имеет правильные привилегии уровня приложения для получения запрошенных данных.

Проверка подлинности для вызова Dataverse осуществляется через маркер носителя, который должен быть включен в качестве заголовка НТТР в веб-запрос в Dataverse. Адаптер должен иметь маркер из экземпляра Azure AD клиента B. (См. "1. Получите маркер" на схеме.) Azure AD выступает в качестве поставщика удостоверений в потоке проверки подлинности.

Проверка подлинности адаптера осуществляется путем указания своего идентификатора приложения (не секретного, зарегистрированного в клиенте A Azure AD) и секрета или сертификата приложения, который есть только у приложения адаптера.

После того как пользователь или приложение прошли проверку подлинности для выполнения вызовов Dataverse, проверки авторизации на уровне Dataverse выполняются для каждого запроса. Эти проверки обеспечивают, что вызывающий объект (удостоверение приложения адаптера, которое обозначено "\<guid A\>" на схеме) имеют соответствующие разрешения приложения. Авторизация на уровне приложений управляется Dataverse через пользователя приложения, представляющего идентификатор приложения адаптера. Управление разрешениями уровня приложения осуществляется путем предоставления доступа к специальным ролям приложения, определенным Dataverse. Эти роли предоставляют детализированные привилегии для приложения.

Более подробные инструкции см. в разделе [Использование аутентификации сервер-сервер в нескольких клиентах](/power-apps/developer/data-platform/use-multi-tenant-server-server-authentication).

Если пройдены проверки разрешений для приложения на уровне Dataverse, подключаемый модуль виртуальных сущностей выполняет вызов конечной точки службы виртуальных сущностей в среде Finance или Human Resources. Для выполнения этого вызова используется проверка подлинности между серверами (S2S). Она использует удостоверение и секрет, настроенные в записи конфигурации службы виртуального источника данных для управления финансами и операциями.

![Запись конфигурации виртуального источника данных для управления финансами и операциями в среде песочницы.](./media/sandbox.jpg)

Дополнительные сведения см. в разделе [Настройка виртуальных сущностей Dataverse](/dev-itpro/power-platform/admin-reference).

Вызов из подключаемого модуля виртуальной сущности Dataverse в Finance или Human Resources включает удостоверение адаптера для исходного вызова в Dataverse из адаптера (идентификатор, обозначенный "\<guid A\>" на архитектурной схеме). Если источник данных виртуальной сущности настроен правильно, а проверки подлинности S2S пройдены, служба виртуальной сущности в Finance или Human Resources будет выполнять запрос в контексте исходного вызывающего объекта (адаптера, \<guid A\>). Проверки разрешений приложения (авторизация) на уровне Finance или Human Resources будут выполняться, чтобы гарантировать, что адаптер имеет привилегии, необходимые для доступа к сущностям данных, запрашиваемым в ходе выполнения запроса.

Управление безопасностью Finance и Human Resources осуществляется следующими способами:

1. Сопоставляя удостоверение адаптера (\<guid A\>) с определенным пользователем Finance и Human Resources. Это сопоставление выполняется на странице **Приложения Azure Active Directory**. Дополнительные сведения см. в разделе [Регистрация внешнего приложения](/dev-itpro/data-entities/services-home-page.md#register-your-external-application).
2. Предоставляя пользователю Finance или Human Resources соответствующие роли, обязанности и привилегии уровня приложения. Дополнительные сведения см. в разделе [Безопасность на основе ролей](/dev-itpro/sysadmin/role-based-security).

Если приложению адаптера (\<guid A\>) предоставлены привилегии, необходимые для доступа к запрашиваемым данным, происходят следующие события:

1. Выполняется запрос.
2. Данные переводятся обратно на их страницу сущности Dataverse.
3. Данные возвращаются адаптеру.

> [!IMPORTANT]
> Во время разработки адаптер может работать с использованием пользователя Finance или Human Resources, которым назначена роль администратора. Однако в рабочей среде этот адаптер никогда не должен запускаться с правами администратора.

## <a name="key-takeaways"></a>Основные итоги

Ниже приведены некоторые важные следствия использования архитектуры виртуальных таблиц или сущностей:

- Управление конфигурацией безопасности для виртуальных таблиц, которые создаются на основе Human Resources, осуществляется в Human Resources.
- Клиент ("обоюдный клиент" на архитектурной схеме ранее в этой статье) обладает полным контролем над привилегиями, предоставляемых удостоверению адаптера интеграции (обозначенный "\<guid A\>" на схеме).
- Клиент несет ответственность за правильную настройку безопасности для своей среды Human Resources. Партнер по интеграции, создающий адаптер, должен предоставить указания о привилегиях, необходимых для этого адаптера.

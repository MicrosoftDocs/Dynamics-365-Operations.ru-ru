---
title: "Конструктор формул в электронной отчетности"
description: "В этом разделе описывается, как использовать конструктор формул в электронной отчетности (ER)."
author: NickSelin
manager: AnnBe
ms.date: 11/27/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-platform
ms.technology: 
ms.search.form: ERDataModelDesigner, ERExpressionDesignerFormula, ERMappedFormatDesigner, ERModelMappingDesigner
audience: Application User, IT Pro
ms.reviewer: kfend
ms.search.scope: Core, Operations
ms.custom: 58771
ms.assetid: 24223e13-727a-4be6-a22d-4d427f504ac9
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-02-28
ms.dyn365.ops.version: AX 7.0.0
ms.translationtype: HT
ms.sourcegitcommit: efcb77ff883b29a4bbaba27551e02311742afbbd
ms.openlocfilehash: 3988c437afda3d57e56a03264d3c1588af497920
ms.contentlocale: ru-ru
ms.lasthandoff: 05/08/2018

---

# <a name="formula-designer-in-electronic-reporting"></a>Конструктор формул в электронной отчетности

[!include [banner](../includes/banner.md)]

В этом разделе описывается, как использовать конструктор формул в электронной отчетности (ER). При проектировании формата для определенного электронного документа в ER можно использовать формулы для преобразования данных, чтобы они отвечали требованиям для выполнения и форматирования этого документа. Эти формулы напоминают формулы в Microsoft Excel. В формулах поддерживаются различные типы функций: текст, дата и время, математические логические, информация, преобразование типа данных, и другое (характерные для конкретных бизнес-доменов функции).

## <a name="formula-designer-overview"></a>Обзор конструктора формул

Электронная отчетность (ER) поддерживает конструктор формул. Поэтому во время разработки имеется возможность задать выражения, которые можно использовать для выполнения следующих задач во время выполнения:

- Преобразование данных, полученных из базы данных Microsoft Dynamics 365 for Finance and Operations, которые должны вводить в модель данных ER, играющую роль источника данных для форматов ER. (Например, эти преобразования могут содержать фильтрацию, группирование и преобразование типов данных.)
- Форматирование данных, которые должны быть отправлены в генерирующий электронный документ в соответствии с макетом и условиями определенного формата электронной отчетности. (Например, форматирование может быть выполнено в соответствии с затребованным языком, культурой или кодировкой.)
- Управление процессом создания электронных документов. (Например, выражения могут включать или отключать вывод конкретных элементов формата, в зависимости от обрабатываемых данных. Они также могут прерывать процесс создания документа или выдавать сообщения пользователям.)

Страницу **Конструктор формул** можно открыть при выполнении любого из следующих действий:

- Связывание элементов источника данных с компонентами модели данных.
- Связывание элементов источника данных с компонентами формата.
- Завершение обслуживания вычисляемых полей, которые являются частью источников данных.
- Определение условий видимости для параметров пользовательского ввода.
- Разработка преобразований формата.
- Определение условий включения для компонентов формата.
- Определение имен файлов для компонентов FILE формата.
- Определение условий для проверок управления процессом.
- Определение текста сообщения для проверок управления процессом.

## <a name="designing-er-formulas"></a>Конструирование формул ER

### <a name="data-binding"></a>Привязка данных

Конструктор формул ER можно использовать для определения выражения, которое конвертирует данные, полученные от источников данных, таким образом, чтобы эти данные можно было ввести в потребителе данных во время выполнения:

- Из источников данных Finance and Operations и параметров времени выполнения в модель данных ER
- Из модели данных ER в формат ER
- Из источников данных Finance and Operations и параметров времени выполнения в формат ER

На следующем рисунке показана разработка выражения этого типа. В этом примере выражение округляет значение поля **Intrastat.AmountMST** таблицы Интрастат в Finance and Operations до двух десятичных знаков, и затем возвращает округленное значение.

[![Привязка данных](./media/picture-expression-binding.jpg)](./media/picture-expression-binding.jpg)

На следующем рисунке показано, как может использоваться выражение этого типа. В этом примере результат сконструированного выражения вводится в компоненте **Transaction.InvoicedAmount** модели данных **Модель налоговой отчетности**.

[![Используемая привязка данных](./media/picture-expression-binding2.jpg)](./media/picture-expression-binding2.jpg)

Во время выполнения созданная формула **ROUND (Intrastat.AmountMST, 2)** округляет значение поля **AmountMST** для каждой записи в таблице Интрастат до двух десятичных разрядов. Затем она вводит округленное значение в компонент **Transaction.InvoicedAmount** модели данных **Налоговая отчетность**.

### <a name="data-formatting"></a>Формат данных

Конструктор формул ER можно использовать для определения выражения, которое форматирует данные, полученные от источников данных, таким образом, чтобы эти данные можно было отправить как часть создания электронного документа. Может иметься форматирование, которое должно применяться как типовое правило, которое должно быть повторно использовано для формата. В этом случае можно ввести это форматирование один раз в конфигурации формата как именованное преобразование, имеющее выражение форматирования. Позднее это именованное преобразование можно связывать с многими компонентами формата, выходные данные в которых должны форматироваться в соответствии с созданным выражением форматирования.

На следующем рисунке показана разработка преобразования этого типа. В этом примере преобразование **TrimmedString** усекает входящие данные типа данных **String**, удаляя ведущие и конечные пробелы. Затем оно возвращает значение усеченной строки.

[![Преобразование](./media/picture-transformation-design.jpg)](./media/picture-transformation-design.jpg)

На следующем рисунке показано, как может использоваться преобразование этого типа. В данном примере несколько компонентов формата отправляют текст как выходные данные для создания электронного документа во время выполнения. Все эти компоненты формата ссылаются на преобразование **TrimmedString** по имени.

[![Используемое преобразование](./media/picture-transformation-usage.jpg)](./media/picture-transformation-usage.jpg)

Когда компоненты формата, такие как компонент **partyName** на предыдущем рисунке, ссылаются на преобразование **TrimmedString**, это преобразование отправляет текст как выходные данные в создающий электронный документ. Этот текст не включает начальные и конечные пробелы.

Если у вас есть форматирование, которое должно применяться индивидуально, его можно внедрить как отдельное выражение привязки определенного компонента "формат". На следующем рисунке показано выражение этого типа. В этом примере компонент формата **partyType** привязан к источнику данных через выражение, преобразующее входящие данные из поля **Model.Company.RegistrationType** в источнике данных в текст в верхнем регистре. Выражение затем отправляет этот текст как выходные данные в электронный документ.

[![Применение форматирования к отдельному компоненту](./media/picture-binding-with-formula.jpg)](./media/picture-binding-with-formula.jpg)

### <a name="process-flow-control"></a>Управление процессом

Конструктор формул ER может использоваться для определения выражений для управления процессом формирования электронных документов. Можно выполнить следующие задачи.

- определения условий, определяющий, когда процесс создания документа должен быть остановлен.
- задания выражений, которые либо будут создавать сообщения для пользователя об остановленных процессах, либо записывать сообщения в журнал выполнения о продолжении процесса формирования отчетности;
- Определение имен файлов генерируемых электронных документов и управление условиями их создания.

Каждое из правил управления процессом конструируется в виде отдельной валидации. На следующем рисунке показана проверка этого типа. Здесь объяснение конфигурации в этом примере:

- Проверка производится, когда узел **INSTAT** создан во время создания XML-файла.
- Если список транзакций пуст, проверка останавливает процесс выполнения и возвращает значение **FALSE**.
- Проверка возвращает сообщение об ошибке, которое включает текст метки SYS70894 в Finance and Operations на языке, предпочитаемом пользователем.

[![Проверка](./media/picture-validation.jpg)](./media/picture-validation.jpg)

Конструктор формул GER используется также для создания имени файла для формируемого электронного документа и управления процессом создания файла. На следующем рисунке показана разработка управления процессом этого типа. Здесь объяснение конфигурации в этом примере:

- Список записей из источника данных **model.Intrastat** разделен на пакеты. Каждый пакет содержит до 1000 записей.
- Выпуск создает ZIP-файл, который содержит один файл в формате XML для каждой партии, который была создана.
- Выражение возвращает имя файла для генерации электронных документов путем объединения имени файла и расширения имени файла. Для второй партии и всех последующих партий имя файла содержит код партии в качестве суффикса.
- Выражение включает (возвратом значения **TRUE**) процесс создания файла для тех пакетов, которые содержат хотя бы одну запись.

[![Управление файлом](./media/picture-file-control.jpg)](./media/picture-file-control.jpg)

### <a name="basic-syntax"></a>Базовый синтаксис

Выражения ER могут содержать любые или все из следующих элементов:

- Константы
- Операторы
- Ссылки
- Пути
- Функции

#### <a name="constants"></a>Константы

При конструировании выражений можно использовать текстовые и числовые константы (т. е., значения, которые не вычисляются). Например, выражение **VALUE ("100") + 20** использует числовую константу **20** и строковую константу **"100"** и возвращает числовое значение **120**. Конструктор формул электронной отчетности (ER) поддерживает escape-последовательности. Таким образом, можно указать строку выражения, которая должна обрабатываться по-разному. Например, выражение **"Лев Толстой ""Война и мир"" Том 1"** возвращает следующую текстовую строку: **Лев Толстой "Война и мир" Том 1**.

#### <a name="operators"></a>Операторы

В следующей таблице показаны арифметические операторы, которые можно использовать для выполнения основных математические операции, например сложение, вычитание, умножение и деление.

| Оператор | Значение               | Пример |
|----------|-----------------------|---------|
| +        | Сложение              | 1+2     |
| -        | Вычитание, отрицание | 5-2, -1 |
| \*       | Умножение        | 7\*8    |
| /        | Подразделение              | 9/3     |

В следующей таблице показываются поддерживаемые операторы сравнения. Эти операторы можно использовать для сравнения двух значений.

| Оператор | Значение                  | Пример    |
|----------|--------------------------|------------|
| =        | Одинаковые                    | X=Y        |
| &gt;     | Больше             | X&gt;Y     |
| &lt;     | Меньше                | X&lt;Y     |
| &gt;=    | Больше или равен | X&gt;=Y    |
| &lt;=    | Меньше или равен    | X&lt;=Y    |
| &lt;&gt; | Не равно             | X&lt;&gt;Y |

Кроме того, можно использовать амперсанд (&) как оператор связывания текста. Таким образом можно соединить (сцепить) одну или несколько текстовых строк в единый фрагмент текста.

| Оператор | Значение     | Пример                                             |
|----------|-------------|-----------------------------------------------------|
| &        | Объединить | "Нет данных для печати" & ":&nbsp;" & "записи не найдены" |

##### <a name="operator-precedence"></a>Приоритет операторов

Порядок, в котором оцениваются части составного выражения, важен. Например, результат выражения **1 + 4 / 2** различается в зависимости от того, выполняться ли первой операция сложения или операция деления. Можно использовать скобки для точного определения, как выражение рассчитывается. Например, чтобы указать, что операция сложения должна быть выполнена первой, вы можете изменить предшествующее выражение на **(1 + 4) / 2**. Если не указать явно порядок операций, которые необходимо выполнить в выражении, порядок основан на приоритете по умолчанию, назначенный поддерживаемым операторам. В следующей таблице показан приоритет, который назначен каждому оператору. Операторы, которые имеют более высокий приоритет (например, 7) вычисляются перед операторами с более низким приоритетом (например, 1).

| Приоритет | Операторы      | Синтаксис                                                                  |
|------------|----------------|-------------------------------------------------------------------------|
| 7          | Группировка       | ( … )                                                                   |
| 6          | Доступ к членам  | … . …                                                                   |
| 5          | Вызов функции  | … ( … )                                                                 |
| 4          | Умножение | … \* …<br>… / …                                                         |
| 3          | Дополняющая       | … + …<br>… - …                                                          |
| 2          | Сравнение     | … &lt; …<br>… &lt;= …<br>… =&gt; …<br>… &gt; …<br>… = …<br>… &lt;&gt; … |
| 1          | Разделение     | … , …                                                                   |

Если выражение содержит несколько последовательных операторов, которые имеют одинаковый приоритет, эти операции вычисляются слева направо. Например, выражение **1 + 6 / 2 \* 3 &gt; 5** возвращает **true**. Рекомендуется использовать скобки для явного указания необходимого порядка операций в выражениях, чтобы выражения было проще читать и обслуживать.

#### <a name="references"></a>Ссылки

Все источники данных текущего компонента ER, доступные в ходе разработки выражения, можно использовать как именованные ссылки. (Текущий компоненту ER может быть моделью или форматом.) Например, текущая модель данных ER содержит источник данных **ReportingDate**, и этот источник данных возвращает значение типа данных **DATETIME**. Для правильного форматирования этого значения в создаваемом документе можно указать источник данных в выражении как **DATETIMEFORMAT (ReportingDate, "dd-MM-yyyy")**.

Всем символам в имени ссылающегося источника данных, которые не представляют букву алфавита, должен предшествовать знак одинарной кавычки ('). Если имя ссылающегося источника данных содержит хотя бы один символ, который не является буквой алфавита, имя необходимо заключить в одинарные кавычки. (Например, символы, не являющиеся буквами алфавита, могут быть знаками препинания или любыми другими записанными символами.) Вот некоторые примеры:

- На источник данных **Today’s date & time** в выражении ER необходимо ссылаться следующим образом: **'Today''s date & time’**.
- На метод **name()** источника данных **Customers** в выражении ER необходимо ссылаться следующим образом: **Customers.'name()'**

Если методы источников данных Finance and Operations имеют параметры, для вызова этих методов используется следующий синтаксис:

- Если метод **isLanguageRTL** источника данных **System** имеет параметр **EN-US** типа данных **String**, этот метод следует указывать в выражении ER как **System.'isLanguageRTL'("EN-US")**.
- Кавычки не требуются, если имя метода содержит только буквенно-цифровые символы. Однако они являются обязательными для метода таблицы, если имя содержит скобки.

При добавлении источника данных **System** в сопоставление ER, которое относится к классу **Global** приложения Finance and Operations, выражение возвращает логическое значение **FALSE**. Измененное выражение **System.' isLanguageRTL'("AR")** возвращает логическое значение **TRUE**.

Можно ограничить способ, которым значения передаются в параметры метода этого типа:

- В методы этого типа могут передаваться только константы. Значения констант определяются во время разработки.
- Для параметров этого типа поддерживаются только простые (основные) типы. (Простые типы данных — это целое число, вещественное число, логическое значение, строка и т. д.)

#### <a name="paths"></a>Пути

Когда выражение ссылается на структурированный источник данных, можно использовать определение пути для выбора конкретного примитивного элемента этого источника данных. Символ точки (.) используется для разделения отдельных элементов структурированного источника данных. Например, текущая модель данных ER содержит источник данных **InvoiceTransactions**, и этот источник данных возвращает список записей. Структура записи **InvoiceTransactions** содержит поля **AmountDebit** и **AmountCredit**, и оба этих поля возвращают числовые значения. Поэтому выражение для вычисления суммы по накладной может быть построено следующим образом: **InvoiceTransactions.AmountDebit - InvoiceTransactions.AmountCredit**.

#### <a name="functions"></a>Функции

В следующих разделах описаны функции, которые можно использовать в выражениях ER. Все источники данных контекста выражения (текущие модель данных ER или формат ER) могут использоваться в качестве параметров вызывающих функций в соответствии со списком аргументов вызывающей функции. Константы также могут использоваться как параметры вызывающих функций. Например, текущая модель данных ER содержит источник данных **InvoiceTransactions**, и этот источник данных возвращает список записей. Структура записи **InvoiceTransactions** содержит поля **AmountDebit** и **AmountCredit**, и оба этих поля возвращают числовые значения. Поэтому выражение для вычисления суммы по накладной может быть построено с использованием встроенной функции округления ER: **ROUND (InvoiceTransactions.AmountDebit - InvoiceTransactions.AmountCredit, 2)**.

## <a name="supported-functions"></a>Поддерживаемые функции

В следующей таблице описаны функции обработки данных, которые можно использовать для создания моделей данных ER и отчетов о ER. Список функций не является фиксированным. Разработчики могут расширить его. Для просмотра списка функций, которые вы используете, откройте область функций в конструкторе формул ER.

### <a name="date-and-time-functions"></a>Функции даты и времени

| Функция | Описание | Пример |
|----------|-------------|---------|
| ADDDAYS (дата и время, дни) | Добавление определенного количества дней к указанному значению даты/времени. | **ADDDAYS (NOW(), 7)** возвращает дату и время на 7 дней в будущем. |
| DATETODATETIME (дата) | Преобразование указанного значения даты в значение даты/времени. | **DATETODATETIME (CompInfo. 'getCurrentDate()')** возвращает текущую дату сессии Finance and Operations 24 декабря 2015 как **12/24/2015 12:00:00 AM**. В этом примере **CompInfo** представляет собой источник данных ER типа **Finance and Operations/Table** и ссылается на таблицу CompanyInfo. |
| NOW () | Возврат текущих даты и времени сервера приложений Finance and Operations в качестве значения даты/времени. | |
| TODAY () | Возврат текущей даты сервера приложений Finance and Operations в качестве значения даты. | |
| NULLDATE () | Возврат значения даты **null**. | |
| NULLDATETIME () | Возврат значение даты/времени **null**. | |
| DATETIMEFORMAT (дата и время, формат) | Преобразование указанного значения даты/времени в строку в указанном формате. (Сведения о поддерживаемых форматах см. разделы [стандартный](https://msdn.microsoft.com/en-us/library/az4se3k1(v=vs.110).aspx) и [настраиваемый](https://msdn.microsoft.com/en-us/library/8kb3ddd4(v=vs.110).aspx).) | **DATETIMEFORMAT (NOW(), "дд-ММ-гггг")** возвращает текущую дату сервера приложений Finance and Operations, 24 декабря 2015, как **"24-12-2015"**, на основе указанного настраиваемого формата. |
| DATETIMEFORMAT (дата и время, формат, культура) | Преобразование указанного значения даты/времени в строку в указанном формате и [культуре](https://msdn.microsoft.com/en-us/goglobal/bb896001.aspx). (Сведения о поддерживаемых форматах см. в разделах [стандартный](https://msdn.microsoft.com/en-us/library/az4se3k1(v=vs.110).aspx) и [настраиваемый](https://msdn.microsoft.com/en-us/library/8kb3ddd4(v=vs.110).aspx)). | **DATETIMEFORMAT (NOW(), "d", "de")** возвращает текущую дату сервера приложений Finance and Operations, 24 декабря 2015, как **"24.12.2015"**, на основе выбранного немецкого языкового стандарта. |
| SESSIONTODAY () | Возврат даты текущей сессии Finance and Operations в качестве значения даты. | |
| SESSIONNOW () | Возврат даты и времени текущей сессии Finance and Operations в качестве значения даты/времени. | |
| DATEFORMAT (дата, формат) | Возвращает строковое представление указанной даты в указанном формате. | **DATEFORMAT (SESSIONTODAY (), "dd-MM-yyyy")** возвращает дату текущей сессии Finance and Operations, 24 декабря 2015, как **"24-12-2015"**, на основе указанного настраиваемого формата. |
| DATEFORMAT (дата, формат, культура) | Преобразование указанного значения даты в строку в указанном формате и [культуре](https://msdn.microsoft.com/en-us/goglobal/bb896001.aspx). (Сведения о поддерживаемых форматах см. в разделах [стандартный](https://msdn.microsoft.com/en-us/library/az4se3k1(v=vs.110).aspx) и [настраиваемый](https://msdn.microsoft.com/en-us/library/8kb3ddd4(v=vs.110).aspx)). | **DATETIMEFORMAT (SESSIONNOW (), "d", "de")** возвращает дату текущей сессии Finance and Operations, 24 декабря 2015, как **"24.12.2015"**, на основе выбранного немецкого языкового стандарта. |
| DAYOFYEAR (дата) | Возвращает целочисленное представление числа дней между 1 января и указанной датой. | **DAYOFYEAR (DATEVALUE ("01-03-2016", "dd-MM-yyyy"))** возвращает **61**. **DAYOFYEAR (DATEVALUE ("01-01-2016", "dd-MM-yyyy"))** возвращает **1**. |
| DAYS (дата 1, дата 2) | Возвращает число дней между первой указанной датой и второй указанной датой. Возвращает положительное значение, если первая дата позднее второй даты, возвращает **0** (ноль), когда первая дата равна второй дате, или возвращает отрицательное значение в противном случае. | **DAYS (TODAY (), DATEVALUE( DATETIMEFORMAT( ADDDAYS(NOW(), 1), "yyyyMMdd"), "yyyyMMdd"))** возвращает **-1**. |

### <a name="data-conversion-functions"></a>Функции преобразования данных

| Функция | описание | Пример |
|----------|-------------|---------|
| DATETODATETIME (дата) | Преобразование указанного значения даты в значение даты/времени. | **DATETODATETIME (CompInfo. 'getCurrentDate()')** возвращает текущую дату сессии Finance and Operations 24 декабря 2015 как **12/24/2015 12:00:00 AM**. В этом примере **CompInfo** представляет собой источник данных ER типа **Finance and Operations/Table** и ссылается на таблицу CompanyInfo. |
| DATEVALUE (строка, формат) | Возвращает представление в виде даты для указанной строки в указанном формате. | **DATEVALUE ("21-декабря-2016", "дд-МММ-гггг")** возвращает дату 21 декабря 2016 в соответствии с указанным настраиваемым форматом и культурой приложения по умолчанию **EN-US**. |
| DATEVALUE (строка, формат, культура) | Возвращает представление даты для указанной строки в указанных формате и культуре. | **DATEVALUE ("21-Gen-2016", "dd-MMM-yyyy", "IT")** возвращает дату 21 января 2016 на основе указанных пользовательского формата и культуры. Однако вызов **DATEVALUE ("21-Gen-2016", "dd-MMM-yyyy", "EN-US")** вызывает исключение, информирующее пользователя, что указанная строка не распознана как допустимая дата. |
| DATETIMEVALUE (строка, формат) | Возвращает представление в виде даты/времени для указанной строки в указанном формате. | **DATETIMEVALUE ("21-Dec-2016 02:55:00", "dd-MMM-yyyy hh:mm:ss")** возвращает 2:55:00 AM 21 декабря 2016 на основе указанного пользовательского формата и культуры приложения по умолчанию **EN-US**. |
| DATETIMEVALUE (строка, формат, культура) | Возвращает представление даты/времени для указанной строки в указанных формате и культуре. | **DATETIMEVALUE ("21-Gen-2016 02:55:00", "dd-MMM-yyyy hh:mm:ss", "IT")** возвращает 2:55:00 AM 21 декабря 2016 на основе указанных пользовательского формата и культуры. Однако вызов **DATETIMEVALUE ("21-Gen-2016 02:55:00", "dd-MMM-yyyy hh:mm:ss", "EN-US")** вызывает исключение, информирующее пользователя, что указанная строка не распознана как допустимая дата/время. |

### <a name="list-functions"></a>Функции для работы со списками

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>Функция</th>
<th>описание</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SPLIT (ввод, длина)</td>
<td>Разделение указанной строки ввода на подстроки, каждая из которых имеет заданную длину. Возврат результата как новый список.</td>
<td><strong>SPLIT (&quot;abcd&quot;, 3)</strong> возвращает новый список, который состоит из 2 записей, которые имеют поле <strong>STRING</strong>. Поле в первой записи содержит текст <strong>&quot;abc&quot;</strong>, и поле во второй записи содержит текст <strong>&quot;d&quot;</strong>.</td>
</tr>
<tr class="even">
<td>SPLITLIST (список, номер)</td>
<td>Разделение указанного списка на партии, каждый из содержит заданный количество записей. Возврат результата как новый список партий, который содержит следующие элементы:
<ul>
<li>Партии как регулярные списки (компонент <strong>Значение</strong>)</li>
<li>Номер текущего пакета (компонент <strong>BatchNumber</strong>)</li>
</ul></td>
<td>На следующем рисунке источник данных <strong>Строки</strong> создается как список записей из трех записей. Этот список разделяется на пакеты, каждый из которых содержит до двух записей.
<p><a href="./media/picture-splitlist-datasource.jpg"><img src="./media/picture-splitlist-datasource.jpg" alt="Data source that is divided into batches" class="alignnone wp-image-290681 size-full" width="397" height="136" /></a></p>
<p>На следующем рисунке показан созданный макет формата. В этом макете формата привязки к источнику данных <strong>Строки</strong> создаются для создания выходных данных в формате XML. Эти выходные данные представляют отдельные узлы для каждого пакета и записей в нем.</p>
<p><a href="./media/picture-splitlist-format.jpg"><img src="./media/picture-splitlist-format.jpg" alt="Format layout that has bindings to a data source" class="alignnone wp-image-290691 size-full" width="374" height="161" /></a></p>
<p>На следующем рисунке показан результат выполнения созданного формата.</p>
<a href="./media/picture-splitlist-result.jpg"><img src="./media/picture-splitlist-result.jpg" alt="Result of running the format" class="alignnone wp-image-290701 size-full" width="358" height="191" /></a></td>
</tr>
<tr class="odd">
<td>LIST (запись 1 [, запись 2, …])</td>
<td>Возвращает новый список, который создан из определенных аргументов.</td>
<td><strong>LIST (model.MainData, model.OtherData)</strong> возвращает пустую запись, где список полей содержит все поля списков записей <strong>MainData</strong> и <strong>OtherData</strong>.</td>
</tr>
<tr class="even">
<td>LISTJOIN (список 1, список 2, …)</td>
<td>Возвращает соединенный список, который создан из списков определенных аргументов.</td>
<td><strong>LISTJOIN (SPLIT (&quot;abc&quot;, 1), SPLIT (&quot;def&quot;, 1))</strong> возвращает список из шести записей, где одно поле типа данных <strong>STRING</strong> содержит по одной букве.</td>
</tr>
<tr class="odd">
<td>ISEMPTY (список)</td>
<td>Возврат <strong>TRUE</strong>, если указанный список не содержит никаких элементов. В противном случае возврат <strong>FALSE</strong>.</td>
<td></td>
</tr>
<tr class="even">
<td>EMPTYLIST (список)</td>
<td>Возврат пустого списка с использованием указанного списка в качестве источника для структуры списка.</td>
<td><strong>EMPTYLIST (SPLIT (&quot;abc&quot;, 1))</strong> возвращает новый пустой список, который имеет такую же структуру, как список, который возвращен функцией <strong>SPLIT</strong>.</td>
</tr>
<tr class="odd">
<td>FIRST (список)</td>
<td>Возврат первой записи определенного списка, если эта запись не пуста. В противном случае создается исключение.</td>
<td></td>
</tr>
<tr class="even">
<td>FIRSTORNULL (список)</td>
<td>Возврат первой записи определенного списка, если эта запись не пуста. В противном случае возврат записи <strong>NULL</strong>.</td>
<td></td>
</tr>
<tr class="odd">
<td>LISTOFFIRSTITEM (список)</td>
<td>Возврат списка, содержащий только первый элемент указанного списка.</td>
<td></td>
</tr>
<tr class="even">
<td>ALLITEMS (путь)</td>
<td>Возврат нового плоского список, представляющий все элементы, соответствующие указанному пути. Путь должен быть определен как действительный путь источника данных для элемента источника данных с типом данных списка записей. Элементы данных, такие как строка пути и дата, должны вызывать ошибку в построителе выражения ER во время разработки.</td>
<td>Если ввести <strong>SPLIT(&quot;abcdef&quot; , 2)</strong> в качестве источника данных (DS), <strong>COUNT( ALLITEMS (DS.Value))</strong> возвращает <strong>3</strong>.</td>
</tr>
<tr class="odd">
<td>ORDERBY (список [,выражение 1, выражение 2, …])</td>
<td>Возврат указанного списка после его сортировки в соответствии с указанными аргументами. Эти аргументы могут определяться как выражения.</td>
<td>Если <strong>Поставщик</strong> настраивается в качестве источника данных ER, который ссылается на таблицу VendTable, <strong>ORDERBY (Vendors, Vendors.&#39;name()&#39;)</strong> возвращает список поставщиков, который отсортирован по имени в восходящем порядке.</td>
</tr>
<tr class="even">
<td>REVERSE (список)</td>
<td>Возврат указанного списка в обращенном порядке сортировки.</td>
<td>Если <strong>Поставщик</strong> настраивается в качестве источника данных ER, который ссылается на таблицу VendTable, <strong>REVERSE (ORDERBY (Vendors, Vendors.&#39;name()&#39;)) )</strong> возвращает список поставщиков, который отсортирован по имени в нисходящем порядке.</td>
</tr>
<tr class="odd">
<td>WHERE (список, условие)</td>
<td>Возврат указанного списка после его фильтрации в соответствии с указанным условием. Указанное условие применяется к списку в памяти. Таким образом, функция <strong>WHERE</strong> отличается от функции <strong>FILTER</strong>.</td>
<td>Если <strong>Поставщик</strong> настраивается в качестве источника данных ER, который ссылается на таблицу VendTable, <strong>WHERE(Vendors, Vendors.VendGroup = &quot;40&quot;)</strong> возвращает список только поставщиков, которые относятся к группе поставщиков 40.</td>
</tr>
<tr class="even">
<td>ENUMERATE (список)</td>
<td>Возврат нового списка, состоящей из перечисленных записей определенного списка, и с использованием следующие элементов:
<ul>
<li>Определенные записи списка как регулярные списки (компонент <strong>Значение</strong>)</li>
<li>Индекс текущей записи (<strong>Номер</strong> компонента)</li>
</ul></td>
<td>На следующем рисунке источник данных <strong>Enumerated</strong> создается как нумерованный список записей поставщика из источника данных <strong>Vendors</strong>, который ссылается на таблицу VendTable.
<p><a href="./media/picture-enumerate-datasource.jpg"><img src="./media/picture-enumerate-datasource.jpg" alt="Enumerated data source" class="alignnone wp-image-290711 size-full" width="387" height="136" /></a></p>
<p>На следующем рисунке показан формат. В этом формате привязки данных создаются для создания выходных данных в формате XML. Эти выходные данные представляют отдельных поставщиков как перечислимые узлы.</p>
<p><a href="./media/picture-enumerate-format.jpg"><img src="./media/picture-enumerate-format.jpg" alt="Format that has data bindings" class="alignnone wp-image-290721 size-full" width="414" height="138" /></a></p>
<p>На следующем рисунке показан результат выполнения созданного формата.</p>
<a href="./media/picture-enumerate-result.jpg"><img src="./media/picture-enumerate-result.jpg" alt="Result of running the format" class="alignnone wp-image-290731 size-full" width="567" height="176" /></a></td>
</tr>
<tr class="odd">
<td>COUNT (список)</td>
<td>Возврат количества записей определенного списка, если список не пуст. В противном случае возврат <strong>0</strong> (ноль).</td>
<td><strong>COUNT (SPLIT(&quot;abcd&quot; , 3))</strong> возвращает <strong>2</strong>, поскольку функция <strong>SPLIT</strong> создает список, который состоит из двух записей.</td>
</tr>
<tr class="even">
<td>LISTOFFIELDS (путь)</td>
<td>Возвращает список записей, который создается из аргумента одного из следующих типов:
<ul>
<li>Перечисление модели</li>
<li>Перечисление форматов</li>
<li>Тара</li>
</ul>
<p>Созданный список состоит из записей, которые имеют следующие поля:</p>
<ul>
<li>Наименование</li>
<li>Этикетка</li>
<li>описание</li>
</ul>
Во время выполнения поля <strong>Метка</strong> и <strong>Описание</strong> возвращают значения, основанные на настройках языка для формата.</td>
<td>На следующем рисунке показано перечисление, введенное в модели данных.
<p><a href="./media/ger-listoffields-function-model-enumeration.png"><img src="./media/ger-listoffields-function-model-enumeration-e1474545790761.png" alt="Enumeration in a model" class="alignnone wp-image-1203943 size-full" width="514" height="155" /></a></p>
<p>Следующая иллюстрация показывает эти детали:</p>
<ul>
<li>Перечисление модели, вставленное в отчет в качестве источника данных.</li>
<li>Выражение ER использует перечисление модели как параметр функции <strong>LISTOFFIELDS</strong>.</li>
<li>Источник данных типа списка записей вставляется в отчет с помощью созданного выражения ER.</li>
</ul>
<p><a href="./media/ger-listoffields-function-in-format-expression.png"><img src="./media/ger-listoffields-function-in-format-expression-e1474546110395.png" alt="Format" class="alignnone wp-image-1204033 size-full" width="549" height="318" /></a></p>
<p>В следующем примере показано элементы формата электронной отчетности, которые привязаны к источнику данных типа списка записей, который был создан с помощью функции <strong>LISTOFFIELDS</strong>.</p>
<p><a href="./media/ger-listoffields-function-format-design.png"><img src="./media/ger-listoffields-function-format-design.png" alt="Format design" class="alignnone size-full wp-image-1204043" width="466" height="221" /></a></p>
<p>На следующем рисунке показан результат выполнения созданного формата.</p>
<p><a href="./media/ger-listoffields-function-format-output.png"><img src="./media/ger-listoffields-function-format-output.png" alt="Format output" class="alignnone size-full wp-image-1204053" width="585" height="158" /></a></p>
<blockquote>[!NOTE]<br>
На основе параметров языка родительских элементов формата FILE и FOLDER переведенный текст для меток и описаний вводится в выходные данные формата электронной отчетности.</blockquote></td>
</tr>
<tr class="odd">
<td>LISTOFFIELDS (путь, язык)</td>
<td>Возвращает список записей, созданный из аргумента, например перечисление модели, перечисление формата или контейнер. Созданный список состоит из записей, которые имеют следующие поля:
<ul>
<li>Наименование</li>
<li>Этикетка</li>
<li>описание</li>
<li>Переведено</li>
</ul>
<p>Во время выполнения поля <strong>Метка</strong> и <strong>Описание</strong> возвращают значения, основанные на параметрах языка для формата и указанного языка. Поле <strong>Переведено</strong> указывает, что поле <strong>Метка</strong> было переведено на указанный язык.</td>
<td>Например, можно использовать тип источника данных <strong>Вычисляемое поле</strong> для настройки источников данных <strong>enumType_de</strong> и <strong>enumType_deCH</strong> для перечисления модели данных <strong>enumType</strong>:
<ul>
<li>enumType_de = <strong>LISTOFFIELDS</strong> (enumType, &quot;de&quot;)</li>
<li>enumType_deCH = <strong>LISTOFFIELDS</strong> (enumType, &quot;de-CH&quot;)</li>
</ul>
В этом случае можно использовать следующее выражение для получения метки значения перечисления на немецком языке (Швейцария), если этот перевод доступен. Если перевод на немецкий язык (Швейцария) недоступен, метка будет на немецком языке: <strong>IF (NOT (enumType_deCH.IsTranslated), enumType_de.Label, enumType_deCH.Label)</strong>.</td>
</tr>
<tr class="even">
<td>STRINGJOIN (список, имя поля, разделитель)</td>
<td>Возвращает строку, состоящую из связанных значений указанного поля из указанного списка. Значения разделяются указанным разделителем.</td>

<td>Если ввести <strong>SPLIT(&quot;abc&quot; , 1)</strong> в качестве источника данных (DS), выражение <strong>STRINGJOIN (DS, DS.Value, &quot;:&quot;)</strong> возвращает <strong>&quot;a</strong><strong>:b</strong><strong>:c&quot;</strong>.</td>

</tr>
<tr class="odd">
<td>SPLITLISTBYLIMIT (список, значение предела, источник предела)</td>
<td>Разделяет указанный список на новый список подсписков и возвращает результаты в содержимом списка записей. Параметр предельного значения определяет значение предела для разделения исходного списка. Параметр предела источника определяет шаг, на котором увеличивается общая сумма. Предел не применяется к одному элементу исходного списка, если источник предела превышает заданный предел.</td>
<td>На следующих рисунках показана формат и источники данных, которые используются для него. 
<p><a href="./media/ger-splitlistbylimit-format.png"><img src="./media/ger-splitlistbylimit-format.png" alt="Format" class="alignnone size-full wp-image-1204063" width="396" height="195" /></a></p>
<p><a href="./media/ger-splitlistbylimit-datasources.png"><img src="./media/ger-splitlistbylimit-datasources.png" alt="Data sources" class="alignnone size-full wp-image-1204073" width="320" height="208" /></a></p>
<p>На следующем рисунке показан результат выполнения формата. В этом случае выводится плоский список товарных номенклатур.</p>
<p><a href="./media/ger-splitlistbylimit-output.png"><img src="./media/ger-splitlistbylimit-output.png" alt="Output" class="alignnone size-full wp-image-1204083" width="462" height="204" /></a></p>
<p>На следующих рисунках этот же формат был скорректирован для представления списка товарных номенклатур в партиях, когда одна партия может содержать товары с общим весом, который не должен превышать 9.</p>
<p><a href="./media/ger-splitlistbylimit-format-1.png"><img src="./media/ger-splitlistbylimit-format-1.png" alt="Adjusted format" class="alignnone size-full wp-image-1204103" width="466" height="438" /></a></p>
<p><a href="./media/ger-splitlistbylimit-datasources-1.png"><img src="./media/ger-splitlistbylimit-datasources-1.png" alt="Data sources for the adjusted format" class="alignnone size-full wp-image-1204093" width="645" height="507" /></a></p>
<p>На следующем рисунке показан результат выполнения скорректированного формата.</p>
<p><a href="./media/ger-splitlistbylimit-output-1.png"><img src="./media/ger-splitlistbylimit-output-1.png" alt="Output of the adjusted format" class="alignnone size-full wp-image-1204113" width="676" height="611" /></a></p>
<blockquote>[!NOTE]<br>
Предел не применяется к последнему элементу исходного списка, так как значение (11) источника предела (вес) превышает заданный предел (9). Используйте функцию <strong>WHERE</strong> или выражение <strong>Включено</strong> соответствующего элемента формата, чтобы игнорировать (пропустить) подсписки во время создания отчета по мере необходимости.</blockquote></td>
</tr>
<tr class="even">
<td>FILTER (список, условие)</td>
<td>Возврат указанного списка после изменения запроса для фильтрации в соответствии с указанным условием. Эта функция отличается от функции <strong>WHERE</strong>, так как указанное условие применяется на уровне базы данных к любому источнику данных ER с типом <strong>Записи таблицы</strong>. Список и условие могут определяться с помощью таблиц и связей.</td>
  <td>Если <strong>Поставщик</strong> настраивается в качестве источника данных ER, который ссылается на таблицу VendTable, <strong>FILTER(Vendors, Vendors.VendGroup = &quot;40&quot;)</strong> возвращает список только поставщиков, которые относятся к группе поставщиков 40. Если <strong>Поставщик</strong> настроен в качестве источника данных ER, который ссылается на таблицу <strong>VendTable</strong> и <strong>parmVendorBankGroup</strong>, настроенный как источник данных ER возвращает значение строкового типа данных, <strong>FILTER (Vendor.&#39;&lt;Relations&#39;.VendBankAccount, Vendor.&#39;&lt;Relations&#39;.VendBankAccount.BankGroupID = parmVendorBankGroup)</strong> возвращает список только счетов поставщиков, входящих в конкретную банковскую группу.</td>
</tr>
</tbody>
</table>

### <a name="logical-functions"></a>Логические функции

| Функция | описание | Пример |
|----------|-------------|---------|
| CASE (выражение, параметр 1, результат 1 \[, параметр 2, результат 2\] … \[, результат по умолчанию\]) | Оценка указанного значения выражения относительно указанных альтернативных вариантов. Возврат результата параметра, который равен значению выражения. В противном случае возвращается необязательный результат по умолчанию, если результат по умолчанию указан. (Результат по умолчанию — это последний параметр, перед которым не указан параметр (вариант).) | **CASE( DATETIMEFORMAT( NOW(), "MM"), "10", "WINTER", "11", "WINTER", "12", "WINTER", "")** возвращает строку **"WINTER"**, когда текущая дата сеанса Finance and Operations — между октябрем и декабрем. В противном случае она возвращает пустую строку. |
| ЕСЛИ (условие, значение 1, значение 2) | Возврат первого указанного значения, когда выполняется указанное условие. В противном случае возвращается второе указанное значение. Если значение 1 и значение 2 — записи или списки записей, результат имеет только поля, существующие в обоих списках. | **IF (1=2, "condition is met", "condition is not met")** возвращает строку **"condition is not met"**. |
| NOT (условие) | Возврат обратного логического значения указанного состояния. | **NOT (TRUE)** возвращает **FALSE**. |
| AND (условие 1\[, условие 2, …\]) | Возврат **TRUE**, если *все* определенные условия верны. В противном случае возврат **FALSE**. | **AND (1=1, "a"="a")** возвращает **TRUE**. **AND (1=2, "a"="a")** возвращает **FALSE**. |
| OR (условие 1\[, условие 2, …\]) | Возврат **FALSE**, если *все* определенные условия неверны. Возврат **TRUE**, если *какое-либо* из определенных условий верно. | **OR (1=2, "a"="a")** возвращает **TRUE**. |

### <a name="mathematical-functions"></a>Математические функции

| Функция | Описание | Пример |
|----------|-------------|---------|
| ABS (число) | Возвращает абсолютное значение указанного числа. (Другими словами, возвращает число без знака.) | **ABS (-1)** возвращает **1**. |
| POWER (число, степень) | Возврат результата возведения указанного положительного значения в определенную степень. | **POWER (10, 2)** возвращает **100**. |
| NUMBERVALUE (строка, десятичный разделитель, разделитель групп цифр) | Преобразование указанной строки в число. Указанный десятичный разделитель используется между целой и дробной частями десятичного числа. Указанный разделитель групп разрядов используется в качестве разделителя тысяч. | **NUMBERVALUE("1 234,56", ",", " ")** возвращает значение **1234.56**. |
| VALUE (строка) | Преобразование указанной строки в число. Символы запятой и точки (.) считаются десятичными разделителями, и ведущий дефис (-) используются в качестве отрицательного знака. Создается исключение, если указанная строка содержит другие символы, не являющиеся цифрами. | **VALUE ("1 234,56")** создает исключение. |
| ROUND (число, десятичных знаков) | Возвращает указанное число после его округления до указанного числа десятичных знаков:<ul><li>Если значение параметра десятичных знаков больше 0 (нуля), указанное число округляется до этого числа десятичных знаков.</li><li>Если значение параметра десятичных знаков равно **0** (ноль), указанное число округляется до ближайшего целого.</li><li>Если значение параметра десятичных знаков меньше 0 (нуля), указанное число округляется слева от десятичного разделителя.</li></ul> | **ROUND (1200.767, 2)** округляет до двух десятичных знаков и возвращает **1200.77**. **ROUND (1200.767, -3)** округляет до ближайшего числа, кратного тысяче, и возвращает **1000**. |
| ROUNDDOWN (число, десятичных знаков) | Возвращает указанное число после его округления вниз до указанного числа десятичных знаков.<blockquote>[!NOTE]<br>Эта функция поступает как <strong>ROUND</strong>, но она всегда округляет указанное число вниз (в направлении нуля).</blockquote> | **ROUNDDOWN (1200.767, 2)** округляет вниз до двух десятичных знаков и возвращает **1200.76**. **ROUNDDOWN (1700.767, -3)** округляет вниз до ближайшего числа, кратного тысяче, и возвращает **1000**. |
| ROUNDUP (число, десятичных знаков) | Возвращает указанное число после его округления вверх до указанного числа десятичных знаков.<blockquote>[!NOTE]<br>Эта функция поступает как <strong>ROUND</strong>, но она всегда округляет указанное число вверх (в направлении от нуля).</blockquote> | **ROUNDUP (1200.763, 2)** округляет вверх до двух десятичных знаков и возвращает **1200.77**. **ROUNDUP (1200.767, -3)** округляет вверх до ближайшего числа, кратного тысяче, и возвращает **1,000**. |

### <a name="data-conversion-functions"></a>Функции преобразования данных

| Функция | описание | Пример |
|----------|-------------|---------|
| VALUE (строка) | Преобразование указанной строки в число. Символы запятой и точки (.) считаются десятичными разделителями, и ведущий дефис (-) используются в качестве отрицательного знака. Создается исключение, если указанная строка содержит другие символы, не являющиеся цифрами. | **VALUE ("1 234,56")** создает исключение. |
| NUMBERVALUE (строка, десятичный разделитель, разделитель групп цифр) | Преобразование указанной строки в число. Указанный десятичный разделитель используется между целой и дробной частями десятичного числа. Указанный разделитель групп разрядов используется в качестве разделителя тысяч. | **NUMBERVALUE("1 234,56", ",", " ")** возвращает **1234.56**. |
| INTVALUE (строка) | Возвращает целочисленное представление указанной строки. Все десятичные знаки усекаются. | **INTVALUE ("100.77")** возвращает **100**. |
| INTVALUE (номер) | Возвращает целочисленное представление указанного числа. Все десятичные знаки усекаются. | **INTVALUE (-100.77)** возвращает **-100**. |
| INT64VALUE (строка) | Возвращает представление int64 указанной строки. Все десятичные знаки усекаются. | **INT64VALUE ("22565422744")** возвращает **22565422744**. |
| INT64VALUE (число) | Возвращает представление int64 указанного числа. Все десятичные знаки усекаются. | **INT64VALUE (22565422744.00)** возвращает **22565422744**. |

### <a name="record-functions"></a>Функции для работы с записями

| Функция | описание | Пример |
|----------|-------------|---------|
| NULLCONTAINER (список) | Возвращает запись **NULL** с той же структурой, как указанный список записей или запись.<blockquote>[!NOTE]<br>Эта функция является устаревшей. Используйте вместо <strong>EMPTYRECORD</strong>.</blockquote> | **NULLCONTAINER (SPLIT ("abc", 1))** возвращает новый пустой запись, который имеет такую же структуру, как список, который возвращен функцией **SPLIT**. |
| EMPTYRECORD (запись) | Возвращает запись **NULL** с той же структурой, как указанный список записей или запись.<blockquote>[!NOTE]<br>Запись <strong>null</strong> является записью, в которой все поля имеют пустое значение. Пустое значения равно <strong>0</strong> (ноль) для чисел, пустой строке для строк и т. д.</blockquote> | **EMPTYRECORD (SPLIT ("abc", 1))** возвращает новый пустой запись, который имеет такую же структуру, как список, который возвращен функцией **SPLIT**. |

### <a name="text-functions"></a>Текстовые функции

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>Функция</th>
<th>описание</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>UPPER (строка)</td>
<td>Возвращает указанную строку после ее преобразования в верхний регистр.</td>
<td><strong>UPPER(&quot;Sample&quot;)</strong> возвращает <strong>&quot;SAMPLE&quot;</strong>.</td>
</tr>
<tr class="even">
<td>LOWER (строка)</td>
<td>Возвращает указанную строку после ее преобразования в нижний регистр.</td>
<td><strong>LOWER (&quot;Sample&quot;)</strong> возвращает <strong>&quot;sample&quot;</strong>.</td>
</tr>
<tr class="odd">
<td>LEFT (строка, количество символов)</td>
<td>Возвращает указанное число символов с начала указанной строки.</td>
<td><strong>LEFT (&quot;Sample&quot;, 3)</strong> возвращает <strong>&quot;Sam&quot;</strong>.</td>
</tr>
<tr class="even">
<td>RIGHT (строка, количество символов)</td>
<td>Возвращает указанное число символов с конца указанной строки.</td>
<td><strong>RIGHT (&quot;Sample&quot;, 3)</strong> возвращает <strong>&quot;ple&quot;</strong>.</td>
</tr>
<tr class="odd">
<td>MID (строка, исходная позиция, количество символов)</td>
<td>Возвращает указанное число символов из указанной строки, начиная с указанного положения.</td>
<td><strong>MID (&quot;Sample&quot;, 2, 3)</strong> возвращает <strong>&quot;amp&quot;</strong>.</td>
</tr>
<tr class="even">
<td>LEN (строка)</td>
<td>Возвращает число символов в указанной строке.</td>
<td><strong>LEN (&quot;Sample&quot;)</strong> возвращает <strong>6</strong>.</td>
</tr>
<tr class="odd">
<td>CHAR (число)</td>
<td>Возврат строки символов, на которые имеются ссылки по указанному номеру юникод.</td>
<td><strong>CHAR (255)</strong> возвращает <strong>&quot;ÿ&quot;</strong>.
<blockquote>[!NOTE]<br>
Строка, возвращаемая этой функцией, зависит от кодировки, выбранной в родительском элементе формата FILE. Список поддерживаемых кодировок см. в разделе <a href="https://msdn.microsoft.com/en-us/library/system.text.encoding(v=vs.110).aspx">Класс Encoding</a>.</blockquote>
</td>
</tr>
<tr class="even">
<td>CONCATENATE (строка 1 [, строка 2, …])</td>
<td>Возвращает все указанные текстовые строки после их объединения в одну строку.</td>
<td><strong>CONCATENATE (&quot;abc&quot;, &quot;def&quot;)</strong> возвращает <strong>&quot;abcdef&quot;</strong>.
<blockquote>[!NOTE]<br>
Выражение <strong>&quot;abc&quot; &amp; &quot;def&quot;</strong> также возвращает <strong>&quot;abcdef&quot;</strong>.</blockquote>
</td>
</tr>
<tr class="odd">
<td>TRANSLATE (строка, шаблон, замена)</td>
<td>Возврат указанной строки после замены всех вхождений символов в указанной строке шаблона символами на соответствующей позиции в указанной строке замены.</td>
<td><strong>TRANSLATE (&quot;abcdef&quot;, &quot;cd&quot;, &quot;GH&quot;)</strong> заменяет шаблон <strong>&quot;cd&quot;</strong> строкой <strong>&quot;GH&quot;</strong> и возвращает <strong>&quot;abGHef&quot;</strong>.</td>
</tr>
<tr class="even">
<td>REPLACE (строка, шаблон, замена, флаг регулярного выражения)</td>
<td>Когда определенный флаг регулярного выражения — <strong>true</strong>, возвращает указанную строку после ее изменения путем применения регулярного выражения, которое определяется как аргумент шаблона для этой функции. Это выражение используется для обнаружения символов, которые необходимо заменить. Символы определенного аргумента замены используются для замены найденных символов. Когда определенный флаг регулярного выражения — <strong>false</strong>, эта функция ведет как <strong>TRANSLATE</strong>.</td>
<td><strong>REPLACE (&quot;+1 923 456 4971&quot;, &quot;[^0-9]&quot;, &quot;&quot;, true)</strong> применяет регулярное выражение, которое удаляет все нечисловые символы и возвращает <strong>&quot;19234564971&quot;</strong>. <strong>REPLACE (&quot;abcdef&quot;, &quot;cd&quot;, &quot;GH&quot;, false)</strong> заменяет шаблон <strong>&quot;cd&quot;</strong> строкой <strong>&quot;GH&quot;</strong> и возвращает <strong>&quot;abGHef&quot;</strong>.</td>
</tr>
<tr class="odd">
<td>TEXT (ввод)</td>
<td>Возврат указанного ввода после его преобразования в текстовую строку, которая отформатирована в соответствии с параметрами языкового стандарта сервера текущего экземпляра Finance and Operations. Для значений типа <strong>real</strong> преобразование строки ограничено до 2 десятичных знаков.</td>
<td>Если языковой стандарт экземпляра сервера Finance and Operations определен как <strong>EN-US</strong>, <strong>TEXT (NOW ())</strong> возвращает текущую дату сеанса Finance and Operations, 17 декабря 2015, как текстовую строку <strong>&quot;12/17/2015 07:59:23 AM&quot;</strong>. <strong>TEXT (1/3)</strong> возвращает <strong>&quot;0.33&quot;</strong>.</td>
</tr>
<tr class="even">
<td>FORMAT (строка 1, строка 2[, строка 3, …])</td>
<td>Возврат указанной строки после ее форматирования путем замены любых вхождений <strong>%N</strong> <em>n</em>-ным аргументом. Аргументы — строки. Если аргумент не предусмотрен для параметра, параметр возвращается как <strong>&quot;%N&quot;</strong> в строке. Для значений типа <strong>real</strong> преобразование строки ограничено до 2 десятичных знаков.</td>
<td>На следующем рисунке источник данных <strong>PaymentModel</strong> возвращает список записей клиентов через компонент <strong>Customer</strong> и значение даты обработки в поле <strong>ProcessingDate</strong>.
<p><a href="./media/picture-format-datasource.jpg"><img src="./media/picture-format-datasource.jpg" alt="PaymentModel data source" class="alignnone wp-image-290751 size-full" width="293" height="143" /></a></p>
<p>В формате ER, который создан для генерации электронного файла для выбранных клиентов, <strong>PaymentModel</strong> выбирается в качестве источника данных и управляет потоком операций. Исключение создается для информирования пользователя, когда выбранный клиент остановлен на дату обработки отчета. Формула, которая предназначена для этого типа управления обработкой, может использовать следующие ресурсы:</p>
<ul>
<li>Метка SYS70894 Finance and Operations которая имеет следующий текст:
<ul>
<li><strong>Для языка EN-US:</strong> &quot;Nothing to print&quot;</li>
<li><strong>Для языка DE:</strong> &quot;Nichts zu drucken&quot;</li>
</ul></li>
<li>Метка SYS18389 Finance and Operations которая имеет следующий текст:
<ul>
<li><strong>Для языка EN-US:</strong> &quot;Customer %1 is stopped for %2.&quot;</li>
<li><strong>Для языка DE:</strong> &quot;Debitor &#39;%1&#39; wird für %2 gesperrt.&quot;</li>
</ul></li>
</ul>
<p>Вот формула, которую можно разработать:</p>
<p>FORMAT (CONCATENATE (@&quot;SYS70894&quot;, &quot;. &quot;, @&quot;SYS18389&quot;), model.Customer.Name, DATETIMEFORMAT (model.ProcessingDate, &quot;d&quot;))</p>
<p>Если отчет обрабатывается для клиента <strong>Litware Retail</strong> 17 декабря 2015 г., в культуре <strong>EN-US</strong> и языке <strong>EN-US</strong>, эта формула возвращает следующий текст, который можно представить в виде сообщения исключения для пользователя:</p>
<p>&quot;Nothing to print. Customer Litware Retail is stopped for 12/17/2015.&quot;</p>
<p>Если этот же отчет обрабатывается для клиента <strong>Litware Retail</strong> 17 декабря 2015 г. в культуре <strong>DE</strong> и языке <strong>DE</strong>, эта формула возвращает следующий текст, который использует другой формат даты:</p>
<p>&quot;Nichts zu drucken. Debitor &#39;Litware Retail&#39; wird für 17.12.2015 gesperrt.&quot;</p>
<blockquote>[!NOTE]<br>
Следующий синтаксис применяется в формулах ER для меток:
<ul>
<li><strong>Для меток из ресурсов Finance and Operations:</strong> <strong>@&quot;X&quot;</strong>, где Х — идентификатор метки в репозитории прикладных объектов (AOT)</li>
<li><strong>Для меток, которые находятся в конфигурациях:</strong> <strong>@&quot;GER_LABEL:X&quot;</strong>, где Х — код метки в конфигурации ER</li>
</ul></blockquote></td>
</tr>
<tr class="odd">
<td>NUMBERFORMAT (число, формат)</td>
<td>Возвращает строковое представление указанного числа в указанном формате. (Сведения о поддерживаемых форматах см. в разделах <a href="https://msdn.microsoft.com/en-us/library/dwhawy9k(v=vs.110).aspx">стандартный</a> и <a href="https://msdn.microsoft.com/en-us/library/0c899ak8(v=vs.110).aspx">настраиваемый</a>.) Контекст, в котором эта функция выполняется, определяет культуру, используемую для форматирования чисел.</td>
<td>Для культуры EN-US <strong>NUMBERFORMAT (0.45, &quot;p&quot;)</strong> возвращает <strong>&quot;45.00 %&quot;</strong>. <strong>NUMBERFORMAT (10.45, &quot;#&quot;)</strong> возвращает <strong>&quot;10&quot;</strong>.</td>
</tr>
<tr class="even">
<td>NUMERALSTOTEXT (номер, язык, валюта, флаг печати названия валюты, десятичные знаки)</td>
<td>Возврат указанного числа после его написания (преобразования) в виде текстовой строки на указанном языке. Код языка указывать необязательно. Если он определен как пустая строка, вместо него используется код языка для контекста выполнения. (Код языка контекста выполнения определяется для создающей папки или файла.) Код валюты также указывать необязательно. Когда он определен как пустая строка, используется валюта компании.
<blockquote>[!NOTE]<br>
Флаг названия валюты для печати и параметры десятичных знаков анализируются только для следующих кодов языков: <strong>CS</strong>, <strong>ET</strong>, <strong>HU</strong>, <strong>LT</strong>, <strong>LV</strong>, <strong>PL</strong> и <strong>RU</strong>. Кроме того, параметр флага названия валюты для печати анализируется только для компаний Finance and Operations, в которых контекст страны или региона поддерживает склонение названий валюты.</blockquote></td>
<td><strong>NUMERALSTOTEXT (1234.56, &quot;EN&quot;, &quot;&quot;, false, 2)</strong> возвращает <strong>&quot;One Thousand Two Hundred Thirty Four and 56&quot;</strong>. <strong>NUMERALSTOTEXT (120, &quot;PL&quot;, &quot;&quot;, false, 0)</strong> возвращает <strong>&quot;Sto dwadzieścia&quot;</strong>. <strong>NUMERALSTOTEXT (120.21, &quot;RU&quot;, &quot;EUR&quot;, true, 2)</strong> возвращает <strong>&quot;Сто двадцать евро 21 евроцент&quot;</strong>.</td>
</tr>
<tr class="odd">
<td>PADLEFT (строка, длина, дополняющие символы)</td>
<td>Возвращает строку указанной длины, в которой в начало указанной строки добавлены указанные символы.</td>
<td><strong>PADLEFT (&quot;1234&quot;, 10, &quot;&nbsp;&quot;)</strong> возвращает текстовую строку <strong>&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1234&quot;</strong>.</td>
</tr>
<tr class="even">
<td>TRIM (строка)</td>
<td>Возвращает указанную текстовую строку после удаления начальных и конечных пробелов и после преобразования нескольких пробелов между словами в одинарные пробелы.</td>
<td><strong>TRIM (&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sample&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;)</strong> возвращает <strong>&quot;Sample text&quot;</strong>.</td>
</tr>
<tr class="odd">
<td>GETENUMVALUEBYNAME (путь к источнику данных перечисления, текст метки значения перечисления)</td>
<td>Возвращает значение указанного источника данных перечисления на основе указанного текста метки перечисления.</td>
<td>На следующем рисунке показано перечисление <strong>ReportDirection</strong> введенное в модели данных. Обратите внимание, что метки определены для значений перечисления.
<p><a href="./media/ER-data-model-enumeration-values.PNG"><img src="./media/ER-data-model-enumeration-values.PNG" alt="Available values for data model enumeration" class="alignnone wp-image-290681 size-full" width="397" height="136" /></a></p>
<p>Следующая иллюстрация показывает эти детали:</p>
<ul>
<li>Перечисление модели <strong>ReportDirection</strong> вставлено в отчет как источник данных, <strong>$Direction</strong>.</li>
<li>Выражение ER, <strong>$IsArrivals</strong>, разработано для использования перечисления модели в качестве параметра этой функции. Значение этого выражения — <strong>TRUE</strong>.</li>
</ul>
<a href="./media/ER-data-model-enumeration-usage.PNG"><img src="./media/ER-data-model-enumeration-usage.PNG" alt="Example of data model enumeration" class="alignnone wp-image-290681 size-full" width="397" height="136" /></a></td>
</tr>
</tbody>
</table>

### <a name="data-conversion-functions"></a>Функции преобразования данных

| Функция | описание | Пример |
|----------|-------------|---------|
| TEXT (ввод) | Возврат указанного ввода после его преобразования в текстовую строку, которая отформатирована в соответствии с параметрами языкового стандарта сервера текущего экземпляра Finance and Operations. Для значений типа **real** преобразование строки ограничено до 2 десятичных знаков. | Если языковой стандарт экземпляра сервера Finance and Operations определен как **EN-US**, **TEXT (NOW ())** возвращает текущую дату сеанса Finance and Operations, 17 декабря 2015, как текстовую строку **"12/17/2015 07:59:23 AM"**. **TEXT (1/3)** возвращает **"0.33"**. |
| QRCODE (строка) | Возвращает изображение QR-кода для указанной строки в двоичном формате base64. | **QRCODE ("Sample text")** возвращает **U2FtcGxlIHRleHQ=**. |

### <a name="data-collection-functions"></a>Функции сбора данных

| Функция | описание | Пример |
|----------|-------------|---------|
| FORMATELEMENTNAME () | Возвращает имя элемента текущего формата. Возвращает пустую строку, когда флаг **Сбор сведений о результате** для текущих файлов выключен. | Для получения дополнительных сведений об использовании этой функции см. проводник по задаче **ER Использование выходных данных формата для инвентаризации и агрегирования**, который является частью бизнес-процесса **Приобретение/разработка компонентов ИТ-услуг и решений**. |
| SUMIFS (ключевая строка для суммирования, строка критериев range1, строка критериев value1 \[, строка критериев range2, строка критериев value2,…\]) | Возвращает сумму значений XML-узлов (где имя определено как ключ), который был собран во время выполнения формата и который удовлетворяет указанным условиям (пары "диапазон-значение"). Возвращает значение **0** (ноль), когда флаг **Сбор сведений о результате** для текущих файлов выключен. | |
| SUMIF (ключевая строка для суммирования, строка диапазона критериев, строка значения критериев) | Возвращает сумму значений XML-узлов (где имя определено как ключ), который был собран во время выполнения формата и который удовлетворяет указанному условию (пара "диапазон-значение"). Возвращает значение **0** (ноль), когда флаг **Сбор сведений о результате** для текущих файлов выключен. | |
| COUNTIFS (ключевая строка для суммирования, строка критериев range1, строка критериев value1 \[, строка критериев range2, строка критериев value2,…\]) | Возвращает количество XML-узлов, которые были собраны во время выполнения формата и которые удовлетворяют указанным условиям (пары "диапазон-значение"). Возвращает значение **0** (ноль), когда флаг **Сбор сведений о результате** для текущих файлов выключен. | |
| COUNTIF (строка диапазона критериев, строка значения критериев) | Возвращает количество XML-узлов, которые были собраны во время выполнения формата и которые удовлетворяют введенному условию ("диапазон-значение"). Возвращает значение **0** (ноль), когда флаг **Сбор сведений о результате** для текущих файлов выключен. | |
| COLLECTEDLIST (ключевая строка для суммирования, строка критериев range1, строка критериев value1 \[, строка критериев range2, строка критериев value2,…\]) | Возвращает список значений XML-узлов XML-кода, которые были собраны во время выполнения формата и которые удовлетворяют введенным условиям ("диапазон-значение"). Возвращает пустой список, когда флаг **Сбор сведений о результате** для текущих файлов выключен. | |

### <a name="other-business-domainspecific-functions"></a>Другие функции (характерные для конкретных бизнес-доменов)

| Функция | описание | Пример |
|----------|-------------|---------|
| CONVERTCURRENCY (сумма, валюта источника, валюта целевая, дата, компания) | Преобразование указанной денежной суммы от указанной валюты источника в указанную валюту целевую, используя настройки определенной компании Finance and Operations на указанную дату. | **CONVERTCURRENCY (1, "EUR", "USD", TODAY(), "DEMF")** возвращает эквивалент одного евро в долларах США на текущую дату сеанса на основе настроек для компании DEMF. |
| ROUNDAMOUNT (число, десятичные знаки, правило округления) | Округление указанной суммы до указанного количества десятичных знаков в соответствии с указанным правилом округления.<blockquote>[!NOTE]<br>Правило округления необходимо определить как значение перечисления <strong>RoundOffType</strong> Finance and Operations.</blockquote> | Если параметр **model.RoundOff** задан как **Downward**, **ROUNDAMOUNT (1000.787, 2, model.RoundOff)** возвращает значение **1000.78**. Если параметр **model.RoundOff** задан как **Normal** или **Rounding-up**, **ROUNDAMOUNT (1000.787, 2, model.RoundOff)** возвращает значение **1000.79**. |
| CURCredRef (цифры) | Возврат ссылки кредитора на основе цифр определенного номера накладной. | **CURCredRef ("VEND-200002")** возвращает **"2200002"**. |
| MOD\_97 (цифры) | Возврат ссылки кредитора как выражение MOD97 на основе цифр определенного номера накладной. | **MOD\_97 ("VEND-200002")** возвращает **"20000285"**. |
| ISOCredRef (цифры) | Возврат ссылки кредитора международной организации по стандартизации (ISO) на основе цифр и алфавитных символов определенного номера накладной.<blockquote>[!NOTE]<br>Чтобы исключить символы из алфавитов, не совместимых с ISO, входной параметр необходимо перевести до передачи к этой функции.</blockquote> | **ISOCredRef ("VEND-200002")** возвращает **"RF23VEND-200002"**. |
| CN\_GBT\_AdditionalDimensionID (строка, номер) | Получить код дополнительной финансовой аналитики. Аналитики представлены в этой строке как коды, отделенные запятыми. В этой строке номера определяют код серии запрошенной аналитики. | **CN\_GBT\_AdditionalDimensionID ("AA,BB,CC,DD,EE,FF,GG,HH",3)** возвращает **"CC"**. |
| GetCurrentCompany () | Возвращает текстовое представление кода для юридического лица (компании), в которую выполнил вход пользователь. | **GETCURRENTCOMPANY ()** возвращает **USMF** для пользователя, выполнившего вход в компанию **Contoso Entertainment System USA** в Finance and Operations. |
| CH\_BANK\_MOD\_10 (цифры) | Возврат ссылки кредитора как выражение MOD10 на основе цифр определенного номера накладной. | **CH\_BANK\_MOD\_10 ("VEND-200002")** возвращает **3**. |
| FA\_SUM (код основного средства, код модели стоимости, дата начала, дата окончания) | Возвращает подготовленный контейнер данных суммы основных средств за указанный период. | **FA\_SUM ("COMP-000001", "Current", Date1, Date2)** возвращает подготовленный контейнер данных основного средства **"COMP-000001"**, которое имеет модель стоимости **"Current"** для периода от **Date1** до **Date2**. |
| FA\_BALANCE (код основного средства, код модели стоимости, год отчета, дата отчета) | Возвращает подготовленный контейнер данных сальдо основных средств. Год отчета необходимо определить как значение перечисления **AssetYear** в Finance and Operations. | **FA\_SUM ("COMP-000001", "Current", AxEnumAssetYear.ThisYear, SESSIONTODAY ())** возвращает подготовленный контейнер данных сальдо для основного средства **"COMP-000001"** с моделью стоимости **"Current"** для даты текущего сеанса Finance and Operations. |
| TABLENAME2ID (строка) | Возвращает целочисленное представление ИД таблицы для указанного имени таблицы. | **TABLENAME2ID ("Intrastat")** возвращает **1510**. |
| ISVALIDCHARACTERISO7064 (строка) | Возвращает логическое значение **TRUE**, если указанная строка представляет допустимый международный номер банковского счета (IBAN). В противном случае возвращается логическое значение **FALSE**. | **ISVALIDCHARACTERISO7064 ("AT61 1904 3002 3457 3201")** возвращает **TRUE**. **ISVALIDCHARACTERISO7064 ("AT61")** возвращает **FALSE**. |

### <a name="functions-list-extension"></a>Расширение перечня функций

ER позволяет расширение перечня функций, используемых в выражениях ER. Для этого требуются некоторые усилия со стороны разработчика. Дополнительные сведения см. в разделе [Расширение списка функций электронной отчетности](general-electronic-reporting-formulas-list-extension.md).

## <a name="additional-resources"></a>Дополнительные ресурсы

[Обзор электронной отчетности](general-electronic-reporting.md)

[Расширение списка функций электронной отчетности (ER)](general-electronic-reporting-formulas-list-extension.md)


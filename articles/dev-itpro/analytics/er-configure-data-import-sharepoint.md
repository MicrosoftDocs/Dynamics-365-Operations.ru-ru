---
title: "Настройка импорта данных из SharePoint"
description: "В этой теме объясняется, как импортировать данные из Microsoft SharePoint."
author: NickSelin
manager: AnnBe
ms.date: 05/21/2018
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-platform
ms.technology: 
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.search.scope: Core, Operations
ms.custom: 220314
ms.assetid: 2685df16-5ec8-4fd7-9495-c0f653e82567
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2018-04-01
ms.dyn365.ops.version: Release 8.0
ms.translationtype: HT
ms.sourcegitcommit: 821d8927211d7ac3e479848c7e7bef9f650d4340
ms.openlocfilehash: 9f23f73e9a98fc50c622255bf6ed027c41ec8010
ms.contentlocale: ru-ru
ms.lasthandoff: 08/13/2018

---
# <a name="configure-data-import-from-sharepoint"></a>Настройка импорта данных из SharePoint

[!include[banner](../includes/banner.md)]

Чтобы импортировать данные из входящего файла с помощью платформы для электронной отчетности (электронной отчетности), необходимо конфигурировать формат электронной отчетности, которая поддерживает импорт, и запустить соответствие модели типу **К месту назначения**, в котором используется данный формат в качестве источника данных. Чтобы импортировать данные, необходимо перейти к файлу, который требуется импортировать. Входящий файл может быть вручную выбран пользователем. При помощи новых возможностей электронной отчетности для поддержки импорта данных из Microsoft SharePoint можно настроить этот процесс как не требующий участия пользователя. Чтобы выполнить импорт данных из файлов, которые хранятся в папках Microsoft SharePoint можно использовать конфигурации аварийного восстановления. В этой теме объясняется, как завершить импорт из SharePoint для Microsoft Dynamics 365 для Finance and Operations. В примерах используются транзакции по поставщику по поставщику в качестве бизнес-данных.

## <a name="prerequisites"></a>Необходимые условия
Чтобы завершить примеры из этой темы необходимы следующие возможности доступа:

- Доступ к Finance and Operations для одной из следующих ролей:

    - Разработчик электронной отчетности
    - Консультант по функциональным возможностям электронной отчетности
    - Системный администратор

- Доступ к экземпляру Microsoft SharePoint Server, который настроен для использования с Finance and Operations
- Конфигурации формата и модели электронной отчетности для платежей по форме 1099

### <a name="create-required-er-configurations"></a>Создать необходимые конфигурации электронной отчетности
Запустите проводники по задаче **Импорт данных электронной отчетности из файла Microsoft Excel**, входящие в состав бизнес-процесса **7.5.4.3 Приобретение/разработка компонентов ИТ-услуг и решений (10677)**. Эти проводники по задаче объясняет процесс разработки и использования конфигураций электронной отчетности для интерактивного импорта проводок по поставщику из внешних файлов Microsoft Excel. Дополнительные сведения см. в разделе [Разбор входящих документов в Microsoft Excel](parse-incoming-documents-excel.md). В конце концов, необходимо будет:

- Конфигурации электронной отчетности

    - Конфигурация модели электронной отчетности, **Модель платежей по форме 1099**
    - Конфигурации формата электронной отчетности, **Формат для импорта проводок поставщиков из Excel**

    [![электронной отчетности конфигурации для импорта данных из SharePoint](./media/GERImportFromSharePoint-01-Configurations.PNG)](./media/GERImportFromSharePoint-01-Configurations.PNG)

- Образец входящего файла для импорта данных:

    - Файл Excel **1099import data.xlsx**, с транзакциями поставщика, которые должны быть импортированы в Finance and Operations

    [![Пример файла Microsoft Excel для импорта из SharePoint](./media/GERImportFromSharePoint-02-Excel.PNG)](./media/GERImportFromSharePoint-02-Excel.PNG)

> [!NOTE]
> Формат для импорта проводок поставщика выбран в качестве сопоставление модели по умолчанию. Таким образом, если выполнить сопоставление модели **Модель платежей по форме 1099** и это сопоставления модели типа **К месту назначения**, сопоставление модели выполняет этот формат, чтобы импортировать данные из внешних файлов. Затем эти данные используются для обновления таблицы приложения.

## <a name="configure-document-management-parameters"></a>Настройка параметров управления документооборотом
1. На странице **Параметры управления документами** настройте доступ к экземпляру SharePoint Server, который будет использоваться компанией, в которую вы на данный момент выполнили вход. В этом примере это компания USMF.
2. Протестируйте подключение к серверу экземпляра SharePoint Server, чтобы убедиться, что вы получили доступ.

    [![Настройка управления документами — сервер SharePoint](./media/GERImportFromSharePoint-03-SharePointSetup.png)](./media/GERImportFromSharePoint-03-SharePointSetup.png)

3. Откройте сконфигурированный новый сайт SharePoint и создайте следующие папки, в которых будут храниться входящие файлы:

    - Источник импорта файлов (основной)
    - Источник импорта файлов (альтернативный)

    [![Настройка управления документами — сервер SharePoint](./media/GERImportFromSharePoint-04-SharePointFolder1.png)](./media/GERImportFromSharePoint-04-SharePointFolder1.png)

    [![Настройка управления документами — сервер SharePoint](./media/GERImportFromSharePoint-05-SharePointFolder2.png)](./media/GERImportFromSharePoint-05-SharePointFolder2.png)

4. В Finance and Operations на странице **Типы документов** создайте следующие типы документа, которые будут использоваться для получения доступа к папкам SharePoint, только что созданной.

    - Основной полуфабрикат
    - Альтернативный полуфабрикат

5. Для созданных типов документов в поле **Группа** введите **Файл** и в поле **Местонахождение** введите **SharePoint**. Затем введите адрес папки SharePoint:

    - Для типа документов **Основной полуфабрикат**: источник импорта файлов (основной)
    - Для типа документов **Альтернативный полуфабрикат**: источник импорта файлов (альтернативный)

    [![Настройка SharePoint — новый тип документа](./media/GERImportFromSharePoint-06-SharePointDocumentTypesSetup.png)](./media/GERImportFromSharePoint-06-SharePointDocumentTypesSetup.png)

## <a name="configure-er-sources-for-the-er-format"></a>Настроить источники электронной отчетности для формата электронной отчетности
1. Перейдите в раздел **Управление организацией** \> **Электронная отчетность** \> **Источник электронной отчетности**.
2. На странице **Источник электронной отчетности** настройте исходные файлы для импорта данных с использованием сконфигурированного формата электронной отчетности.
3. Определите маску имени файла, таким образом, чтобы импортировались только файлы с расширением .xlsx. Маска имени файла является необязательной и используется только в том случае, если она была определена. Можно определить только одну маску для каждого формата электронной отчетности.
4. Выберите обе папки SharePoint, которые были созданы ранее.

    [![Настройка источника файлов электронной отчетности](./media/GERImportFromSharePoint-07-FormatSourceSetup.PNG)](./media/GERImportFromSharePoint-07-FormatSourceSetup.PNG)

> [!NOTE]
> - *Источник* электронной отчетности определяется индивидуально для каждой компании приложения. Напротив, *Конфигурации* электронной отчетности используются совместно несколькими компаниями.
> - При удалении настройки источника электронной отчетности в формате электронной отчетности также удаляются все состояния связанного файла (см. ниже).

## <a name="review-the-files-states-for-the-er-format"></a>Просмотрите состояния файлов для формата электронной отчетности
1. На странице **Источник электронной отчетности** выберите **Состояния файлов для источников** для просмотра содержимого источников файлов, настроенных для текущего формата электронной отчетности.
2. В разделе **Файлы** просмотрите список файлов. Этот список будут включены следующие:

    - Исходные файлы, которые применимы на основе маски имя файла (если маска файла определена), и готовые для импорта данных. Для этих файлов раздел **Журналы источников для формата импорта** пуст.
    - Ранее импортированные файлы. Для каждого из этих файлов, в разделе **Журналы источников для формата импорта** можно просмотреть историю импорта этого файла.

Можно также открыть страницу **Состояния файлов для источников**, выбрав **Управление организацией** \> **Электронная отчетность** \> **Состояния файлов для источников**. В этом случае страница предоставляет сообщение об источниках файла для всех форматов электронной отчетности, которые были сконфигурированы для источников файлов в компании, в которую выполнен вход в данный момент.

## <a name="import-data-from-excel-files-that-are-in-a-sharepoint-folder"></a>Импорт данных из файлов Excel, которые находятся в папке SharePoint
1. В SharePoint необходимо загрузить файл Microsoft Excel **1099import data.xlsx**, содержащий транзакции поставщика **Источник импорта файлов (основной)** в папке SharePoint, созданного ранее.

    [![Содержание SharePoint — Microsoft Excel для импорта](./media/GERImportFromSharePoint-08-UploadFile.png)](./media/GERImportFromSharePoint-08-UploadFile.png)

2. В Finance and Operations на странице **Состояния файлов для источников** выберите **Обновить** для обновления страницы. Обратите внимание, что файл Excel, отправленный в SharePoint, появился в этой форме со статусом **Готово**. На данный момент поддерживаются следующие статусы:

    - **Готово** — назначается автоматически для каждого нового файла в папке SharePoint. Этот статус означает, что файл готов для импорта.
    - **Выполняется импорт** — назначается автоматически отчетом по электронной отчетности, когда файл будет заблокирован процессом импорта для предотвращения использования другими процессами (при одновременном запуске многие из них).
    - **Импортировано** — назначается автоматически отчетом по электронной отчетности после успешного завершения импорта файлов. Этот статус означает, что импортируемый файл был удален из конфигурированного источника файлов (папка SharePoint).
    - **Сбой** — назначается автоматически отчетом по электронной отчетности, когда импорт файла завершается с ошибками или исключениями.
    - **Заблокировано** — назначается вручную пользователем в этой форме. Этот статус означает, что файл не будут импортированы в данный момент. Этот статус используется для откладывания некоторых файлов импорта.

    [![Страница состояния файла электронной отчетности для выбранных источников](./media/GERImportFromSharePoint-09-FileStatesForm.png)](./media/GERImportFromSharePoint-09-FileStatesForm.png)

## <a name="import-data-from-sharepoint-files"></a>Импорт данных из файлов SharePoint
1. Откройте дерево конфигурации электронной отчетности, выберите **Модель платежей по форме 1099**и разверните список компонентов модели электронной отчетности.
2. Выберите имя сопоставления модели, чтобы открыть список сопоставлений модели конфигурации выбранной модели электронной отчетности.

    [![Страница состояния файла электронной отчетности для выбранных источников](./media/GERImportFromSharePoint-10-SelectModelMapping.PNG)](./media/GERImportFromSharePoint-10-SelectModelMapping.PNG)

3. Выберите **Выполнить** для выполнения сопоставления выбранной модели электронной отчетности. Так как источники файла для формата электронной отчетности были сконфигруированы, можно изменять настройку параметра **Источник файла**, если требуется. Если сохранить настройку этого параметра, файлы .xslx импортируются из конфигурируемых источников (в данном примере, папки SharePoint).

    В этом примере импортируется только один файл. Тем не менее если имеется множественные файлы, они будут выбраны для импорта в том порядке, в котором они были добавлены в папку SharePoint. Каждое выполнения формата электронной отчетности импортирует один выбранный файл.

    [![Запустить сопоставление модели электронной отчетности](./media/GERImportFromSharePoint-11-RunModelMapping.PNG)](./media/GERImportFromSharePoint-11-RunModelMapping.PNG)

4. Сопоставление модели может запускаться автоматически в пакетном режиме. В этом случае каждый раз, когда пакетное задание будет выполнять этот формат электронной отчетности, будет импортироваться один файл из конфигурированных источников файлов. Используйте следующий код для реализации этого пакета выполнения.

    ```
    ERObjectsFactory::createMappingDestinationRunByImportFormatMappingId().run()
    ```

    Когда файл успешно импортирован из папки SharePoint, он удаляется из нее.

5. Введите идентификатор ваучера, например **V-00001**, а затем выберите **OK**.

    [![Запустить сопоставление моделиэлектронной отчетности](./media/GERImportFromSharePoint-12-ModelMappingRunFinished.PNG)](./media/GERImportFromSharePoint-12-ModelMappingRunFinished.PNG)

6. На странице **Состояния файлов для источников** выберите **Обновить** для обновления страницы.

    [![Страница состояния файла электронной отчетности для выбранных источников](./media/GERImportFromSharePoint-13-FileStatesForm.PNG)](./media/GERImportFromSharePoint-13-FileStatesForm.PNG)

7. В разделе **Файлы** просмотрите список файлов. Раздел **Журналы источников для формата импорта** содержит журнал импорта файлов Excel. Так как этот файл был успешно завершен, он помечается как **Удалено** в папке SharePoint.
8. Проверка **Источник импорта файлов (основной)** папки SharePoint. Файлы Excel, которые были успешно импортированы, были удалены из этой папки.
9. В Finance and Operations выберите **Расчеты с поставщиками** \> **Периодические задачи** \> **Налог по форме 1099** \> **Сопоставление поставщика для формы 1099**.
10. В полях **Дата начала** и **Дата окончания** введите соответствующие значения. Затем выберите **транзакции по форме 1099 вручную**.

    транзакции поставщика, которые были импортированы из файлов Excel на сайте SharePoint для ваучера **V-00001**, будут показаны на странице.

    [![Страница проводок поставщика по форме 1099](./media/GERImportFromSharePoint-14-ImportedTransactions.PNG)](./media/GERImportFromSharePoint-14-ImportedTransactions.PNG)

## <a name="prepare-an-excel-file-for-import"></a>Подготовить файл Excel к импорту
1. Открытие файла Excel, который использовался ранее. В строке 1 столбца 3 добавьте код поставщика, который не существует в приложении. Добавьте дополнительную дополнительную ложную информацию поставщика в строку.

    [![Пример файла Microsoft Excel для импорта из SharePoint](./media/GERImportFromSharePoint-15-Excel.PNG)](./media/GERImportFromSharePoint-15-Excel.PNG)

2. Загрузуите обновленный файл Excel, содержащий транзакции поставщиков, в папку SharePoint **Источник импорта файлов (основной)**.
3. В Finance and Operations откройте дерево конфигурации электронной отчетности, выберите **Модель платежей по форме 1099**и разверните список компонентов модели электронной отчетности.
4. Выберите имя сопоставления модели, чтобы обновить сопоставление модели таким образом, чтобы неверный код поставщика был оценен как ошибка во время импорта данных.
5. Выберите **Конструктор**.
6. На вкладке **Проверки** необходимо изменить действие после проверки для правила проверки, которое было настроено для оценки наличия счета поставщика, который был импортирован в приложении. Обновите значение поля **Действия после проверки** на **Остановить выполнение**, сохранить изменения и закрыть страницу.

    [![Страница конструктора сопоставления модели электронной отчетности](./media/GERImportFromSharePoint-16-UpdateModelMapping.PNG)](./media/GERImportFromSharePoint-16-UpdateModelMapping.PNG)

7. Сохраните изменения и закройте конструктор сопоставления модели электронной отчетности.
8. Выберите **Выполнить** для выполнения сопоставления модифицированной модели электронной отчетности.
9. Введите идентификатор ваучера, например **V-00002**, а затем выберите **OK**.

    Обратите внимание, что в окне Infolog содержатся уведомления о том, что файл, находящийся в папке SharePoint содержит неверный код поставщика и не может быть импортирован.

    [![Конструктор-сопоставления-модели-ER</1](./media/GERImportFromSharePoint-17-ModelMappingRunFinished.PNG)](./media/GERImportFromSharePoint-17-ModelMappingRunFinished.PNG)

10. На странице **Состояния файла для источников** выберите **Обновить**и затем в разделе **Файлы** просмотрите список файлов.

    [![Страница состояния файла ER для выбранных источников](./media/GERImportFromSharePoint-18-FileStatesForm.PNG)](./media/GERImportFromSharePoint-18-FileStatesForm.PNG)

    Раздел **Источники журнала импорта в формате** указывает, что произошла ошибка при импорте и файл до сих пор находится в папке SharePoint ( флажок **Удален** не установлен). Если устранить этот файл на сайте SharePoint, добавив правильный код поставщика, а затем изменить статус файла с **Не пройден** на **Готово** в разделе **Журналы источников для формата импорта**, можно импортировать файл еще раз.

11. Проверка **Источник импорта файлов (основной)** папки SharePoint. Обратите внимание, что файл Excel, которая не была импортирована, все еще находится в этой папке.
12. В Finance and Operations выберите **Расчеты с поставщиками** \> **Периодические задачи** \> **Налог по форме 1099** \> **Сопоставление записей поставщика по форме 1099**, введите соответствующие значения в поля **Дата начала** и **Дата окончания**, а затем выберите **транзакции пр форме 1099 вручную**.

    Доступны только транзакции для ваучера V-00001. Нет проводок для ваучера V-00002, несмотря на то, что была обнаружена ошибка в последней импортированной транзакции в файле Excel.


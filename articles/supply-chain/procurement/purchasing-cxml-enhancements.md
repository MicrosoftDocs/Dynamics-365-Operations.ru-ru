---
title: Улучшения cXML покупки
description: Функция улучшения cXML покупки основана на существующей функции внешнего каталога "Внешний заказ", которая используется для заявок на покупку.
author: Henrikan
ms.date: 08/03/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: CatCXMLParameters, CatCXMLPurchRequest
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: henrikan
ms.search.validFrom: 2020-08-03
ms.dyn365.ops.version: 10.0.13
ms.openlocfilehash: f4a7ee091d73e2104571ac9134a9de9bab0a7074
ms.sourcegitcommit: 3b87f042a7e97f72b5aa73bef186c5426b937fec
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2021
ms.locfileid: "7575472"
---
# <a name="purchasing-cxml-enhancements"></a>Улучшения cXML покупки

[!include [banner](../includes/banner.md)]

Функция _улучшения cXML покупки_ основана на существующей [функции внешнего каталога](set-up-external-catalog-for-punchout.md), которая используется для заявок на покупку. Эта существующая функциональность называется _внешний заказ_. Хотя заказ на покупку не обязательно должен создаваться из заявки на закупку, должна существовать связь между поставщиком по заказу на покупку и параметрами, которые используются для отправки документа заказа на покупку.

## <a name="turn-on-the-purchasing-cxml-enhancements-feature"></a>Включение функции улучшений cXML покупки

Чтобы включить функцию, откройте страницу **[Управление функциями](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)** и выполните поиск функции с названием *Улучшения cXML покупки*. Выберите функцию, затем выберите **Включить сейчас**, чтобы включить ее.

После включения функции следует настроить параметры в следующих трех областях:

- **[Параметры cXML](#cxml-parameters)**  — эти параметры используются для настройки некоторых глобальных параметров для функций отправки заказов на покупку.
- **[Настройка поставщика](#vendor-setup)**  — если язык cXML должен использоваться по умолчанию для всех новых заказов на покупку, созданных для любого поставщика, установите для параметра **Отправлять заказ на покупку с помощью cXML** значение _Да_ для этого поставщика.
- **[Внешние каталоги](#external-catalog-setup)**  — используйте новые настройки **Свойства заказа**, чтобы определить формат документа заказа на покупку и порядок его отправки.

Данная конфигурация представлена на приведенном ниже рисунке.

![Области для настройки функций cXML.](media/cxml-settings-areas.png "Области для настройки функций cXML")

Кроме того, необходимо настроить [пакетное задание запроса заказа на покупку](#po-batch). Это пакетное задание используется для отправки подтвержденных заказов на покупку.

## <a name="set-up-global-cxml-parameters"></a><a name="cxml-parameters"></a>Настройка глобальных параметров cXML

Страница **Параметры cXML** используется для создания нескольких глобальных настроек, которые применяются к функциям отправки заказов на покупку.

![Страница параметров cXML.](media/cxml-parameters.png "Страница параметров cXML")

Перейдите в раздел **Закупки и источники \> Настройка \> Управление cXML \> Параметры cXML** и установите следующие параметры:

- **Тестовый режим cXML** — этот глобальный параметр влияет на способ физического отправки заказов на покупку из пакетного задания. Выберите одно из следующих значений:

    - **Тест** — в этом режиме пакетное задание может быть запущено, а XML-документ для сообщения создается, но не отправляется. Вместо этого он сохраняется в запросе заказа на покупку для целей проверки. Этот режим полезен, когда вы находитесь на начальной стадии реализации и хотите увидеть, как данные вводятся в сообщение cXML. Может также потребоваться создать образцы сообщений, которые можно отправить поставщикам для первоначальной проверки.
    - **Активный** — в этом режиме функция использует [настройки внешнего каталога](#external-catalog-setup), чтобы физически передать каждый документ поставщику.

- **Отправлять обновления запросов на покупку** — установите для этого параметра значение *Да*, чтобы отправлять сообщение об обновлении для заказов на покупку. Установите значение *Нет*, чтобы предотвратить отправку сообщения. Большинство поставщиков предпочитают не получать сообщения об обновлениях. Вместо этого они требуют, чтобы клиенты с ними связывались по телефону или по электронной почте, если необходимо изменить заказ на покупку. Этот параметр является глобальным параметром, и во внешнем каталоге для каждого поставщика невозможно задать переопределение. Заказ на покупку будет помечен как обновленный, если выполняется разноска второго подтверждения по заказу на покупку, но первое подтверждение уже было отправлено и подтверждено поставщиком. Если имеется второе подтверждение, но первое подтверждение не было отправлено, второе подтверждение будет считаться новым документом. Можно подтвердить заказ на покупку столько раз, сколько необходимо, пока не будет отправлено одно подтверждение. Следующее подтверждение будет рассматриваться как сообщение об обновлении.
- **Отправлять сообщение об удалении запросов на покупку** — установите для этого параметра значение *Да*, чтобы отправлять сообщение об удалении для заказов на покупку. Установите значение *Нет*, чтобы предотвратить отправку сообщения. Большинство поставщиков предпочитают не получать сообщения об удалении. Вместо этого они требуют, чтобы клиенты с ними связывались по телефону или по электронной почте, если заказ на покупку был отправлен по ошибке. Этот параметр является глобальным параметром, и во внешнем каталоге для каждого поставщика невозможно задать переопределение. Заказ на покупку будет помечен как удаленный, если отменяется заказ на покупку в Supply Chain Management.
- **Файл архива** — укажите путь к файлу, в который требуется экспортировать и сохранить архивные документы cXML. Путь используется при выполнении функции очистки со страницы **Запрос заказа на покупку**.
- **Макс. число знаков для строки улицы** — введите максимальное количество символов, которое может использоваться в поле улицы для адресов в документе cXML. Этот глобальный параметр влияет на всех поставщиков, если в свойствах внешнего каталога не указана переопределение.

## <a name="set-up-vendor-purchase-orders-to-use-cxml"></a><a name="vendor-setup"></a>Настройка заказов на покупку для поставщика на использование cXML

Каждый раз, когда вы подтверждаете заказ на покупку, для которого для параметра **Отправлять заказ на покупку с помощью cXML** указано значение _Да_, система автоматически создает сообщение cXML и доставляет его поставщику, связанному с этим заказом на покупку. Имеется два способа управления этим параметром для заказов на покупку:

- Чтобы настроить поставщика так, чтобы он автоматически использовал cXML для всех новых заказов на покупку, созданных на основе заявки, перейдите в раздел **Закупки и источники \> Поставщики \> Все поставщики**, затем выберите или создайте поставщика, чтобы открыть страницу со сведениями. Затем на экспресс-вкладке **Значения заказа на покупку по умолчанию** установите для параметра **Отправлять заказ на покупку с помощью cXML** значение _Да_. Если cXML должен также использоваться автоматически для новых заказов на покупку, которые **не** создаются из заявки, необходимо также установить для свойства заказа **ENABLEMANUALPO** значение _True_ для соответствующего внешнего каталога, как описано в разделе [Установка свойств заказа](#set-order-properties) далее в этой теме.
- Для отдельных заказов на покупку перейдите в раздел **Закупки и источники\> Заказы на покупку \> Все заказы на покупку** и выберите или создайте заказ на покупку, чтобы открыть страницу подробных сведений. Переключитесь в представление **Заголовок**, затем на экспресс-вкладке **Настройка** установите требуемое значение параметра **Отправлять заказ на покупку с помощью cXML**.

![Настройки по умолчанию для заказов на покупку для поставщика.](media/cxml-order-defaults.png "Настройки по умолчанию для заказов на покупку для поставщика")

## <a name="set-up-an-external-catalog-to-use-cxml"></a><a name="external-catalog-setup"></a>Настройка внешнего каталога для использования cXML

На странице **Внешние каталоги** для каждого из каталогов можно настроить функцию внешнего заказа и функцию отправки заказов на покупку. Чтобы найти соответствующие настройки, перейдите в раздел **Закупки и источники \> Каталоги \> Внешние каталоги**. Сначала [настраивается каждый каталог, как обычно](set-up-external-catalog-for-punchout.md). Этот процесс включает в себя назначение поставщика, выбор категорий, которые поставщику разрешено поставлять, и активацию каталога. Затем настройте дополнительные параметры, описанные в этом разделе.

> [!NOTE]
> При подтверждении заказа на покупку, который может быть отправлен через cXML, система выполняет поиск поставщика, связанного с заказом на покупку, затем находит первый активный внешний каталог, связанный с этим поставщиком. Затем система использует настройки из этого внешнего каталога для отправки заказа на покупку. Если настроено несколько внешних каталогов, система использует только первый найденный внешний каталог на основе поставщика в заказе на покупку. Поэтому рекомендуется создать только один внешний каталог для каждого поставщика.

![Параметры внешнего каталога.](media/cxml-supplier-catalog.png "Параметры внешнего каталога")

### <a name="set-the-punchout-protocol-type"></a>Установка типа протокола внешнего заказа

На экспресс-вкладке **Общие** страницы **Внешние каталоги** установите в поле **Тип протокола внешнего заказа** значение _cXML_. Этот параметр будет единственным доступным параметром, если только партнер не расширил функциональность и не предоставил дополнительный параметр в расширении.

Если вы также используете каталог для внешнего заказа, необходимо также [настроить формат сообщения](set-up-external-catalog-for-punchout.md). Формат сообщения используется для установления связи с поставщиком в проводке внешнего заказа из заявки. При отправке заказа на покупку свойства заказа будут использоваться для создания связи с поставщиком.

### <a name="set-the-order-properties"></a><a name="set-order-properties"></a>Задание свойств заказа

Функция _Улучшения cXML покупки_ добавляет новую экспресс-вкладку **Свойства заказа** для внешних каталогов. На этой экспресс-вкладке представлена сетка, в которой можно определить свойства заказа. Она также содержит панель инструментов. На этой панели инструментов находятся следующие три кнопки, которые можно использовать для управления свойствами заказа:

- **Свойства по умолчанию** — при настройке нового каталога выберите эту кнопку, чтобы добавить в сетку предопределенную коллекцию часто используемых свойств.
- **Создать** — добавление в сетку нового свойства.
- **Удалить** — удаление текущего выбранного свойства из сетки. При случайном удалении свойства по умолчанию выберите **Свойства по умолчанию**, чтобы восстановить все отсутствующие свойства.

При каждом добавлении в сетку одного или нескольких свойств используйте правый столбец, чтобы указать значение для каждого из них.

Свойства по умолчанию используются следующим образом:

- **BUYER\_COOKIE** — это поле отслеживания можно использовать для указания конкретной информации для вашей компании. Если у вас нет соглашения с поставщиком о том, как это свойство используется, оно не имеет значительного смысла при отправке заказа на покупку. Поэтому для него следует задать простое значение.
- **DELIVERTO** — когда адрес доставки вводится в документ из заказа на покупку, поле **Сведения, которые следует принять во внимание** используется для установки поля **DeliverTo** в XML-сообщении. Если требуется, чтобы это значение было именем инициатора запроса, и вы задаете поле инициатора запроса в заголовке заказа на покупку, введите значение _REQUESTER_ для этого свойства, чтобы имя инициатора запроса было введено в поле **DeliverTo** в XML. В этом случае используются основной адрес электронной почты и номер телефона инициатора запроса, а не лица, размещающего заказ.
- **DEPLOYMENTMODE** — задайте это свойство в соответствии с требованиями поставщика. Эти значения обычно являются _PRODUCTION_ или _TEST_. Установите значение на основе ваших договоренностей с поставщиком. Обычно оно должно соответствовать предполагаемой системе, соответствующей значению **ORDERCHECKURL**, которое поставщик указывает в качестве тестовой или производственной системы.
- **FIXEDBILLADDRESSID** — когда поле **addressID** в XML-сообщении установлено, оно выбирает местоположение, указанное в адресе. Если значение идентификатора, который вы сообщили поставщику, отличается от значения в местоположении адреса по какой-либо причине, можно принудительно переопределить это, указав здесь значение. Предполагается, что используется только один адрес поставщика, и адрес настраивается в системе поставщика. Адрес выставления счета — это основной адрес накладной, указанный для юридического лица в Supply Chain Management.
- **FIXEDSHIPADDRESSID** — когда поле **addressID** в XML-сообщении установлено, оно выбирает местоположение, указанное в адресе. Если значение идентификатора, который вы сообщили поставщику, отличается от значения в местоположении адреса по какой-либо причине, можно принудительно переопределить это, указав здесь значение. Предполагается, что используется только один адрес поставщика, и адрес настраивается в системе поставщика. Адресом поставки является адрес, указанный в заголовке заказа на покупку. Большинство поставщиков принимает только адреса в заголовкк, а не адреса в строках. Хотя в XML имеются поля для адресов строк, для них будет задан адрес заголовка.
- **FROM\_DOMAIN** — введите значение, которое используется для отправки документов заказа на покупку. Это значение предоставляется поставщиком.
- **FROM\_IDENTITY** — введите значение, которое используется для отправки документов заказа на покупку. Это значение предоставляется поставщиком.
- **ORDERCHECKURL** — введите URL-адрес, по которому необходимо передать документы заказа на покупку. Этот URL-адрес начинается с `https://` и предоставляется поставщиком.
- **PAYLOAD\_ID** — введите значение префикса для идентификатора полезной нагрузки, если это необходимо для бизнес-процессов текущего поставщика.
- **SENDER\_DOMAIN** — введите значение, которое используется для отправки документов заказа на покупку. Это значение предоставляется поставщиком.
- **SENDER\_IDENTITY** — введите значение, которое используется для отправки документов заказа на покупку. Это значение предоставляется поставщиком.
- **SHARED\_SECRET** — введите значение, которое используется для отправки документов заказа на покупку. Это значение предоставляется поставщиком.
- **STREETLENGTH** — введите число, соответствующее максимальному количеству знаков, которое поставщик будет принимать в качестве названия улицы. Если здесь указано значение, оно переопределяет значение, указанное на странице **Параметры cXML**. Система удалит разрывы строк и пробелы, чтобы попытаться вписать стандартный адрес в Supply Chain Management в указанное здесь число символов. Все дополнительные символы будут отброшены.
- **TO\_DOMAIN** — введите значение, которое используется для отправки документов заказа на покупку. Это значение предоставляется поставщиком.
- **TO\_IDENTITY** — введите значение, которое используется для отправки документов заказа на покупку. Это значение предоставляется поставщиком.
- **USERAGENT** — введите значение для идентификации используемой системы. Например, введите _Dynamics 365 Supply Chain Management_.
- **VERSION** — введите номер версии cXML, если поставщик запрашивает эту информацию. Версия по умолчанию — *1.2.008*. Эта версия является стабильной и принимается большинством поставщиков.
- **RESPONSETEXT** — введите любой произвольный текст, который, как вы ожидаете, будет возвращен поставщиком в ответном сообщении cXML после того, как заказ был отправлен. Таким образом, система может пометить сообщение как _Подтвержденное_. Если ответ не соответствует стандартному тексту или тексту клиента, введенному здесь, запрос будет помечен как _Ошибка_.
- **RESPONSETEXTSUB** — задайте для этого свойства значение _TRUE_, если необходимо выполнить поиск по тексту ответа поставщика для значений, указанных в поле **RESPONSETEXT**. Например, поставщик может вернуть длинную строку, которая включает "ОК" в ответе. В этом случае можно ввести _ОК_ в поле **RESPONSETEXT** и установить для параметра **RESPONSETESTSUB** значение _TRUE_ для поиска "ОК" в любом месте ответа. Для заказа можно затем задать значение _Подтвержден_.
- **CONTENTTYPE** — в стандартной настройке каталога нет необходимости задавать это свойство. Если вы получаете сообщение об ошибке сервера 500 из системы поставщика при отправке заказа на покупку, можно выполнить испытания, установив для этого свойства значение _FALSE_. Это значение изменит настройку в веб-запросе и может разрешить отправку сообщения для некоторых платформ.
- **ENABLEHEADERS** — установите для этого свойства значение _TRUE_, чтобы отправить заголовки вместе с заказом на покупку. Значение этого свойства следует задавать только в том случае, если поставщик требует его. Если для этого свойства задано значение _TRUE_, добавьте дополнительные настраиваемые свойства, которые основаны на предоставляемых поставщиком именах, и добавьте к ним префикс _H\__. Типичными примерами являются **H\_USERID**, **H\_PASSWORD**, **H\_RECEIVERID** и **H\_ACTIONREQUEST**. В свойства по умолчанию включены следующие пользовательские свойства:

    - **H\_USERID** — если торговому партнеру требуется, чтобы вы отправляли код пользователя как часть URL-адреса для отправки заказа на покупку, введите здесь значение.
    - **H\_PASSWORD** — если торговому партнеру требуется, чтобы вы отправляли пароль как часть URL-адреса для отправки заказа на покупку, введите здесь значение.

- **ENABLEMANUALPO** — если это свойство имеет значение _TRUE_, то когда пользователи вручную создают заказы на покупку (то есть когда они не начинают процесс из заявки), эти заказы на покупку наследуют настройку параметра **Отправлять заказ на покупку с помощью cXML** от поставщика. Если это свойство не задано или имеет значение _FALSE_, параметр **Отправлять заказ на покупку с помощью cXML** не будет установлен в заголовке заказа на покупку для созданных вручную заказов на покупку. Для заказов на покупку, созданных на основе заявки, значение параметра **Отправлять заказ на покупку с помощью cXML** всегда наследуется от поставщика, независимо от настройки этого свойства. Дополнительные сведения см. в разделе [Настройка заказов на покупку для поставщика на использование cXML](#vendor-setup) ранее в этой теме.
- **PUNCHOUTPOONLY** — если это свойство имеет значение _TRUE_, только строки заявки на закупку, которые были созданы из процесса внешнего заказа, будут иметь параметр **Отправлять заказ на покупку с помощью cXML** в заголовке заказа на покупку. Кроме того, тип строки заявки на закупку всех строк в заказе на покупку должен быть _Номенклатура внешнего каталога_. В противном случае заказ на покупку cXML невозможно создать.
- **PUNCHOUTSHIPTO** — если это свойство имеет значение _TRUE_, адрес юридического лица по умолчанию будет добавлен в сообщение запроса настройки внешнего заказа, когда пользователь открывает внешний каталог. Этот адрес добавляется как адрес **ShipTo**. Поставщики будут использовать адрес **ShipTo** для отображения цены на основе местоположения компании.
- **TRACEPUNCHOUT** — если получено сообщение об ошибке при попытке перехода к внешнему каталогу из заявки, установите для этого свойства значение _TRUE_. Затем информация трассировки будет заполняться для сообщений **PunchOutSetupRequest** и **PunchOutResponse**, которые передаются между Supply Chain Management и сайтом поставщика. Эту информацию можно просмотреть на странице **Журнал сообщений корзины cXML**, которую можно открыть с помощью страницы **Настройка внешнего каталога** для каталога поставщика, с которым возникла проблема. Значение этого свойства следует задавать равным _TRUE_ только в том случае, если производится устранение неполадок, поскольку оно приводит к значительному увеличению накладных расходов по производительности базы данных для каждого внешнего заказа. Дополнительные сведения см. в разделе [Просмотр журнала сообщений корзины cXML для внешнего каталога внешнего заказа](#message-log) далее в этой теме.
- **REPLACENEWLINE** — установите для этого свойства значение _TRUE_, если имеется проблема, так как система поставщика отправляет сообщение **PunchOutResponse**, содержащее символы новой строки (\\n). Эта проблема может возникнуть, если сообщения поставщика анализируются ПО промежуточного слоя или центром поставок. При возникновении проблемы с настройкой нового поставщика установите для свойства **TRACEPUNCHOUT** значение _TRUE_, чтобы просмотреть сообщение **PunchOutResponse** и определить, разбиваются ли XML-теги символами новой строки.
- **POCOMMENTS** — задайте для этого свойства значение _TRUE_, если требуется, чтобы документ cXML включал примечания, прикрепленные к заказу на покупку в Supply Chain Management. Текст вложения включается в комментарии заголовка в сообщении заказа на покупку. Дополнительные сведения о том, как система выбирает и обрабатывает такие вложения, см. в разделе [Вложение примечаний к заказу на покупку](#attach-po-notes) далее в этой теме.
- **VENDCOMMENTS** — задайте для этого свойства значение _TRUE_, если требуется, чтобы документ cXML включал примечания, прикрепленные к заказу на покупку в Supply Chain Management. Текст вложения включается в комментарии заголовка в сообщении заказа на покупку. Дополнительные сведения о том, как система выбирает и обрабатывает такие вложения, см. в разделе [Вложение примечаний к заказу на покупку](#attach-po-notes).
- **CLEANAMP** — если получено сообщение об ошибке при попытке выполнить запрос внешнего заказа к поставщику, а URL-адрес возврата поставщика содержит неправильно закодированные знаки амперсанда (\&), установите для этого свойства значение _TRUE_.
- **PUNCHOUTTZ** — задайте для этого свойства значение _TRUE_, если поставщик, с которым ведется работа, использует стандарт международной организации по стандартизации (ISO) 8601, чтобы выполнить определенную проверку даты/времени сообщения запроса внешнего заказа. Supply Chain Management использует дату в формате всемирного координированного времени (UTC) в сообщении **PunchOutSetupRequest**. Таким образом, при установке для этого свойства значения _TRUE_ *+00:00* добавляется к формату даты и времени.
- **WMSADDRESSID** — задайте для этого свойства значение _TRUE_, чтобы использовать номер склада в заголовке заказа на покупку как значение **addressID** в адресе **ShipTo** для запроса заказа на покупку, который отправляется поставщику. Если задать значение для свойства **FIXEDSHIPADDRESSID**, это значение имеет приоритет над данным значением. Поэтому следует использовать одно свойство или другое, чтобы задать значение **addressID** в адресе **ShipTo** для документа.
- **PUNCHOUTSHIPTOUSER** — это свойство совместно используется вместе со свойством **PUNCHOUTSHIPTO**. Если для параметра **PUNCHOUTSHIPTO** указано значение _TRUE_, то будет выбран адрес юридического лица. Если для параметра **PUNCHOUTSHIPTOUSER** задано значение _TRUE_, вместо адреса юридического лица используется основной адрес пользователя внешнего заказа.

### <a name="activate-the-external-catalog"></a>Активация внешнего каталога

После завершения настройки всех свойств и настройки других параметров для внешнего каталога вернитесь на экспресс-вкладку **Общие** страницы **Внешние каталоги** и установите для параметра **Активный** значение *Да*.

### <a name="attach-notes-to-a-purchase-order"></a><a name="attach-po-notes"></a>Прикрепление примечаний к заказу на покупку

Как упоминалось в разделе [Задание свойств заказа](#set-order-properties), если необходимо, чтобы поставленные cXML включали текст из примечаний, приложенных к соответствующему заказу на покупку и/или записям поставщика, можно установить для свойства **POCOMMENTS** и/или **VENDCOMMENTS** значение _TRUE_ в настройке внешнего каталога. В этом разделе приводятся более подробные сведения о том, как система выбирает и обрабатывает такие вложения, если они используются.

Чтобы задать типы примечаний, которые будет искать система, перейдите в раздел **Закупки и источники \> Настройка \> Формы \> Из настройки**. Затем на вкладке **Заказ на покупку** установите в поле **Включить документы типа** тип примечаний, которые требуется иметь возможность включать. Будут включены только текстовые примечания, а не вложенные документы.

![Страница настройки формы.](media/cxml-form-setup.png "Страница настройки формы")

Вложения будут включены в заказ на покупку только в том случае, если в их поле **Тип** установлено значение, выбранное в поле **Включить документы типа**, и если их поле **Ограничение** задано значение _Внешнее_. Чтобы создать, просмотреть или изменить вложения для заказа на покупку, перейдите в раздел **Закупки и источники \> Все заказы на покупку**, выберите или создайте заказ на покупку, затем нажмите кнопку **Вложения** (символ скрепки) в верхнем правом углу.

![Вложенное примечание, настроенное для отправки поставщику.](media/cxml-note-to-vendor.png "Вложенное примечание, настроенное для отправки поставщику")

## <a name="view-the-cxml-cart-message-log-for-external-catalog-punchout"></a><a name="message-log"></a>Просмотр журнала сообщений корзины cXML для внешнего каталога внешнего заказа

При установке для поля **Тип протокола внешнего заказа** значения _cXML_ для внешнего каталога система фиксирует журнал сообщений корзин, полученный назад от поставщиков. Этот журнал может использоваться для устранения неполадок и других целей обработки данных.

Чтобы открыть журнал для внешнего каталога, выберите соответствующий каталог, а затем на панели операций выберите **Журнал сообщений корзины cXML**. На странице **Журнал сообщений корзины cXML** отображается список возвращенных корзин, XML, который относится к этим корзинам, и строки, созданные в соответствующей заявке на покупку.

![Страница журнал сообщений корзины cXML.](media/cxml-cart-message-log.png "Страница журнал сообщений корзины cXML")

## <a name="set-the-extrinsic-elements-for-external-catalog-punchout"></a>Задание внешних элементов для внешнего каталога внешнего заказа

При установке для поля **Тип протокола внешнего заказа** значения *cXML* для внешнего каталога можно добавить настраиваемые внешние элементы, которые будут вставлены в правильное место в сообщении запроса XML.

Чтобы добавить внешние элементы во внешний каталог, выполните следующие действия.

1. Перейдите в раздел **Закупки и источники \> Каталоги \> Внешние каталоги**.
1. Выберите соответствующий каталог.
1. На экспресс-вкладке **Формат сообщений** в разделе **Внешние** выберите **Добавить** для добавления строки к сетке для каждого внешнего элемента, который требуется включить. В каждой строке заполните следующие поля:

    - **Имя** — введите имя для элемента. Это значение станет значением атрибута **name** для элемента XML **Extrinsic**, который создается каждой строкой. Обычно вы будете работать с поставщиком, чтобы согласовать имя для каждого из внешних элементов.
    - **Значение** — выберите значение для элемента. Это значение станет значением элемента XML, который создается каждой строкой. Доступны следующие значения:

        - **Имя пользователя** — использовать имя пользователя, который выполняет внешний заказ. Это имя является именем для входа в Supply Chain Management.
        - **Адрес электронной почты пользователя** — использовать адрес электронной почты пользователя, который выполняет внешний заказ. Этот адрес представляет собой адрес, настроенный пользователем на вкладке **Учетная запись** страницы **Параметры пользователя**.
        - **Случайное значение** — используется уникальное случайное значение.
        - **Полное имя пользователя** — используется полное имя контактного лица, которое связано с пользователем, обращающимся к внешнему каталогу.
        - **Имя** — используется имя контактного лица, которое связано с пользователем, обращающимся к внешнему каталогу.
        - **Фамилия** — используется фамилия контактного лица, которое связано с пользователем, обращающимся к внешнему каталогу.
        - **Номер телефона** — используется основной номер телефона контактного лица, которое связано с пользователем, обращающимся к внешнему каталогу.

![Параметры внешних элементов.](media/cxml-extrinsics.png "Параметры внешних элементов")

Пользователь или администратор не увидит внешние элементы, так как они не добавляются до тех пор, пока пользователь не выполнит внешний заказ. Они будут автоматически вставлены между элементами **BuyerCookie** и **BrowserFromPost** в сообщении запроса настройки cXML. Таким образом, нет необходимости задавать их вручную в XML при настройке внешнего каталога.

![Внешние элементы, добавленные в XML.](media/cxml-extrinsics-xml.png "Внешние элементы, добавленные в XML")

## <a name="create-and-process-a-purchase-order"></a><a name="create-po"></a>Создание и обработка заказа на покупку

При создании заказа на покупку для поставщика он наследует настройку параметра **Отправлять заказ на покупку с помощью cXML** из данного поставщика. Однако этот параметр остается доступным на экспресс-вкладке **Настройка** в представлении **Заголовок** заказа на покупку, поэтому при необходимости его можно изменить позже.

![Заказ на покупку, настроенный на использование cXML.](media/cxml-purchase-order.png "Заказ на покупку, настроенный на использование cXML")

При создании заказа на покупку из заявки на закупку, которая поступила из потока внешнего заказа, все необходимые сведения о строке будут заполнены. Затем можно вручную добавлять строки заказа на покупку или скопировать их из других заказов на покупку. Обязательно задайте все обязательные поля. Эти обязательные поля включают внешний ссылочный номер, который является номером поставщика, который будет использоваться в сообщении cXML.

![Пример номера внешней ссылки.](media/cxml-line-details.png "Пример номера внешней ссылки")

После завершения заполнения всех сведений для заказа на покупку обязательно подтвердите его. Сообщение не отправляется, если заказ на покупку не подтвержден. Чтобы подтвердить заказ на покупку, на панели операций на вкладке **Покупка** в группе **Действия** выберите **Подтвердить**. 

После подтверждения заказа на покупку можно просмотреть статус подтверждения в журналах **Подтверждения заказов на покупку**. В области действий на вкладке **Покупка** в группе **Журналы** выберите **Подтверждения заказов на покупку**.

Каждый заказ на покупку может иметь много подтверждений. Каждое подтверждение помечается увеличивающимся порядковым номером. На следующем рисунке заказ на покупку *00000275*, а подтверждение — *00000275-1*. Эта нумерация отражает стандартную функциональность Supply Chain Management, в которой изменения в заказе на покупку и, следовательно, тип сообщения cXML, которое должно быть отправлен поставщику, определяется на основе подтверждения. Как показано на рисунке, страница **Подтверждения заказа на покупку** содержит также поля **Статус отправки заказа** и **Статус запрос на заказ у поставщика**. Дополнительные сведения о различных значениях статуса, которые могут отображаться на этой странице, см. в разделе [Отслеживание запросов заказов на покупку](#monitor-po-requests) далее в этой теме.

![Страница подтверждений заказов на покупку.](media/cxml-po-confirmations.png "Страница подтверждений заказов на покупку")

Для просмотра дополнительных сведений о документе выберите **Запрос заказа на покупку** над сеткой.

Страница **Запрос заказа на покупку** содержит две сетки. Сетка в верхней части страницы имеет одну запись для каждого заказа на покупку, помеченного для отправки. Сетка на вкладке **История запросов заказов на покупку** в нижней части страницы может иметь несколько записей для выбранного заказа на покупку, чтобы указать статус каждого подтверждения. На следующем рисунке показан заказ на покупку 00000275 в верхней сетке и документ 00000275-1 в сетке на вкладке **История запросов заказов на покупку**.

![Страница запросов заказов на покупку.](media/cxml-po-request.png "Страница запросов заказов на покупку")

Если пакетное задание настроено и запущено, документ будет отправлен. Можно просмотреть статус изменения после отправки документа. На следующем рисунке в поле **Статус отправки заказа** установлено значение _Отправлено_. В поле **Статус запроса заказа у поставщика** задано значение _Подтвержден_, чтобы указать, что поставщик получил документ и смог прочитать его и сохранить в своей системе. В сетке на вкладке **История запросов заказов на покупку** отображается время, когда документ был отправлен. Дополнительные сведения о различных значениях статуса, которые могут отображаться на этой странице, см. в разделе [Отслеживание запросов заказов на покупку](#monitor-po-requests).

![Сообщения о состоянии на странице запросов заказов на покупку.](media/cxml-po-request-2.png "Сообщения о состоянии на странице запросов заказов на покупку")

## <a name="schedule-the-purchase-order-request-batch-job"></a><a name="po-batch"></a>Планирование пакетного задания запросов заказов на покупку

Чтобы активировать пакетное задание для отправки запросов заказов на покупку, перейдите на страницу **Закупки и источники \> Настройка \> Управление cXML \> Запрос заказа на покупку**, затем на панели операций на вкладке **Запрос заказа на покупку** в группе **Пакетное задание** выберите **Отправить задание**, чтобы открыть диалоговое окно **Подготовка и отправка запроса заказа на покупку**. Это диалоговое окно можно использовать для настройки периодичности, так же как обычно для пакетных заданий в Supply Chain Management. Выберите интервал в соответствии с объемом заказа. Хотя пакетное задание может быть запущено каждую минуту, вероятно, лучше всего отправлять партии в течение рабочего дня, используя окна приема заказов, соответствующие графикам работы поставщиков.

Например, поставщик имеет политику, которая указывает, что все заказы, полученные до 13:00, будут отгружены в этот же день. В этом случае пакетное задание может быть запущено несколько раз утром, чтобы передать все существующие заказы. Остальные заказы будут затем отправлены на следующий день. Это решение является исключительно бизнес-решением. Его можно просмотреть его и задать соответствующие параметры.

Процесс будет искать документы запросов заказов на покупку, имеющие статус *Ожидание*. Если имеется заказ, который должен быть отправлен поставщику немедленно, можно выбрать **Отправить задание** и установить для параметра **Пакетная обработка** значение *Нет*.

## <a name="monitor-purchase-order-requests"></a><a name="monitor-po-requests"></a>Мониторинг запросов заказов на покупку

### <a name="view-the-status-of-a-purchase-order"></a>Просмотр статуса заказа на покупку

Когда заказы, которые могут быть отправлены через cXML, подтверждаются, они переходят в статус _Ожидание_. Как было описано в разделе [Создание и обработка заказа на покупку](#create-po), можно просмотреть статус заказа на покупку на странице **Запрос заказа на покупку**. Каждый запрос заказа на покупку может иметь один или несколько статусов в зависимости от его параметров и данных. В этом разделе описываются различные типы состояний и значения, которые они могут иметь. Эти сведения могут помочь в управлении вопросами и понимании статуса заказов на покупку.

![Статус заказа на покупку на странице запросов заказов на покупку.](media/cxml-monitor-po-request.png "Статус заказа на покупку на странице запросов заказов на покупку")

Сетка в верхней части страницы **Запрос заказа на покупку** может содержать следующие значения статуса:

- **Статус отправки заказа** — это поле может иметь одно из следующих значений:

    - **Ожидание** — документ ожидает отправки.
    - **Отправлен** — документ отправлен.
    - **Остановлено** — документ был помечен как _Остановлено_ перед отправкой. (Чтобы пометить документ как _Остановлено_, выберите **Остановить** на панели операций страницы **Запрос на покупку**.)
    - **Архив** — документ очищен. (Чтобы очистить документ, выберите **Очистить** на панели операций страницы **Запрос на покупку**.)

- **Статус запроса заказа у поставщика** — это поле может иметь одно из следующих значений:

    - **Ожидание** — документ ожидает отправки.
    - **Подтверждено** — документ был подтвержден как полученный поставщиком. Просмотреть подробное XML-сообщение, возвращенное поставщиком, можно на вкладке **XML ответа** в нижней части страницы.
    - **Ошибка** — документ был отправлен поставщику, но произошла ошибка. Просмотреть сообщение об ошибке можно, выбрав вкладку **XML ответа** в нижней части страницы.

Сетка на вкладке **История запросов заказов на покупку** в нижней части страницы **Запрос заказа на покупку** может содержать следующие значения:

- **Тип запроса заказа** — это поле может иметь одно из следующих значений:

    - **Создать** — строка помечается как новая сразу после подтверждения заказа на покупку.
    - **Обновить** — если подтверждение уже было отправлено и подтверждено поставщиком, следующее подтверждение будет помечено как _Обновление_. Обновления будут отправляться только в том случае, если в параметре **Отправлять обновления запросов на покупку** установлено значение *Да* в [глобальных параметрах cXML](#cxml-parameters).
    - **Удалить** — если подтверждение уже было отправлено и подтверждено поставщиком, но заказ на покупку отменен, то ожидающее подтверждение будет помечено как _Удаление_. Удаления будут отправляться только в том случае, если в параметре **Отправлять удаления запросов на покупку** установлено значение *Да* в [глобальных параметрах cXML](#cxml-parameters).

- **Время запроса** — время создания подтверждения заказа. Время запроса можно сравнить со временем статуса заказа, чтобы определить время между подтверждением и подтверждением поставщика.
- **Статус отправки заказа** — это поле совпадает со значением поля **Статус заказа на отправку** в верхней части страницы. Оно повторяется здесь, чтобы упростить просмотр состояния на уровне подтверждения. Если поле **Тип запроса заказа** имеет значение *Создать*, и заказ на покупку заново подтверждается перед отправкой подтверждения, в поле **Статус отправки заказа** устанавливается значение *Архив*.
- **Время статуса заказа** — время последнего обновления записи журнала запросов заказов на покупку. (Обновления включают изменения статуса.)
- **Статус запроса заказа у поставщика** — это поле совпадает со значением поля **Статус запроса заказа у поставщика** в верхней части страницы. Оно повторяется здесь, чтобы упростить просмотр состояния на уровне подтверждения.
- **Время повторной отправки** — время, когда запись была снова отправлена.
- **Число повторных передач** — количество раз, когда запись была повторно отправлена. Большое число указывает на несколько сбоев, поэтому может указывать на проблему с настройкой данных или настройкой данных у вашего поставщика.

### <a name="view-the-xml-for-a-purchase-order-request-message"></a>Просмотр XML для сообщения запроса заказа на покупку

Чтобы просмотреть XML для сообщения запроса заказа на покупку, выберите вкладку **Текст запроса XML** в нижней части страницы **Запрос заказа на покупку**. Сведения на этой вкладке могут быть полезны при тестировании или проверке ошибок. Чтобы сведения были более удобочитаемыми, их можно просмотреть в виде форматированного сообщения. Скопируйте содержимое вкладки в текстовый файл, затем просмотрите его в редакторе XML.

![Вкладка текста запроса XML.](media/cxml-request-xml-text.png "Вкладка текста запроса XML")

### <a name="view-the-details-of-the-vendor-response"></a>Просмотр сведений об ответе поставщика

Чтобы просмотреть содержимое подтверждения поставщика или отклика об ошибке, перейдите на вкладку **XML ответа** в нижней части страницы **Запрос заказа на покупку**.

![Вкладка XML ответа.](media/cxml-response-xml.png "Вкладка XML ответа")

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Настройка внешнего каталога для PunchOut eProcurement](set-up-external-catalog-for-punchout.md)
- [Использование внешних каталогов для электронных закупок с внешними заказами](use-external-catalogs-for-punchout.md)


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
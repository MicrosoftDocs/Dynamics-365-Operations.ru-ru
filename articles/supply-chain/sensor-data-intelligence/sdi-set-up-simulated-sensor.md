---
title: Настройка симулятора датчика для тестирования
description: В этой статье описывается, как настроить симулятор, который можно использовать для проверки Аналитики данных датчиков, не устанавливая физические датчики.
author: johanhoffmann
ms.date: 09/02/2022
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: johanho
ms.search.validFrom: 2022-09-02
ms.dyn365.ops.version: 10.0.30
ms.openlocfilehash: dc8bd020a53214abab28ec51ffc6d6be74979932
ms.sourcegitcommit: c5f2cba3c2b0758e536eeaaa40506659a53085e1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/12/2022
ms.locfileid: "9643985"
---
# <a name="set-up-a-simulated-sensor-for-testing"></a>Настройка симулятора датчика для тестирования

[!include [banner](../includes/banner.md)]
[!INCLUDE [preview-banner](../includes/preview-banner.md)]

Если вы хотите протестировать Аналитику данных датчиков, не устанавливая физические датчики, вы можете воспользоваться службой *интерактивного модулятора Raspberry PI Интернета вещей Azure*, чтобы смоделировать сигналы датчика и отправить их в решение Интернета вещей (IoT) в Microsoft Azure. Дополнительные сведения о симуляторе см. в разделе [Подключение интерактивного модулятора Raspberry Pi к Центру Интернета вещей Azure (Node.js)](/azure/iot-hub/iot-hub-raspberry-pi-web-simulator-get-started).

## <a name="video-instructions"></a>Видеоинструкции

В следующем видео показано, как настроить симулятор датчика для тестирования. В других разделах этой статьи приводятся те же инструкции в текстовом формате.

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE588g6]

## <a name="create-a-device-in-azure-iot-hub"></a>Создание устройства в Центре Интернета вещей Azure

Необходимо сначала настроить устройство для проверки подлинности сигналов датчика в Центре Интернета вещей Azure

1. В Azure перейдите к списку ресурсов для группы ресурсов, созданной для использования с Аналитикой данных датчиков. (Дополнительные сведения см. в разделе [Развертывание решения Интернета вещей в Azure](sdi-deploy-iot-solution-on-azure.md).)
1. В списке ресурсов найдите запись, в которой в поле **Тип** указано значение *Центр Интернета вещей*. В столбце **Имя**, выберите имя, чтобы открыть страницу сведений о ресурсе.
1. В левой панели навигации выберите **Устройства**.
1. На странице **Устройства** выберите **Добавить устройство**.
1. На странице **Создать устройство** задайте следующие поля:

    - **Код устройства** — введите имя для нового устройства (например, *My-IoT-Device*).
    - **Тип аутентификации** — выберите *Симметричные ключи*.
    - **Автоматически создавать ключи** — установите этот флажок.
    - **Подключить это устройство к Центру Интернета вещей** — выберите *Включить*.

1. Выберите **Сохранить**, чтобы вернуться на страницу **Устройства**.
1. Найдите новое устройство в списке. В столбце **Код устройства**, выберите имя, чтобы открыть страницу сведений об устройстве. Если новое устройство не отображается в списке, обновите страницу.
1. Скопируйте значение **Основная строка подключения** (например, нажав кнопку **Копировать в буфер обмена**). Это значение потребуется в дальнейшем при настройке модулятора Raspberry Pi IoT для эмуляции сигналов датчика. Поэтому рекомендуем временно скопировать его в текстовый файл.

## <a name="add-the-azure-connection-string-to-the-raspberry-pi-iot-simulator"></a>Добавьте строку подключения Azure в модулятор Raspberry Pi IoT

Выполните следующие действия, чтобы добавить строку подключения с устройства в Центре Интернета вещей Azure в сценарий в службе Raspberry.

1. Откройте [модулятор Raspberry Pi IoT](https://azure-samples.github.io/raspberry-pi-web-simulator/).
1. В панели редактора кода найдите строку, которая содержит следующую команду.

    `const connectionString = '[Your IoT hub device connection string]';`

1. Замените текст справки, включая скобки, значением **Основной строки подключения**, скопированным в предыдущем разделе. Результат должен быть похож на следующий пример.

    `const connectionString = 'HostName=XXX;DeviceId=YYY;SharedAccessKey=ZZZ';`

## <a name="add-sensor-ids-and-values-to-the-payload-in-the-raspberry-pi-iot-simulator"></a>Добавьте коды и значения датчиков в полезные данные в модуляторе Raspberry Pi IoT

Теперь необходимо настроить модулятор Raspberry Pi IoT с моделируемыми датчиками и значениями, которые они будут отправлять как полезные данные.

- В редакторе кода модулятора Raspberry Pi IoT найдите функцию `getMessage` и измените ее так, чтобы она соответствовала следующему коду. (Датчики настраиваются в строках `cb()`.)

    ```cpp
    function getMessage(cb) {
        messageId++;
        sensor.readSensorData()
        .then(function (data) {
            cb(JSON.stringify({ value: 1, sensorId: 'MachineStatus' }), false);
            cb(JSON.stringify({ value: 70, sensorId: 'Quality' }), false);
            cb(JSON.stringify({ value: 1, sensorId: 'AssetMaintenance' }), false);
            cb(JSON.stringify({ value: 1, sensorId: 'ProductionDelay' }), false);
            cb(JSON.stringify({ value: 20, sensorId: 'AssetDowntime' }), false);
        })
        .catch(function (err) {
            console.error('Failed to read out sensor data: ' + err);
        });
    }
    ```

    > [!IMPORTANT]
    > Коды датчиков, заданные в редакторе кода для модулятора Raspberry Pi IoT, должны совпадать с кодами датчиков, которые будут указаны далее для сценариев в Supply Chain Management. В приведенном выше коде используются удобные для чтения коды датчиков. Однако в реальном ситуации коды датчиков будут иметь значения глобального уникального идентификатора (GUID), предоставляемые изготовителями датчиков. Удобные для чтения коды датчиков, используемые в этом примере кода, также используются в примерах в [Сценарии качества продукта](sdi-scenario-product-quality.md), [Сценарии обслуживания активов](sdi-scenario-asset-maintenance.md), [Сценарии задержки производства](sdi-scenario-production-delays.md) и [Сценарии статуса оборудования](sdi-scenario-equipment-downtime.md)). Поэтому используйте этот код, если вы будете работать с этими сценариями.

## <a name="edit-the-interval-for-sending-sensor-signals"></a>Изменение интервала отправки сигналов датчика

Теперь необходимо задать интервал, с которым модулятор Raspberry Pi IoT должен отправлять эмулированные сигналы датчиков.

1. В редакторе кода модулятора Raspberry Pi IoT найдите следующий вызов функции.

    `setInterval(sendMessage, 2000);`

2. По умолчанию модулятор Raspberry Pi IoT отправляет сигнал датчика каждые 2000 миллисекунд (две секунды). Если требуется, это значение можно изменить.

## <a name="run-the-raspberry-pi-iot-simulator"></a>Запуск модулятора Raspberry Pi IoT

- Выберите **Запуск**, чтобы запустить модулятор и начать отправку смоделированных данных датчика.

---
title: Расчет дат поставки для заказа на продажу с использованием CTP
description: Функция "Доступно для заказа с учетом производства (CTP)" позволяет предоставлять клиентам реалистичные даты возможной поставки определенных товаров. В этой статье описывается, как настроить и использовать функцию CTP в каждой подсистеме планирования (надстройке "Оптимизация планирования" и встроенной подсистеме).
author: t-benebo
ms.date: 07/20/2022
ms.topic: article
ms.search.form: SalesAvailableDlvDates, SalesTable, CustParameters, InventItemOrderSetup
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: benebotg
ms.search.validFrom: 2022-07-20
ms.dyn365.ops.version: 10.0.28
ms.openlocfilehash: 9a2d8a66fe7e68ebd5729a401af3f0efe04051b1
ms.sourcegitcommit: e0905a3af85d8cdc24a22e0c041cb3a391c036cb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2022
ms.locfileid: "9229944"
---
# <a name="calculate-sales-order-delivery-dates-using-ctp"></a>Расчет дат поставки для заказа на продажу с использованием CTP

[!include [banner](../../includes/banner.md)]
[!INCLUDE [preview-banner](../../includes/preview-banner.md)]

Функция "Доступно для заказа с учетом производства (CTP)" позволяет предоставлять клиентам реалистичные даты возможной поставки определенных товаров. Для каждой строки продажи можно указать дату, с учетом имеющихся в наличии запасов, производственных мощностей и времени транспортировки.

CTP расширяет функцию [Доступно для резервирования](../../sales-marketing/delivery-dates-available-promise-calculations.md) (ATP) путем учета информации о мощностях. В то время как в ATP учитывается только доступность материалов и предполагаются бесконечные мощности, CTP рассматривает доступность как материалов, так и мощностей. Поэтому данный метод предоставляет более реалистичную картину того, может ли спрос быть удовлетворен в течение определенного интервала времени.

Функция CTP работает немного по-разному в зависимости от того, какая подсистема планирования используется: надстройка "Оптимизация планирования" или встроенная подсистема сводного планирования. В этой статье описывается, как настроить ее в каждой подсистеме. CTP для надстройки "Оптимизация планирования" в настоящее время поддерживает только часть сценариев CTP, поддерживаемых встроенным ядром.

## <a name="turn-on-ctp-for-planning-optimization"></a>Включение CTP в надстройке "Оптимизация планирования"

Вы всегда можете использовать функцию CTP встроенной подсистемы сводного планирования. Однако если вы хотите использовать CTP для надстройки "Оптимизация планирования", необходимо включить ее в системе. Администраторы могут использовать параметры [управления компонентами](../../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) для проверки статуса функции и ее включения. В рабочей области **Управление функциями** эта функция перечисляется следующими способами:

- **Модуль:** *Сводное планирование*
- **Имя функции:** *(Предварительная версия) CTP для "Оптимизации планирования"*

## <a name="how-ctp-compares-to-atp"></a>Разница между CTP и ATP

CTP и ATP похожи, но CTP часто обеспечивает более точный результат, как показано в следующем примере.

Номенклатура A — это номенклатура, которая состоит из номенклатуры B и C, а количество номенклатуры A в наличии равно нулю (0). При выполнении проверки ATP, которая учитывает только материалы, количество ATP также будет равно нулю (0). Однако если выполняется проверка с помощью CTP, система проверяет доступность номенклатур B и C, проверяет ресурсы, необходимые для включения их в номенклатуру A, и вычисляет, сколько номенклатуры A можно создать. Кроме того, CTP может проверять в своих расчетах наличие ресурсов и материалов, необходимых для получения дополнительного объема номенклатур B и C с их последующим использованием для создания дополнительного объема номенклатуры A.

Расчет CTP, в котором учитываются как материалы, так и ресурсы, может возвращать большее количество, чем расчет, основанный только на проверке материалов (особенно если проверяемая номенклатура является собираемой на заказ). Иначе говоря, функциональность CTP основана на функции развертывания, и ее можно выполнить для выбранной строки заказа на продажу, чтобы рассчитать ожидаемую дату поставки.

## <a name="how-ctp-differs-depending-on-the-master-planning-engine-that-you-use"></a>Отличия CTP в зависимости от используемого механизма сводного планирования

В приведенной ниже таблице сведены различия между CTP для надстройки "Оптимизация планирования" и CTP для встроенной подсистемы сводного планирования.

| Элемент | Оптимизация планирования | Встроенная подсистема сводного планирования |
|---|---|---|
| Параметр **Контроль даты поставки** для заказов, строк заказов и продуктов | *CTP для оптимизации планирования* | *CTP* |
| Время расчета | Расчет запускается путем выполнения динамического плана в качестве запланированной задачи. | Расчет немедленно запускается каждый раз при вводе или обновлении строки заказа на продажу. |
| Значение поля **Статус CTP для оптимизации планирования** | <p>Отображается значение *Не готово* для заказов и строк заказов, для которых не выполнялся динамический план после создания или последнего обновления заказов и строк.</p><p>Значение *Готово* отображается для заказов и строк, для которых производился расчет подтвержденных дат поставки с помощью CTP путем запуска динамического плана.</p> | Значение *Готово* отображается всегда. |

## <a name="set-default-delivery-date-control-methods"></a><a name="default-methods"></a>Настройка методов управления датой поставки по умолчанию

В системе могут использоваться различные методы для расчета оценки даты поставки для каждого заказа и каждой строки заказа. Необходимо задать метод управления датой поставки, который будет использоваться чаще всего в качестве глобального метода по умолчанию. Можно также установить индивидуальные переопределения для каждого продукта. Позже вы сможете переопределить методы по умолчанию для любого заказа или строки заказа, если это потребуется.

### <a name="set-the-global-default-delivery-date-control"></a><a name="global-default"></a>Настройка глобального управления датой поставки по умолчанию

Метод управления датой поставки по умолчанию будет применен ко всем новым строкам заказа, для которых не применяется переопределение. Чтобы выбрать метод, выполните указанные ниже действия.

1. Перейдите в раздел **Расчеты с клиентами \> Настройка \> Параметры модуля расчетов с клиентами**.
1. На вкладке **Отгрузки** на экспресс-вкладке **Управление поставкой** в поле **Контроль даты поставки** выберите метод, который хотите использовать в качестве метода по умолчанию для вашей компании.

    - *Нет* — не рассчитывать даты поставок.
    - *Время упреждения для продаж* — время упреждения для продаж представляет собой время, затрачиваемое с момента создания заказа на продажу до отправки номенклатуры. Расчет даты поставки основан на количестве дней по умолчанию и не учитывает доступность запасов, известный спрос или запланированные поставки.
    - *ATP* — ATP — это количество номенклатуры, которое доступно и может быть зарезервировано для клиента на определенную дату. Расчет ATP включает незадействованные запасы, значения времени упреждения, плановые поступления и расходы.
    - *ATP + резервное время для отпуска* — дата отгрузки равна дате ATP плюс резервное время для отпуска номенклатуры. Резервное время для отпуска — это время, необходимое для подготовки номенклатур для отгрузки.
    - *CTP* — использование расчета CTP встроенной подсистемы сводного планирования. Если используется оптимизация планирования, *метод управления датой поставки CTP* не разрешен, и его выбор приведет к ошибке при выполнении расчета.
    - *CTP для оптимизации планирования* — использование для расчета CTP надстройки "Оптимизация планирования". Этот параметр не действует, если используется встроенная подсистема сводного планирования.

### <a name="set-delivery-date-control-overrides-for-individual-products"></a>Переопределение управления датой поставки для отдельных продуктов

Можно назначить переопределения для определенных продуктов, для которых требуется использовать метод управления датой поставки, отличный от того, который установлен в качестве глобального метода по умолчанию.

1. Выберите **Управление сведениями о продукте \> Продукты \> Выпущенные продукты**.
1. Выберите продукт, который необходимо настроить.
1. На панели действий на вкладке **Управление запасами** в группе **Настройки заказа** выберите **Параметры заказа по умолчанию**.
1. На странице **Параметры заказов по умолчанию** на экспресс-вкладке **Заказ на продажу** установите для параметра **Переопределить управление поставками** значение *Да*.
1. В поле **Контроль даты поставки** выберите метод, который будет использоваться для выбранного продукта. Доступны те же параметры, которые описаны в разделе [Настройка глобального управления датой поставки по умолчанию](#global-default).

## <a name="schedule-ctp-for-planning-optimization-calculations"></a><a name="batch-job"></a>Расписание CTP для расчетов "Оптимизации планирования"

При использовании CTP для надстройки "Оптимизация планирования" необходимо запустить динамический план, чтобы система выполнила расчеты CTP, а затем установить подтвержденные даты отгрузки и поступления для всех соответствующих заказов. План должен включать все номенклатуры, для которых требуются подтвержденные даты отгрузки и приемки. (При использовании CTP для встроенной подсистемы планирования расчеты CTP немедленно выполняются локально. Таким образом, нет необходимости выполнять динамический план, чтобы увидеть результаты CTP.)

Чтобы обеспечить своевременную доступность дат для всех пользователей, рекомендуется настроить пакетные задания для регулярного выполнения соответствующих планов. Например, пакетное задание, которое настроено на выполнение динамического плана каждые 30 минут, будет устанавливать подтвержденные даты отгрузки и получения каждые 30 минут. Таким образом, пользователям, которые вводят заказы и выполняют импорт заказов, придется ждать не более 30 минут, чтобы получить подтвержденные даты отгрузки и получения.

Чтобы настроить пакетное задание для регулярного запуска динамического плана в обычном расписании, выполните указанные ниже действия.

1. Перейдите в раздел **Сводное планирование \> Сводное планирование \> Выполнить \> Сводное планирование**.
1. В диалоговом окне **Сводное планирование** на экспресс-вкладке **Параметры** укажите в поле **Сводный план** динамический план, который требуется выполнить.
1. На экспресс-вкладке **Выполнять в фоновом режиме** установите для параметра **Пакетная обработка** значение *Да*.
1. Выберите **Повторение** и, если необходимо, настройте график.
1. Нажмите кнопку **ОК**, чтобы сохранить график.
1. Нажмите кнопку **ОК**, чтобы создать пакетное задание и закрыть диалоговое окно.

## <a name="use-ctp-for-built-in-master-planning"></a>Использование CTP для встроенной подсистемы планирования

### <a name="create-a-new-order-by-using-ctp-for-built-in-master-planning"></a>Создание нового заказа с помощью CTP для встроенного сводного планирования

Для каждого добавляемого нового заказа на продажу или строки заказа система назначает метод управления датой поставки по умолчанию. Заголовок заказа всегда начинается с глобального метода по умолчанию. Если для заказанной номенклатуры назначено переопределение, новая строка заказа будет использовать это переопределение. В противном случае для новой строки заказа будет также использоваться глобальный метод по умолчанию. Поэтому необходимо задать методы по умолчанию, которые будут соответствовать наиболее часто используемому методу управления датой поставки. После создания заказа можно при необходимости переопределить метод по умолчанию на уровне заголовка заказа или строки заказа. Дополнительные сведения см. в разделах [Настройка методов управления датой поставки по умолчанию](#default-methods) и [Изменение существующих заказов на продажу для использования CTP](#change-orders).

### <a name="view-confirmed-delivery-dates-when-you-use-ctp-for-built-in-master-planning"></a>Просмотр подтвержденных дат поставки при использовании CTP для встроенного сводного планирования

При использовании встроенного механизма планирования, расчеты CTP применяются к заказам и строкам заказов, для которых в поле **Контроль даты поставки** указано значение *CTP*.

Для строк продаж, использующих CTP для встроенного сводного планирования, система автоматически устанавливает поля **Подтвержденная дата отгрузки** и **Подтвержденная дата приемки** при каждом сохранении строки продажи. Если позднее в строку продаж вносятся определенные изменения (например, путем изменения количества или узла), сразу происходит перерасчет дат.

- Чтобы просмотреть подтвержденные даты поставки для строки заказа на продажу, откройте заказ на продажу и выберите строку заказа на продажу. Затем на экспресс-вкладке **Сведения о строке** на вкладке **Поставка** проверьте значения полей **Подтвержденная дата отгрузки** и **Подтвержденная дата прихода**.
- Чтобы просмотреть подтвержденные даты поставки для всего заказа, откройте заказ на продажу и выберите представление **Заголовок**. Затем на экспресс-вкладке **Поставка** проверьте значения в полях **Подтвержденная дата отгрузки** и **Подтвержденная дата прихода**.

## <a name="use-ctp-for-planning-optimization"></a>Использование CTP для надстройки "Оптимизация планирования"

### <a name="create-a-new-order-by-using-ctp-for-planning-optimization"></a>Создание нового заказа с помощью CTP для "Оптимизации планирования"

Для каждого добавляемого нового заказа на продажу или строки заказа система назначает метод управления датой поставки по умолчанию. Заголовок заказа всегда начинается с глобального метода по умолчанию. Если для заказанной номенклатуры назначено переопределение, новая строка заказа будет использовать это переопределение. В противном случае для новой строки заказа будет также использоваться глобальный метод по умолчанию. Поэтому необходимо задать методы по умолчанию, которые будут соответствовать наиболее часто используемому методу управления датой поставки. После создания заказа можно при необходимости переопределить метод по умолчанию на уровне заголовка заказа или строки заказа. Дополнительные сведения см. в разделах [Настройка методов управления датой поставки по умолчанию](#default-methods) и [Изменение существующих заказов на продажу для использования CTP](#change-orders).

### <a name="view-confirmed-delivery-dates-when-using-ctp-for-planning-optimization"></a>Просмотр подтвержденных дат поставки при использовании CTP для надстройки "Оптимизация планирования"

При использовании надстройки "Оптимизация планирования" расчеты CTP применяются к заказам и строкам заказов, для которых в поле **Контроль даты поставки** указано значение *CTP для оптимизации планирования*.

Для строк продаж, использующих CTP для "Оптимизации планирования", поля **Подтвержденная дата отгрузки** и **Подтвержденная дата прихода** будут оставаться пустыми, пока не будет выполнен соответствующий динамический план (обычно с использованием периодического пакетного задания). Затем они устанавливаются автоматически. Дополнительные сведения см. в разделе [Расписание CTP для расчетов "Оптимизации планирования"](#batch-job).

Поле **Статус CTP для оптимизации планирования** указывает, были ли рассчитаны подтвержденные даты, которые еще не указаны для каждой строки, использующей CTP для надстройки "Оптимизация планирования". В поле отображается значение *Не готово* для строк и заказов, для которых подтвержденные даты поставки еще не были рассчитаны или больше не являются допустимыми вследствие других изменений. В нем отображается значение *Готово* для строк и заказов, которые были рассчитаны. Можно просмотреть статус для каждой строки и для всего заказа.

- Чтобы просмотреть статус для строки заказа на продажу, откройте заказ на продажу и выберите строку заказа на продажу. Затем на экспресс-вкладке **Сведения по строке** на вкладке **Поставка** проверьте значение поля **Статус CTP для оптимизации планирования**. Поля **Подтвержденная дата отгрузки** и **Подтвержденная дата прихода** для этой строки также отображаются на данной вкладке после их расчета.
- Чтобы просмотреть статус всего заказа, откройте заказ на продажу и выберите представление **Заголовок**. Затем на экспресс-вкладке **Поставка** проверьте значение поля **Статус CTP для оптимизации планирования**. Поля **Подтвержденная дата отгрузки** и **Подтвержденная дата прихода** для этого заказа также отображаются на данной вкладке после их расчета.

<!-- KFM: The following text may be untrue and needs to be reviewed with the PM for next revision:

The sales orders that are *Ready* or *Not ready* are shown in the **All sales orders** list page. You can check the sales order that are *Ready* or *Not ready* from the sales order list page by filtering on this new status field.

-->

> [!NOTE]
> - Если обновить строку заказа на продажу, после того как CTP для надстройки "Оптимизация планирования" рассчитает подтвержденные даты, система очистит эти даты до следующего запуска соответствующего динамического плана.
> - При редактировании соответствующего параметра, который может повлиять на существующие подтвержденные даты (например, путем изменения времени упреждения, резервирования или маркировки), следует удалить подтвержденные даты для соответствующих существующих заказов. Это действие приведет к тому, что статус каждой соответствующей строки изменится на *Не готово*. Это изменение приведет к пересчету системой подтвержденных дат при следующем запуске динамического плана.

## <a name="change-existing-sales-orders-so-that-they-use-ctp"></a><a name="change-orders"></a>Изменение существующих заказов на продажу для использования CTP

Значение **Контроль даты поставки** можно изменить для любого открытого заказа в любое время. Можно изменить это значение на уровне заголовка или для каждой строки по мере необходимости.

### <a name="change-to-ctp-at-the-order-header-level"></a>Изменение CTP на уровне заголовка заказа

<!-- KFM: Would be nice to mention how changing this setting on the header affects the individual lines. -->

Чтобы изменить заказ так, чтобы он использовал CTP, на уровне заголовка заказа, выполните указанные ниже действия.

1. Перейдите в раздел **Расчеты с клиентами \> Заказы \> Все заказы на продажу**.
1. Откройте заказ на продажу, который необходимо настроить, или создайте новый.
1. Выберите пункт **Заголовок**, чтобы открыть информацию о заголовке на странице **Сведения о заказе на продажу**.
1. На Экспресс-вкладке **Поставка** задайте в поле **Управление датой поставки** одно из приведенных ниже значений в зависимости от используемой подсистемы планирования.

    - *CTP* — использование расчета CTP встроенной подсистемы сводного планирования. При использовании надстройки "Оптимизация планирования" метод управления датой поставки *CTP* не разрешен. Таким образом, если выбрано это значение, при запуске расчетов произойдет ошибка.
    - *CTP для оптимизации планирования* — использование для расчета CTP надстройки "Оптимизация планирования". Этот параметр не действует, если используется встроенная подсистема планирования.

<!-- KFM: Additional dialogs are shown here. Review these with the PM and expand this procedure at next revision. -->
1. Выберите **ОК**, чтобы применить изменения.

### <a name="change-to-ctp-at-the-order-line-level"></a>Изменение CTP на уровне строки заказа

Если строка заказа была создана с помощью другого метода управления датой поставки, можно в любой момент перевести ее на CTP. Изменения, вносимые на уровне строки, не влияют на другие строки. Однако они могут привести к тому, что общие даты доставки заказа будут смещаться вперед или назад, в зависимости от того, как меняется обновленный расчет каждой строки. <!-- KFM: Confirm this intro at next revision -->

Чтобы изменить заказ так, чтобы он использовал CTP для встроенного сводного планирования, на уровне строки заказа, выполните указанные ниже действия.

1. Перейдите в раздел **Расчеты с клиентами \> Заказы \> Все заказы на продажу**.
1. Откройте заказ на продажу, который необходимо настроить, или создайте новый.
1. На странице **Сведения о заказе на продажу** на экспресс-вкладке **Строки заказа на продажу** выберите строку заказа на продажу, которую необходимо настроить.
1. На экспресс-вкладке **Сведения по строке** на вкладке **Поставка** введите в поле **Контроль даты поставки** одно из указанных ниже значений в зависимости от используемой подсистемы планирования.

    - *CTP* — использование расчета CTP встроенной подсистемы сводного планирования. При использовании надстройки "Оптимизация планирования" метод управления датой поставки *CTP* не разрешен. Таким образом, если выбрано это значение, при запуске расчетов произойдет ошибка.
    - *CTP для оптимизации планирования* — использование для расчета CTP надстройки "Оптимизация планирования". Этот параметр не действует, если используется встроенная подсистема планирования.

    Появится диалоговое окно **Доступные даты отгрузки и приемки**, в котором отображаются доступные даты отгрузки и приемки. Это диалоговое окно работает аналогичным образом и для строк заказов, и для заголовка заказа (см. описание в предыдущем разделе).

1. На панели операций выберите **Сохранить**.

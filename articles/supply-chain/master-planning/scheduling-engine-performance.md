---
title: Повышение производительности подсистемы планирования
description: В этом разделе приводятся сведения о подсистеме планирования и о том, как повысить производительность.
author: ChristianRytt
manager: tfehr
ms.date: 09/03/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.custom: 19311
ms.assetid: 5ffb1486-2e08-4cdc-bd34-b47ae795ef0f
ms.search.region: Global
ms.search.industry: ''
ms.author: kamaybac
ms.search.validFrom: 2020-09-03
ms.dyn365.ops.version: ''
ms.openlocfilehash: 2c39a72d22c01faec3856e7f47cb6b3811447cab
ms.sourcegitcommit: 38d40c331c8894acb7b119c5073e3088b54776c1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2021
ms.locfileid: "4983449"
---
# <a name="improve-scheduling-engine-performance"></a><span data-ttu-id="2857c-103">Повышение производительности подсистемы планирования</span><span class="sxs-lookup"><span data-stu-id="2857c-103">Improve scheduling engine performance</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="2857c-104">Подсистема планирования ресурсов используется при планировании маршрутов для запланированных и выпущенных производственных заказов.</span><span class="sxs-lookup"><span data-stu-id="2857c-104">The resource scheduling engine is used when scheduling routes for planned and released production orders.</span></span> <span data-ttu-id="2857c-105">Подсистема первоначально была выпущена как часть Dynamics AX 2012 и претерпела несколько улучшений с момента ее выпуска.</span><span class="sxs-lookup"><span data-stu-id="2857c-105">The engine was originally released as part of Dynamics AX 2012 and has gone through several improvements since its release.</span></span>

<span data-ttu-id="2857c-106">[Проблема планирования производственных заданий](https://en.wikipedia.org/wiki/Job_shop_scheduling) является чрезвычайно сложной комбинаторной проблемой, в которой время решения растет экспоненциально с количеством переменных принятия решения.</span><span class="sxs-lookup"><span data-stu-id="2857c-106">The [job shop scheduling problem](https://en.wikipedia.org/wiki/Job_shop_scheduling) is an extremely complex combinatorial problem where solution time grows exponentially with the number of decision variables.</span></span> <span data-ttu-id="2857c-107">Часто клиенты настраивают маршруты производства и соответствующие данные таким образом, что проблема планирования не может быть решена за разумное время даже на самом современном оборудовании.</span><span class="sxs-lookup"><span data-stu-id="2857c-107">Oftentimes, customers set up production routes and related data in a way that results in a scheduling problem that can't be solved in reasonable time even on the most modern hardware.</span></span> <span data-ttu-id="2857c-108">Этот раздел поможет понять подсистему планирования и определить влияние определенной настройки на производительность.</span><span class="sxs-lookup"><span data-stu-id="2857c-108">This topic will help you understand the scheduling engine and how a specific setup can have influence on the performance.</span></span>

<span data-ttu-id="2857c-109">Когда дело доходит до повышения производительности планирования, общие рекомендации рекомендуют уменьшить сложность проблемы, которую должна решить подсистема.</span><span class="sxs-lookup"><span data-stu-id="2857c-109">When it comes to improving the performance of the scheduling, general guidelines recommend reducing the complexity of the problem the engine needs to solve.</span></span> <span data-ttu-id="2857c-110">Ниже приведены основные факторы, которые могут повлиять на производительность:</span><span class="sxs-lookup"><span data-stu-id="2857c-110">Some of the main factors that can affect performance include:</span></span>

- <span data-ttu-id="2857c-111">Маршруты с большим количеством операций</span><span class="sxs-lookup"><span data-stu-id="2857c-111">Routes with many operations</span></span>
- <span data-ttu-id="2857c-112">Маршруты с параллельными операциями</span><span class="sxs-lookup"><span data-stu-id="2857c-112">Routes with parallel operations</span></span>
- <span data-ttu-id="2857c-113">Операции с количеством ресурсов более единицы</span><span class="sxs-lookup"><span data-stu-id="2857c-113">Operations with quantity of resources higher than one</span></span>
- <span data-ttu-id="2857c-114">Операции с многими применимыми ресурсами</span><span class="sxs-lookup"><span data-stu-id="2857c-114">Operations with many applicable resources</span></span>
- <span data-ttu-id="2857c-115">Использование жестких связей</span><span class="sxs-lookup"><span data-stu-id="2857c-115">Use of hard links</span></span>
- <span data-ttu-id="2857c-116">Использование ограничения по мощности</span><span class="sxs-lookup"><span data-stu-id="2857c-116">Use of finite capacity</span></span>
- <span data-ttu-id="2857c-117">Число различных используемых календарей</span><span class="sxs-lookup"><span data-stu-id="2857c-117">The number of different calendars used</span></span>
- <span data-ttu-id="2857c-118">Число интервалов рабочего времени в день в календаре</span><span class="sxs-lookup"><span data-stu-id="2857c-118">The number of working time slots per day in the calendar</span></span>
- <span data-ttu-id="2857c-119">Общая длительность маршрута</span><span class="sxs-lookup"><span data-stu-id="2857c-119">Total duration of the route</span></span>
- <span data-ttu-id="2857c-120">Параллельное выполнение нескольких подсистем планирования</span><span class="sxs-lookup"><span data-stu-id="2857c-120">Running multiple scheduling engines in parallel</span></span>

## <a name="overview-of-basic-scheduling-flow"></a><span data-ttu-id="2857c-121">Обзор основного потока планирования</span><span class="sxs-lookup"><span data-stu-id="2857c-121">Overview of basic scheduling flow</span></span>

<span data-ttu-id="2857c-122">Чтобы понять, как данная настройка может влиять на производительность, важно понять, как выполняется процесс, как внутри подсистемы, так и в коде X++, окружающем ее.</span><span class="sxs-lookup"><span data-stu-id="2857c-122">To understand how a given setup can affect performance, it is important to understand something about how the process flows, both inside the engine and in the X++ code that surrounds it.</span></span>

<span data-ttu-id="2857c-123">Базовый процесс планирования заказа состоит из трех основных шагов:</span><span class="sxs-lookup"><span data-stu-id="2857c-123">The basic process of scheduling an order consists of three main steps:</span></span>

- <span data-ttu-id="2857c-124">**Загрузка данных** — здесь модели данных X++ преобразуются в модель внутренних данных подсистемы в форме заданий и ограничений.</span><span class="sxs-lookup"><span data-stu-id="2857c-124">**Loading data** – Here, the X++ data models are transformed into the engine's internal data model in the form of jobs and constraints.</span></span>
- <span data-ttu-id="2857c-125">**Планирование** — это основной источник для планирования, который обрабатывает данную модель и ограничения и создает результат.</span><span class="sxs-lookup"><span data-stu-id="2857c-125">**Scheduling** – This is the main source for scheduling that processes the given model and constraints, and generates a result.</span></span> <span data-ttu-id="2857c-126">В ходе этого процесса подсистема будет запрашивать сведения о рабочем времени и существующих резервированиях мощностей из X++ по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="2857c-126">During this process, the engine will request working time information and existing capacity reservations from X++ as needed.</span></span>
- <span data-ttu-id="2857c-127">**Сохранение данных** — результат подсистеме в форме слотов резервирования мощностей для задания обрабатывается кодом X++ для сохранения резервирований мощностей и обновления значений времени начала и завершения заданий/операций/заказов.</span><span class="sxs-lookup"><span data-stu-id="2857c-127">**Save data** – The engine result in the form of job capacity reservation slots is processed by X++ code to save capacity reservations and update the start and end times of the jobs/operation/order.</span></span>

## <a name="load-data-into-the-engine"></a><span data-ttu-id="2857c-128">Загрузка данных в подсистему</span><span class="sxs-lookup"><span data-stu-id="2857c-128">Load data into the engine</span></span>

<span data-ttu-id="2857c-129">В подсистеме планирования имеется более абстрактная модель данных, чем база данных Supply Chain Management, поскольку она была создана как универсальный механизм, который может обрабатывать различные источники данных.</span><span class="sxs-lookup"><span data-stu-id="2857c-129">The scheduling engine has a more abstract data model than the Supply Chain Management database because it has been built as a generic engine that can handle different sources of data.</span></span> <span data-ttu-id="2857c-130">Понятия маршрута, вторичных операций и времени выполнения необходимо "перевести" в универсальную модель заданий и ограничений, предоставляемую подсистемой.</span><span class="sxs-lookup"><span data-stu-id="2857c-130">The concepts of route, secondary operations, and run time need to be "translated" into the generic job and constraint model that the engine exposes.</span></span> <span data-ttu-id="2857c-131">Логика создания модели содержит значительный объем бизнес-логики и различается в зависимости от исходных данных.</span><span class="sxs-lookup"><span data-stu-id="2857c-131">The logic for building the model has a significant amount of business logic to it and is different depending on the source data.</span></span> <span data-ttu-id="2857c-132">Ответственным классом X++ является `WrkCtrScheduler`, который имеет производные классы для спланированных производственных заказов, запущенных в производство производственных заказов и прогнозов проектов.</span><span class="sxs-lookup"><span data-stu-id="2857c-132">The responsible X++ class is `WrkCtrScheduler` and it has derived classes for planned production orders, released production orders, and project forecasts.</span></span>

<span data-ttu-id="2857c-133">В качестве примера рассмотрим маршрут, показанный в следующей таблице и на изображении, который кажется относительно простым.</span><span class="sxs-lookup"><span data-stu-id="2857c-133">As an example, consider a route shown in the following table and image, which seems relatively simple.</span></span>

| <span data-ttu-id="2857c-134">Операция.</span><span class="sxs-lookup"><span data-stu-id="2857c-134">Oper.</span></span> <span data-ttu-id="2857c-135">№ п/п</span><span class="sxs-lookup"><span data-stu-id="2857c-135">No.</span></span> | <span data-ttu-id="2857c-136">Приоритет</span><span class="sxs-lookup"><span data-stu-id="2857c-136">Priority</span></span> | <span data-ttu-id="2857c-137">Время настройки</span><span class="sxs-lookup"><span data-stu-id="2857c-137">Setup time</span></span> | <span data-ttu-id="2857c-138">Время выполнения</span><span class="sxs-lookup"><span data-stu-id="2857c-138">Run time</span></span> | <span data-ttu-id="2857c-139">Время ожидания "после"</span><span class="sxs-lookup"><span data-stu-id="2857c-139">Queue time after</span></span> | <span data-ttu-id="2857c-140">Количество ресурсов</span><span class="sxs-lookup"><span data-stu-id="2857c-140">Quantity of resources</span></span> | <span data-ttu-id="2857c-141">Следующий</span><span class="sxs-lookup"><span data-stu-id="2857c-141">Next</span></span> |
| --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="2857c-142">10</span><span class="sxs-lookup"><span data-stu-id="2857c-142">10</span></span> | <span data-ttu-id="2857c-143">Первичные</span><span class="sxs-lookup"><span data-stu-id="2857c-143">Primary</span></span> | <span data-ttu-id="2857c-144">1.00</span><span class="sxs-lookup"><span data-stu-id="2857c-144">1.00</span></span> | <span data-ttu-id="2857c-145">2.00</span><span class="sxs-lookup"><span data-stu-id="2857c-145">2.00</span></span> | | <span data-ttu-id="2857c-146">1</span><span class="sxs-lookup"><span data-stu-id="2857c-146">1</span></span> | <span data-ttu-id="2857c-147">20</span><span class="sxs-lookup"><span data-stu-id="2857c-147">20</span></span> |
| <span data-ttu-id="2857c-148">10</span><span class="sxs-lookup"><span data-stu-id="2857c-148">10</span></span> | <span data-ttu-id="2857c-149">Вторичные&nbsp;1</span><span class="sxs-lookup"><span data-stu-id="2857c-149">Secondary&nbsp;1</span></span> | | | | <span data-ttu-id="2857c-150">1</span><span class="sxs-lookup"><span data-stu-id="2857c-150">1</span></span> | <span data-ttu-id="2857c-151">20</span><span class="sxs-lookup"><span data-stu-id="2857c-151">20</span></span> |
| <span data-ttu-id="2857c-152">20</span><span class="sxs-lookup"><span data-stu-id="2857c-152">20</span></span> | <span data-ttu-id="2857c-153">Первичные</span><span class="sxs-lookup"><span data-stu-id="2857c-153">Primary</span></span> | | <span data-ttu-id="2857c-154">3.00</span><span class="sxs-lookup"><span data-stu-id="2857c-154">3.00</span></span> | <span data-ttu-id="2857c-155">1.00</span><span class="sxs-lookup"><span data-stu-id="2857c-155">1.00</span></span> | <span data-ttu-id="2857c-156">3</span><span class="sxs-lookup"><span data-stu-id="2857c-156">3</span></span> | <span data-ttu-id="2857c-157">0</span><span class="sxs-lookup"><span data-stu-id="2857c-157">0</span></span> |

<span data-ttu-id="2857c-158">![Пример схемы маршрута](media/scheduling-engine-route.png "Пример схемы маршрута")</span><span class="sxs-lookup"><span data-stu-id="2857c-158">![Example rout diagram](media/scheduling-engine-route.png "Example rout diagram")</span></span>

<span data-ttu-id="2857c-159">При отправке этого в подсистему он разделяется на восемь заданий, как показано на следующем рисунке (выберите изображение, чтобы увеличить его).</span><span class="sxs-lookup"><span data-stu-id="2857c-159">When sending this to the engine, it is split out into eight jobs, as shown in the following illustration (select the image to enlarge it).</span></span>

<span data-ttu-id="2857c-160">[![Задания механизма планирования](media/scheduling-engine-jobs.png "Задания механизма планирования")](media/scheduling-engine-jobs-large.png)</span><span class="sxs-lookup"><span data-stu-id="2857c-160">[![Scheduling engine jobs](media/scheduling-engine-jobs.png "Scheduling engine jobs")](media/scheduling-engine-jobs-large.png)</span></span>

<span data-ttu-id="2857c-161">Стандартная связь между двумя заданиями — это `FinishStart`, что означает, что время завершения одного задания должно предшествовать времени начала другого задания.</span><span class="sxs-lookup"><span data-stu-id="2857c-161">The standard link between two jobs is `FinishStart`, meaning that the end time of one job must be before the start time of another job.</span></span> <span data-ttu-id="2857c-162">Так как эта настройка должна выполняться тем же ресурсом, который позже выполнит процесс, существуют ограничения `OnSameResource` между ними.</span><span class="sxs-lookup"><span data-stu-id="2857c-162">Because the setup must be performed by the same resource that will later do the process, there are `OnSameResource` constraints between them.</span></span> <span data-ttu-id="2857c-163">Между заданиями для первичной и вторичной операции для 10 имеются связи `StartStart` и `FinishFinish`, что означает, что задания должны начинаться и заканчиваться одновременно, и существуют ограничения `NotOnSameResource`, которые не допускают один и тот же ресурс для первичной и вторичной операций.</span><span class="sxs-lookup"><span data-stu-id="2857c-163">Between the jobs for primary and secondary operation for 10, there are `StartStart` and `FinishFinish` links, which means that the jobs must both start and end at the same time, and there are `NotOnSameResource` constraints, which will prevent the same resource for primary and secondary.</span></span>

<span data-ttu-id="2857c-164">Для операции 20, где для количества ресурсов было установлено значение 3, задание процесса разделяется на три отдельных задания, где все задания должны выполняться точно в одно время.</span><span class="sxs-lookup"><span data-stu-id="2857c-164">For operation 20, where the quantity of resources has been set to 3, the process job has been split into three distinct jobs where all the jobs must run at the exact same time.</span></span>
<span data-ttu-id="2857c-165">В этом случае маршрутная группа была настроена на то, чтобы не резервировать мощность для очереди после времени, поэтому существует только одно задание для этой очереди после.</span><span class="sxs-lookup"><span data-stu-id="2857c-165">In this case, the route group has been set up to not reserve capacity for queue after times, which is why there is only a single job for the queue after.</span></span>

<span data-ttu-id="2857c-166">Подсистема планирования только понимает концепции заданий и не имеет представления об операциях.</span><span class="sxs-lookup"><span data-stu-id="2857c-166">The scheduling engine only understands the concepts of jobs and has no notion of operations.</span></span> <span data-ttu-id="2857c-167">Это означает, что при планировании операций эти операции также разбиваются на задания, хотя они не будут сохранены в базе данных.</span><span class="sxs-lookup"><span data-stu-id="2857c-167">This means that when doing operation scheduling, the operations are also split into jobs, although these will not be persisted in the database.</span></span>

<span data-ttu-id="2857c-168">Для каждого задания также будет определена потребность в мощностях для задания (требуемое количество секунд).</span><span class="sxs-lookup"><span data-stu-id="2857c-168">For each job, we will also define what the job capacity requirement is (the number of seconds required).</span></span> <span data-ttu-id="2857c-169">В зависимости от того, как были определены требования к ресурсам, для каждого задания можно также отправить список всех потенциально применимых ресурсов, на которых может выполняться задание, и определить потребность в мощностях для этого конкретного ресурса.</span><span class="sxs-lookup"><span data-stu-id="2857c-169">Depending on how the resource requirements have been defined, we may also, for each job, send a list of all the potential applicable resources that the job could run on and what the capacity requirement is for that specific resource.</span></span> <span data-ttu-id="2857c-170">Несмотря на то, что список подходящих ресурсов отсылается при создании модели, подсистеме все равно тербуется обеспечить, чтобы назначения ресурсов было действительно действительно для всей продолжительности задания.</span><span class="sxs-lookup"><span data-stu-id="2857c-170">Even though the list of applicable resources is sent when building the model, the engine will still need to ensure that the resource assignment is actually valid for the entire job duration.</span></span>

## <a name="scheduling-engine-internals"></a><span data-ttu-id="2857c-171">Внутренний механизм планирования</span><span class="sxs-lookup"><span data-stu-id="2857c-171">Scheduling engine internals</span></span>

### <a name="scheduling-engine-interface"></a><span data-ttu-id="2857c-172">Интерфейс механизма планирования</span><span class="sxs-lookup"><span data-stu-id="2857c-172">Scheduling engine interface</span></span>

<span data-ttu-id="2857c-173">Чтобы получить представление о внутреннем функционировании подсистемы, лучше рассмотреть функции, предоставляемые ею снаружи.</span><span class="sxs-lookup"><span data-stu-id="2857c-173">To get an idea of how the engine works internally, it is best to look at the functionality it exposes externally.</span></span> <span data-ttu-id="2857c-174">В X++ основным интерфейсом является `WrkCtrSchedulerEngineInterface`.</span><span class="sxs-lookup"><span data-stu-id="2857c-174">In X++, the main interface is `WrkCtrSchedulerEngineInterface`.</span></span> <span data-ttu-id="2857c-175">Он имеет методы, описанные в следующих подразделах.</span><span class="sxs-lookup"><span data-stu-id="2857c-175">It has the methods described in the following subsections.</span></span>

#### <a name="general-engine"></a><span data-ttu-id="2857c-176">Общая подсистема</span><span class="sxs-lookup"><span data-stu-id="2857c-176">General engine</span></span>

| <span data-ttu-id="2857c-177">**Метод**</span><span class="sxs-lookup"><span data-stu-id="2857c-177">**Method**</span></span> | <span data-ttu-id="2857c-178">**Целевые назначения**</span><span class="sxs-lookup"><span data-stu-id="2857c-178">**Purpose**</span></span> |
| --- | --- |
| `run` | <span data-ttu-id="2857c-179">Планирует все загруженные задания и возвращает код ошибки.</span><span class="sxs-lookup"><span data-stu-id="2857c-179">Schedules all loaded jobs and returns the error code.</span></span> |
| `getJobSchedulingSequenceResult` | <span data-ttu-id="2857c-180">Получает результат планирования и первое задание с ошибкой для последовательности, определяемой конкретным заданием.</span><span class="sxs-lookup"><span data-stu-id="2857c-180">Gets the scheduling result and the first error job for the sequence identified by a specific job.</span></span> |
| `validateJobCapacityReservations` | <span data-ttu-id="2857c-181">Проверяет резервирования мощности для всех заданий, сохраненных подсистемой.</span><span class="sxs-lookup"><span data-stu-id="2857c-181">Validates the capacity reservations for all the jobs stored by the engine.</span></span> |
| `setReservationsTimeStamp` | <span data-ttu-id="2857c-182">Посылает метку времени в подсистему, устанолвенную на все новые резервирования мощности для запланированных заданий в кэше подсистемы.</span><span class="sxs-lookup"><span data-stu-id="2857c-182">Sends a timestamp to the engine set on all new capacity reservations for the scheduled jobs in the cache of the engine.</span></span> |
| `addPropertyToGroupAggregation` | <span data-ttu-id="2857c-183">Добавляет префикс свойства в набор свойств, используемых при статистической обработке мощности.</span><span class="sxs-lookup"><span data-stu-id="2857c-183">Adds a property prefix to the set of properties used when capacity is aggregated.</span></span> |
| `addResource` | <span data-ttu-id="2857c-184">Добавляет ресурс в пул ресурсов подсистемы планирования.</span><span class="sxs-lookup"><span data-stu-id="2857c-184">Adds a resource to the scheduling engine resource pool.</span></span> |
| `addResourceGroup` | <span data-ttu-id="2857c-185">Добавляет группу ресурсов в пул групп ресурсов подсистемы планирования.</span><span class="sxs-lookup"><span data-stu-id="2857c-185">Adds a resource group to the scheduling engine resource group pool.</span></span> |
| `addResourceGroupMembership` | <span data-ttu-id="2857c-186">Добавляет ресурс в качестве участника группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2857c-186">Adds a resource as a member to a resource group.</span></span> |
| `addOptimizationGoal` | <span data-ttu-id="2857c-187">Добавляет цель оптимизации планирования (продолжительность или приоритет).</span><span class="sxs-lookup"><span data-stu-id="2857c-187">Adds a scheduling optimization goal (duration or priority).</span></span> |

#### <a name="individual-jobs"></a><span data-ttu-id="2857c-188">Отдельные задания</span><span class="sxs-lookup"><span data-stu-id="2857c-188">Individual jobs</span></span>

| <span data-ttu-id="2857c-189">**Метод**</span><span class="sxs-lookup"><span data-stu-id="2857c-189">**Method**</span></span> | <span data-ttu-id="2857c-190">**Целевые назначения**</span><span class="sxs-lookup"><span data-stu-id="2857c-190">**Purpose**</span></span> |
| --- | --- |
| `addJobInfo` | <span data-ttu-id="2857c-191">Добавляет запись сведений о задании, которая информирует подсистему о задании, которое должно быть запланировано.</span><span class="sxs-lookup"><span data-stu-id="2857c-191">Adds a job information record that informs the engine about a job that should be scheduled.</span></span> |
| `addConstraintJobEndsAt` | <span data-ttu-id="2857c-192">Добавляет ограничение, в соответстви с которым задание должно заканчиваться в указанные дату и время.</span><span class="sxs-lookup"><span data-stu-id="2857c-192">Adds a constraint that a job should end at a specified date and time.</span></span> |
| `addConstraintJobStartsAt` | <span data-ttu-id="2857c-193">Добавляет ограничение, в соответстви с которым задание должно начинаться в указанные дату и время.</span><span class="sxs-lookup"><span data-stu-id="2857c-193">Adds a constraint that a job should start at a specified date and time.</span></span> |
| `addConstraintMaxJobDays` | <span data-ttu-id="2857c-194">Определяет ограничение, что задание может охватывать указанное максимальное число дней.</span><span class="sxs-lookup"><span data-stu-id="2857c-194">Defines the constraint that a job can span over a specified maximal number of days.</span></span> |
| `addConstraintResourceRequirement` | <span data-ttu-id="2857c-195">Добавляет ограничение, что задание должно быть запланировано на конкретный ресурс.</span><span class="sxs-lookup"><span data-stu-id="2857c-195">Adds the constraint that the job must be scheduled on a specific resource.</span></span> |
| `addJobBindPriority` | <span data-ttu-id="2857c-196">Добавляет приоритет привязки задания для пары (задание, уровень ограничения).</span><span class="sxs-lookup"><span data-stu-id="2857c-196">Adds a job bind priority for a (job, constraint level) pair.</span></span> <span data-ttu-id="2857c-197">Значение с более высоким приоритетом означает, что переменные задания будут привязаны ранее.</span><span class="sxs-lookup"><span data-stu-id="2857c-197">A higher priority value means the job variables will be bound earlier.</span></span> <span data-ttu-id="2857c-198">Задание будет обработано перед заданиями с более низким значением приоритета в одной и той же последовательности.</span><span class="sxs-lookup"><span data-stu-id="2857c-198">The job will be processed before jobs with lower priority value in the same sequence.</span></span> |
| `addJobCapacity` | <span data-ttu-id="2857c-199">Добавляет сведения о загрузке мощности для задания (например, для требуемого времени выполнения задания) независимо от того, на каком ресурсе запущено задание.</span><span class="sxs-lookup"><span data-stu-id="2857c-199">Adds capacity load information for a job (like the required job runtime) independent on which resource the job runs on.</span></span> |
| `addJobResourceCapacity` | <span data-ttu-id="2857c-200">Добавляет ресурс в набор ресурсов, которые могут использоваться для выполнения задания, и задает мощность, требуемую при запуске на этом ресурсе.</span><span class="sxs-lookup"><span data-stu-id="2857c-200">Adds a resource to the set of resources that may be used to perform a job, and states the capacity required when running on that resource.</span></span> |
| `addJobGoal` | <span data-ttu-id="2857c-201">Добавляет сведения о цели задания для определенного уровня ограничения (самое раннее время окончания или самое позднее время начала).</span><span class="sxs-lookup"><span data-stu-id="2857c-201">Adds job goal information for a specific constraint level (earliest end time or latest start time).</span></span> |
| `addJobResourcePriority` | <span data-ttu-id="2857c-202">Добавляет приоритет, который будет использоваться при планировании задания на ресурсе.</span><span class="sxs-lookup"><span data-stu-id="2857c-202">Adds the priority to use when a job is scheduled on a resource.</span></span> |
| `addJobResourceRuntime` | <span data-ttu-id="2857c-203">Указывается время задания, зависящее от ресурса, для которого будет запланировано задание.</span><span class="sxs-lookup"><span data-stu-id="2857c-203">Specifies a job time that is dependent of the resource the job will be scheduled on.</span></span> |
| `addJobRuntime` | <span data-ttu-id="2857c-204">Указывается время задания, независящее от ресурса, на котором будет запланировано задание.</span><span class="sxs-lookup"><span data-stu-id="2857c-204">Specifies a job time that is independent of the resource on which the job will be scheduled.</span></span> |
| `scheduleJobOnResourceGroup` | <span data-ttu-id="2857c-205">Помечает задание для планирования на уровне группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2857c-205">Marks a job for scheduling on the resource group level.</span></span> |
| `setJobResourcePreemptionAllowed` | <span data-ttu-id="2857c-206">Определяет, разрешено ли вытеснение для задания в ресурсе (если подсистеме разрешается запланировать задание в нескольких несвязанных слотах мощности).</span><span class="sxs-lookup"><span data-stu-id="2857c-206">Sets whether preemption is allowed for a job on a resource (if engine is allowed to schedule the job in noncontiguous capacity slots).</span></span> |
| `setRequiredNumberOfResources` | <span data-ttu-id="2857c-207">Задает число ресурсов, необходимых для планирования задания (только для планирования операций).</span><span class="sxs-lookup"><span data-stu-id="2857c-207">Sets the number of resources required to schedule a job (only for operations scheduling).</span></span> |

#### <a name="constraints-between-jobs"></a><span data-ttu-id="2857c-208">Ограничения между заданиями</span><span class="sxs-lookup"><span data-stu-id="2857c-208">Constraints between jobs</span></span>

| <span data-ttu-id="2857c-209">**Метод**</span><span class="sxs-lookup"><span data-stu-id="2857c-209">**Method**</span></span> | <span data-ttu-id="2857c-210">**Целевые назначения**</span><span class="sxs-lookup"><span data-stu-id="2857c-210">**Purpose**</span></span> |
| --- | --- |
| `addJobLink` | <span data-ttu-id="2857c-211">Добавляет ссылку (например, окончание\>запуск) между двумя заданиями.</span><span class="sxs-lookup"><span data-stu-id="2857c-211">Adds a link (such as finish\>start) between two jobs.</span></span> |
| `addConstraintEndsDelayed` | <span data-ttu-id="2857c-212">Определяет ограничение, что задание не может завершиться до окончания других заданий плюс некоторое время задержки.</span><span class="sxs-lookup"><span data-stu-id="2857c-212">Defines the constraint that a job cannot end before another jobs end plus some delay time.</span></span> |
| `addConstraintJobListWorkingTimeIntersect` | <span data-ttu-id="2857c-213">Добавляет ограничения, что слоты мощности, зарезервированные для заданий, должны быть в пересекающемся рабочем времени для двух ресурсов, используемых заданиями.</span><span class="sxs-lookup"><span data-stu-id="2857c-213">Adds a constraint that the capacity slots reserved for the jobs must be on the intersecting working times for the two resources used by the jobs.</span></span> |
| `addConstraintJobOverlap` | <span data-ttu-id="2857c-214">Добавляет ограничение, определяющее способ упорядочения заданий, когда определенное количество номенклатуры может быть перемещено между двумя ресурсами, пока первый ресурс все еще не завершил обработку, так что второй ресурс может начать обработку.</span><span class="sxs-lookup"><span data-stu-id="2857c-214">Add a constraint that defines how jobs are sequenced when a given quantity of an item can be moved between two resources while the first resource is still not finished processing, so that the second resource can start processing.</span></span> |
| `addConstraintNotOnSameResource` | <span data-ttu-id="2857c-215">Добавляет ограничение, что два задания не должны планироваться на одном и том же ресурсе.</span><span class="sxs-lookup"><span data-stu-id="2857c-215">Adds a constraint that two jobs should not be scheduled on the same resource.</span></span> |
| `addConstraintOnSameResource` | <span data-ttu-id="2857c-216">Добавляет ограничение, что два задания должны исопльзовать один и тот же ресурс.</span><span class="sxs-lookup"><span data-stu-id="2857c-216">Adds a constraint that two jobs must be using the same resource.</span></span> |
| `addJobSameReservations` | <span data-ttu-id="2857c-217">Добавляет ограничение, что задание должно в конечном итоге иметь резервирования мощностей для тех же временных интервалов, что и первичное задание.</span><span class="sxs-lookup"><span data-stu-id="2857c-217">Adds a constraint that a job must end up having capacity reservations for the same time slots as the primary job.</span></span> |
| `setPrimaryParallelJob` | <span data-ttu-id="2857c-218">Добавляет сведения о том, что задание является основным заданием в наборе параллельных заданий.</span><span class="sxs-lookup"><span data-stu-id="2857c-218">Adds information about what job is the primary job in a set of parallel jobs.</span></span> |

### <a name="solver"></a><span data-ttu-id="2857c-219">Решатель</span><span class="sxs-lookup"><span data-stu-id="2857c-219">Solver</span></span>

<span data-ttu-id="2857c-220">Сама по себе подсистема является специализированным средством решения ограничений с добавленными настраиваемыми эвристиками.</span><span class="sxs-lookup"><span data-stu-id="2857c-220">The engine itself is essentially a specialized constraint solver with custom heuristics added.</span></span> <span data-ttu-id="2857c-221">Поиск решения базируется на двух основных элементах: переменных и ограничениях.</span><span class="sxs-lookup"><span data-stu-id="2857c-221">The solver is based on two main elements: variables and constraints.</span></span>

#### <a name="variable"></a><span data-ttu-id="2857c-222">Переменная</span><span class="sxs-lookup"><span data-stu-id="2857c-222">Variable</span></span>

<span data-ttu-id="2857c-223">Переменная представляет домен возможных значений.</span><span class="sxs-lookup"><span data-stu-id="2857c-223">A variable represents a domain of possible values.</span></span> <span data-ttu-id="2857c-224">Подсистема планирования имеет два типа переменных:</span><span class="sxs-lookup"><span data-stu-id="2857c-224">Scheduling engine has two types of variables:</span></span>

- <span data-ttu-id="2857c-225">**Переменная DateTime** — содержит домен со всеми датами и временем, и домен может быть ограничен путем перемещения нижней и верхней границ для времени переменной ближе друг к другу.</span><span class="sxs-lookup"><span data-stu-id="2857c-225">**DateTime variable** - Has a domain of all dates and times, and the domain can be restricted by moving the lower and upper bound for the time of the variable closer to each other.</span></span>
- <span data-ttu-id="2857c-226">**Переменная ресурсов** — имеет домен применимых ресурсов, и домен можно ограничить, удалив ресурсы из списка.</span><span class="sxs-lookup"><span data-stu-id="2857c-226">**Resource variable** - Has a domain of applicable resources, and the domain can be restricted by eliminating resources from the list.</span></span>

#### <a name="constraint"></a><span data-ttu-id="2857c-227">Ограничение</span><span class="sxs-lookup"><span data-stu-id="2857c-227">Constraint</span></span>

<span data-ttu-id="2857c-228">Ограничение действует на переменные путем ограничения их доменов, но оно также зависит от переменных, так что оно активируется при изменении переменных.</span><span class="sxs-lookup"><span data-stu-id="2857c-228">A constraint acts on variables by restricting their domains, but it also depends on variables so it gets activated when variables change.</span></span> <span data-ttu-id="2857c-229">Процесс "распространение ограничения" происходит в том случае, когда ограничение выполняет свою основную функцию и сообщает основной логике, было ли выполнение успешным.</span><span class="sxs-lookup"><span data-stu-id="2857c-229">The process of "constraint propagation" is when a constraint performs its main function and reports back to the main logic if successful.</span></span>

<span data-ttu-id="2857c-230">Переменная считается связанной, если ее дальнейшее ограничение невозможно, что для переменной DateTime означает, что верхние и нижние границы одинаковы, и для переменной ресурса означает, что она имеет только один подходящий ресурс.</span><span class="sxs-lookup"><span data-stu-id="2857c-230">A variable is considered bound when it can't be restricted further, which for DateTime variable means that upper and lower bound is the same, and for the Resource variable that it has only a single applicable resource.</span></span> <span data-ttu-id="2857c-231">Когда все переменные связаны, найдено решение.</span><span class="sxs-lookup"><span data-stu-id="2857c-231">When all variables are bound, a solution is found.</span></span>

### <a name="constraint-levels"></a><span data-ttu-id="2857c-232">Уровни ограничений</span><span class="sxs-lookup"><span data-stu-id="2857c-232">Constraint levels</span></span>

<span data-ttu-id="2857c-233">Когда планирование выполняется как часть этапа покрытия планировании потребностей в материалах (MRP), заказы будут планироваться назад от даты потребности.</span><span class="sxs-lookup"><span data-stu-id="2857c-233">When scheduling is executed as part of the material requirements planning (MRP) coverage phase, the orders will be scheduled backward from requirement date.</span></span> <span data-ttu-id="2857c-234">Однако, если невозможно найти график, который начинается сегодня или позднее и заканчивается до даты потребности, то направление планирования изменится на "вперед от текущей даты".</span><span class="sxs-lookup"><span data-stu-id="2857c-234">However, if it is not possible to find a schedule that starts today or later and ends before the requirement date, then the scheduling direction will change to forward from today.</span></span>

<span data-ttu-id="2857c-235">Это основное бизнес-правило обрабатывается путем организации ограничений в уровнях.</span><span class="sxs-lookup"><span data-stu-id="2857c-235">This main business rule is handled by organizing the constraints in levels.</span></span> <span data-ttu-id="2857c-236">Если при использовании ограничений на самом высоком уровне решения не обнаружены, то все ограничения на этом уровне удаляются, и выполняется попытка на более низком уровне.</span><span class="sxs-lookup"><span data-stu-id="2857c-236">If no solution is found when using the constraints on the highest level, then the constraints on that level are all dropped, and the lower level is tried.</span></span> <span data-ttu-id="2857c-237">На практике это означает, что при обратном планировании модель будет содержать уровень 1 с целями задания с самым последним временем начала при заданном максимальном ограничении времени окончания (датой потребности) и уровнем 0 с целями задания более раннего времени окончания и заданным значением минимального ограничения времени начала, равным текущей дате.</span><span class="sxs-lookup"><span data-stu-id="2857c-237">In praxis, this means that for backward scheduling the model will contain a level 1 with job goals of latest start time given a maximum end time constraint (the requirement date), and a level 0 with job goals of earliest end time and given a minimum start time constraint of today.</span></span>

### <a name="algorithm"></a><span data-ttu-id="2857c-238">Алгоритм</span><span class="sxs-lookup"><span data-stu-id="2857c-238">Algorithm</span></span>

<span data-ttu-id="2857c-239">Основные этапы алгоритма подсистемы следующие:</span><span class="sxs-lookup"><span data-stu-id="2857c-239">The main steps of the engine algorithm are:</span></span>

1. <span data-ttu-id="2857c-240">Поиск последовательностей (цепочек заданий), которые могут быть решены отдельно.</span><span class="sxs-lookup"><span data-stu-id="2857c-240">Find sequences (job chains) which can be solved separately.</span></span>
1. <span data-ttu-id="2857c-241">Попытка найти исходное решение для последовательности с максимальным уровнем ограничения.</span><span class="sxs-lookup"><span data-stu-id="2857c-241">Try to find an initial solution for the sequence for the highest constraint level.</span></span>
    1. <span data-ttu-id="2857c-242">Сортировка заданий в последовательности на основе целей и приоритетов заданий, чтобы можно было найти начальное задание.</span><span class="sxs-lookup"><span data-stu-id="2857c-242">Sort the jobs in the sequence based on job goal and priorities, such that a start job can be found.</span></span>
    1. <span data-ttu-id="2857c-243">Просмотр заданий в цикле в следующем порядке:</span><span class="sxs-lookup"><span data-stu-id="2857c-243">Loop the jobs in the following sequence:</span></span>
        1. <span data-ttu-id="2857c-244">Поиск всех ограничений, которые необходимо распространить, и выполнение распространения.</span><span class="sxs-lookup"><span data-stu-id="2857c-244">Find all constraints that need to be propagated and run propagation.</span></span>
        1. <span data-ttu-id="2857c-245">Если все переменные для задания связаны, то обнаружено решение для этого задания.</span><span class="sxs-lookup"><span data-stu-id="2857c-245">If all variables for the job have been bound, then a solution for that job has been found.</span></span>
        1. <span data-ttu-id="2857c-246">Если одну из переменных невозможно связать без нарушения ограничений, выполняется откат привязки переменных, опробуется другое значение в домене (для переменной ресурса) и перезапускается распространение ограничения.</span><span class="sxs-lookup"><span data-stu-id="2857c-246">If one of the variables could not be bound without violating the constraints, then roll back the variable binding, try a different value in the domain (for resource variable), and rerun the constraint propagation.</span></span>
1. <span data-ttu-id="2857c-247">Если решение не найдено, удаляются все ограничения на текущем уровне ограничения, уровень ограничения снижается (если доступны более низкие уровни) и повторный поиск решения выполняется с новым набором ограничений.</span><span class="sxs-lookup"><span data-stu-id="2857c-247">If no solution was found, then all constraints on the current constraint level is removed, the constraint level lowered (if any lower levels are available) and solution search retried with the new set of constraint.</span></span>
1. <span data-ttu-id="2857c-248">Если подходящее решение было обнаружено, будет запущен этап оптимизации, который попытается найти лучшее решение, пока не будет достигнуто время ожидания оптимизации либо все сочетания ресурсов не будут исчерпаны.</span><span class="sxs-lookup"><span data-stu-id="2857c-248">If a feasible solution was found, then the optimization phase is started, which will try to find a better solution until the optimization timeout is reached or all resource combinations have been exhausted.</span></span>

<span data-ttu-id="2857c-249">Средство решения ограничений не знает о специфике алгоритма планирования.</span><span class="sxs-lookup"><span data-stu-id="2857c-249">The constraint solver is not aware of the specifics of the scheduling algorithm.</span></span> <span data-ttu-id="2857c-250">Вся "магия" происходит при определении и сочетании различных ограничений.</span><span class="sxs-lookup"><span data-stu-id="2857c-250">It is in the definition and combination of the various constraints that the "magic" happens.</span></span>

### <a name="determining-working-times"></a><span data-ttu-id="2857c-251">Определение значений рабочего времени</span><span class="sxs-lookup"><span data-stu-id="2857c-251">Determining working times</span></span>

<span data-ttu-id="2857c-252">Большая часть (внутренних) ограничений в подсистеме управляет рабочим временем и емкостью ресурса.</span><span class="sxs-lookup"><span data-stu-id="2857c-252">A large part of the (internal) constraints in the engine controls the working time and capacity of a resource.</span></span> <span data-ttu-id="2857c-253">Фактически задача состоит в том, чтобы пройти по интервалам рабочего времени для ресурса, начиная с заданной точки, в определенном направлении, и найти достаточно длинный интервал, в течение которого требуемая мощность (время) для задания может поместиться.</span><span class="sxs-lookup"><span data-stu-id="2857c-253">Essentially, the task is to traverse the working time slots for a resource from a given point in a given direction, and find a long enough interval in which the jobs required capacity (time) can fit.</span></span>

<span data-ttu-id="2857c-254">Для этого подсистеме необходимо знать значения рабочего времени ресурса.</span><span class="sxs-lookup"><span data-stu-id="2857c-254">To do this, the engine needs to know the working times of a resource.</span></span> <span data-ttu-id="2857c-255">В отличие от основной модели данных, значения рабочего времени *загружаются с отложенным запуском*, то есть они загружаются в подсистему по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="2857c-255">Opposite to the main model data, the working times are *lazy loaded*, meaning that they are loaded into the engine as needed.</span></span> <span data-ttu-id="2857c-256">Причиной этого подхода является то, что часто существуют значения рабочего времени в Supply Chain Management для календаря в течение очень долгого времени, и обычно существует много календарей, так что данные могут быть очень большими для предварительной загрузки.</span><span class="sxs-lookup"><span data-stu-id="2857c-256">The reason for this approach is that there are often working times in Supply Chain Management for a calendar for a very long period and typically many calendars exist so the data would be quite large to pre-load.</span></span>

<span data-ttu-id="2857c-257">Сведения о календаре запрашиваются подсистемой в виде фрагментов путем вызова метода класса X++ `WrkCtrSchedulingInteropDataProvider.getWorkingTimes`.</span><span class="sxs-lookup"><span data-stu-id="2857c-257">Calendar information is requested by the engine in chunks, by invoking the X++ class method `WrkCtrSchedulingInteropDataProvider.getWorkingTimes`.</span></span> <span data-ttu-id="2857c-258">Этот запрос предназначен для определенного кода календаря в заданном интервале времени.</span><span class="sxs-lookup"><span data-stu-id="2857c-258">The request is for a specific calendar ID in a specific time interval.</span></span> <span data-ttu-id="2857c-259">В зависимости от состояния кэша сервера в Supply Chain Management каждый из этих запросов может закончиться в нескольких вызовах базы данных, что занимает много времени (относительно чистого времени вычислений).</span><span class="sxs-lookup"><span data-stu-id="2857c-259">Depending on the state of the server cache in Supply Chain Management, each of these requests could end up in several database calls, which takes a long time (relative to the pure computational time).</span></span> <span data-ttu-id="2857c-260">Кроме того, если календарь содержит очень сложные определения рабочих часов с множеством интервалов рабочего времени в день, это увеличивает время загрузки.</span><span class="sxs-lookup"><span data-stu-id="2857c-260">Also, if the calendar contains very elaborate working time definitions with many working time intervals per day, this adds to the time the loading takes.</span></span>

<span data-ttu-id="2857c-261">Когда данные о рабочем времени загружаются в подсистему планирования, это сохраняется во внутреннем кэше для соответствующего календаря, что означает, что если какие-либо другие задания или ресурсы используют этот же календарь, следующие операции подстановки могут быть выполнены быстро из памяти.</span><span class="sxs-lookup"><span data-stu-id="2857c-261">When the working time data is loaded in the scheduling engine, this is retained in its internal cache for the specific calendar, meaning that if any other jobs or resources are using the same calendar then the next lookups can be performed quickly from memory.</span></span> <span data-ttu-id="2857c-262">Одна из наиболее частых причины плохой производительности состоит в том, что для каждого ресурса используется отдельный код календаря, так как в этом случае необходимо запрашивать данные для каждого календаря, даже если содержимое календарей может быть одинаковым.</span><span class="sxs-lookup"><span data-stu-id="2857c-262">One common cause of bad performance is if a separate calendar ID is used for each resource, because data will then need to be requested for each calendar, even though the content of the calendars might be the same.</span></span>

### <a name="finite-capacity"></a><span data-ttu-id="2857c-263">Ограничение по мощности</span><span class="sxs-lookup"><span data-stu-id="2857c-263">Finite capacity</span></span>

<span data-ttu-id="2857c-264">При использовании ограничения по мощности размеры ячеек рабочего времени из календаря разбиваются и уменьшаются на основе существующих резервирований мощностей.</span><span class="sxs-lookup"><span data-stu-id="2857c-264">When using finite capacity, the working time slots from the calendar are split and reduced based on the existing capacity reservations.</span></span> <span data-ttu-id="2857c-265">Эти резервирования также выбираются с помощью того же класса `WrkCtrSchedulingInteropDataProvider`, что и календари, но вместо этого используется метод `getCapacityReservations`.</span><span class="sxs-lookup"><span data-stu-id="2857c-265">These reservations are also fetched through the same `WrkCtrSchedulingInteropDataProvider` class as the calendars, but instead use the method `getCapacityReservations`.</span></span> <span data-ttu-id="2857c-266">При планировании при сводном планировании учитываются резервирования для данного сводного плана и, если это разрешено на странице **Параметры сводного планирования**, также включаются резервирования из утвержденных производственных заказов.</span><span class="sxs-lookup"><span data-stu-id="2857c-266">When scheduling during master planning, the reservations for the specific master plan are considered and if enabled on the **Master planning parameters** page, the reservations from firmed production orders are also included.</span></span> <span data-ttu-id="2857c-267">Аналогично, при планировании производственного заказа также можно включить резервирования из существующих спланированных заказов, хотя это используется не так часто, как обратное.</span><span class="sxs-lookup"><span data-stu-id="2857c-267">Similarly, when scheduling a production order, it is also an option to include reservations from existing planned orders, although this is not as common as the other way around.</span></span>

<span data-ttu-id="2857c-268">Использование ограничения по мощности приведет к тому, что планирование займет больше времени из-за нескольких причин:</span><span class="sxs-lookup"><span data-stu-id="2857c-268">Using finite capacity will cause scheduling to take longer due to several reasons:</span></span>

- <span data-ttu-id="2857c-269">Выборка сведений о емкости из базы данных является медленным действием, и кэширование сведений о емкости на стороне сервера обычно работает не так хорошо, как и в случае значений рабочего времени, поскольку обычно они не являются общими для ресурсов, в отличие от календарей.</span><span class="sxs-lookup"><span data-stu-id="2857c-269">Fetching the capacity information from database is a slow operation and the server-side caching of capacity information is typically not as good as for working times because they are not shared among resources like calendars typically are.</span></span>
- <span data-ttu-id="2857c-270">Число интервалов рабочего времени для перебора увеличивается увеличение из-за разбиения, а также интервалы для более долгого периода времени должны обычно исследоваться, прежде чем можно будет найти решение.</span><span class="sxs-lookup"><span data-stu-id="2857c-270">The number of working time slots to traverse increases due to the splits, and slots for a longer time period must typically be investigated before a solution can be found.</span></span>
- <span data-ttu-id="2857c-271">После завершения планирования необходимо выполнить проверку на наличие конфликтующих резервирований (подробные сведения см. в разделе "Параллельное выполнение нескольких подсистем планирования").</span><span class="sxs-lookup"><span data-stu-id="2857c-271">After the scheduling is complete, a check for conflicting reservations must be performed (see the "Running scheduling engines in parallel" section for details).</span></span>

### <a name="examining-the-resource-combinations"></a><span data-ttu-id="2857c-272">Изучение комбинаций ресурсов</span><span class="sxs-lookup"><span data-stu-id="2857c-272">Examining the resource combinations</span></span>

<span data-ttu-id="2857c-273">Если последовательность заданий содержит только стандартные ссылки `FinishStart`, то есть она образует простую цепь без ветвей, оптимальный результат (с точки зрения отдельного заказа, а не по всем заказам) может быть достигнут путем поиска лучшего решения для первого задания, а затем поиска лучшего решения для следующего задания.</span><span class="sxs-lookup"><span data-stu-id="2857c-273">If the job sequence only contains the standard `FinishStart` links, meaning it forms a simple chain without any branches, an optimal result (seen from the single order, not across orders) can be achieved by finding the best solution for the first job and then moving on to find the best solution for the next job.</span></span> <span data-ttu-id="2857c-274">Наилучшим решением для задания является поиск ресурса, который может получить начальную и конечную даты задания, ближайшие к цели задания (при планировании вперед это означает получение конечной даты задания как можно раньше), в то же время учитывая ограничения.</span><span class="sxs-lookup"><span data-stu-id="2857c-274">The best solution for a job means finding the resource that can get the from and to date of the job closest to the job goal (in forward scheduling this means getting the end date of the job as early as possible) while still respecting the constraints.</span></span>

<span data-ttu-id="2857c-275">При наличии параллельных заданий поиск решения может включать в себя анализ различных комбинаций ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2857c-275">When there are parallel jobs, finding a solution may involve examining different combinations of resources.</span></span> <span data-ttu-id="2857c-276">Число возможных комбинаций ресурсов равно произведению количества применимых ресурсов для связанных параллельных заданий.</span><span class="sxs-lookup"><span data-stu-id="2857c-276">The number of possible resource combinations is the product of the number of applicable resources for the connected parallel jobs.</span></span> <span data-ttu-id="2857c-277">В частности, при планировании заказа в обратном направлении от даты потребности логика может потратить много времени, чтобы выяснить, что нет решения проблемы, которая позволит уместить параллельные задания до сегодняшней даты, так как в этом случае потребуется проверить все комбинации, так как могут быть некоторые ресурсы с большей эффективностью или другим календарем, которые могут дать результат.</span><span class="sxs-lookup"><span data-stu-id="2857c-277">Especially when scheduling an order backwards from a requirement date, it can take quite a while for the logic to realize that there is no solution to the problem that will make the parallel jobs fit before today's date, as it will need to check all the combinations because there could be some resources that had a higher efficiency or a different calendar that might give a result.</span></span> <span data-ttu-id="2857c-278">Это означает, что если ограничение времени ожидания не было задано, логика будет работать в течение длительного времени перед переходом на направление вперед.</span><span class="sxs-lookup"><span data-stu-id="2857c-278">This means that if no timeout limit has been set it will run for a long time before changing the direction to forward.</span></span>

<span data-ttu-id="2857c-279">Эта комбинаторная логика также означает, что при дополнительном увеличении числа соответствующих ресурсов подсистема может работать еще медленнее.</span><span class="sxs-lookup"><span data-stu-id="2857c-279">This combinatorial logic also means that adding more applicable resources may make the engine run slower.</span></span> <span data-ttu-id="2857c-280">Если проблемы с производительностью возникают при использовании параллельных операций и планировании с бесконечной мощностью, это можно частично исправить, если конструктор маршрута принимает решение о том, какой ресурс следует использовать, а затем назначет ресурс непосредственно в операции (поскольку в большинстве случаев подсистема всегда будет выбирать один и тот же ресурс, поэтому конечный результат будет одинаковым).</span><span class="sxs-lookup"><span data-stu-id="2857c-280">If performance problems occur when having parallel operations and scheduling with infinite capacity, it can partly be fixed by having the route designer take a decision on which resource should be used and then assign the resource directly on the operation (because the engine in most cases will always end up picking the same resource, so the end result will be the same).</span></span>

### <a name="hard-links"></a><span data-ttu-id="2857c-281">Жесткие связи</span><span class="sxs-lookup"><span data-stu-id="2857c-281">Hard links</span></span>

<span data-ttu-id="2857c-282">Задание типа связи между двумя заданиями на жесткое позволяет гарантировать отсутствие разрыва по времени между окончанием одного задания и началом следующего.</span><span class="sxs-lookup"><span data-stu-id="2857c-282">Setting the link type between two jobs to hard, ensures that there is no time gap between the finish of one job and the start of the next one.</span></span> <span data-ttu-id="2857c-283">Это может быть очень полезно в сценариях, например, когда металл нагревается в одном задании, а затем обрабатывается в следующем задании, где нежелательно, чтобы металл в промежутке остыл.</span><span class="sxs-lookup"><span data-stu-id="2857c-283">This can be very useful in scenarios like when metal is heated in one job and then processed in the next job, where it is not desirable to have the metal cool down in between.</span></span>

<span data-ttu-id="2857c-284">При стандартных мягких связях и прямом планировании если маршрут образует простую цепь без ветвей, результат можно получить, выполнив поиск решения для первого задания, удовлетворяющего собственным ограничениям, и затем перемещаясь по цепочке, выполняя распространение времени окончания предыдущего задания на следующее задание.</span><span class="sxs-lookup"><span data-stu-id="2857c-284">With standard soft links and forward scheduling, if the route forms a simple chain without any branches, a result can be achieved by finding a solution for the first job that satisfies its own constraints and then moving on through the chain propagating the end time from the previous job to the next job.</span></span> <span data-ttu-id="2857c-285">Если текущее задание не может найти никакой мощности, время начала для него будет перемещено далее без последствий для предыдущих заданий, что потенциально создает зазоры между заданиями.</span><span class="sxs-lookup"><span data-stu-id="2857c-285">If the current job can't find any capacity, the start time for it will be moved out further, without any consequence for the previous jobs potentially creating gaps between the jobs.</span></span> <span data-ttu-id="2857c-286">Однако при работе с жесткими связями (особенно в связи с ограничением по мощности) для того же сценария тот факт, что одно задание далее в цепи не может найти емкость, означает, что все предыдущие запланированные задания придется "перетаскивать" по одному и, таким образом, перепланировать несколько раз.</span><span class="sxs-lookup"><span data-stu-id="2857c-286">However with hard links (especially in connection with finite capacity) for the same scenario, the fact that one job later in the chain cannot find capacity, will mean that all previous scheduled jobs will have to be "dragged" along one by one and thereby rescheduled a number of times.</span></span> <span data-ttu-id="2857c-287">Жесткие связи, особенно в сценариях с высокой загрузкой для нескольких ресурсов, могут вызывать цепную реакцию, в которой задания влияют друг на друга, и необходимо выполнить несколько итераций, прежде чем результат будет стабилизироваться до появления подходящего графика.</span><span class="sxs-lookup"><span data-stu-id="2857c-287">Especially in scenarios with high load for multiple resources, the hard links can cause a chain reaction where the jobs will affect each other and a number of iterations will have to be performed before the result stabilizes into a feasible schedule.</span></span>

## <a name="running-scheduling-engines-in-parallel"></a><span data-ttu-id="2857c-288">Параллельное выполнение подсистем планирования</span><span class="sxs-lookup"><span data-stu-id="2857c-288">Running scheduling engines in parallel</span></span>

<span data-ttu-id="2857c-289">При планировании в процессе выполнения сводного планирования, когда используются помощники, все вспомогательные потоки сводного планирования также могут скомплектовать задачи по планированию производственных заказов.</span><span class="sxs-lookup"><span data-stu-id="2857c-289">When performing scheduling as part of a master planning run where helpers are used, each of the master planning helper threads can also pick up production order scheduling tasks.</span></span> <span data-ttu-id="2857c-290">Это означает, что в одно и то же время может выполняться несколько подсистем планирования.</span><span class="sxs-lookup"><span data-stu-id="2857c-290">This means that multiple scheduling engines can be running at the same time.</span></span> <span data-ttu-id="2857c-291">Хотя многопоточность в общем случае дает очень значительной выигрыш в производительности, при планировании могут также быть некоторые функциональные недостатки.</span><span class="sxs-lookup"><span data-stu-id="2857c-291">While multithreading in general is a highly significant performance benefit, there are also some functional downsides when it comes to scheduling.</span></span>

<span data-ttu-id="2857c-292">В MRP все производственные заказы данного уровня спецификации (BOM) планируются в последовательности дат потребности, то есть заказы с самой ранней датой потребности должны быть запланированы первыми и тем самым получит наибольшую шансы получить доступную мощность ресурса.</span><span class="sxs-lookup"><span data-stu-id="2857c-292">In MRP, all production orders for a given bill of materials (BOM) level are scheduled in requirement date sequence, meaning that those orders with the earliest requirement date should be scheduled first and thereby have the highest chance of getting the available resource capacity.</span></span> <span data-ttu-id="2857c-293">Однако когда несколько подсистем выбирают из списка незапланированных заказов, последовательность больше не гарантируется, так как одна подсистема можно завершиться быстрее, чем другая.</span><span class="sxs-lookup"><span data-stu-id="2857c-293">However, with multiple engines picking from the list of unscheduled orders the sequence is no longer ensured, as one might complete faster than the other.</span></span>

<span data-ttu-id="2857c-294">Кроме того, при планировании с ограничением по мощности и при попытке нескольких экземпляров подсистем планировать заказы, которые потенциально могут использовать одни и те же ресурсы за один и тот же интервал времени, может произойти условие гонки.</span><span class="sxs-lookup"><span data-stu-id="2857c-294">Also, when scheduling using finite capacity and when multiple engine instances are trying to schedule orders that are potentially using the same resources at the same time interval, a race condition can occur.</span></span> <span data-ttu-id="2857c-295">Количество таких состояний гонки записывается в поле **Конфликты планирования** на странице журнала сводных планов.</span><span class="sxs-lookup"><span data-stu-id="2857c-295">The number of such race conditions is recorded in the **Scheduling conflicts** field on the master plans history page.</span></span> <span data-ttu-id="2857c-296">Логика разрешения конфликтов выглядит следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2857c-296">The conflict resolution logic is as follows:</span></span>

- <span data-ttu-id="2857c-297">Планирование заказа (без блокировки) и получение резервирований мощности.</span><span class="sxs-lookup"><span data-stu-id="2857c-297">Schedule an order (lock-free) and get capacity reservations.</span></span>
- <span data-ttu-id="2857c-298">Выполнение блокировки.</span><span class="sxs-lookup"><span data-stu-id="2857c-298">Take the lock.</span></span>
- <span data-ttu-id="2857c-299">Проверка наличия более новых резервирований мощности для запланированных ресурсов в интервале времени.</span><span class="sxs-lookup"><span data-stu-id="2857c-299">Check if newer capacity reservations exist for the scheduled resources in the timespan.</span></span>
  - <span data-ttu-id="2857c-300">Если нет, зазаписывается емкость и освобожается блокировка.</span><span class="sxs-lookup"><span data-stu-id="2857c-300">If no, write the capacity and release the lock.</span></span>
  - <span data-ttu-id="2857c-301">Если да, снимается блокировка и заказ перепланируется с начала.</span><span class="sxs-lookup"><span data-stu-id="2857c-301">If yes, release the lock and reschedule the order from the beginning.</span></span>

<span data-ttu-id="2857c-302">Таким образом, при планировании с использованием нескольких экземпляров подсистемы результат не является полным детерминированным, поскольку он будет зависеть от точного времени каждого из потоков.</span><span class="sxs-lookup"><span data-stu-id="2857c-302">So, when scheduling with multiple engine instances, the result is not fully deterministic because it will depend on the exact timing of each of the threads.</span></span>

## <a name="operation-scheduling-performance"></a><span data-ttu-id="2857c-303">Производительность планирования операций</span><span class="sxs-lookup"><span data-stu-id="2857c-303">Operation scheduling performance</span></span>

<span data-ttu-id="2857c-304">Хотя планирование операций также известно как грубое планирование загрузки, наблюдаемое с точки зрения подсистемы, это может быть более сложным проблемой, если используется ограничение по мощности, так как для определения осуществимости потребуется большее количество данных.</span><span class="sxs-lookup"><span data-stu-id="2857c-304">Even though operation scheduling is also known as rough-cut capacity planning, seen from an engine standpoint, it can be a harder problem to solve if finite capacity is used, as more data is needed to determine feasibility.</span></span>

<span data-ttu-id="2857c-305">Мощность группы ресурсов зависит от того, какие и сколько ресурсов являются участниками группы ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2857c-305">The capacity of a resource group depends on which and how many resources are members of the resource group.</span></span> <span data-ttu-id="2857c-306">Группа ресурсов сама по себе не имеет никакой мощности &mdash; только когда ресурсы являются участниками группы, она будет иметь мощность.</span><span class="sxs-lookup"><span data-stu-id="2857c-306">A resource group in itself does not have any capacity&mdash;only when resources are a member of the group will it have capacity.</span></span> <span data-ttu-id="2857c-307">Поскольку членство в группах ресурсов может меняться со временем, мощность должна оцениваться за день.</span><span class="sxs-lookup"><span data-stu-id="2857c-307">Because the resource group membership can vary over time, capacity must be evaluated per day.</span></span>

<span data-ttu-id="2857c-308">При планировании операций календарь группы ресурсов используется для определения начального и конечного времени каждой операции.</span><span class="sxs-lookup"><span data-stu-id="2857c-308">In operations scheduling, the resource group's calendar is used to determine the start and end times for each operation.</span></span> <span data-ttu-id="2857c-309">Это означает, что календарь группы ресурсов ограничивает время, в течение которого операции могут быть запланированы, одной операцией в один день в одной группе ресурсов.</span><span class="sxs-lookup"><span data-stu-id="2857c-309">This means that the resource group's calendar places a limit on how much time can be operations scheduled for one operation on one day in one resource group.</span></span> <span data-ttu-id="2857c-310">В противоположность календарю для конкретных ресурсов, данные о эффективности календаря игнорируются для группы ресурсов, поскольку они просто обозначают открытые часы и не имеют фактической мощности.</span><span class="sxs-lookup"><span data-stu-id="2857c-310">Opposite the calendar for the specific resources, the efficiency data of the calendar is ignored for the resource group as it simply denotes opening hours and not actual capacity.</span></span>

<span data-ttu-id="2857c-311">Например, если рабочее время для группы ресурсов на одну конкретную дату равно от 8:00 до 16:00, одна операция не может поместить большую загрузку на группу ресурсов, чем может быть помещено в 8 часов, вне зависимости от того, сколько мощностей доступно в группе ресурсов в этот день в целом.</span><span class="sxs-lookup"><span data-stu-id="2857c-311">For example, if the working time for a resource group on one specific date is from 8:00 to 16:00, one operation can't put more load on the resource group than what can be fit into 8 hours, no matter how much capacity that the resource group has available in total on that day.</span></span> <span data-ttu-id="2857c-312">Доступная мощность может, однако, дополнительно ограничивать загрузку.</span><span class="sxs-lookup"><span data-stu-id="2857c-312">The available capacity can however limit the load further.</span></span>

<span data-ttu-id="2857c-313">Загрузка из планирования заданий по всем ресурсам, включенным в группу ресурсов на данный день, учитывается, когда рассчитывается доступная мощность для группы ресурсов в одном и том же дне.</span><span class="sxs-lookup"><span data-stu-id="2857c-313">The load from job scheduling on all the resources included in the resource group on a given day is considered when the available capacity for the resource group on the same day is calculated.</span></span> <span data-ttu-id="2857c-314">Для каждой даты расчет следующий:</span><span class="sxs-lookup"><span data-stu-id="2857c-314">For each date, the calculation is:</span></span>

<span data-ttu-id="2857c-315">*Доступная емкость группы ресурсов = емкость для ресурсов в группе на основе их календаря &ndash; Загрузка ресурсов в группе запланированными заданиями &ndash; Загрузка ресурсов в группы запланированными операциями &ndash; Загрузка группы ресурсов запланированными операциями*</span><span class="sxs-lookup"><span data-stu-id="2857c-315">*Available resource group capacity = Capacity for resources in the group based on their calendar &ndash; Job scheduled load on the resources in the group &ndash; Operations scheduled load on the resources in the group &ndash; Operations scheduled load on the resource group*</span></span>

<span data-ttu-id="2857c-316">На вкладке **Потребности в ресурсах** в операции маршрута можно указать требования к ресурсам с помощью определенного ресурса (в этом случае операция будет запланирована с использованием этого ресурса), для группы ресурсов, для типа ресурсов или для одной или нескольких возможностей, навыков, курсов или сертификатов.</span><span class="sxs-lookup"><span data-stu-id="2857c-316">On the **Resource requirements** tab on the route operation, the resource requirements can be specified using either a specific resource (in which case the operation will be scheduled using that resource), for a resource group, for a resource type, or for one or more capabilities, skill, course, or certificate.</span></span> <span data-ttu-id="2857c-317">Хотя использование всех этих параметров обеспечивает большую гибкость в проектировании маршрута, это также усложняет планирование для подсистемы, поскольку мощность должна учитываться по "свойствам" (абстрактное имя, используемое в подсистеме для возможностей, навыков и т. д.).</span><span class="sxs-lookup"><span data-stu-id="2857c-317">While using all of these options gives a great flexibility on the route design, it also complicates the scheduling for the engine as the capacity must be accounted for per "property" (the abstract name used in the engine for capability, skills, and so on).</span></span>

<span data-ttu-id="2857c-318">Мощность группы ресурсов для возможности является суммой мощностей для всех ресурсов в группе ресурсов, имеющих рассматриваемую возможность.</span><span class="sxs-lookup"><span data-stu-id="2857c-318">The resource group's capacity for a capability is the sum of the capacity for all resources in the resource group that has the capability in question.</span></span> <span data-ttu-id="2857c-319">Если ресурс в группе имеет возможность, он будет учитываться независимо от того, какой уровень мощности требуется.</span><span class="sxs-lookup"><span data-stu-id="2857c-319">If a resource in the group has a capability, it will be considered no matter what level of the capacity is required.</span></span>

<span data-ttu-id="2857c-320">При планировании операций доступная мощность для определенной возможности для группы ресурсов будет уменьшена при загрузке с операцией, требующей наличия требуемой возможности.</span><span class="sxs-lookup"><span data-stu-id="2857c-320">In operations scheduling, the available capacity for a certain capability for a resource group will be reduced when it is loaded with an operation that requires the capability in question.</span></span> <span data-ttu-id="2857c-321">Если для операции требуется более одной возможности, мощность будет уменьшена для всех необходимых возможностей.</span><span class="sxs-lookup"><span data-stu-id="2857c-321">If the operation requires more than one capability, the capacity will be reduced for all required capabilities.</span></span>

<span data-ttu-id="2857c-322">Для каждой даты требуемый расчет следующий:</span><span class="sxs-lookup"><span data-stu-id="2857c-322">For each date, the required calculation is:</span></span>

<span data-ttu-id="2857c-323">*Доступная емкость для возможности = Емкость для возможности &ndash; Загрузка запланированными заданиями на ресурсы с определенной возможностью, включенных в группу ресурсов &ndash; Загрузка запланированными операциями на ресурсы с определенной возможностью, включаемых в группы ресурсов &ndash; Загрузка запланированными операциями на саму группу ресурсов, требующая определенную возможность*</span><span class="sxs-lookup"><span data-stu-id="2857c-323">*Available capacity for a capability = Capacity for the capability &ndash; Job scheduled load on the resources with the specific capability, included in the resource group &ndash; Operations scheduled load on the resources with the specific capability, included in the resource group &ndash; Operations scheduled load on the resource group itself that require the specific capability*</span></span>

<span data-ttu-id="2857c-324">Это означает, что если загружается конкретный ресурс, нагрузка учитывается в расчете доступной мощности для группы ресурсов по возможностям, так как загрузка конкретного ресурса сокращает его вклад в мощность группы ресурсов для возможности, независимо от того, относится ли загрузка конкретного ресурса к этой конкретной возможности.</span><span class="sxs-lookup"><span data-stu-id="2857c-324">This means that if there is load on a specific resource, the load is considered in the calculation of the resource group's available capacity per capability, because the load on a specific resource reduces its contribution to the resource group's capacity for a capability no matter if the load on the specific resource is for that specific capability.</span></span> <span data-ttu-id="2857c-325">Если на уровне группы ресурсов имеется загрузка, она учитывается в расчете доступной мощности группы ресурсов по возможностям только в том случае, если загрузка производится из операции, требующей наличия конкретной возможности.</span><span class="sxs-lookup"><span data-stu-id="2857c-325">If there is load on the resource group level, it is considered in the calculation of the resource group's available capacity per capability only if the load is from an operation that requires the specific capability.</span></span>

<span data-ttu-id="2857c-326">Вышеописанная логика сложная, поскольку она одинакова для каждого типа "свойства", так что для использования планирования операций с ограничением по мощности требуется загрузка значительного объема данных.</span><span class="sxs-lookup"><span data-stu-id="2857c-326">The above logic is complicated, as this is the same for each type of "property" so using operations scheduling with finite capacity requires a significant amount of data to be loaded.</span></span>

## <a name="viewing-scheduling-engine-input-and-output"></a><span data-ttu-id="2857c-327">Просмотр ввода и вывода подсистемы планирования</span><span class="sxs-lookup"><span data-stu-id="2857c-327">Viewing scheduling engine input and output</span></span>

<span data-ttu-id="2857c-328">Чтобы получить подробные сведения о вводе и выводе процесса планирования, включите ведение журнала, перейдя на страницу **Управление организацией \> Настройка \> Планирование \> Панель трассировки планирования**.</span><span class="sxs-lookup"><span data-stu-id="2857c-328">To get specific details of the input and output of the scheduling process,  enable logging by going to **Organization administration \> Setup \> Scheduling \> Scheduling tracing cockpit**.</span></span>

<span data-ttu-id="2857c-329">На этой странице сначала выберите **Включить ведение журналов** на панели операций.</span><span class="sxs-lookup"><span data-stu-id="2857c-329">On this page, first select **Enable logging** on the Action Pane.</span></span> <span data-ttu-id="2857c-330">Затем выполните планирование для производственного заказа.</span><span class="sxs-lookup"><span data-stu-id="2857c-330">Then run the scheduling for the production order.</span></span> <span data-ttu-id="2857c-331">После завершения вернитесь на страницу **Панель трассировки планирования** и выберите **Отключить ведение журналов** на панели операций.</span><span class="sxs-lookup"><span data-stu-id="2857c-331">When complete, return to the **Scheduling tracing cockpit** page and select **Disable logging** on the Action Pane.</span></span> <span data-ttu-id="2857c-332">Обновите страницу и в сетке появится новая строка.</span><span class="sxs-lookup"><span data-stu-id="2857c-332">Refresh the page and a new line will appear in the grid.</span></span> <span data-ttu-id="2857c-333">Выберите новую строку и выберите **Загрузить** на панели операций.</span><span class="sxs-lookup"><span data-stu-id="2857c-333">Select the new line and select **Download** on the Action Pane.</span></span> <span data-ttu-id="2857c-334">Вы получите сжатую ZIP-папку, содержащую следующие файлы:</span><span class="sxs-lookup"><span data-stu-id="2857c-334">This will give you a .zip compressed folder containing the following files:</span></span>

- <span data-ttu-id="2857c-335">**Log. txt** — это файл журнала, в котором описываются шаги, выполняемые подсистемой.</span><span class="sxs-lookup"><span data-stu-id="2857c-335">**Log.txt** - This is the log file that describes the steps that the engine goes through.</span></span> <span data-ttu-id="2857c-336">Он очень сложный и может быть немного ошеломляющим, но если используется как часть эксперимента с настройкой маршрута для устранения проблем с производительностью, первое, что нужно искать, — это разница времени между первой и последней строкой, поскольку в этом случае будет выдаваться точное время, затраченное планировщиком.</span><span class="sxs-lookup"><span data-stu-id="2857c-336">It is very elaborate and can be a bit overwhelming, but when used as part of experimenting with the route setup to resolve performance problems the first thing to look for is the difference in time between the first and the last line, as this will give you the exact time the scheduler has spent.</span></span>
- <span data-ttu-id="2857c-337">**XmlModel.xml** — содержит модель, встроенную в X++, на основе которой работает подсистема.</span><span class="sxs-lookup"><span data-stu-id="2857c-337">**XmlModel.xml** - This contains the model that is built in X++ and that the engine operates on.</span></span> <span data-ttu-id="2857c-338">Значение `JobId`, используемое в файле, соотносится со значением `RecId` из исходной таблицы, содержащей задания (`ReqRouteJob` или `ProdRouteJob`).</span><span class="sxs-lookup"><span data-stu-id="2857c-338">The `JobId` used in the file correlates to the `RecId` from the source table containing the jobs (`ReqRouteJob` or `ProdRouteJob`).</span></span> <span data-ttu-id="2857c-339">Обычно в этом файле следует искать, что даты, указанные в полях `ConstraintJobStartsAt` и `ConstraintJobEndsAt` соответствуют ожидаемым, что свойство `JobGoal` установлено правильно, а также что задания связаны друг с другом через ограничения `JobLink`.</span><span class="sxs-lookup"><span data-stu-id="2857c-339">The typical thing to look for in this file is that the dates given in `ConstraintJobStartsAt` and `ConstraintJobEndsAt` are as expected, that the `JobGoal` property is set correctly, and that the jobs are related to each other through the `JobLink` constraints.</span></span>
- <span data-ttu-id="2857c-340">**XmlSlots.xml** — содержит все рабочее время и резервирования мощности, запрошенные подсистемой.</span><span class="sxs-lookup"><span data-stu-id="2857c-340">**XmlSlots.xml** - This contains all the working times and capacity reservations that the engine has requested.</span></span> <span data-ttu-id="2857c-341">Рабочее время и резервирования календаря будут запрашиваться подсистемой только для периодов времени, в которые она пытается поместить задания (и дополнительный буфер), так что если файл содержит время далеко в будущем, это может свидетельствовать о проблеме с настройкой.</span><span class="sxs-lookup"><span data-stu-id="2857c-341">The calendar working times and reservations will only be requested by the engine for the time periods where it tries to place the jobs (and an extra buffer), so if the file contains times very far in the future, it might be an indication of a problem with the setup.</span></span> <span data-ttu-id="2857c-342">Узлы `ResourceProperty` будут показывать для каждого ресурса, с какими группами ресурсов и какими возможностями он связан для каких периодов.</span><span class="sxs-lookup"><span data-stu-id="2857c-342">The `ResourceProperty` nodes will show for each resource which resource group and capabilities it is associated with for which periods.</span></span>
- <span data-ttu-id="2857c-343">**Result.xml** — содержит результат выполнения планирования.</span><span class="sxs-lookup"><span data-stu-id="2857c-343">**Result.xml** - This contains the result of the scheduling run.</span></span>

<span data-ttu-id="2857c-344">Обратите внимание на то, что функциональные возможности трассировки могут добавлять значительные накладные расходы производительности, поэтому их следует использовать только для исследования планирования определенных заказов управляемым образом.</span><span class="sxs-lookup"><span data-stu-id="2857c-344">Note that the tracing functionality can add significant performance overhead, so only use it for investigating scheduling of specific orders in a controlled manner.</span></span> <span data-ttu-id="2857c-345">Если она включена во время выполнения сводного планирования, оно быстро достигает предельного размера и прекращает выполнение.</span><span class="sxs-lookup"><span data-stu-id="2857c-345">If it is turned on during a master planning run it will quickly reach its size limit and stop.</span></span>

## <a name="troubleshooting-performance"></a><span data-ttu-id="2857c-346">Устранение неполадок производительности</span><span class="sxs-lookup"><span data-stu-id="2857c-346">Troubleshooting performance</span></span>

<span data-ttu-id="2857c-347">Как можно понять из всех предыдущих разделов, есть несколько ловушек, связанных с настройкой и использованием подсистемы планирования, что может повлечь за собой проблемы с производительностью.</span><span class="sxs-lookup"><span data-stu-id="2857c-347">As can be understood from all of the previous sections, there are some pitfalls when it comes to the setup and usage of the scheduling engine, which can lead to performance problems.</span></span> <span data-ttu-id="2857c-348">Для устранения подобных проблем можно использовать следующий контрольный список.</span><span class="sxs-lookup"><span data-stu-id="2857c-348">The following check list can be used for troubleshooting such issues.</span></span> <span data-ttu-id="2857c-349">Важно взглянуть на все точки, поскольку чаще всего сочетание нескольких факторов ведет к проблемам.</span><span class="sxs-lookup"><span data-stu-id="2857c-349">It is important to look at all the points as it is most often a combination of multiple factors that leads to problems.</span></span>

### <a name="performing-scheduling-as-part-of-mrp-when-it-is-not-needed"></a><span data-ttu-id="2857c-350">Выполнение планирования в рамках MRP, когда это не требуется</span><span class="sxs-lookup"><span data-stu-id="2857c-350">Performing scheduling as part of MRP when it is not needed</span></span>

<span data-ttu-id="2857c-351">Несмотря на то, что маршруты используются для целей управления производством, таких как калькуляция затрат и отчетность, это может оказаться ненужным для учета в ходе MRP.</span><span class="sxs-lookup"><span data-stu-id="2857c-351">Even though routes are used for the production control purposes such as costing and reporting, it might not be necessary to consider them during MRP.</span></span> <span data-ttu-id="2857c-352">В некоторых случаях для планирования достаточно стандартного времени производственного цикла, указанного для номенклатуры.</span><span class="sxs-lookup"><span data-stu-id="2857c-352">In some cases, having a standard production lead time specified for the item will be sufficient for planning.</span></span> <span data-ttu-id="2857c-353">Чтобы отключить планирование маршрутов, установите для временных границ мощности нулевые значения.</span><span class="sxs-lookup"><span data-stu-id="2857c-353">To turn off route scheduling, set the capacity time fence to zero.</span></span> <span data-ttu-id="2857c-354">Если планирование должно быть выполнено, то временные границы мощности должны быть тщательно настроены, поскольку в этом случае может отсутствовать необходимость учета маршрутов для всей области временных границ покрытия MRP.</span><span class="sxs-lookup"><span data-stu-id="2857c-354">If scheduling should be done, then the capacity time fence must be carefully set because it might not be necessary to consider routes for the full extent of the MRP's coverage time fence.</span></span>

<span data-ttu-id="2857c-355">Обратите внимание, что если заказ не запланирован в ходе MRP, тогда его потребуется запланировать при утверждении спланированного заказа.</span><span class="sxs-lookup"><span data-stu-id="2857c-355">Note that if the order is not scheduled during MRP, then it will instead need to be scheduled when the planned order is firmed.</span></span> <span data-ttu-id="2857c-356">Это означает, что процесс утверждения займет больше времени, поэтому, в зависимости от того, сколько предложенных спланированных заказов было утверждено, увеличение производительности в ходе MRP может быть потеряно при утверждении.</span><span class="sxs-lookup"><span data-stu-id="2857c-356">This means that the firming process will take longer, so depending on how many of the suggested planned orders get firmed the performance gain during MRP might be lost at firming.</span></span>

### <a name="route-with-unnecessary-operations"></a><span data-ttu-id="2857c-357">Маршрут с ненужными операциями</span><span class="sxs-lookup"><span data-stu-id="2857c-357">Route with unnecessary operations</span></span>

<span data-ttu-id="2857c-358">При разработке маршрута заманчиво пытаться точно моделировать реальный мир со всеми этапами производства.</span><span class="sxs-lookup"><span data-stu-id="2857c-358">When designing the route, it is tempting to try to model the real world exactly with all the steps the production goes through.</span></span> <span data-ttu-id="2857c-359">Хотя это может быть полезно в некоторых случаях, это плохо для производительности, так как модель, с которой необходимо работать подсистеме, становится больше (в отношении заданий и ограничений), и для вставки и обновления заданий и резервирования мощностей будут выполняться больше инструкций SQL.</span><span class="sxs-lookup"><span data-stu-id="2857c-359">While this can be useful in some cases, it is not good for the performance as the model the engine needs to work on gets larger (both in terms of jobs and constraints) and more SQL statements will be executed for insertion and update of the jobs and capacity reservations.</span></span> <span data-ttu-id="2857c-360">Кроме того, имеется дальнейший эффект необходимости последующей отчетности о ходе выполнения заданий, что может быть уменьшено с помощью автоматической разноски.</span><span class="sxs-lookup"><span data-stu-id="2857c-360">Also, there is the downstream effect of having to eventually report progress on the jobs, which can be mitigated with automatic postings.</span></span> <span data-ttu-id="2857c-361">Если данные не используются ни для каких целей, они создают ненужную нагрузку.</span><span class="sxs-lookup"><span data-stu-id="2857c-361">If the data is not used for anything, it creates unnecessary load.</span></span>

<span data-ttu-id="2857c-362">Рекомендуется создавать только те операции, которые строго необходимы для планирования (как правило, являются ресурсами, представляющими узкие места) и/или для калькуляции затрат.</span><span class="sxs-lookup"><span data-stu-id="2857c-362">We recommend that you only create operations that are strictly needed for scheduling (which will typically be the bottleneck resources) and/or costing purposes.</span></span> <span data-ttu-id="2857c-363">В качестве альтернативы необходимо сгруппировать многие более мелкие операции в одну большую операцию, представляющую большую часть процесса.</span><span class="sxs-lookup"><span data-stu-id="2857c-363">Alternatively you should group many smaller distinct operations into one larger operation that represents a greater part of the process.</span></span>

### <a name="many-applicable-resources-for-an-operation"></a><span data-ttu-id="2857c-364">Много применимых ресурсов для операции</span><span class="sxs-lookup"><span data-stu-id="2857c-364">Many applicable resources for an operation</span></span>

<span data-ttu-id="2857c-365">Количество применимых ресурсов для операции определяется требованиями к ресурсам, установленными в связи с операцией.</span><span class="sxs-lookup"><span data-stu-id="2857c-365">The number of applicable resources for an operation is determined by the resource requirements set on the operation relation.</span></span> <span data-ttu-id="2857c-366">Требование может быть либо для конкретного (отдельного) ресурса, либо быть основано на принадлежности ресурса к группе ресурсов или возможности.</span><span class="sxs-lookup"><span data-stu-id="2857c-366">The requirement can either be for a specific (individual) resource or it can be based on the resource's membership of a resource group or capability.</span></span>

<span data-ttu-id="2857c-367">Если планирование не выполняется с ограничением по мощности и все соответствующие ресурсы имеют одинаковый календарь и эффективность, то подсистема планирования всегда будет выбирать один и тот же ресурс для операции, но только после того, как все соответствующие ресурсы будут проверены на предмет того, что он "лучше", чем другие.</span><span class="sxs-lookup"><span data-stu-id="2857c-367">If scheduling is not done using finite capacity and all the applicable resources have the same calendar and efficiency, then the scheduling engine will always end up picking the same resource for an operation, but only after trying all the applicable resources to check if there is one that is "better" than the others.</span></span> <span data-ttu-id="2857c-368">В этом случае нагрузка планирования может быть значительно уменьшена путем простого постоянного назначения определенного ресурса операции во время разработки маршрута.</span><span class="sxs-lookup"><span data-stu-id="2857c-368">In this case, the load of the scheduling can be greatly reduced simply by always assigning a specific resource to the operation at the route design time.</span></span>

### <a name="route-with-parallel-operations"></a><span data-ttu-id="2857c-369">Маршрут с параллельными операциями</span><span class="sxs-lookup"><span data-stu-id="2857c-369">Route with parallel operations</span></span>

<span data-ttu-id="2857c-370">Хотя параллельные операции (первичные/вторичные) являются мощным средством моделирования сценариев, например, когда машина и оператор оба необходимы для выполнения конкретной задачи, это также источник многих вопросов, связанных с производительностью.</span><span class="sxs-lookup"><span data-stu-id="2857c-370">While parallel operations (primary/secondary) are a powerful tool to model scenarios like when a machine and an operator are both needed to perform a specific task, it is also the source of many performance issues.</span></span> <span data-ttu-id="2857c-371">Если требование для определенного индивидуального ресурса назначается и основной, и вторичной операциям, обычно это не проблема.</span><span class="sxs-lookup"><span data-stu-id="2857c-371">If a requirement for a specific individual resource is assigned to both the primary and secondary operation, it is typically not a problem.</span></span> <span data-ttu-id="2857c-372">Но если имеется много возможных ресурсов для каждой из операций, то при планировании добавляется значительная сложность вычислений.</span><span class="sxs-lookup"><span data-stu-id="2857c-372">But if there are many possible resources for each of the operations, then it adds significant computational complexity to the scheduling.</span></span>

<span data-ttu-id="2857c-373">Альтернативой использованию параллельных операций является моделирование этих пар как "виртуальных" ресурсов (которые затем представляют группу, которая всегда объединяются для влкючения в действие) или просто отказ от моделирования одной из операций, если она не представляет узкого места.</span><span class="sxs-lookup"><span data-stu-id="2857c-373">An alternative to using parallel operations is either to model the pairs as "virtual" resources (which will then represent the team that always goes together for the operation) or to simply not model one of the operations if it doesn't represent a bottleneck.</span></span>

### <a name="route-with-quantity-of-resources-higher-than-1"></a><span data-ttu-id="2857c-374">Маршрут с количеством ресурсов более 1</span><span class="sxs-lookup"><span data-stu-id="2857c-374">Route with quantity of resources higher than 1</span></span>

<span data-ttu-id="2857c-375">Если задано количество ресурсов, необходимых для выполнения операции, более единицы, то эффективно будет работать точно так же, как и при использовании первичных/вторичных операций, так как в подсистему отправляются несколько параллельных заданий.</span><span class="sxs-lookup"><span data-stu-id="2857c-375">If setting the quantity of resources needed for an operation higher than one, then it results effectively the same as using primary/secondary operations because multiple parallel jobs are sent to the engine.</span></span> <span data-ttu-id="2857c-376">Однако в этом случае нет возможности использовать конкретное назначение ресурсов, поскольку количество, большее единицы, требует, чтобы для операции было применимо более одного ресурса.</span><span class="sxs-lookup"><span data-stu-id="2857c-376">However, for this case there is not an option of using specific resource assignments, because a quantity higher than one requires that more than one resource is applicable for the operation.</span></span>

### <a name="excessive-use-of-finite-capacity"></a><span data-ttu-id="2857c-377">Излишнее использование ограничения по мощности</span><span class="sxs-lookup"><span data-stu-id="2857c-377">Excessive use of finite capacity</span></span>

<span data-ttu-id="2857c-378">Использование ограничения по мощности требует от подсистемы загрузки информации о емкости из базы данных и может иметь вычислительные накладные расходы, поскольку это затрудняет поиск решения, особенно в средах, в которых ресурсы резервируются ближе к максимальной мощности.</span><span class="sxs-lookup"><span data-stu-id="2857c-378">Use of finite capacity requires the engine to load the capacity information from a database and can have a computational overhead because it will be harder to find a solution especially in environments where the resources are booked close to their maximum capacity.</span></span> <span data-ttu-id="2857c-379">В результате важно аккуратно оценить, действительно ли ресурсы должны использовать ограничение по мощности или они могут иметь избыточное резервирование.</span><span class="sxs-lookup"><span data-stu-id="2857c-379">As a result, it is important to carefully evaluate if a resource really needs to use finite capacity or they can be overbooked.</span></span> <span data-ttu-id="2857c-380">Поскольку может быть различие между ресурсами с ограничением по мощности в отношении важности исключения из избыточного резервирования, рекомендуется использовать параметр "узкое место" на ресурсе в сочетании с отдельным значением в плане в параметре "Временная граница мощности по минимальным доступным ресурсам".</span><span class="sxs-lookup"><span data-stu-id="2857c-380">Because there might be a difference among finite capacity resources in how important they are not to overbook, we recommend using the bottleneck option on a resource in combination with a separate value on the plan in "Capacity time fence for bottleneck resources".</span></span> <span data-ttu-id="2857c-381">Использование концепции узкого места может обеспечить возможность уменьшения общей временной границы ограничения по мощности.</span><span class="sxs-lookup"><span data-stu-id="2857c-381">Using the bottleneck concept can enable that the general finite capacity time fence can be lowered.</span></span>

### <a name="setting-hard-links"></a><span data-ttu-id="2857c-382">Задание жестких связей</span><span class="sxs-lookup"><span data-stu-id="2857c-382">Setting hard links</span></span>

<span data-ttu-id="2857c-383">Стандартный тип связи маршрута — *мягкая*, что означает, что между временем завершения одной операции и временем начала следующей операции допускается промежуток.</span><span class="sxs-lookup"><span data-stu-id="2857c-383">The standard link type of the route is *soft*, which means that a time gap is allowed between the finishing time of one operation and the start of the next.</span></span> <span data-ttu-id="2857c-384">Разрешение этого может привести к нежелательному эффекту, при котором если материал или мощность недоступны для одной из операций в течение очень длительного времени, производство может достаточно должно простаивать ,что является причиной возможного увеличения незавершенного производства.</span><span class="sxs-lookup"><span data-stu-id="2857c-384">Allowing this can have the unfortunate effect that, if materials or capacity are not available for one of the operations for a very long time, the production could be idle for quite a while, meaning a possible increase of work in progress.</span></span> <span data-ttu-id="2857c-385">Это не произойдет с жесткими связями, поскольку окончание и начало должны быть идеально совмещены.</span><span class="sxs-lookup"><span data-stu-id="2857c-385">This will not happen with hard links because the finish and start must align perfectly.</span></span> <span data-ttu-id="2857c-386">Однако настройка жесткой связи повышает сложность задачи планирования, так как пересечения рабочего времени и мощности должны рассчитываться для двух ресурсов операций.</span><span class="sxs-lookup"><span data-stu-id="2857c-386">But setting hard links makes the scheduling problem more difficult because working time and capacity intersections must be calculated for the two resources of the operations.</span></span> <span data-ttu-id="2857c-387">Если используются также параллельные операции, это добавляет значительное время вычислений.</span><span class="sxs-lookup"><span data-stu-id="2857c-387">If there are also parallel operations involved, this adds significant computational time.</span></span> <span data-ttu-id="2857c-388">Если ресурсы двух операций имеют разные календари, которые не перекрываются вообще, проблема не имеет решения.</span><span class="sxs-lookup"><span data-stu-id="2857c-388">If the resources of the two operations have different calendars that don't overlap at all, the problem is unsolvable.</span></span>

<span data-ttu-id="2857c-389">Жесткие связи рекомендуется использовать только в том случае, если это строго необходимо, и следует тщательно продумать, требуется ли каждая операция маршрута.</span><span class="sxs-lookup"><span data-stu-id="2857c-389">We recommend using hard links only when strictly necessary, and carefully consider if it is necessary for each operation of the route.</span></span>

<span data-ttu-id="2857c-390">Для уменьшения незавершенного производства без применения жестких связей можно запланировать заказ дважды, использовав противоположное направление для второго прохода.</span><span class="sxs-lookup"><span data-stu-id="2857c-390">To reduce the work in progress without applying hard links, a trick is to schedule the order twice with changing to the opposite direction for the second pass.</span></span> <span data-ttu-id="2857c-391">Если первое расписание было выполнено в обратном направлении от даты поставки, то второе должно быть выполнено вперед от запланированной даты начала.</span><span class="sxs-lookup"><span data-stu-id="2857c-391">If the first schedule was done backwards from delivery date, then the second should be done forward from the scheduled start date.</span></span> <span data-ttu-id="2857c-392">Это приведет к тому, что задания будут сжиматься максимально возможно, чтобы минимизировать незавершенное производство.</span><span class="sxs-lookup"><span data-stu-id="2857c-392">This will result in the jobs being compressed as much as possible so that the work in progress is minimized.</span></span>

### <a name="separate-calendar-for-each-resource"></a><span data-ttu-id="2857c-393">Отдельный календарь для каждого ресурса</span><span class="sxs-lookup"><span data-stu-id="2857c-393">Separate calendar for each resource</span></span>

<span data-ttu-id="2857c-394">Одним из основных источников данных для подсистемы планирования являются сведения из календаря, которые могут быть дорогостоящими для загрузки из базы данных.</span><span class="sxs-lookup"><span data-stu-id="2857c-394">One of the main sources of data for the scheduling engine is calendar information, which can be expensive to load from the database.</span></span> <span data-ttu-id="2857c-395">Так как календари создаются на основе шаблонов, есть соблазн создать календарь для каждого ресурса, а затем скорректировать сведения в этом календаре, когда ресурс имеет простой и другие проблемы.</span><span class="sxs-lookup"><span data-stu-id="2857c-395">Because calendars are generated based on templates, it would be tempting to generate a calendar for each resource and then adjust the information in this calendar when the resource has downtime and other issues.</span></span> <span data-ttu-id="2857c-396">Однако это очень существенно ограничивает возможности подсистем для кэширования данных календаря, поскольку им потребуется запросить новые данные для каждого ресурса и это может быть большой источник проблем производительности.</span><span class="sxs-lookup"><span data-stu-id="2857c-396">However, doing this will severely limit the engines ability to cache the calendar data as it would need to request new data for each resource and can be a large source of performance problems.</span></span> <span data-ttu-id="2857c-397">Вместо этого рекомендуется в максимальной степени повторно использовать календари между ресурсами, а затем управлять изменениями времени простоя, назначая другой код календаря для этого периода.</span><span class="sxs-lookup"><span data-stu-id="2857c-397">Instead, we recommend that you reuse the calendars as much as possible between the resources, and then control downtime changes by assigning a different calendar ID for a period.</span></span>

### <a name="high-number-of-working-time-slots-per-calendar-day"></a><span data-ttu-id="2857c-398">Большое число интервалов рабочего времени на календарный день</span><span class="sxs-lookup"><span data-stu-id="2857c-398">High number of working time slots per calendar day</span></span>

<span data-ttu-id="2857c-399">Так как подсистема функционирует путем проверки временных интервалов по одному для мощности, полезно минимизировать количество временных интервалов за каждый календарный день.</span><span class="sxs-lookup"><span data-stu-id="2857c-399">Because the engine works by examining time slots one-by-one for capacity, it is beneficial to minimize the number of time slots per calendar day.</span></span> <span data-ttu-id="2857c-400">Это можно сделать, например, с помощью рассмотрения того, важно ли для результирующего графика то, что работники имеют перерыв на 5 минут каждый час.</span><span class="sxs-lookup"><span data-stu-id="2857c-400">This could be done, for example, by considering whether it's important for the resulting schedule to reflect that workers have a 5-minute break every hour.</span></span>

### <a name="large-or-none-scheduling-timeouts"></a><span data-ttu-id="2857c-401">Большие (или отсутствующие) тайм-ауты планирования</span><span class="sxs-lookup"><span data-stu-id="2857c-401">Large (or none) scheduling timeouts</span></span>

<span data-ttu-id="2857c-402">Производительность подсистемы планирования может быть оптимизирована с помощью параметров, находящихся на странице **Параметры планирования**.</span><span class="sxs-lookup"><span data-stu-id="2857c-402">Scheduling engine performance can be optimized using parameters found on the **Scheduling parameters** page.</span></span> <span data-ttu-id="2857c-403">Параметры **Время ожидания планирования включено** и **Время ожидания оптимизации планирования включено** должны всегда иметь значение **Да**.</span><span class="sxs-lookup"><span data-stu-id="2857c-403">The **Scheduling timeout enabled** and **Scheduling optimization timeout enabled** settings should always be set to **Yes**.</span></span> <span data-ttu-id="2857c-404">Если установлено значение **Нет**, планирование может потенциально работать бесконечно, если был создан недопустимый маршрут со множеством параметров.</span><span class="sxs-lookup"><span data-stu-id="2857c-404">If set to **No**, the scheduling can potentially run infinitely if an unfeasible route with many options has been created.</span></span>

<span data-ttu-id="2857c-405">Значение параметра **Максимальное время планирования на одну последовательность** определяет, сколько секунд можно, как минимум, потратить на попытку поиска решения для одной последовательности (в большинстве случаев последовательность соответствует отдельному заказу).</span><span class="sxs-lookup"><span data-stu-id="2857c-405">The value for **Maximum scheduling time per sequence** controls how many seconds can, at most, be spent trying to find a solution for a single sequence (in most cases a sequence corresponds to a single order).</span></span> <span data-ttu-id="2857c-406">Значение, которое следует использоваться здесь, сильно зависит от сложности маршрута и настроек, таких как ограничение по мощности, но максимум около 30 секунд является хорошей отправной точкой.</span><span class="sxs-lookup"><span data-stu-id="2857c-406">The value to use here highly depends on the complexity of the route and settings like finite capacity, ut a maximum of about 30 seconds is a good starting point.</span></span>

<span data-ttu-id="2857c-407">Значение параметра **Время ожидания попыток оптимизации** определяет, сколько максимально секунд можно использовать для поиска лучшего решения, чем то, которое было найдено.</span><span class="sxs-lookup"><span data-stu-id="2857c-407">The value for **Optimization attempts timeout** controls how many seconds can at most be used to find a better solution than the one originally found.</span></span> <span data-ttu-id="2857c-408">Это влияет только на маршруты, использующие параллельные операции, так как для них необходимо тестирование различных комбинаций.</span><span class="sxs-lookup"><span data-stu-id="2857c-408">This will only influence routes that are using parallel operations as these make it necessary to test different combinations.</span></span>

> [!NOTE]
> <span data-ttu-id="2857c-409">Значения, установленные для параметров времени ожидания, применяются как для планирования выпущенных производственных заказов, так и для спланированных заказов как часть MRP.</span><span class="sxs-lookup"><span data-stu-id="2857c-409">The values set for the timeouts will be applied both for scheduling of released production orders and of planned orders as part of MRP.</span></span> <span data-ttu-id="2857c-410">В результате задание очень больших значений может значительно увеличить время выполнения MRP при запуске для плана с множеством спланированных производственных заказов.</span><span class="sxs-lookup"><span data-stu-id="2857c-410">As a result, setting very high values could significantly add to the run time of MRP when running for a plan with many planned production orders.</span></span>

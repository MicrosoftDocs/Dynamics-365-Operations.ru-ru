---
title: Интеграция с системами управления производством независимых разработчиков
description: В этой статье объясняется, как интегрировать Microsoft Dynamics 365 Supply Chain Management с системой управления производством (MES) сторонних разработчиков.
author: johanhoffmann
ms.date: 10/01/2021
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: johanho
ms.search.validFrom: 2021-10-01
ms.dyn365.ops.version: 10.0.23
ms.openlocfilehash: 208ed2d6c8b411d12888966d9c175730e828eb44
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2022
ms.locfileid: "8860648"
---
# <a name="integrate-with-third-party-manufacturing-execution-systems"></a>Интеграция с системами управления производством независимых разработчиков

[!include [banner](../includes/banner.md)]

Некоторые производственные организации, использующие Microsoft Dynamics 365 Supply Chain Management, используют собственные функции в Dynamics 365 для управления производственными мероприятиями для станков, оборудования и персонала. Однако в других производственных организациях, особенно в случае сложных производственных требований, вместо этого используются системы управления производством (MES) стороннего разработчика. Организации могут выбрать решение MES третьей стороны, поскольку, к примеру, оно специально приспособлено для их вертикальной отрасли.

В интегрированном решении обмен данными выполняется полностью автоматически и происходит в режиме, близком к режиму реального времени. Таким образом, данные остаются актуальными в обеих системах, и ввод данных вручную не является обязательным. Например, когда потребление материалов регистрируется в системе MES, интеграция гарантирует, что то же потребление также регистрируется в Dynamics 365. Следовательно, актуальные записи запасов доступны для других важных процессов, таких как планирование и продажи.

Решение позволяет пользователям Supply Chain Management быстрее, проще и дешевле выполнять интеграцию со сторонними решениями MES. Оно предлагает следующие функции:

- Бизнес-события и интерфейсы, поддерживающие [основные процессы управления производством](#processes-available-for-mes-integration)
- Централизованная панель мониторинга, в которой можно отслеживать историю обработки событий и устранять неполадки и исправлять сбойные процессы

На следующем рисунке показана типичная коллекция бизнес-событий, процессов и сообщений, которыми обменивается интегрированное решение.

![Типичный сценарий интеграции.](media/3p-mes-scenario.png "Типичный сценарий интеграции.")

## <a name="turn-on-the-mes-integration-feature"></a>Включение функции интеграции MES

Прежде чем можно будет использовать эту функцию, администратор должен включить ее в системе, как описано в следующей процедуре.

1. Перейдите в раздел **Администрирование системы \> Настройка \> Конфигурация лицензии**.
1. Убедитесь, что ключ лицензии **Время и посещаемость** включен (отображается флажок). Этот лицензионный ключ необходим, поскольку он управляет функциональностью и данными системы выполнения производства. Если он не включен, выполните следующие действия:
    1. Переведите систему в режим обслуживания, как описано в разделе [Режим обслуживания](../../fin-ops-core/dev-itpro/sysadmin/maintenance-mode.md).
    1. На странице **Конфигурация лицензии** выберите флажок **Время и посещаемость**.
    1. Выключите режим обслуживания, как описано в разделе [Режим обслуживания](../../fin-ops-core/dev-itpro/sysadmin/maintenance-mode.md)
1. Перейдите в раздел **Администрирование системы \> Рабочие области \> Управление функциями**.
1. Включите функцию, которая указана, следующим способом (см. также раздел [Обзор управления функциями](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)):
    - **Модуль:** *Управление производством*
    - **Название функции:** *Интеграция системы управления производством*

## <a name="processes-available-for-mes-integration"></a>Процессы, доступные для интеграции MES

Для интеграции можно включить любые из следующих процессов или из все.

| Наименование процесса | Описание |
|---|---|
| Запуск в производство производственных заказов и бизнес-события изменения статуса производственного заказа | Этот процесс предоставляет бизнес-событие, которое может прослушивать система MES, для получения сведений о производственных заказах, которые должны быть произведены. Предполагается, что ссылочные данные, связанные с производственным заказом, предоставляются от Supply Chain Management системе MES через протокол OData (Open Data Protocol) или сущности данных. |
| Запустить производственный заказ | Этот процесс обеспечивает Supply Chain Management сведениями о производственных заказах, которые запускаются с помощью системы MES. Это гарантирует, что обе системы имеют актуальное представление всех производственных действий. |
| Сообщение о произведенном или списанном количестве | Этот процесс обеспечивает Supply Chain Management сведениями о количестве товара и количестве брака, сообщенных для производственного задания с помощью системы MES. Это гарантирует, что супервизоры цеха имеют актуальное представление хода выполнения плана производства. |
| Сообщение о потреблении сырья | Этот процесс обеспечивает Supply Chain Management сведениями из системы MES о количестве потребленных материалов. Он делает актуальные записи запасов доступными для других важных процессов, таких как планирование и продажи. |
| Сообщение о времени, затраченном на операцию | Этот процесс обеспечивает Supply Chain Management сведениями о времени, которое используется для определенной операции. |
| Завершить производственный заказ | Этот процесс информирует Supply Chain Management, что система MES обновила производственный заказ до его последнего статуса *Завершено*. Этот статус указывает, что в производственном заказе больше не будет произведено никаких количеств. |

## <a name="monitor-incoming-messages"></a>Мониторинг входящих сообщений

Чтобы отслеживать входящие сообщения в системе, откройте страницу **Интеграция системы управления производством**. Там можно просматривать, обрабатывать и устранять проблемы.

Все сообщения для конкретного производственного заказа обрабатываются в последовательности их получения. Однако сообщения для других производственных заказов не могут быть обработаны в полученной последовательности, поскольку пакетные задания обрабатываются параллельно. В случае сбоя пакетное задание будет пытаться обработать каждое сообщение три раза, прежде чем устанавливать статус *Сбой*.

## <a name="call-the-api"></a>Вызов API

Для вызова API-интерфейса интеграции системы MES отправьте запрос `POST` на следующий URL-адрес конечной точки:

`/api/services/SysMessageServices/SysMessageService/SendMessage`

Тело отправленного запроса должно быть похоже на следующий пример. Замените значения для `_companyId`, `_messageType` и `_messageContent` на требуемые. Сведения о различных типах сообщений, поддерживаемых интерфейсом API, и о проектировании их содержимого см. в следующем разделе.

```json
{
    "_companyId": "USMF",
    "_messageQueue": "JmgMES3P",
    "_messageType": "ProdProductionOrderReportFinished",
    "_messageContent":
    "{\"ProductionOrderNumber\": \"P000123\", \"ReportFinishedLines\": [{\"ItemNumber\": \"A0001\", \"ReportedGoodQuantity\": 10, \"ReportAsFinishedDate\": \"2021-01-01\"}]}"
}
```

## <a name="api-message-types-and-content"></a>Типы и содержимое сообщений API

В этом разделе описывается каждый тип сообщений, которыми можно обмениваться через API интеграции с системой MES.

### <a name="start-production-order-message"></a>Сообщение о запуске производственного заказа

Для сообщения о *запуске производственного заказа* значение параметра `_messageType` равно `ProdProductionOrderStart`. В следующей таблице показаны поля, которые поддерживает это сообщение.

| Имя поля | Статус | Тип |
|---|---|---|
| `ProductionOrderNumber` | Обязательная аналитика | Строка |
| `StartedQuantity` | Необязательно | Действующий |
| `StartedDate` | Необязательно | Дата |
| `AutomaticBOMConsumptionRule` | Необязательно | Перечисление (FlushingPrincip \| Always \| Never) |

### <a name="report-as-finished-message"></a>Сообщение о приемке

Для сообщения о *приемке* значение `_messageType` равно `ProdProductionOrderReportFinished`. В следующей таблице показаны поля, которые поддерживает это сообщение.

| Имя поля | Статус | Тип |
|---|---|---|
| `ProductionOrderNumber` | Обязательная аналитика | Строка |
| `ReportFinishedLines` | Обязательная аналитика | Список строк (по крайней мере одна), каждая из которых содержит полезные данные, которые описаны в следующей таблице |

В следующей таблице показаны поля, поддерживаемые каждой строкой в разделе `ReportFinishedLines` сообщения `ProdProductionOrderReportFinished`.

| Имя поля | Статус | Тип |
|---|---|---|
| `LineNumber` | Необязательно | Действующий |
| `ItemNumber` | Необязательно | Строка|
| `ProductionType` | Необязательно | Перечисление (MainItem \| Formula \| BOM \| Co_Product \| By_Product \| None), расширяемое |
| `ReportedErrorQuantity` | Необязательно | Действующий|
| `ReportedGoodQuantity` | Необязательно | Действующий|
| `ReportedErrorCatchWeightQuantity` | Необязательно | Действующий |
| `ReportedGoodCatchWeightQuantity` | Необязательно | Действующий |
| `AcceptError` | Необязательно | Перечисление (Да \| Нет) |
| `ErrorCause` | Необязательно | Перечисление (None \| Material \| Machine \| OperatingStaff), расширяемое |
| `ExecutedDateTime` | Необязательно | DateTime |
| `ReportAsFinishedDate` | Необязательно | Дата |
| `AutomaticBOMConsumptionRule` | Необязательно | Перечисление (FlushingPrincip \| Always \| Never) |
| `AutomaticRouteConsumptionRule` | Необязательно |Перечисление (RouteDependent \| Always \| Never) |
| `RespectFlushingPrincipleDuringOverproduction` | Необязательно | Перечисление (Да \| Нет) |
| `ProductionJournalNameId` | Необязательно | Строка |
| `PickingListProductionJournalNameId` | Необязательно | Строка|
| `RouteCardProductionJournalNameId` | Необязательно | Строка |
| `FromOperationNumber` | Необязательно | Целое число|
| `ToOperationNumber` | Необязательно | Целое число|
| `InventoryLotId` | Необязательно | Строка |
| `BaseValue` | Необязательно | Строка |
| `EndJob` | Необязательно | Перечисление (Да \| Нет) |
| `EndPickingList` | Необязательно | Перечисление (Да \| Нет) |
| `EndRouteCard` | Необязательно | Перечисление (Да \| Нет) |
| `PostNow` | Необязательно | Перечисление (Да \| Нет) |
| `AutoUpdate` | Необязательно | Перечисление (Да \| Нет) |
| `ProductColorId` | Необязательно | Строка|
| `ProductConfigurationId` | Необязательно | Строка |
| `ProductSizeId` | Необязательно | Строка |
| `ProductStyleId` | Необязательно | Строка |
| `ProductVersionId` | Необязательно | Строка |
| `ItemBatchNumber` | Необязательно | Строка |
| `ProductSerialNumber` | Необязательно | Строка |
| `LicensePlateNumber` | Необязательно | Строка |
| `InventoryStatusId` | Необязательно | Строка |
| `ProductionWarehouseId` | Необязательно | Строка |
| `ProductionSiteId` | Необязательно | Строка |
| `ProductionWarehouseLocationId` | Необязательно | Строка |
| С `InventoryDimension1` по `InventoryDimension12` | Необязательно | Строка |

12 расширяемых аналитик (от `InventoryDimension1` до `InventoryDimension12`) требуют настройки и не всегда используются. Дополнительные сведения о них см. в разделе [Добавление новых складских аналитик через расширение](../../fin-ops-core/dev-itpro/extensibility/inventory-dimensions.md).

### <a name="material-consumption-picking-list-message"></a>Сообщение о потреблении материала (лист комплектации)

Для сообщения о *потреблении материала (лист комплектации)* значение `_messageType` равно `ProdProductionOrderPickingList`. В следующей таблице показаны поля, которые поддерживает это сообщение.

| Имя поля | Статус | Тип |
|---|---|---|
| `ProductionOrderNumber` | Обязательная аналитика | Строка |
| `JournalNameId` | Необязательно | Строка |
| `PickingListLines` | Обязательная аналитика | Список строк (по крайней мере одна), каждая из которых содержит полезные данные, которые описаны в следующей таблице |

В следующей таблице показаны поля, поддерживаемые каждой строкой в разделе `PickingListLines` сообщения `ProdProductionOrderPickingList`.

| Имя поля | Статус | Тип |
|---|---|---|
| `ItemNumber` | Обязательная аналитика | Строка |
| `ConsumptionBOMQuantity` | Необязательно | Действующий |
| `ProposalBOMQuantity` | Необязательно | Действующий |
| `ScrapBOMQuantity` | Необязательно | Действующий |
| `BOMUnitSymbol` | Необязательно | Строка |
| `ConsumptionInventoryQuantity` | Необязательно | Действующий |
| `ProposalInventoryQuantity` | Необязательно | Действующий |
| `ConsumptionCatchWeightQuantity` | Необязательно | Действующий |
| `ProposalCatchWeightQuantity` | Необязательно | Действующий |
| `ConsumptionDate` | Необязательно | Дата |
| `OperationNumber` | Необязательно | Целое число |
| `LineNumber` | Необязательно | Действующий |
| `PositionNumber` | Необязательно | Строка |
| `IsConsumptionEnded` | Необязательно | Перечисление (Да \| Нет) |
| `ErrorCause` | Необязательно | Перечисление (None \| Material \| Machine \| OperatingStaff), расширяемое |
| `InventoryLotId` | Необязательно | Строка |

### <a name="time-used-for-operation-route-card-message"></a>Время, используемое для сообщения об операции (маршрутная карта)

Для сообщения о *времени, используемом для операции (маршрутная карта)* значение `_messageType` равно `ProdProductionOrderRouteCard`. В следующей таблице показаны поля, которые поддерживает это сообщение.

| Имя поля | Статус | Тип |
|---|---|---|
| `ProductionOrderNumber` | Обязательная аналитика | Строка |
| `JournalNameId` | Необязательно | Строка |
| `RouteCardLines` | Обязательная аналитика | Список строк (по крайней мере одна), каждая из которых содержит полезные данные, которые описаны в следующей таблице |

В следующей таблице показаны поля, поддерживаемые каждой строкой в разделе `RouteCardLines` сообщения `ProdProductionOrderRouteCard`.

| Имя поля | Статус | Тип |
|---|---|---|
| `OperationNumber` | Обязательная аналитика | Целое число |
| `OperationPriority` | Необязательно | Перечисление (Primary \| Secondary1 \| Secondary2 \| ... \| Secondary20) |
| `OperationId` | Необязательно | Строка |
| `OperationsResourceId` | Необязательно | Строка |
| `Worker` | Необязательно | Строка |
| `HoursRouteCostCategoryId` | Необязательно | Строка |
| `QuantityRouteCostCategoryId` | Необязательно | Строка |
| `HourlyRate` | Необязательно | Действующий |
| `Hours` | Необязательно | Действующий |
| `GoodQuantity` | Необязательно | Действующий |
| `ErrorQuantity` | Необязательно | Действующий |
| `CatchWeightGoodQuantity` | Необязательно | Действующий |
| `CatchWeightErrorQuantity` | Необязательно | Действующий |
| `QuantityPrice` | Необязательно | Действующий |
| `ProcessingPercentage` | Необязательно | Действующий |
| `ConsumptionDate` | Необязательно | Дата |
| `TaskType` | Необязательно | Перечисление (QueueBefore \| Setup \| Process \| Overlap \| Transport \| QueueAfter \| Burden) |
| `ErrorCause` | Необязательно | Перечисление (None \| Material \| Machine \| OperatingStaff), расширяемое |
| `OperationCompleted` | Необязательно | Перечисление (Да \| Нет) |
| `BOMConsumption` | Необязательно | Перечисление (Да \| Нет) |
| `ReportAsFinished` | Необязательно | Перечисление (Да \| Нет) |

### <a name="end-production-order-message"></a>Сообщение о завершении производственного заказа

Для сообщения о *завершении производственного заказа* значение параметра `_messageType` равно `ProdProductionOrderEnd`. В следующей таблице показаны поля, которые поддерживает это сообщение.

| Имя поля | Статус | Тип |
|---|---|---|
| `ProductionOrderNumber` | Обязательная аналитика | Строка |
| `ExecutedDateTime` | Необязательно | DateTime |
| `EndedDate` | Необязательно | Дата |
| `UseTimeAndAttendanceCost` | Необязательно | Перечисление (Да \| Нет) |
| `AutoReportAsFinished` | Необязательно | Перечисление (Да \| Нет) |
| `AutoUpdate` | Необязательно | Перечисление (Да \| Нет) |

## <a name="other-production-information"></a>Другая производственная информация

Сообщения поддерживают действия или события, происходящие в цехе. Они обрабатываются с помощью платформы интеграции MES, которая описывается в этой статье. Дизайн подразумевает, что другие справочные сведения для совместного использования с MES (например, сведения о продукте или спецификация либо маршрут (с определенной настройкой и временем конфигурации), используемые в конкретном производственном заказе) извлекаются из системы с использованием [информационных объектов](../../fin-ops-core/dev-itpro/data-entities/data-entities-data-packages.md#data-entities) с помощью переноса файлов или OData.

## <a name="receive-feedback-about-the-state-of-a-message"></a>Получение обратной связи о состоянии сообщения

После того как система MES отправила сообщение в Supply Chain Management, для Supply Chain Management может быть уместным вернуть отзыв о состоянии сообщения. Ниже приведены несколько примеров случаев, в которых такое поведение может быть уместным:

- Нет человека, ответственного за постоянный контроль интеграции с системой MES.
- Лицо, ответственное за интеграцию с системой MES, хочет получать уведомления по электронной почте о сбое сообщения, чтобы он знал, что нужно предпринять действие.
- Система MES должна отображать сообщение об ошибке, чтобы сообщить оператору цеха или какому-то сотруднику отдела ИТ о том, что они должны предпринять действие.
- Система MES должна пересчитывать график заказа после того, как она получит сообщение о сбое (например, из-за того, что не удалось запустить производственный заказ).

В этих случаях можно воспользоваться преимуществом стандартной функции оповещения в модуле Supply Chain Management. Для получения сведений о том, как работают стандартные оповещения, см. в следующих ресурсах:

- Статья справки: [Обзор оповещений](../../fin-ops-core/fin-ops/get-started/alerts-overview.md)
- Видео: [Параметры правила оповещения в Dynamics 365 for Finance and Operations](https://www.youtube.com/watch?v=cpzimwOjicM&ab_channel=MicrosoftDynamics365)

Например, можно настроить следующие оповещения, чтобы отправить отзыв о состоянии сообщения:

- Создание бизнес-события ("Послать извне"), которое используется, если сообщение находится в состоянии *Сбой*.
- Отправьте уведомление и сообщение электронной почты ИТ-администратору или руководителю производственного цеха.

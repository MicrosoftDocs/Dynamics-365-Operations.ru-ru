---
title: Настройка Inventory Visibility
description: В этой статье описывается, как настроить видимость запасов.
author: yufeihuang
ms.date: 05/27/2022
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: yufeihuang
ms.search.validFrom: 2021-08-02
ms.dyn365.ops.version: 10.0.21
ms.openlocfilehash: 61819d9c5af64b58697e07be85beebc084ae5935
ms.sourcegitcommit: 20ce54cb40290dd116ab8b157c0a02d6757c13f5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/20/2022
ms.locfileid: "9542295"
---
# <a name="configure-inventory-visibility"></a>Настройка Inventory Visibility

[!include [banner](../includes/banner.md)]


В этой статье описывается, как настроить видимость запасов для с помощью приложения Видимость запасов в Power Apps.

## <a name="introduction"></a><a name="introduction"></a>Введение

Прежде чем приступить к работе с видимостью запасов, необходимо выполнить следующую конфигурацию, как описано в этой статье:

- [Конфигурация источника данных](#data-source-configuration)
- [Конфигурация раздела](#partition-configuration)
- [Конфигурация иерархии индекса продуктов](#index-configuration)
- [Конфигурация резервирования (необязательно)](#reservation-configuration)
- [Пример конфигурации по умолчанию](#default-configuration-sample)

## <a name="prerequisites"></a>Необходимые условия

Перед началом установки установите и настройте надстройку "Видимость запасов", как описано в разделе [Установка и настройка видимости запасов](inventory-visibility-setup.md).

## <a name="the-configuration-page-of-the-inventory-visibility-app"></a><a name="configuration"></a>Страница Конфигурация приложения Видимость запасов

В Power Apps страница **Конфигурация** [приложения Видимость запасов](inventory-visibility-power-platform.md) позволяет настроить конфигурацию в наличии и конфигурацию предварительного резервирования. После установки надстройки конфигурация по умолчанию включает значение от Microsoft Dynamics 365 Supply Chain Management (источник данных `fno`). Можно просмотреть параметры по умолчанию. Кроме того, в зависимости от бизнес-требований и требований разноски запасов для внешней системы, можно изменить конфигурацию, чтобы стандартизировать способ разноски, упорядочения и запроса изменений запасов в нескольких системах. В остальных разделах этой статьи объясняется, как использовать каждую часть страницы **Конфигурация**.

После завершения настройки выберите **Обновить конфигурацию** в приложении.

## <a name="enable-inventory-visibility-features-in-power-apps-feature-management"></a><a name="feature-switch"></a>Включение функций Видимость запасов в управлении функциями Power Apps

В надстройках "Видимость запасов" в установку добавляется несколько новых функций Power Apps. По умолчанию эти функции отключены. Чтобы использовать их, откройте страницу **Конфигурация**, затем на вкладке **Управление функциями** включите следующие функции, как требуется.

| Имя управления функциями | Описание |
|---|---|
| *OnHandReservation* | Эта функция служит для создания резервирований, потребления зарезервированных и/или незарезервированных складских количеств с помощью видимости запасов. Дополнительные сведения см. в разделе [Резервирования видимости запасов](inventory-visibility-reservations.md). |
| *OnHandMostSpecificBackgroundService* | Эта функция предоставляет сводку запасов для продуктов вместе со всеми аналитиками. Итоговые данные по запасам будут периодически синхронизироваться с видимость запасов. Периодичность синхронизации по умолчанию составляет каждые 15 минут, а максимальная частота может составлять один раз каждые 5 минут. Для получения дополнительной информации см. раздел [Сводка запасов](inventory-visibility-power-platform.md#inventory-summary). |
| *onHandIndexQueryPreloadBackgroundService* | Эта функция позволяет предварительно загрузить запросы запасов в наличии видимости запасов для сборки списков в наличии с предварительно выбранными аналитиками. Периодичность синхронизации по умолчанию составляет каждые 15 минут. Для получения дополнительной информации см. раздел [Сводка запасов](inventory-visibility-power-platform.md#preload-the-inventory-visibility-onhand-query). |
| *OnhandChangeSchedule* | Эта необязательная функция позволяет использовать функции графика изменения запасов в наличии и доступности для заказа (ATP). Дополнительные сведения см. в разделе [График изменения запасов в наличии и доступность для заказа](inventory-visibility-available-to-promise.md). |
| *Распределение* | Эта дополнительная функция позволяет видимости запасов иметь возможность защиты запасов (выделение на самостоятельный баланс) и управления избыточной продажей. Дополнительные сведения см. в разделе [Распределение запасов видимости запасов](inventory-visibility-allocation.md). |
| *Включить складские номенклатуры в видимости запасов* | Эта необязательная функция обеспечивает возможность просмотра запасов для поддержки номенклатур, включенных в процессы управления складом (WMS). Дополнительные сведения см. в разделе [Поддержка видимости запасов для номенклатур WMS](inventory-visibility-whs-support.md). |

## <a name="find-the-service-endpoint"></a><a name="get-service-endpoint"></a>Поиск конечной точки службы

Если правильная конечная точка службы видимости запасов неизвестна, откройте страницу **Конфигурация** в Power Apps и выберите **Показать конечную точку службы** в верхнем правом углу. На странице будет отображена правильная конечная точка службы.

## <a name="data-source-configuration"></a><a name="data-source-configuration"></a>Конфигурация источника данных

Каждый источник данных представляет систему, из которой поступают данные. Примерами имен источника данных являются `fno` (то есть, "приложения Dynamics 365 для управления финансами и операциями") и `pos` (то есть, "POS"). По умолчанию Supply Chain Management настраивается в качестве источника данных по умолчанию (`fno`) в видимости запасов.

> [!NOTE]
> Источник данных `fno` зарезервирован для Supply Chain Management. Если надстройка видимости запасов интегрирована со средой Supply Chain Management, рекомендуется не удалять конфигурации, связанные с `fno` в источнике данных.

Чтобы добавить источник данных, выполните следующие действия.

1. Выполните вход в среду Power Apps и откройте область **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Источник данных** выберите **Создать источник данных**, чтобы добавить источник данных.

> [!NOTE]
> При добавлении источника данных перед обновлением конфигурации для службы "Видимость запасов" проверьте имя источника данных, физические меры и сопоставления измерений. Вы не сможете изменить эти параметры после того, как будет выбрано **Обновление конфигурации**.

Конфигурация источника данных включает следующие компоненты:

- Аналитики (сопоставление аналитики)
- Физические меры
- Рассчитанные меры

### <a name="dimensions-dimension-mapping"></a><a name="data-source-configuration-dimension"></a>Аналитики (сопоставление аналитики)

Целью настройки аналитики является стандартизация интеграции нескольких систем для разноски событий и запросов, основанным на сочетании аналитик. Видимость запасов предоставляет список базовых аналитик, которые могут быть сопоставлены из аналитик вашего источника данных. Тридцать три аналитики доступны для сопоставления.

- По умолчанию, если используется Supply Chain Management в качестве одного из источников данных, 13 аналитик сопоставляются со стандартными аналитиками Supply Chain Management. Двенадцать других аналитик (`inventDimension1` через `inventDimension12`) сопоставляются с настраиваемыми аналитиками в Supply Chain Management. Оставшиеся восемь аналитик — это расширенные аналитики, которые можно сопоставить с внешними источниками данных.
- Если в качестве одного из источников данных не используется Supply Chain Management, можно свободно сопоставить аналитики. В следующей таблице показан полный список доступных аналитик.

> [!NOTE]
> Если ваша аналитика не входит в список аналитик по умолчанию и вы используете внешний источник данных, мы рекомендуем использовать `ExtendedDimension1` через `ExtendedDimension8` для выполнения сопоставления.

| Тип аналитики | Базовая аналитика |
|---|---|
| Продукт | `ColorId` |
| Продукт | `SizeId` |
| Продукт | `StyleId` |
| Продукт | `ConfigId` |
| Отслеживание | `BatchId` |
| Отслеживание | `SerialId` |
| Расположение | `LocationId` |
| Расположение | `SiteId` |
| Статус запасов | `StatusId` |
| Зависит от склада | `WMSLocationId` |
| Зависит от склада | `WMSPalletId` |
| Зависит от склада | `LicensePlateId` |
| Прочее | `VersionId` |
| Запасы (настраиваемый) | `InventDimension1` через `InventDimension12` |
| Расширение | `ExtendedDimension1` через `ExtendedDimension8` |
| System | `Empty` |

> [!NOTE]
> Типы аналитики, приведенные в предыдущей таблице, используются только для справки. Вам не нужно определять их в видимости запасов.
>
> Аналитики запасов (настраиваемые) могут быть зарезервированы для Supply Chain Management. В этом случае вместо этого можно использовать расширенные аналитики.

Внешние системы могут получить доступ к видимости запасов через интерфейсы API RESTFUL. Для интеграции видимость запасов позволяет настроить _внешний источник данных_ и сопоставление из _внешних аналитик_ для _базовых аналитик_. Ниже приведен пример таблицы сопоставления аналитик.

| Внешняя аналитика | Базовая аналитика |
|---|---|
| `MyColorId` | `ColorId` |
| `MySizeId` | `SizeId` |
| `MyStyleId` | `StyleId` |
| `MyDimension1` | `ExtendedDimension1` |
| `MyDimension2` | `ExtendedDimension2` |

Настроив сопоставление аналитики, можно отправлять внешние аналитики непосредственно в видимость запасов. После этого видимость запасов будет автоматически преобразовывать внешние аналитики в базовые аналитики.

Чтобы добавить сопоставления аналитик, выполните следующие действия.

1. Выполните вход в среду Power Apps и откройте область **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Источник данных** в разделе **Сопоставление аналитик** выберите **Добавить**, чтобы добавить отображение аналитик.
    ![Добавление сопоставлений аналитик](media/inventory-visibility-dimension-mapping.png "Добавление сопоставлений аналитик")

1. В поле **Имя аналитики** укажите исходную аналитику.
1. В поле **Для базовой аналитики** выберите аналитику в видимости запасов, которую необходимо сопоставить.
1. Нажмите **Сохранить**.

Например, если источник данных включает аналитику цвета продукта, можно сопоставить его с базовой аналитикой `ColorId`, чтобы добавить пользовательскую аналитику `ProductColor` в источник данных `exterchannel`. Затем она сопоставляется с базовой аналитикой `ColorId`.

### <a name="physical-measures"></a><a name="data-source-configuration-physical-measures"></a>Физические меры

Когда источник данных выполняет разноску изменения запасов в видимости запасов, он разносит это изменение, используя *физические измерения*. Физические меры изменяют количество и отображают статус запасов. В зависимости от потребностей можно определить собственные физические меры. Запросы могут основываться на физических измерениях.

Видимость запасов предоставляет список физических мер по умолчанию, связанных с Supply Chain Management (источник данных `fno`). Эти физические измерения по умолчанию берутся из статусов проводок по запасам на странице **Список количества в наличии** в Supply Chain Management (**Управление запасами \> Запросы и отчет \> Список количества в наличии**). В следующей таблице представлен пример физических мер.

| Имя физической меры | описание |
|---|---|
| `NotSpecified` | Не указано |
| `Arrived` | Прибыло |
| `AvailOrdered` | Доступно заказанного |
| `AvailPhysical` | Физ. доступно |
| `Deducted` | Отпущено |
| `OnOrder` | OnOrder |
| `Ordered` | Занято |
| `PhysicalInvent` | Физические запасы |
| `Picked` | Скомплектовано |
| `PostedQty` | Разнесенное количество |
| `QuotationIssue` | Расход по предложению |
| `QuotationReceipt` | Принятие предложения |
| `Received` | Получение |
| `Registered` | Зарегистрировано |
| `ReservOrdered` | Зарезервировано в заказанных |
| `ReservPhysical` | Физически зарезервировано |

Если источником данных является Supply Chain Management, нет необходимости повторно создавать физические измерения по умолчанию. Однако для внешних источников данных можно создать новые физические измерения, выполнив следующие действия.

1. Выполните вход в среду Power Apps и откройте область **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Источник данных** в разделе **Физические измерения** выберите **Добавить**, укажите имя исходного измерения и сохраните изменения.

### <a name="calculated-measures"></a>Рассчитанные меры

Можно использовать видимость запасов для запроса по физическим мерам запасов и по *настраиваемым рассчитанным мерам*. Вычисляемые меры дают настраиваемую формулу вычислений, которая состоит из комбинации физических мер. Эта функция позволяют определить набор физических мер, которые будут добавлены, и/или набор физических мер, которые будут вычтены, чтобы сформировать настраиваемую меру.

> [!IMPORTANT]
> Вычисляемая мера представляет собой композицию физических показателей. Формула может включать только физические показатели без дубликатов, но не рассчитанные меры.

Конфигурация позволяет определить набор модификаторов, которые добавляются или вычитаются для получения итогового агрегированного выходного количества.

Для настройки настраиваемой вычисляемой меры выполните следующие действия.

1. Выполните вход в среду Power Apps и откройте область **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Рассчитанная мера** выберите **Создать расчет меры** для добавления вычисляемой меры.
1. Задайте следующие поля для новой вычисляемой меры:

    - **Имя новой вычисляемой меры** — введите имя вычисляемой меры.
    - **Источник данных** — выберите источник данных, связанный с новым модификатором. Система запросов представляет собой источник данных.

1. Выберите **Добавить**, чтобы добавить модификатор к новой вычисляемой мере.
1. Задайте следующие поля для нового модификатора:

    - **Модификатор** — выберите тип модификатора (*Сложение* или *Вычитание*).
    - **Источник данных** — выберите источник данных, в котором должна быть найдена мера, обеспечивающая значение модификатора.
    - **Мера** — выберите имя меры (из выбранного источника данных), которая предоставляет значение для модификатора.

1. Повторяйте шаги с 5 по 6 до тех пор, пока не будут добавлены все необходимые модификаторы.
1. Нажмите **Сохранить**.

Например, может быть следующий результат запроса.

```json
[
    {
        "productId": "T-shirt",
        "dimensions": {
            "SiteId": "1",
            "LocationId": "11",
            "ColorId": "Red"
        },
        "quantities": {
            "pos": {
                "inbound": 80.0,
                "outbound": 20.0
            },
            "fno": {
                "availphysical": 100.0,
                "orderedintotal": 50.0,
                "orderedreserved": 10.0
            },
            "externalchannel": {
                "received": 90.0,
                "scheduled": 30.0,
                "issued": 60.0,
                "reserved": 40.0
            }
        }
    }
]
```

Затем выполняется настройка вычисляемой меры с именем `MyCustomAvailableforReservation`, как показано в следующей таблице. Эта рассчитанная мера будет потреблена системой потребления.

| Система потребления | Рассчитанная мера | Иcточник данных | Физическая мера | Тип расчета |
|---|---|---|---|---|
| `CustomChannel` | `MyCustomAvailableforReservation` | `fno` | `availphysical` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `fno` | `orderedintotal` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `fno` | `orderedreserved` | `Subtraction` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `pos` | `inbound` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `pos` | `outbound` | `Subtraction` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `externalchannel` | `received` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `externalchannel` | `scheduled` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `externalchannel` | `issued` | `Subtraction` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `externalchannel` | `reserved` | `Subtraction` |

При использовании этой расчетной формулы новый результат запроса будет включать настроенную меру.

```json
[
    {
        "productId": "T-shirt",
        "dimensions": {
            "SiteId": "1",
            "LocationId": "11",
            "ColorId": "Red"
        },
        "quantities": {
            "pos": {
                "inbound": 80.0,
                "outbound": 20.0
            },
            "fno": {
                "availphysical": 100.0,
                "orderedintotal": 50.0,
                "orderedreserved": 10.0
            },
            "externalchannel": {
                "received": 90.0,
                "scheduled": 30.0,
                "issued": 60.0,
                "reserved": 40.0
            },
            "CustomChannel": {
                "MyCustomAvailableforReservation": 220.0
            }
        }
    }
]
```

Выходные данные `MyCustomAvailableforReservation` основаны на параметрах расчета в настраиваемых измерениях следующим образом: 100 + 50 – 10 + 80 – 20 + 90 + 30 – 60 – 40 = 220.

## <a name="partition-configuration"></a><a name="partition-configuration"></a>Конфигурация раздела

В настоящее время конфигурация разделов состоит из двух базовых аналитик (`SiteId` и `LocationId`), которые показывают, как распределяются данные. Операции в рамках одного раздела могут повысить производительность при меньших затратах. В следующей таблице показана конфигурация разделов по умолчанию, которая предоставляется надстройкой видимости запасов.

| Базовая аналитика | Иерархия |
|---|---|
| `SiteId` | 1 |
| `LocationId` | 2 |

Решение включает эту конфигурацию разделов по умолчанию. Следовательно, *определять ее самостоятельно не требуется*.

> [!IMPORTANT]
> На настраивайте конфигурацию разделов по умолчанию. Если удалить или изменить ее, то, вероятно, произойдет неожиданная ошибка.

## <a name="product-index-hierarchy-configuration"></a><a name="index-configuration"></a>Конфигурация иерархии индекса продуктов

В большинстве случаев запрос запасов в наличии не будет иметь самый высокий "итоговый" уровень. Вместо этого, возможно, потребуется просмотреть результаты, агрегированные на основе складских аналитик.

Видимость запасов обеспечивает гибкость, позволяя настраивать _индексы_ для повышения производительность ваших запросов. Эти индексы основаны на аналитике или комбинации аналитик. Индекс состоит из *номера набора*, *аналитики* и *иерархии*, как определено в следующей таблице.

| ФИО | описание |
|---|---|
| Номер набора | Аналитики, которые относятся к одному набору (индекс), будут сгруппированы вместе и для них будут добавлены одинаковые номера наборов. |
| Аналитика | Базовые аналитики, по которым выполняется агрегирование результатов запроса. |
| Иерархия | Иерархия позволяет повысить производительность некоторых сочетаний измерений при использовании в фильтрах и параметрах группировки запросов. Например, если настроить набор аналитик с помощью иерархической последовательности `(ColorId, SizeId, StyleId)`, система может быстрее обрабатывать запросы, имеющие четыре комбинации измерений. Первое сочетание пустое, второе — `(ColorId)`, третье, `(ColorId, SizeId)`, а четвертое — `(ColorId, SizeId, StyleId)`. Другие комбинации не будут ускорены. Фильтры не ограничиваются по порядку, но должны быть внутри этих измерений, если требуется повысить их производительность. Дополнительные сведения см. в следующих примерах. |

Для настройки индекса иерархии продуктов выполните следующие действия.

1. Выполните вход в среду Power Apps и откройте область **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Индекс иерархии продуктов** в разделе **Сопоставление аналитик** выберите **Добавить**, чтобы добавить отображение аналитик.
1. По умолчанию предоставляется список индексов. Чтобы изменить существующий индекс, выберите **Изменить** или **Добавить** в разделе для соответствующего индекса. Чтобы создать новый набор индексов, выберите **Создать набор индексов**. Для каждой строки каждого набора индексов в поле **Аналитика** выберите из списка базовых аналитик. Значения для следующих полей создаются автоматически:

    - **Номер набора** – аналитики, которые относятся к одной группе (индекс), будут сгруппированы вместе и для них будут добавлены одинаковые номера наборов.
    - **Иерархия** — иерархия повышает производительность некоторых сочетаний измерений при использовании в фильтрах и параметрах группировки запросов.

> [!TIP]
> Вот несколько советов, которые следует иметь в виду при настройке иерархии индексов:
>
> - Базовые аналитики, которые определены в конфигурации разделов, не должны определяться в конфигурациях индекса. Если базовая аналитика определена повторно в конфигурации индекса, запрос по этому индексу будет невозможен.
> - Если необходимо только запросить запасы, агрегированные по всем комбинациям аналитик, то можно настроить один индекс, содержащий базовую аналитику `Empty`.

### <a name="example"></a>Пример

В этом разделе представлен пример работы иерархии.

В следующей таблице представлен список доступных запасов для данного примера.

| Номенклатура | ColorId | SizeId | StyleId | Количество |
|---|---|---|---|---|
| Футболка | Черный | Небольшой | Широк. | 1 |
| Футболка | Черный | Небольшой | Обычная | 2 |
| Футболка | Черный | Большое | Широк. | 3 |
| Футболка | Черный | Большое | Обычная | 4 |
| Футболка | Красный | Небольшой | Широк. | 5 |
| Футболка | Красный | Небольшой | Обычная | 6 |
| Футболка | Красный | Большое | Обычная | 7 |

В следующей таблице показан способ настройки иерархии индекса.

| Номер набора | Аналитика | Иерархия |
|---|---|---|
| 1 | `ColorId` | 1 |
| 1 | `SizeId` | 2 |
| 1 | `StyleId` | 3 |

Индекс позволяет выполнять запросы запасов в наличии следующими способами:

- `()` — сгруппированы по всем

    - Футболка, 28

- `(ColorId)` — сгруппированы по `ColorId`

    - Футболка, черная, 10
    - Футболка, красная, 18

- `(ColorId, SizeId)` — группирование по сочетанию `ColorId` и `SizeId`

    - Футболка, черная, малая, 3
    - Футболка, черная, большая, 7
    - Футболка, красная, малая, 11
    - Футболка, красная, большая, 7

- `(ColorId, SizeId, StyleId)` — группирование по сочетанию `ColorId`, `SizeId` и `StyleId`

    - Футболка, черная, малая, широкая, 1
    - Футболка, черная, малая, обычная, 2
    - Футболка, черная, большая, широкая, 3
    - Футболка, черная, большая, обычная, 4
    - Футболка, красная, малая, широкая, 5
    - Футболка, красная, малая, обычная, 6
    - Футболка, красная, большая, обычная, 7

## <a name="reservation-configuration-optional"></a><a name="reservation-configuration"></a>Конфигурация резервирования (необязательно)

Конфигурация резервирования требуется, если нужно использовать функцию "предварительное резервирование". Конфигурация состоит из двух фундаментальных частей:

- Сопоставление предварительного резервирования
- Иерархия предварительного резервирования

### <a name="soft-reservation-mapping"></a>Сопоставление предварительного резервирования

При резервировании может возникнуть необходимость узнать, доступны ли в данный момент запасы в наличии для резервирования. Проверка связана с вычисляемой мерой, которая представляет собой формулу вычисления комбинации физических мер.

Настроив сопоставление физической меры с рассчитанной мерой, служба видимости запасов должна автоматически проверять доступность резервирования на основе физической меры.

Перед настройкой этого сопоставления необходимо определить физические меры, вычисляемые меры и их источники данных на вкладках **Источник данных** и **Вычисляемая мера** страницы **Конфигурация** в Power Apps (как описано ранее в этой статье).

Чтобы определить сопоставление предварительного резервирования, выполните следующие действия.

1. Определите физическую меру, которая выступает в качестве меры предварительного резервирования (например, `SoftReservOrdered`).
1. На вкладке **Рассчитанная мера** на странице **Конфигурация** укажите рассчитанную меру *доступно для резервирования* (AFR), которая содержит формулу вычисления AFR, которую необходимо сопоставить с физической мерой. Например, можно настроить `AvailableToReserve` (доступно для резервирования), чтобы оно содержало ранее определенную физическую меру `SoftReservOrdered`. Таким образом можно узнать, какие количества, имеющие статус запасов `SoftReservOrdered`, будут доступны для резервирования. В следующей таблице показана формула вычисления AFR.

    | Тип расчета | Иcточник данных | Физическая мера |
    |---|---|---|
    | Сложение | `fno` | `AvailPhysical` |
    | Сложение | `pos` | `Inbound` |
    | Вычитание | `pos` | `Outbound` |
    | Вычитание | `iv` | `SoftReservOrdered` |

    Рекомендуется настроить вычисляемую меру так, чтобы она содержала физическую величину, на которой основывается мера резервирования. Таким образом мера резервирования будет влиять на количество вычисляемых мер. Таким образом, в этом примере вычисляемая мера `AvailableToReserve` источника данных `iv` должна содержать физическую меру `SoftReservOrdered` из `iv` как компонента.

1. Откройте страницу **Конфигурация**.
1. На вкладке **Сопоставление предварительного резервирования** настройте сопоставление физической меры с рассчитанной мерой. Для предыдущего примера можно использовать следующие параметры для сопоставления `AvailableToReserve` с ранее определенной физической мерой `SoftReservOrdered`.

    | Источник данных физической меры | Физическая мера | Доступно для источника данных резервирования | Доступно для рассчитанной меры резервирования |
    |---|---|---|---|
    | `iv` | `SoftReservOrdered` | `iv` | `AvailableToReserve` |

    > [!NOTE]
    > Если вы не можете редактировать вкладку **Сопоставление предварительного резервирования**, вам может потребоваться включить функцию *OnHandReservation* на вкладке **Управление функциями**.

Теперь, когда выполняется резервирование в `SoftReservOrdered`, видимость запасов будет автоматически выполнять поиск `AvailableToReserve` и связанной формулы вычислений для проверки резервирования.

Например, в видимости запасов имеются следующие запасы в наличии.

```json
{
    "productId": "T-shirt",
    "dimensions": {
        "SiteId": "1",
        "LocationId": "11",
        "ColorId": "Red"
    },
    "quantities": {
        "iv": {
            "SoftReservOrdered": 90
        },
        "fno": {
            "availphysical": 70.0,
        },
        "pos": {
            "inbound": 50.0,
            "outbound": 20.0
        }
    }
}
```

В этом случае применяются следующие вычисления:

`AvailableToReserve` = `fno.availphysical` + `pos.inbound` – `pos.outbound` – `iv.SoftReservOrdered`  
= 70 + 50 – 20 – 90  
= 10

Таким образом, при попытке выполнить резервирование в `iv.SoftReservOrdered` и количестве меньше или равно `AvailableToReserve` (10), можно выполнить резервирование.

> [!NOTE]
> При вызове API резервирования можно контролировать проверку резервирования путем указания логического параметра `ifCheckAvailForReserv` в тексте запроса. Значение `True` означает, что проверка является обязательной, а значение `False` означает, что проверка не является обязательной. Значение по умолчанию — `True`.

### <a name="soft-reservation-hierarchy"></a>Иерархия предварительного резервирования

Иерархия резервирования описывает последовательность аналитик, которая должна быть указана при выполнении резервирования. Это функционирует так же, как и иерархия индексов продуктов для запросов в наличии.

Иерархия резервирования не зависит от иерархии индексов продуктов. Эта независимость позволяет реализовать управление категориями, когда пользователи могут разбить аналитики на детали, чтобы указать требования для более точного резервирования. Иерархия иерархии предварительного резервирования должна содержать `SiteId` и `LocationId` в качестве компонентов, поскольку они создают конфигурацию раздела. При выполнении резервирования необходимо указать раздел для продукта.

Ниже приведен пример иерархии предварительного резервирования.

| Базовая аналитика | Иерархия |
|---|---|
| `SiteId` | 1 |
| `LocationId` | 2 |
| `ColorId` | 3 |
| `SizeId` | 4 |
| `StyleId` | 5 |

В этом примере можно выполнять резервирование по следующим последовательностям аналитик. При выполнении резервирования необходимо указать раздел для продукта. Таким образом, можно использовать базовую иерархию `(SiteId, LocationId)`.

- `(SiteId, LocationId)`
- `(SiteId, LocationId, ColorId)`
- `(SiteId, LocationId, ColorId, SizeId)`
- `(SiteId, LocationId, ColorId, SizeId, StyleId)`

Допустимая последовательность аналитик должен строго следовать иерархии резервирования, аналитика за аналитикой. Например, последовательность иерархии `(SiteId, LocationId, SizeId)` недействительная, так как отсутствует `ColorId`.

## <a name="available-to-promise-configuration-optional"></a>Конфигурация доступности для заказа (дополнительно)

Можно настроить видимость запасов, чтобы можно было планировать будущие изменения запасов в наличии и рассчитывать доступные для заказа количества (ATP). ATP — это количество номенклатуры, которое доступно и может быть зарезервировано для клиента в следующем периоде. Использование этого расчета может значительно повысить возможности выполнения заказов. Чтобы использовать эту функцию, необходимо включить ее на вкладке **Управление функциями**, затем настроить ее на вкладке **Параметр ATP**. Дополнительные сведения см. в разделе [Графики изменения запасов в наличии и доступность для заказа](inventory-visibility-available-to-promise.md).

## <a name="complete-and-update-the-configuration"></a>Выполнение и обновление конфигурации

После завершения настройки необходимо внести все изменения в видимость запасов. Чтобы применить изменения, выберите **Обновить конфигурацию** в верхнем правом углу страницы **Конфигурация** в Power Apps.

При первом выборе **Обновить конфигурацию** система запрашивает учетные данные.

- **Код клиента** — код приложения Azure, созданный для видимости запасов.
- **Код арендатора** — идентификатор арендатора Azure.
- **Секрет клиента** — секрет приложения Azure, созданный для видимости запасов.

После входа в систему конфигурация обновляется в службе видимости запасов.

> [!NOTE]
> Перед обновлением конфигурации для службы "Видимость запасов" проверьте имя источника данных, физические меры и сопоставления мер. Вы не сможете изменить эти параметры после того, как будет выбрано **Обновление конфигурации**.

## <a name="default-configuration-sample"></a><a name="default-configuration-sample"></a>Пример конфигурации по умолчанию

На стадии инициализации видимость запасов устанавливает конфигурацию по умолчанию, которая подробно описана здесь. Эту конфигурацию можно изменить.

### <a name="data-source-configuration"></a>Конфигурация источника данных

#### <a name="configuration-of-the-iv-data-source"></a>Конфигурация источника данных iv

В этом разделе описывается, как настроить источник данных `iv`.

##### <a name="physical-measures-configured-for-the-iv-data-source"></a>Физические меры, настроенные для источника данных "iv"

Для источника данных `iv` настроены следующие физические меры:

- `Ordered`
- `SoftReservPhysical`
- `SoftReservOrdered`
- `ReservOrdered`
- `ReservPhysical`

##### <a name="orderedtotal-calculated-measure"></a>Вычисляемая мера OrderedTotal

Вычисляемая мера `OrderedTotal` настраиваемся для источника данных `iv`, как показано в следующей таблице.

| Тип расчета | Иcточник данных | Физическая мера |
|---|---|---|
| Сложение | `fno` | `Ordered` |
| Сложение | `fno` | `Arrived` |
| Сложение | `iv` | `Ordered` |

##### <a name="onhand-calculated-measure"></a>Рассчитанная мера OnHand

Вычисляемая мера `OnHand` настраиваемся для источника данных `iv`, как показано в следующей таблице.

| Тип расчета | Иcточник данных | Физическая мера |
|---|---|---|
| Сложение | `fno` | `PhysicalInvent` |
| Сложение | `iom` | `OnHand` |
| Сложение | `erp` | `Unrestricted` |
| Сложение | `erp` | `QualityInspection` |
| Сложение | `pos` | `PosInbound` |
| Вычитание | `pos` | `PosOutbound` |

##### <a name="reservedtotal-calculated-measure"></a>Вычисляемая мера ReservedTotal

Вычисляемая мера `ReservedTotal` настраиваемся для источника данных `iv`, как показано в следующей таблице.

| Тип расчета | Иcточник данных | Физическая мера |
|---|---|---|
| Сложение | `fno` | `ReservPhysical` |
| Сложение | `fno` | `ReservOrdered` |
| Сложение | `iv` | `SoftReservPhysical` |
| Сложение | `iv` | `SoftReservOrdered` |
| Сложение | `iv` | `ReservPhysical` |
| Сложение | `iv` | `ReservOrdered` |

##### <a name="softreserved-calculated-measure"></a>Вычисляемая мера SoftReserved

Вычисляемая мера `SoftReserved` настраиваемся для источника данных `iv`, как показано в следующей таблице.

| Тип расчета | Иcточник данных | Физическая мера |
|---|---|---|
| Сложение | `iv` | `SoftReservPhysical` |
| Сложение | `iv` | `SoftReservOrdered` |

##### <a name="hardreserved-calculated-measure"></a>Вычисляемая мера HardReserved

Вычисляемая мера `HardReserved` настраиваемся для источника данных `iv`, как показано в следующей таблице.

| Тип расчета | Иcточник данных | Физическая мера |
|---|---|---|
| Сложение | `fno` | `ReservPhysical` |
| Сложение | `fno` | `ReservOrdered` |
| Сложение | `iv` | `ReservPhysical` |
| Сложение | `iv` | `ReservOrdered` |

##### <a name="openorder-calculated-measure"></a>Вычисляемая мера OpenOrder

Вычисляемая мера `OpenOrder` настраиваемся для источника данных `iv`, как показано в следующей таблице.

| Тип расчета | Иcточник данных | Физическая мера |
|---|---|---|
| Сложение | `fno` | `OnOrder` |
| Сложение | `iom` | `OnOrder` |

##### <a name="onhandavailable-calculated-measure"></a>Вычисляемая мера OnHandAvailable

Вычисляемая мера `OnHandAvailable` настраиваемся для источника данных `iv`, как показано в следующей таблице.

| Тип расчета | Иcточник данных | Физическая мера |
|---|---|---|
| Сложение | `fno` | `PhysicalInvent` |
| Сложение | `iom` | `OnHand` |
| Сложение | `erp` | `Unrestricted` |
| Сложение | `erp` | `QualityInspection` |
| Сложение | `pos` | `PosInbound` |
| Вычитание | `fno` | `ReservPhysical` |
| Вычитание | `iv` | `SoftReservPhysical` |
| Вычитание | `pos` | `PosOutbound` |

##### <a name="availabletoreserve-calculated-measure"></a>Вычисляемая мера AvailableToReserve

Вычисляемая мера `AvailableToReserve` настраиваемся для источника данных `iv`, как показано в следующей таблице.

| Тип расчета | Иcточник данных | Физическая мера |
|---|---|---|
| Сложение | `fno` | `PhysicalInvent` |
| Сложение | `iom` | `OnHand` |
| Сложение | `erp` | `Unrestricted` |
| Сложение | `erp` | `QualityInspection` |
| Сложение | `pos` | `PosInbound` |
| Сложение | `fno` | `Ordered` |
| Сложение | `fno` | `Arrived` |
| Сложение | `iv` | `Ordered` |
| Вычитание | `fno` | `ReservPhysical` |
| Вычитание | `fno` | `ReservOrdered` |
| Вычитание | `iv` | `SoftReservPhysical` |
| Вычитание | `iv` | `SoftReservOrdered` |
| Вычитание | `iv` | `ReservPhysical` |
| Вычитание | `iv` | `ReservOrdered` |
| Вычитание | `pos` | `PosOutbound` |

##### <a name="inventorysupply-calculated-measure"></a>Вычисляемая мера InventorySupply

Вычисляемая мера `InventorySupply` настраиваемся для источника данных `iv`, как показано в следующей таблице.

| Тип расчета | Иcточник данных | Физическая мера |
|---|---|---|
| Сложение | `fno` | `Ordered` |
| Сложение | `fno` | `Arrived` |
| Сложение | `iv` | `Ordered` |
| Сложение | `fno` | `PhysicalInvent` |
| Сложение | `iom` | `OnHand` |
| Сложение | `erp` | `Unrestricted` |
| Сложение | `erp` | `QualityInspection` |
| Сложение | `pos` | `PosInbound` |
| Вычитание | `pos` | `PosOutbound` |

##### <a name="inventorydemand-calculated-measure"></a>Вычисляемая мера InventoryDemand

Вычисляемая мера `InventoryDemand` настраиваемся для источника данных `iv`, как показано в следующей таблице.

| Тип расчета | Иcточник данных | Физическая мера |
|---|---|---|
| Сложение | `fno` | `OnOrder` |
| Сложение | `iom` | `OnOrder` |
| Сложение | `iv` | `SoftReservPhysical` |
| Сложение | `iv` | `SoftReservOrdered` |
| Дополнение | `fno` | `ReservPhysical` |
| Дополнение | `fno` | `ReservOrdered` |
| Дополнение | `iv` | `ReservPhysical` |
| Дополнение | `iv` | `ReservOrdered` |

#### <a name="configuration-of-the-fno-data-source"></a>Конфигурация источника данных "fno"

В этом разделе описывается, как настроить источник данных `fno`.

##### <a name="dimension-mappings-for-the-fno-data-source"></a>Сопоставления аналитик для источника данных "fno"

Сопоставления аналитик, перечисленные в следующей таблице, настроены для источника данных `fno`.

| Внешняя аналитика | Базовая аналитика |
|---|---|
| `InventBatchId` | `BatchId` |
| `InventColorId` | `ColorId` |
| `InventLocationId` | `LocationId` |
| `InventSerialId` | `SerialId` |
| `InventSiteId` | `SiteId` |
| `InventSizeId` | `SizeId` |
| `InventStatusId` | `StatusId` |
| `InventStyleId` | `StyleId` |
| `LicensePlateId` | `LicensePlateId` |
| `WMSLocationId` | `WMSLocationId` |
| `WMSPalletId` | `WMSPalletId` |
| `ConfigId` | `ConfigId` |
| `InventVersionId` | `VersionId` |
| `InventDimension1` | `CustomDimension1` |
| `InventDimension2` | `CustomDimension2` |
| `InventDimension3` | `CustomDimension3` |
| `InventDimension4` | `CustomDimension4` |
| `InventDimension5` | `CustomDimension5` |
| `InventDimension6` | `CustomDimension6` |
| `InventDimension7` | `CustomDimension7` |
| `InventDimension8` | `CustomDimension8` |
| `InventDimension9` | `CustomDimension9` |
| `InventDimension10` | `CustomDimension10` |
| `InventDimension11` | `CustomDimension11` |
| `InventDimension12` | `CustomDimension12` |

##### <a name="physical-measures-configured-for-the-fno-data-source"></a>Физические меры, настроенные для источника данных "fno"

Для источника данных `fno` настроены следующие физические меры:

- `Ordered`
- `Arrived`
- `AvailPhysical`
- `PhysicalInvent`
- `ReservPhysical`
- `ReservOrdered`
- `OnOrder`

#### <a name="configuration-of-the-pos-data-source"></a>Конфигурация источника данных "pos"

В этом разделе описывается, как настроить источник данных `pos`.

##### <a name="physical-measures-for-the-pos-data-source"></a>Физические меры, настроенные для источника данных "pos"

Для источника данных `pos` настроены следующие физические меры:

- `PosInbound`
- `PosOutbound`

##### <a name="availquantity-calculated-measure"></a>Вычисляемая мера AvailQuantity

Вычисляемая мера `AvailQuantity` настраиваемся для источника данных `pos`, как показано в следующей таблице.

| Тип расчета | Иcточник данных | Физическая мера |
|---|---|---|
| Дополнение | `fno` | `AvailPhysical` |
| Дополнение | `pos` | `PosInbound` |
| Вычитание | `pos` | `PosOutbound` |

#### <a name="configuration-of-the-iom-data-source"></a>Конфигурация источника данных "iom"

Следующие физические меры настраиваются для источника данных `iom` (Intelligent Order Management):

- `OnOrder`
- `OnHand`

#### <a name="configuration-of-the-erp-data-source"></a>Конфигурация источника данных "erp"

Следующие физические меры настраиваются для источника данных `erp` (планирование ресурсов предприятия):

- `Unrestricted`
- `QualityInspection`

### <a name="partition-configuration"></a>Конфигурация раздела

В следующей таблице показана конфигурация раздела по умолчанию.

| Базовая аналитика | Иерархия |
|---|---|
| `SiteId` | 1 |
| `LocationId` | 2 |

### <a name="index-configuration"></a>Конфигурация индекса

В следующей таблице показана конфигурация индекса по умолчанию.

| Номер набора | Аналитика | Иерархия |
|---|---|---|
| 1 | `ColorId` | 1 |
| 1 | `SizeId` | 2 |
| 1 | `StyleId` | 3 |

### <a name="reservation-configuration"></a>Конфигурация резервирования

В этом разделе описывается конфигурация резервирования по умолчанию.

#### <a name="reservation-mapping"></a>Сопоставление резервирования

В следующей таблице показано сопоставление резервирования по умолчанию.

| Источник данных физической меры | Физическая мера | Доступно для источника данных резервирования | Доступно для рассчитанной меры резервирования |
|---|---|---|---|
| `iv` | `SoftReservOrdered` | `iv` | `AvailableToReserve` |

#### <a name="reservation-hierarchy"></a>Иерархия резервирования

В следующей таблице показана иерархия резервирования по умолчанию.

| Базовая аналитика | Иерархия |
|---|---|
| `SiteId` | 1 |
| `LocationId` | 2 |
| `ColorId` | 3 |
| `SizeId` | 4 |
| `StyleId` | 5 |
| `BatchId` | 6 |
| `SerialId` | 7 |
| `StatusId` | 8 |
| `LicensePlateId` | 9 |
| `WMSLocationId` | 10 |
| `WMSPalletId` | 11 |
| `ConfigId` | 12 |
| `VersionId` | 13 |
| `CustomDimension1` | 14 |
| `CustomDimension2` | 15 |
| `CustomDimension3` | 16 |
| `CustomDimension4` | 17 |
| `CustomDimension5` | 18 |
| `CustomDimension6` | 19 |
| `CustomDimension7` | 20 |
| `CustomDimension8` | 21 |
| `CustomDimension9` | 22 |
| `CustomDimension10` | 23 |
| `CustomDimension11` | 24 |
| `CustomDimension12` | 25 |
| `ExtendedDimension1` | 26 |
| `ExtendedDimension2` | 27 |
| `ExtendedDimension3` | 28 |
| `ExtendedDimension4` | 29 |
| `ExtendedDimension5` | 30 |
| `ExtendedDimension6` | 31 |
| `ExtendedDimension7` | 32 |
| `ExtendedDimension8` | 33 |

[!INCLUDE[footer-include](../../includes/footer-banner.md)]


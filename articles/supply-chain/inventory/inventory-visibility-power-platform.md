---
title: Приложение видимости запасов
description: В этой теме описывается, как использовать приложение видимости запасов.
author: yufeihuang
ms.date: 08/02/2021
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: yufeihuang
ms.search.validFrom: 2021-08-02
ms.dyn365.ops.version: 10.0.21
ms.openlocfilehash: cc09dd82547ec42041889e9a96662cd17549a3ea
ms.sourcegitcommit: b9c2798aa994e1526d1c50726f807e6335885e1a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/13/2021
ms.locfileid: "7345010"
---
# <a name="inventory-visibility-app"></a>Приложение видимости запасов

[!include [banner](../includes/banner.md)]
[!INCLUDE [cc-data-platform-banner](../../includes/cc-data-platform-banner.md)]

В этой теме описывается, как использовать приложение видимости запасов.

Видимость запасов — приложение на основе модели для визуализации. Приложение содержит три страницы: **Конфигурация**, **Операционная видимость** и **Сводка по запасам**. Оно имеет следующие функции:

- Оно предоставляет интерфейс пользователя (UI) для настройки конфигурации "в наличии" и конфигурации предварительного резервирования.
- Оно поддерживает запросы запасов в наличии в реальном времени в различных комбинациях аналитик.
- Оно предоставляет пользовательский интерфейс для разноски запросов резервирования.
- Оно предоставляет настраиваемое представление запасов в наличии для продуктов вместе со всеми аналитиками

## <a name="prerequisites"></a>Необходимые условия

Перед началом установки установите и настройте надстройку "Видимость запасов", как описано в разделе [Настройка видимости запасов](inventory-visibility-setup.md).

## <a name="configuration"></a><a name="configuration"></a>Конфигурация

Страница **Конфигурация** позволяет настроить конфигурацию в наличии и конфигурацию предварительного резервирования. После установки надстройки конфигурация по умолчанию включает значение от Microsoft Dynamics 365 Supply Chain Management (источник данных `fno`). Можно просмотреть настройку по умолчанию. Кроме того, в зависимости от бизнес-требований и требований разноски запасов для внешней системы, можно изменить конфигурацию в [Dataverse](/powerapps/maker/common-data-service/data-platform-intro), чтобы стандартизировать способ разноски, упорядочения и запроса изменений запасов в нескольких системах.

### <a name="define-data-sources"></a>Определение источников данных

Вы определяете каждый *источник данных*, который необходимо интегрировать с видимостью запасов. Видимость запасов поддерживает интеграцию с различными источниками данных, такими как система POS-терминалов, Supply Chain Management и другие внешние системы. По умолчанию Supply Chain Management настраивается в качестве источника данных по умолчанию (`fno`) в видимости запасов.

Чтобы добавить источник данных, выполните следующие действия.

1. Выполните вход в среду Power Apps и откройте область **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Источник данных** выберите **Создать источник данных**, чтобы добавить источник данных.

> [!NOTE]
> При добавлении источника данных перед обновлением конфигурации для службы "Видимость запасов" проверьте имя источника данных, физические меры и сопоставления измерений. Вы не сможете изменить эти параметры после того, как будет выбрано **Обновление конфигурации**.

### <a name="set-up-dimension-mappings"></a>Настройка сопоставлений аналитик

Видимость запасов предоставляет список базовых аналитик, которые могут быть сопоставлены из аналитик вашего источника данных. Тридцать три аналитики доступны для сопоставления.

- По умолчанию, если используется Supply Chain Management в качестве одного из источников данных, 13 аналитик сопоставляются со стандартными аналитиками Supply Chain Management. Двенадцать других аналитик (`inventDimension1` через `inventDimension12`) сопоставляются с настраиваемыми аналитиками в Supply Chain Management. Оставшиеся восемь аналитик — это расширенные аналитики, которые можно сопоставить с внешними источниками данных.
- Если в качестве одного из источников данных не используется Supply Chain Management, можно свободно сопоставить аналитики. В следующей таблице показан полный список доступных аналитик.

> [!NOTE]
> Если ваша аналитика не входит в список аналитик по умолчанию и вы используете внешний источник данных, мы рекомендуем использовать `ExtendedDimension1` через `ExtendedDimension8` для выполнения сопоставления.

| Тип аналитики | Имя аналитики |
|---|---|
| Продукт | `ColorId` |
| Продукт | `SizeId` |
| Продукт | `StyleId` |
| Продукт | `ConfigId` |
| Отслеживание | `BatchId` |
| Отслеживание | `SerialId` |
| Расположение | `LocationId` |
| Расположение | `SiteId` |
| Статус запасов | `StatusId` |
| Зависит от склада | `WMSLocationId` |
| Зависит от склада | `WMSPalletId` |
| Зависит от склада | `LicensePlateId` |
| Другая | `VersionId` |
| Запасы (настраиваемый) | `InventDimension1` через `InventDimension12` |
| Другая | `ExtendedDimension1` через `ExtendedDimension8` |

Чтобы добавить сопоставления аналитик, выполните следующие действия.

1. Выполните вход в среду Power Apps и откройте область **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Источник данных** в разделе **Сопоставление аналитик** выберите **Добавить**, чтобы добавить отображение аналитик.
1. В поле **Имя аналитики** укажите исходную аналитику.
1. В поле **Для базовой аналитики** выберите аналитику в видимости запасов, которую необходимо сопоставить.
1. Нажмите **Сохранить**.

![Добавление сопоставлений аналитик](media/inventory-visibility-dimension-mapping.png "Добавление сопоставлений аналитик")

Например, если источник данных включает аналитику цвета продукта, можно сопоставить его с базовой аналитикой `ColorId`, чтобы добавить пользовательскую аналитику `ProductColor` в источник данных `exterchannel`. Затем она сопоставляется с базовой аналитикой `ColorId`.

## <a name="create-a-physical-measure"></a>Создание физического измерения

Когда источник данных выполняет разноску изменения запасов в видимости запасов, он разносит это изменение, используя *физические измерения*. Физические измерения — это модификаторы, которые соответствуют суммарным статусам проводок по запасам. Запросы могут основываться на физических измерениях.

Видимость запасов имеет список физических измерений по умолчанию. Эти физические измерения по умолчанию берутся из статусов проводок по запасам на странице **Список количества в наличии** в Supply Chain Management (**Управление запасами \> Запросы и отчет \> Список количества в наличии**).

| Модификатор | ФИО |
|---|---|
| `PhysicalInvent` | Физические запасы |
| `ReservPhysical` | Физически зарезервировано |
| `AvailPhysical` | Физически доступно |
| `ReservOrdered` | Зарезервировано в заказанных |
| `PostedQty` | Разнесенное количество |
| `Deducted` | Отпущено |
| `Picked` | Скомплектовано |
| `Received` | Получение |
| `Registered` | Зарегистрировано |
| `Arrived` | Прибыло |
| `Ordered` | Занято |
| `OnOrder` | В заказе |
| `QuotationReceipt` | Поступления-предложение |
| `QuotationIssue` | Отпуск - предложение |

Если источником данных является Supply Chain Management, нет необходимости повторно создавать физические измерения по умолчанию. Однако для внешних источников данных можно создать новые физические измерения, выполнив следующие действия.

1. Выполните вход в среду Power Apps и откройте область **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Источник данных** в разделе **Физические измерения** выберите **Добавить**, укажите имя исходного измерения и сохраните изменения.

## <a name="define-the-product-hierarchy-index"></a>Определение индекса иерархии продуктов

Настроив агрегированные группы аналитик, можно использовать видимость запасов для запроса статуса запасов в наличии. В видимости запасов каждая группа аналитик называется *индексом*. Каждый индекс соответствует номеру набора. Можно выбрать аналитики, которые будут использоваться для настройки индексирования, в зависимости от способа, которым будет запрашиваться в видимости запасов.

Для настройки индекса иерархии продуктов выполните следующие действия.

1. Выполните вход в среду Power Apps и откройте область **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Индекс иерархии продуктов** в разделе **Сопоставление аналитик** выберите **Добавить**, чтобы добавить отображение аналитик.
1. По умолчанию предоставляется список индексов. Чтобы изменить существующий индекс, выберите **Изменить** или **Добавить** в разделе для соответствующего индекса. Чтобы создать новый набор индексов, выберите **Создать набор индексов**. Для каждой строки каждого набора индексов в поле **Аналитика** выберите из списка базовых аналитик. Значения для следующих полей создаются автоматически:

    - **Номер набора** – аналитики, которые относятся к одной группе (индекс), будут сгруппированы вместе и для них будут добавлены одинаковые номера наборов.
    - **Иерархия** — иерархия используется для определения поддерживаемых комбинаций аналитик, которые могут запрашиваться в группе аналитик (индекс). Например, при настройке группы аналитик с последовательностью иерархии *Стиль*, *Цвет* и *Размер* система поддерживает результат выполнения трех групп запросов. Первая группа является только стилем. Вторая группа представляет собой сочетание стиля и цвета. А третья группа представляет собой сочетание стиля, цвета и размера. Другие сочетания не поддерживаются.

Дополнительные сведения см. в [Конфигурация иерархии индекса продуктов](inventory-visibility-configuration.md#index-configuration).

### <a name="example"></a>Пример

В этом разделе представлен пример работы иерархии. В следующей таблице представлен список доступных запасов для данного примера.

| Номенклатура | Стиль | Цвет | Размер | Количество |
|---|---|---|---|---|
| I0001 | Широк. | Черный | Небольшой | 1 |
| I0001 | Широк. | Черный | Большое | 2 |
| I0001 | Широк. | Красный | Небольшой | 3 |
| I0001 | Обычная | Черный | Небольшой | 4 |
| I0001 | Обычная | Черный | Большое | 5 |
| I0001 | Обычная | Красный | Небольшой | 6 |
| I0001 | Обычная | Красный | Большое | 7 |

В следующей таблице показан способ настройки иерархии индекса.

| Ключ | Номер набора | Иерархия |
|---|---|---|
| `StyleId` | 1 | 1 |
| `ColorId` | 1 | 2 |
| `SizeId` | 1 | 3 |

На основе описанных выше параметров сочетание аналитик для запроса видимости запасов имеет вид — *Стиль*, *Цвет* и *Размер*. Настройка иерархии позволяет внешним системам запрашивать запасы в наличии следующими способами:

- `()` — сгруппированы по всем. Вот результат:

    - I0001, 28

- `(StyleId)` — группирование по стилю. Вот результат:

    - I0001, широкий, 6
    - I0001, обычный, 22

- `(StyleId, ColorId)` — группирование по сочетанию стиля и цвета. Вот результат:

    - I0001, широкие, черные, 3
    - I0001, широкий, красный, 3
    - I0001, обычный, черный, 9
    - I0001, обычный, красный, 13

- `(StyleId, ColorId, SizeId)` — группирование по сочетанию стиля, цвета и размера. Вот результат:

    - I0001, широкие, черные, маленькие, 1
    - I0001, широкие, черные, большие, 2
    - I0001, широкий, красный, малый, 3
    - I0001, обычный, черный, малый, 4
    - I0001, обычный, черный, большой, 5
    - I0001, обычный, красный, малый, 6
    - I0001, обычный, красный, большой, 7

## <a name="set-up-a-custom-calculated-measure"></a>Настройка настраиваемой вычисляемой меры

Можно использовать видимость запасов для запроса по физическим мерам запасов и по *настраиваемым рассчитанным мерам*.

Конфигурация позволяет определить набор модификаторов, которые добавляются или вычитаются для получения итогового агрегированного выходного количества.

1. Выполните вход в среду Power Apps и откройте область **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Рассчитанная мера** выберите **Создать расчет меры** для добавления вычисляемой меры. Затем задайте поля, как описано в следующей таблице.

    | Поле | значение |
    |---|---|
    | Название новой вычисляемой меры | Введите имя вычисляемой меры. |
    | Иcточник данных | Система запросов представляет собой источник данных. |
    | Источник данных модификатора | Введите источник данных модификатора. |
    | Модификатор | Введите имя модификатора. |
    | Тип модификатора | Выберите тип модификатора (*сложение* или *вычитание*). |

В следующей таблице показан пример настраиваемых рассчитанных мер `MyCustomAvailableforReservation`. Дополнительные сведения об этом примере см. в разделе [Конфигурация источника данных](inventory-visibility-configuration.md#data-source-configuration).

| Источник данных вычисляемой меры | Рассчитанная мера | Источник данных модификатора | Модификатор | Тип модификатора |
|---|---|---|---|---|
| `CustomChannel` | `MyCustomAvailableforReservation` | `fno` | `availphysical` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `fno` | `orderedintotal` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `fno` | `orderedreserved` | `Subtraction` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `mypos` | `Inbound` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `mypos` | `Outbound` | `Subtraction` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `exterchannel` | `received` | `Addition` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `exterchannel` | `issued` | `Subtraction` |
| `CustomChannel` | `MyCustomAvailableforReservation` | `Exteexterchannelrchannel` | `reserved` | `Subtraction` |

### <a name="set-up-a-soft-reservation-mapping"></a><a name="setup-reservation-mapping"></a>Настройка сопоставления предварительного резервирования

[!INCLUDE [preview-banner-section](../../includes/preview-banner-section.md)]

Прежде чем можно будет изменить вкладку **Сопоставление предварительного резервирования**, необходимо включить функцию *OnHandReservation* на вкладке **Управление функциями**.

Настроив сопоставление физической меры с рассчитанной мерой, служба видимости запасов должна автоматически проверять доступность резервирования на основе физической меры.

Перед настройкой этого сопоставления необходимо определить физические меры, вычисляемые меры и их источники данных на вкладках **Источник данных** и **Вычисляемая мера** страницы **Конфигурация** в Power Apps (как описано ранее в этом разделе).

Чтобы определить сопоставление предварительного резервирования, выполните следующие действия.

1. Определите физическую меру, которая выступает в качестве меры предварительного резервирования (например, `softreservordered`).
1. На вкладке **Рассчитанная мера** на странице **Конфигурация** укажите рассчитанную меру *доступно для резервирования* (AFR), которая содержит формулу вычисления AFR, которую необходимо сопоставить с физической мерой. Например, можно настроить `availforreserv` (доступно для резервирования), чтобы оно содержало ранее определенную физическую меру `softreservordered`. Таким образом можно узнать, какие количества, имеющие статус запасов `softreservordered`, будут доступны для резервирования. В следующей таблице показана формула вычисления AFR.

    | Модификатор | Иcточник данных | Мера |
    |---|---|---|
    | `Addition` | `fno` | `availphysical` |
    | `Addition` | `pos` | `inbound` |
    | `Subtraction` | `pos` | `outbound` |
    | `Subtraction` | `iv` | `softreservordered` |

1. Откройте страницу **Конфигурация**.
1. На вкладке **Сопоставление предварительного резервирования** настройте сопоставление физической меры с рассчитанной мерой. Для предыдущего примера можно использовать следующие параметры для сопоставления `availforreserv` с ранее определенной физической мерой `softreservordered`.

    | Источник данных физической меры | Физическая мера | Доступно для источника данных резервирования | Доступно для рассчитанной меры резервирования |
    |---|---|---|---|
    | `iv` | `softreservordered` | `iv` | `availforreserv` |

### <a name="set-up-a-soft-reservation-hierarchy"></a><a name="setup-reservation-hierarchy"></a>Настройка иерархии предварительного резервирования

[!INCLUDE [preview-banner-section](../../includes/preview-banner-section.md)]

Прежде чем можно будет изменить вкладку **Иерархия предварительного резервирования**, необходимо включить функцию *OnHandReservation* на вкладке **Управление функциями**.

Иерархия резервирования описывает последовательность аналитик, которая должна быть указана при выполнении резервирования. Это функционирует так же, как и иерархия индексов продуктов для запросов в наличии.

Иерархия резервирования может отличаться от иерархии индексов в наличии. Эта независимость позволяет реализовать управление категориями, когда пользователи могут разбить аналитики на детали, чтобы указать требования для более точного резервирования.

#### <a name="example"></a>Пример

В системе настроена следующая иерархия резервирования.

| Аналитика | Иерархия |
|---|---|
| `ColorId` | 1 |
| `SizeId ` | 2 |
| `StyleId` | 3 |

Используя эту иерархию резервирования, можно выполнять резервирование по следующим заказам аналитик:

- `()` – аналитика не задана.
- `(ColorId)`
- `(ColorId, SizeId)`
- `(ColorId, SizeId, StyleId)`

Заказ аналитики должен строго следовать последовательности иерархий резервирования, аналитика за аналитикой. Например, в этом примере не разрешается использовать резервирования с `(ColorId, StyleId)`, поскольку эта последовательность не определена в иерархии резервирования.

### <a name="control-feature-management"></a><a name="feature-switch"></a>Управление функциями управления

В надстройке "Видимость запасов" представлены такие функции, как *OnHandReservation* и *OnHandMostSpecificBackgroundService*. По умолчанию эти функции отключены. Чтобы использовать их, откройте страницу **Конфигурация** в Power Apps, а затем на вкладке **Управление функциями** включите их.

### <a name="complete-and-update-the-configuration"></a>Выполнение и обновление конфигурации

После завершения настройки необходимо внести все изменения в видимость запасов. Чтобы применить изменения, выберите **Обновить конфигурацию** в верхнем правом углу страницы **Конфигурация** в Power Apps.

При первом выборе **Обновить конфигурацию** система запрашивает учетные данные.

- **Код клиента** — код приложения Azure, созданный для видимости запасов.
- **Код арендатора** — идентификатор арендатора Azure.
- **Секрет клиента** — секрет приложения Azure, созданный для видимости запасов.

После входа в систему конфигурация обновляется в службе видимости запасов.

> [!NOTE]
> Перед обновлением конфигурации для службы "Видимость запасов" проверьте имя источника данных, физические меры и сопоставления мер. Вы не сможете изменить эти параметры после того, как будет выбрано **Обновление конфигурации**.

### <a name="find-the-service-endpoint"></a><a name="get-service-endpoint"></a>Поиск конечной точки службы

Если правильная конечная точка службы видимости запасов неизвестна, откройте страницу **Конфигурация** в Power Apps и выберите **Показать конечную точку службы** в верхнем правом углу. На странице будет отображена правильная конечная точка службы.

## <a name="operational-visibility"></a>Операционная видимость

Страница **Операционная видимость** содержит результаты запроса запасов в наличии в реальном времени на основе различных комбинаций аналитик. Если включена функция *OnHandReservation*, можно также разнести запросы на резервирование со страницы **Операционная видимость**.

### <a name="on-hand-query"></a>Запрос в наличии

На вкладке **Запрос в наличии** отображаются результаты запроса запасов в наличии в реальном времени.

Когда выбрана вкладка **Запрос в наличии**, система запрашивает учетные данные, чтобы она могла получить токен носителя, который требуется для запроса к службе видимости запасов. Можно просто вставить токен носителя в поле **BearerToken** и закрыть диалоговое окно. Затем можно выполнить разноску запроса запасов в наличии.

Если токен носителя недействителен или истек, необходимо вставить новый в поле **BearerToken**. Введите правильные значения **Идентификатор клиента**, **Код арендатора**, **Секрет клиента**, а затем выберите **Обновить**. Система автоматически получит новый, действительный токен носителя.

Для разноски запроса в наличии введите запрос в тексте запроса. Воспользуйтесь шаблоном, указанным в [Запрос с помощью метода разноски](inventory-visibility-api.md#query-with-post-method).

![Настройки запросов в наличии](media/inventory-visibility-query-settings.png "Настройки запросов в наличии")

### <a name="reservation-posting"></a>Разноска резервирования

[!INCLUDE [preview-banner-section](../../includes/preview-banner-section.md)]

Вкладка **Разноска резервирования** используется для разноски запроса на резервирование. Прежде чем можно будет разнести запрос на резервирование, необходимо включить функцию *OnHandReservation*. Дополнительные сведения об этой функции см. в разделе [Резервирования видимости запасов](inventory-visibility-reservations.md).

Для разноски запроса на резервирование необходимо ввести значение в тексте запроса. Воспользуйтесь шаблоном, описанным в разделе [Создание одного события резервирования](inventory-visibility-api.md#create-one-reservation-event). Затем выберите **Разнести**. Чтобы просмотреть сведения об ответе на запрос, выберите **Показать подробности**. Можно также получить значение **reservationId** из сведений ответа.

## <a name="inventory-summary"></a>Сводка запасов

**Сводка запасов** — настраиваемое представление *сущности суммы запасов в наличии*. Она предоставляет сводку запасов для продуктов вместе со всеми аналитиками. Используя **Расширенный фильтр** в Dataverse, можно создать личное представление, в котором будут отображаться важные для вас строки. С помощью расширенных параметров фильтра можно создавать разнообразные представления, из простых до сложных. Они также позволяют добавлять сгруппированные и вложенные условия для фильтров.

Дополнительные сведения об использовании **расширенного фильтра** см. в разделе [Редактирование или создание персональных представлений с помощью расширенных фильтров сетки](/powerapps/user/grid-filters-advanced)

В верхней части настроенного представления представлены три поля: **Аналитика по умолчанию**, **Пользовательская аналитика** и **Мера**. Эти поля можно использовать для управления, какие столбцы видимы.

Можно выбрать заголовок столбца для фильтрации или сортировки текущего результата.

В нижней части пользовательского представления отображаются такие сведения, как "50 записей (29 выбрано)" или "50 записей". Эти сведения относятся к загруженным в данный момент записям из результатов **расширенного фильтра**. Текст "29 выбрано" означает число записей, выбранных с помощью фильтра заголовка столбца для загруженных записей.

В нижней части представления находится кнопка **Загрузить еще**, которую можно использовать для загрузки дополнительных записей из Dataverse. Число загруженных записей по умолчанию — 50. При выборе **Загрузить еще** в представление загружаются следующие 1000 доступных записей. Число на кнопке **Загрузить еще** означает загруженные в данный момент записи и общее число записей для результатов **расширенного фильтра**.

![Сводка запасов](media/inventory-visibility-onhand-list.png "Сводка запасов")

---
title: Установка надстройки видимости запасов
description: В этой статье описывается, как установить надстройку отображения запасов для Microsoft Dynamics 365 Supply Chain Management.
author: yufeihuang
ms.date: 11/04/2022
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: yufeihuang
ms.search.validFrom: 2021-08-02
ms.dyn365.ops.version: 10.0.21
ms.openlocfilehash: c08568b14d7f5c79a1d3609107a88f905498ce2b
ms.sourcegitcommit: 49f8973f0e121eac563876d50bfff00c55344360
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2022
ms.locfileid: "9762790"
---
# <a name="install-and-set-up-inventory-visibility"></a>Установка и настройка Inventory Visibility

[!include [banner](../includes/banner.md)]

В этой статье описывается, как установить надстройку отображения запасов для Microsoft Dynamics 365 Supply Chain Management.

Необходимо использовать [Microsoft Dynamics Lifecycle Services](https://lcs.dynamics.com/v2), чтобы установить надстройку видимости запасов. Lifecycle Services — это портал совместной работы, который предоставляет среду и набор регулярно обновленных служб, которые помогут управлять жизненным циклом приложений для управления финансами и операциями. Дополнительные сведения см. в разделе [Ресурсы Lifecycle Services](../../fin-ops-core/dev-itpro/lifecycle-services/lcs.md).

> [!TIP]
> Рекомендуется присоединиться к группе пользователей надстройки видимости запасов, где можно найти полезные руководства, получить последние обновления и задать любые вопросы, которые у вас могут иметься по использованию видимости запасов. Чтобы присоединиться, отправьте сообщение электронной почты группе продукта видимости запасов по адресу [inventvisibilitysupp@microsoft.com](mailto:inventvisibilitysupp@microsoft.com) и включите свой идентификатор среды Supply Chain Management.

## <a name="inventory-visibility-prerequisites"></a>Необходимые условия для видимости запасов

Перед установкой надстройки видимости запасов необходимо сделать следующее:

- Получите проект внедрения Lifecycle Services с по крайней мере одной развернутой средой.
- Убедитесь, что необходимые условия для настройки надстроек завершены. Сведения об этих предварительных требованиях см. в разделе [Обзор надстроек](../../fin-ops-core/dev-itpro/power-platform/add-ins-overview.md). Для контроля запасов не требуется связывание с двойной записью.

> [!NOTE]
> Страны и регионы, которые в настоящее время поддерживаются: Канада (CCA, ECA), США (WUS, EUS), Европейский Союз (NEU, WEU), Соединенное Королевство (SUK, WUK), Австралия (EAU, SEAU), Япония (EJP, WJP) и Бразилия (SBR, SCUS).

При возникновении каких-либо вопросов о необходимых условиях свяжитесь с группой разработчиков продукта для отображения запасов по адресу [inventvisibilitysupp@microsoft.com](mailto:inventvisibilitysupp@microsoft.com).

## <a name="install-the-inventory-visibility-add-in"></a><a name="install-add-in"></a>Установка надстройки видимости запасов

Перед установкой надстройки зарегистрируйте приложение и добавьте секрет клиента в Azure Active Directory (Azure AD) в своей подписке Azure. Инструкции см. в разделе [Регистрация приложения](/azure/active-directory/develop/quickstart-register-app) и [Добавление секрета клиента](/azure/active-directory/develop/quickstart-register-app#add-a-certificate). Обязательно запишите значения **Идентификатор приложения (клиента)**, **Секрет клиента** и **Идентификатора арендатора**, так как они понадобятся позже.

> [!IMPORTANT]
> Если имеется более одной среды Lifecycle Services, создайте отдельное приложение Azure AD для каждой из них. При использовании того же кода приложения и кода клиента для установки надстройки Видимость запасов в различных средах, в старых средах будет выдаваться маркер. В результате только последняя установка будет действительной.

После регистрации приложения и добавления к нему секрета клиента в Azure AD выполните следующие действия, чтобы установить надстройку "Отображение запасов".

1. Выполните вход в [Lifecycle Services](https://lcs.dynamics.com/Logon/Index).
1. На домашней странице выберите проект, в котором развернута среда.
1. На странице проекта выберите среду, в которой требуется установить надстройку.
1. На странице среды прокрутите вниз, чтобы увидеть раздел **Надстройки среды** в разделе **Интеграция Power Platform**. Там можно найти имя среды Dataverse. Убедитесь, что имя среды Dataverse является именем, которое будет использоваться для отображения запасов.

    > [!NOTE]
    > В настоящее время поддерживаются только среды Dataverse, созданные с использованием Lifecycle Services. Если среда Dataverse была создана каким-либо другим способом (например, с помощью центра администрирования PowerApps) и если она связана с вашей средой Supply Chain Management, необходимо сначала устранить проблему с сопоставлением, прежде чем устанавливать надстройку видимости запасов.
    >
    > Возможно, что среда с двойной записью связана с экземпляром Dataverse, а Lifecycle Services не настроен для интеграции Power Platform. Это несоответствие ссылок может привести к непредсказуемому поведению. Рекомендуется, чтобы сведения среды Lifecycle Services соответствовали сведениям среды, к который вы подключены в двойной записи, чтобы одно и то же подключение можно было использовать в бизнес-событиях, виртуальных таблицах и надстройках. См. раздел [Несоответствие ссылок](../../fin-ops-core/dev-itpro/data-entities/dual-write/lcs-setup.md#linking-mismatch) для получения сведений о том, как исправить проблему сопоставления. После устранения проблемы сопоставления можно продолжить установку отображения запасов.

1. В разделе **Надстройки сред** выберите **Установить новую надстройку**.

    ![Страница среды в Lifecycle Services](media/inventory-visibility-environment.png "Страница среды в Lifecycle Services")

1. Выберите ссылку **Установить новую надстройку**. Откроется список доступных надстроек.
1. Выберите **Контроль запасов** в списке.
1. Задайте следующие поля для своей среды:

    - **Идентификатор приложения (клиента) AAD** — введите идентификатор приложения Azure AD, который был создан ранее и который вы записали.
    - **Идентификатор арендатора AAD** — введите идентификатор арендатора, который вы записали ранее.

    ![Страница настройки надстройки](media/inventory-visibility-setup.png "Страница настройки надстройки")

1. Примите условия, установив флажок **Условия**.
1. Выберите **Установить**. Статус надстройки будет отображаться как **Установка**. После завершения установки обновите страницу. Статус должен изменяться на **Установлено**.
1. В Dataverse в области переходов в левой части выберите раздел **Приложения** и убедитесь, что **Видимость запасов** Power Apps установлена успешно. Если раздел **Приложения** не существует, обратитесь к специалистам по контролю запасов по адресу [inventvisibilitysupp@microsoft.com](mailto:inventvisibilitysupp@microsoft.com).

> [!NOTE]
> Если система предупреждает вас, что у вас нет разрешения на установку видимости запасов в Lifecycle Services, необходимо связаться с администратором, чтобы изменить разрешение.
>
> Если установка со страницы Lifecycle Services занимает больше часа, тогда у вашей учетной записи пользователя может отсутствовать разрешение на установку решений в среде Dataverse. Чтобы устранить проблему, выполните следующие действия:
>
> 1. Отмените процесс установки надстройки видимости запасов со страницы Lifecycle Services.
> 1. Выполните вход в [центр администрирования Microsoft 365](https://admin.microsoft.com) и убедитесь, что учетной записи пользователя, которую требуется использовать для установки надстройки, назначена лицензия "План Dynamics 365 Unified Operations". При необходимости назначьте лицензию
> 1. Войдите в [центр администрирования Power Platform](https://admin.powerplatform.microsoft.com), используя соответствующую учетную запись пользователя. Затем установите надстройку видимости запасов, выполнив следующие действия:
>     1. Выберите среду, в которую необходимо установить надстройку.
>     1. Выберите **Приложения Dynamics 365**.
>     1. Выберите **Установить приложение**.
>     1. Выберите **Видимость запасов**
>
> 1. По завершении установки вернитесь на страницу Lifecycle Services и повторите попытку переустановить надстройку **Видимость запасов**.

## <a name="set-up-inventory-visibility-in-supply-chain-management"></a><a name="setup-dynamics-scm"></a>Настройка Видимости запасов в Supply Chain Management

### <a name="deploy-the-inventory-visibility-integration-package"></a><a name="deploy-inventory-visibility-package"></a>Развертывание пакета интеграции контроля запасов

Если используется Supply Chain Management версии 10.0.17 или более ранней, обратитесь в службу поддержки контроля запасов по адресу [inventvisibilitysupp@microsoft.com](mailto:inventvisibilitysupp@microsoft.com) для получения пакетного файла. Затем разверните пакет в Lifecycle Services.

> [!NOTE]
> Если во время развертывания возникает ошибка несоответствия версий, необходимо вручную импортировать проект X++ в среду разработки. Затем создайте развертываемый пакет в среде разработки и разверните его в рабочей среде.
>
> Этот код включен в Supply Chain Management 10.0.18. Если вы используете эту версию или более позднюю, развертывание не требуется.

Убедитесь, что в среде Supply Chain Management включены следующие функции. (По умолчанию они включены.)

| Описание функции | Версия кода | Переключить класс |
|---|---|---|
| Включение и отключение использования складских аналитик в таблице InventSum      | 10.0.11 | InventUseDimOfInventSumToggle      |
| Включение и отключение использования складских аналитик в таблице InventSumDelta | 10.0.12 | InventUseDimOfInventSumDeltaToggle |

### <a name="set-up-inventory-visibility-integration"></a><a name="setup-inventory-visibility-integration"></a>Настройка интеграции Видимости запасов

После установки надстройки подготовьте систему Supply Chain Management для работы с ней, выполнив следующие действия.

1. В Supply Chain Management откройте рабочую область **[Управление функциями](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)** и включите следующие функции:
    - *Интеграция видимости запасов* — обязательно.
    - *Интеграция видимости запасов со смещением резервирования* — рекомендуется, но не обязательно. Требуется версия 10.0.22 или более поздняя. Дополнительные сведения см. в разделе [Резервирования видимости запасов](inventory-visibility-reservations.md).

1. Перейдите в раздел **Управление запасами \> Настройка \> Параметры интеграции видимости запасов**.
1. Откройте вкладку **Общие** и внесите следующие настройки:
    - **Конечная точка видимости запасов** — введите URL-адрес среды, в которой выполняется Видимость запасов. Дополнительные сведения см. в [Поиск конечной точки службы](inventory-visibility-configuration.md#get-service-endpoint).
    - **Максимальное число записей в одном запросе** — задать максимальное число записей для включения в один запрос. Необходимо ввести положительное целое число меньше или равное 1000. Значение по умолчанию — 512. Настоятельно рекомендуется сохранить значение по умолчанию, если вы не получили рекомендации от службы поддержки Майкрософт или, в ином случае, не уверены, что необходимо изменить.

1. Если вы включили функцию *Интеграция Видимости запасов с смещением резервирования*, откройте вкладку **смещение резервирования** и выполните следующие настройки:
    - **Включить смещение резервирования** — установите значение *Да*, чтобы включить эту функцию.
    - **Модификатор смещения резервирования** — выберите статус складской проводки, который сместит резервирования, сделанные на в Видимость запасов. Этот параметр определяет этап обработки заказов, который запускает смещения. Стадия отслеживается по статусу складской проводки заказа. Выберите один из следующих вариантов:
        - *В заказе* — для статуса *В проводке* заказ будет отправлять запрос на смещения при создании. Количество смещения будет равно количеству созданного заказа.
        - *Резерв* — для статуса *Резервирование заказанной проводки* заказ отправит запрос смещения при резервировании, комплектации, разноске отборочной накладной или выпуске накладной. Запрос будет запущен только один раз для первого шага, когда происходит упомянутый процесс. В качестве количество смещения будет получено количество, в котором статус складской проводки изменен с *Заказано* на *Зарезервировано в заказанных* (или более позднее статус) в соответствующей строке заказа.

1. Перейдите **Управление запасами \> Периодические операции \> Интеграция контроля запасов** и включите задание. Все события изменения запасов из модуля Supply Chain Management будут разнесены в контроль запасов.

## <a name="uninstall-the-inventory-visibility-add-in"></a><a name="uninstall-add-in"></a>Удаление надстройки видимости запасов

Чтобы удалить надстройку видимости запасов, выполните следующие шаги:

1. Войдите в Supply Chain Management.
1. Перейдите **Управление запасами \> Периодические операции \> Интеграция контроля запасов** и выключите задание.
1. Перейдите в Lifecycle Services и откройте страницу среды, в которой требуется удалить надстройку (см. также [Установка надстройки видимости запасов](#install-add-in)).
1. Выберите **Удалить**.
1. Процесс удаления теперь отключает надстройку "Отображение запасов", отменяет регистрацию надстройки в Lifecycle Services и удаляет все временные данные, которые хранятся в кэше данных надстройки "Видимость запасов". Однако основные данные запасов, которые были синхронизированы с вашей подпиской Dataverse, все еще хранятся там. Чтобы удалить эти данные, выполните остальную часть процедуры.
1. Откройте [Power Apps](https://make.powerapps.com).
1. Выберите **Среда** на панели переходов.
1. Выберите среду Dataverse, связанную с вашей средой Lifecycle Services.
1. Перейдите в пункт **Решения** и удалите следующие решения в указанном ниже порядке:
    1. Dynamics 365 Inventory Visibility — привязка
    1. Dynamics 365 Inventory Visibility — подключаемые модули
    1. Dynamics 365 Inventory Visibility — приложение
    1. Dynamics 365 Inventory Visibility — элементы управления
    1. Dynamics 365 Inventory Visibility — основа 

    После удаления этих решений данные, хранящиеся в таблицах, также будут удалены.

> [!NOTE]
> Если восстанавливается база данных Supply Chain Management после удаления надстройки видимости запасов, а затем требуется переустановить надстройку, перед переустановкой надстройки убедитесь, что удалены старые данные о видимости запасов, которые хранятся в подписке Dataverse (как описано в предыдущей процедуре). Это предотвратит ошибки в противоречивости данных, которые могут возникнуть в противном случае.

## <a name="clean-inventory-visibility-data-from-dataverse-before-restoring-the-supply-chain-management-database"></a><a name="restore-environment-database"></a>Очистка данных видимости запасов из Dataverse до восстановления базы данных Supply Chain Management

Если вы использовали видимость запасов, а затем восстановите базу данных Supply Chain Management, то в восстановленной базе данных могут содержаться данные, которые больше не соответствуют данным, которые ранее были синхронизированы надстройкой видимости запасов с Dataverse. Это несоответствие данных может привести к возникновению системных ошибок и других проблем. Таким образом, важно всегда очищать все данные видимости запасов из Dataverse перед восстановлением базы данных Supply Chain Management.

Если требуется восстановить базу данных Supply Chain Management, выполните следующую процедуру:

1. Удалите надстройку "Видимость запасов" и удалите все связанные данные в Dataverse, как описано в разделе [Удаление настройки видимости запасов](#uninstall-add-in)
1. Восстановите базу данных Supply Chain Management, например, как описано в разделе [Восстановление базы данных на определенный момент времени (PITR)](../../fin-ops-core/dev-itpro/database/database-point-in-time-restore.md) или [Восстановление производственной базы данных на определенный момент времени в среде "песочницы"](../../fin-ops-core/dev-itpro/database/database-pitr-prod-sandbox.md).
1. Если вы все-таки хотите ее использовать, переустановите и настройте настройку видимости запасов, как описано в разделах [Установка надстройки видимости запасов](#install-add-in) и [Настройка интеграции видимости запасов](#setup-inventory-visibility-integration)


[!INCLUDE[footer-include](../../includes/footer-banner.md)]

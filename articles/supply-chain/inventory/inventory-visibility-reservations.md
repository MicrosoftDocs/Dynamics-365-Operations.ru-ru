---
title: Резервирования видимости запасов
description: В этой теме описывается, как настроить функцию резервирования для создания резервирований, потребления зарезервированных и/или незарезервированных складских количеств с помощью отображения запасов.
author: yufeihuang
ms.date: 08/02/2021
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: yufeihuang
ms.search.validFrom: 2021-08-02
ms.dyn365.ops.version: 10.0.21
ms.openlocfilehash: 6c87018cbfbe22fbbc441a1a23aee0ac44af9ddc
ms.sourcegitcommit: b9c2798aa994e1526d1c50726f807e6335885e1a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/13/2021
ms.locfileid: "7345157"
---
# <a name="inventory-visibility-reservations"></a>Резервирования видимости запасов

[!include [banner](../includes/banner.md)]
[!include [preview banner](../includes/preview-banner.md)]
[!INCLUDE [cc-data-platform-banner](../../includes/cc-data-platform-banner.md)]

В этой теме описывается, как настроить функцию резервирования для создания резервирований, потребления зарезервированных и/или незарезервированных складских количеств с помощью отображения запасов.

Резервирование используется для маркировки количества запасов, которое будет использоваться в будущем. При создании резервирования система не позволяет другим заказам резервировать или потреблять зарезервированные товары до тех пор, пока резервирование не будет потреблено или отменено. Резервирование создается, потребляется и отменяется путем использования вызовов API для службы отображения запасов.

Можно дополнительно настроить Microsoft Dynamics 365 Supply Chain Management (и другие системы сторонних производителей) на автоматическое смещение количества, которое было зарезервировано с помощью функции видимости запасов. Значение смещения удаляется из записей резервирования в видимости запасов.

При включении функции резервирования Supply Chain Management автоматически становится готово к смещению резервирований, выполненных с использованием видимости запасов.

> [!NOTE]
> Функциям смещения требуется Supply Chain Management версии 10.0.22 или более поздней. Если необходимо использовать резервирование видимости запасов, рекомендуется дождаться обновления Supply Chain Management до версии 10.0.22 или более поздней.

## <a name="turn-on-the-reservation-feature"></a>Включите функцию резервирования

Чтобы включить функцию резервирования, выполните следующие действия.

1. В Power Apps откройте **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Управление функциями** включите функцию *OnHandReservation*.
1. Войдите в Supply Chain Management.
1. Перейдите в раздел **Управление запасами \> Настройка \> Параметры интеграции видимости запасов**.
1. В области **Смещение резервирования** установите для параметра **Включить смещение резервирования** значение *Да*.

## <a name="use-the-reservation-feature-in-inventory-visibility"></a>Использование функции резервирования в видимости запасов

При вызове API резервирования система помечает резервирование указанных товаров и количеств. Необходимо определить иерархию резервирования и запросы на разноску, которые соответствуют этой иерархии резервирования. Резервирования могут быть выполнены путем прямого вызова API резервирования.

### <a name="configure-the-reservation-hierarchy"></a>Настройка иерархии резервирования

Иерархия резервирования описывает последовательность аналитик, которая должна быть указана при выполнении резервирования. Это функционирует так же, как и иерархия индексов для запросов в наличии.

Иерархия резервирования может отличаться от иерархии индексов. Эта независимость позволяет реализовать управление категориями, когда пользователи могут разбить аналитики на детали, чтобы указать требования для более точного резервирования.

Чтобы настроить иерархию предварительного резервирования в Power Apps, откройте страницу **Конфигурация**, а затем на вкладке **Сопоставление предварительного резервирования** настройте иерархию резервирования путем добавления и/или изменения аналитик и их уровней иерархии.

### <a name="call-the-reservation-api"></a>Вызов API резервирования

Резервирования выполняются в службе отображения запасов путем отправки запроса POST в URL-адрес службы, например `/api/environment/{environment-ID}/onhand/reserve`.

Для резервирования текст запроса должен содержать код организации, идентификатор продукта, зарезервированные количества и аналитики. Запрос создает уникальный идентификатор резервирования для каждой записи резервирования. Запись о резервировании содержит уникальную комбинацию кода продукта и аналитик.

Вот пример текста запроса для ссылки.

```json
# Url
# replace {RegionShortName} and {EnvironmentId} with your value
https://inventoryservice.{RegionShortName}-il301.gateway.prod.island.powerapps.com/api/environment/{EnvironmentId}/onhand/reserve

# Method
Post

# Header
# replace {access_token} with the one get from security service
Api-version: "1.0"
Content-Type: "application/json"
Authorization: "Bearer {access_token}"

# Body
{
    "id": "id-bike-0001",
    "organizationId": "usmf",
    "productId": "Bike",
    "dimensions": {
        "SiteId": "1",
        "LocationId": "11",
        "ColorId": "Red",
        "SizeId": "small"
    },
    "quantityDataSource": "iv",
    "modifier": "SoftReservOrdered",
    "quantity": 1,
    "ifCheckAvailForReserv": true
}
```

## <a name="offset-reservations-in-supply-chain-management"></a>Смещение резервирований в Supply Chain Management

Для статусов складских проводок, включающих указанный модификатор смещения, обновление проводки будет смещать соответствующую запись резервирования, когда выполняются все следующие условия:

- Код резервирования в складской проводке совпадает с кодом резервирования записи о резервировании в службе видимости запасов.
- Аналитики складской проводки совпадают с аналитиками записи о резервировании в службе видимости запасов.
- Изменения статуса складских проводок запускают смещения для резервирований, когда статус складской проводки отражает тот факт, что процесс заказа был завершен или пропущен.

Количество смещения соответствует количеству запасов, указанному в складских проводках. Смещение не вступит в силу, если в службе видимости запасов не останется зарезервированного количества.

> [!NOTE]
> Функция смещения доступна в версии 10.0.22

### <a name="set-up-the-reserve-offset-modifier"></a>Настройка модификатора смещения резерва

Модификатор смещения резерва определяет этап обработки заказов, при котором инициируются смещения. Стадия отслеживается по статусу складской проводки заказа. Чтобы настроить модификатор смещения резерва, сделайте следующее.

1. Перейдите в раздел **Управление запасами \> Настройка \> Параметры интеграции видимости запасов \> Смещение резервирования**.
1. Установите в поле **Модификатор смещения резерва** на одно из следующих значений:

    - *В заказе* — для статуса *В проводке* заказ будет отправлять запрос на смещения при создании.
    - *Резерв* — для статуса *Резервирование заказанной проводки* заказ отправит запрос смещения при резервировании, комплектации, разноске отборочной накладной или выпуске накладной. Запрос будет запущен только один раз для первого шага, когда происходит упомянутый процесс.

### <a name="set-up-reservation-ids"></a>Настройка кодов резервирования

Идентификатор резервирования уникальный помечает запись резервирования в видимости запасов. В Supply Chain Management пользователи передают резервирования для строк заказа, чтобы отметить смещение для соответствующей записи о резервировании.

Чтобы настроить коды резервирования в Supply Chain Management, выполните следующие действия.

1. Откройте заказ на продажу (например, на странице **Все заказы на продажу**).
1. На экспресс-вкладке **Строки заказа на продажу** выберите строку заказа.
1. На экспресс-вкладке **Строки заказа на продажу** на панели инструментов выберите **Обновить строку \> Запасы \> Интеграция видимости запасов**.
1. Введите соответствующие коды резервирований.

Изменение статуса запасов соответствует настройке модификатора смещения.

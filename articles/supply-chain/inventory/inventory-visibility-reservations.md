---
title: Резервирования видимости запасов
description: В этой теме описывается, как настроить функцию резервирования для создания резервирований, потребления зарезервированных и/или незарезервированных складских количеств с помощью отображения запасов.
author: yufeihuang
ms.date: 08/02/2021
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: yufeihuang
ms.search.validFrom: 2021-08-02
ms.dyn365.ops.version: 10.0.21
ms.openlocfilehash: acc5d5f93f3f625892aac37780a44e221b6eb5ac
ms.sourcegitcommit: 2d6e31648cf61abcb13362ef46a2cfb1326f0423
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/07/2021
ms.locfileid: "7475044"
---
# <a name="inventory-visibility-reservations"></a>Резервирования видимости запасов

[!include [banner](../includes/banner.md)]
[!include [preview banner](../includes/preview-banner.md)]
[!INCLUDE [cc-data-platform-banner](../../includes/cc-data-platform-banner.md)]

В этой теме описывается, как настроить функцию резервирования для создания резервирований, потребления зарезервированных и/или незарезервированных складских количеств с помощью отображения запасов.

Резервирование используется для маркировки количества запасов, которое будет использоваться в будущем. При создании резервирования система не позволяет другим заказам резервировать или потреблять зарезервированные товары до тех пор, пока резервирование не будет потреблено или отменено. Резервирование создается, потребляется и отменяется путем использования вызовов API для службы отображения запасов.

Можно дополнительно настроить Microsoft Dynamics 365 Supply Chain Management (и другие системы сторонних производителей) на автоматическое смещение количества, которое было зарезервировано с помощью функции видимости запасов. Значение смещения удаляется из записей резервирования в видимости запасов.

При включении функции резервирования Supply Chain Management автоматически становится готово к смещению резервирований, выполненных с использованием видимости запасов.

## <a name="turn-on-and-set-up-the-reservation-feature"></a><a name="turn-on"></a>Включите и настройте функцию резервирования

Чтобы включить функцию резервирования, выполните следующие действия.

1. Войдите в Power Apps и откройте **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Управление функциями** включите функцию *OnHandReservation*.
1. Войдите в Supply Chain Management.
1. Перейдите в рабочую область **[Управление функциями](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)** и включите функцию *Интеграция видимости запасов с возможностью смещения резервирования* (требуется версия 10.0.22 или более поздняя).
1. Перейдите на вкладку **Управление запасами \> Настройка \> Параметры интеграции видимости запасов**, откройте вкладку **Смещение резервирования** и выполните следующие настройки:
    - **Включить смещение резервирования** — установите значение *Да*, чтобы включить эту функцию.
    - **Модификатор смещения резервирования** — выберите статус складской проводки, который сместит резервирования, сделанные на в Видимость запасов. Этот параметр определяет этап обработки заказов, который запускает смещения. Стадия отслеживается по статусу складской проводки заказа. Выберите один из следующих вариантов:
        - *В заказе* — для статуса *В проводке* заказ будет отправлять запрос на смещения при создании. Количество смещения будет равно количеству созданного заказа.
        - *Резерв* — для статуса *Резервирование заказанной проводки* заказ отправит запрос смещения при резервировании, комплектации, разноске отборочной накладной или выпуске накладной. Запрос будет запущен только один раз для первого шага, когда происходит упомянутый процесс. В качестве количество смещения будет получено количество, в котором статус складской проводки изменен с *Заказано* на *Зарезервировано в заказанных* (или более позднее статус) в соответствующей строке заказа.

## <a name="use-the-reservation-feature-in-inventory-visibility"></a>Использование функции резервирования в видимости запасов

При вызове API резервирования система помечает резервирование указанных товаров и количеств. Необходимо определить иерархию резервирования и запросы на разноску, которые соответствуют этой иерархии резервирования. Резервирования могут быть выполнены путем прямого вызова API резервирования.

### <a name="configure-the-reservation-hierarchy"></a>Настройка иерархии резервирования

Иерархия резервирования описывает последовательность аналитик, которая должна быть указана при выполнении резервирования. Это функционирует так же, как и иерархия индексов для запросов в наличии.

Иерархия резервирования может отличаться от иерархии индексов. Эта независимость позволяет реализовать управление категориями, когда пользователи могут разбить аналитики на детали, чтобы указать требования для более точного резервирования.

Чтобы настроить иерархию предварительного резервирования в Power Apps, откройте страницу **Конфигурация**, а затем на вкладке **Иерархия предварительного резервирования** настройте иерархию резервирования путем добавления и/или изменения аналитик и их уровней иерархии.

Иерархия иерархии предварительного резервирования должна содержать `SiteId` и `LocationId` в качестве компонентов, поскольку они создают конфигурацию раздела.

Дополнительные сведения о настройке резервирований см. в разделе [Конфигурация резервирования](inventory-visibility-configuration.md#reservation-configuration).

### <a name="call-the-reservation-api"></a>Вызов API резервирования

Резервирования выполняются в службе отображения запасов путем отправки запроса POST в URL-адрес службы, например `/api/environment/{environment-ID}/onhand/reserve`.

Для резервирования текст запроса должен содержать код организации, идентификатор продукта, зарезервированные количества и аналитики. Запрос создает уникальный идентификатор резервирования для каждой записи резервирования. Запись о резервировании содержит уникальную комбинацию кода продукта и аналитик.

При вызове API резервирования можно контролировать проверку резервирования путем указания логического параметра `ifCheckAvailForReserv` в тексте запроса. Значение `True` означает, что проверка является обязательной, а значение `False` означает, что проверка не является обязательной. Значение по умолчанию — `True`.

Если необходимо отменить резервирование или отказаться от указанного количества запасов, установите отрицательное значение количества и задайте для параметра `ifCheckAvailForReserv` значение `False` для пропуска проверки.

Вот пример текста запроса для ссылки.

```json
# Url
# replace {RegionShortName} and {EnvironmentId} with your value
https://inventoryservice.{RegionShortName}-il301.gateway.prod.island.powerapps.com/api/environment/{EnvironmentId}/onhand/reserve

# Method
Post

# Header
# replace {access_token} with the one get from security service
Api-version: "1.0"
Content-Type: "application/json"
Authorization: "Bearer {access_token}"

# Body
{
    "id": "id-bike-0001",
    "organizationId": "usmf",
    "productId": "Bike",
    "dimensions": {
        "SiteId": "1",
        "LocationId": "11",
        "ColorId": "Red",
        "SizeId": "small"
    },
    "quantityDataSource": "iv",
    "modifier": "SoftReservOrdered",
    "quantity": 1,
    "ifCheckAvailForReserv": true
}
```

## <a name="offset-reservations-in-supply-chain-management"></a>Смещение резервирований в Supply Chain Management

Для статусов складских проводок, включающих указанный модификатор смещения, обновление проводки будет смещать соответствующую запись резервирования, когда выполняются все следующие условия:

- Код резервирования в складской проводке совпадает с кодом резервирования записи о резервировании в службе видимости запасов.
- Аналитики складской проводки совпадают с аналитиками записи о резервировании в службе видимости запасов.
- Изменения статуса складских проводок запускают смещения для резервирований, когда статус складской проводки отражает тот факт, что процесс заказа был завершен или пропущен.

Количество смещения соответствует количеству запасов, указанному в складских проводках. Смещение не вступит в силу, если в службе видимости запасов не останется зарезервированного количества.

### <a name="set-up-the-reservation-offset-modifier"></a>Настройка модификатора смещения резервирования

Если это еще не сделано, настройте модификатор резервирования, как описано в разделе [Включение и настройка функции резервирования](#turn-on).

### <a name="set-up-reservation-ids"></a>Настройка кодов резервирования

Идентификатор резервирования уникальный помечает запись резервирования в видимости запасов. В Supply Chain Management пользователи передают резервирования для строк заказа, чтобы отметить смещение для соответствующей записи о резервировании.

Чтобы настроить коды резервирования в Supply Chain Management, выполните следующие действия.

1. Откройте заказ на продажу (например, на странице **Все заказы на продажу**).
1. На экспресс-вкладке **Строки заказа на продажу** выберите строку заказа.
1. На экспресс-вкладке **Строки заказа на продажу** на панели инструментов выберите **Обновить строку \> Запасы \> Интеграция видимости запасов**.
1. Введите соответствующие коды резервирований.

Изменение статуса запасов соответствует настройке модификатора смещения.

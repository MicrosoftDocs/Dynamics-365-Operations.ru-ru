---
title: Резервирования Inventory Visibility
description: В этой статье описывается, как настроить функцию резервирования для создания резервирований, потребления зарезервированных и/или незарезервированных складских количеств с помощью отображения запасов.
author: yufeihuang
ms.date: 11/04/2022
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: yufeihuang
ms.search.validFrom: 2021-08-02
ms.dyn365.ops.version: 10.0.21
ms.openlocfilehash: 0ae0589f8bac7ebf9b43cf0f3bc02680d324b29b
ms.sourcegitcommit: 49f8973f0e121eac563876d50bfff00c55344360
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2022
ms.locfileid: "9762750"
---
# <a name="inventory-visibility-reservations"></a>Резервирования в видимости запасов

[!include [banner](../includes/banner.md)]

В этой статье описывается типичный вариант использования для предварительных резервирований и объясняется порядок их настройки в видимости запасов. Она содержит информацию о порядке создания предварительных резервирований, их сдвиге при физическом потреблении и корректировке или отмене резервирования указанных количеств запасов.

## <a name="sample-use-case-for-soft-reservation"></a>Пример варианта использования для предварительного резервирования

Предварительное резервирование помогает организациям получить единый источник истинности доступных запасов, особенно в процессе выполнения заказа. Эта функция полезна в организациях, где имеются следующие условия:

- Организация имеет как минимум две разных системы, в которых непосредственно принимаются исходящие заказы.
- Организация очень строга и хочет исключить повторное резервирование запасов продуктов, что может случиться, если несколько систем смогут несколько раз зарезервировать последний экземпляр на складе. Эта ситуация исключается, когда все системы заказов могут выполнять вызовы API мгновенного предварительного резервирования в видимости запасов, что позволяет получить один источник истинности запасов в наличии.

[<img src="media/inventory-visibility-soft-reservation.png" alt="Inventory Visibility soft reservation." title="Предварительное резервирование в видимости запасов" width="720" />](media/inventory-visibility-soft-reservation.png)

На предыдущем рисунке показано, как работают предварительные резервирования, и выделяются следующие операции:

- Начальный уровень запасов синхронизирован с модулем видимости запасов из Microsoft Dynamics 365 Supply Chain Management.
- Предварительные резервирования разносятся из каждого канала или систем заказов в модуль видимости запасов. Модуль видимости запасов проверяет доступность запасов и пытается выполнить предварительное резервирование. Если предварительное резервирование выполнено успешно, модуль видимости запасов добавляет к предварительно зарезервированному количеству, вычитает из количества, доступного для резервирования (AFR) и откликается кодом предварительного резервирования.
- В это время ваше количество физических запасов остается тем же
- Затем можно выполнить синхронизацию как одного, так и агрегированных заказов с предварительным резервированием (строк заказов) в Supply Chain Management, чтобы произвести окончательные резервирования и выпуск на склад или обновить конечное количество запасов.
- Можно настроить систему на [смещение предварительных резервирований](#offset-scm) при обновлении физических запасов в Supply Chain Management.

Предварительные резервирования обычно создаются, потребляются и отменяются путем использования вызовов API для службы видимости запасов.

> [!NOTE]
> Можно дополнительно настроить Supply Chain Management (и другие системы сторонних производителей) на автоматическое смещение количества, которое было зарезервировано с помощью функции видимости запасов. Значение смещения удаляется из записей резервирования в видимости запасов.
>
> По умолчанию функция смещения автоматически включается, когда включается функция предварительного резервирования.

## <a name="turn-on-and-set-up-the-reservation-feature"></a><a name="turn-on"></a>Включите и настройте функцию резервирования

Чтобы включить функцию резервирования, выполните следующие действия.

1. Войдите в Power Apps и откройте **Видимость запасов**.
1. Откройте страницу **Конфигурация**.
1. На вкладке **Управление функциями** включите функцию *OnHandReservation*.
1. Войдите в свою среду Supply Chain Management.
1. Перейдите в рабочую область **[Управление функциями](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md)** и включите функцию *Интеграция видимости запасов с возможностью смещения резервирования* (требуется версия 10.0.22 или более поздняя).
1. Перейдите на вкладку **Управление запасами \> Настройка \> Параметры интеграции видимости запасов**, откройте вкладку **Смещение резервирования** и выполните следующие настройки:

    - **Включить смещение резервирования** — установите значение *Да*, чтобы включить эту функцию.
    - **Модификатор смещения резервирования** — выберите статус складской проводки, который сместит резервирования, сделанные в службе видимости запасов. Этот параметр определяет этап обработки заказов, который запускает смещения. Стадия отслеживается по статусу складской проводки заказа. Выберите одно из следующих значений:

        - *Заказано* — заказы, имеющие статус *В заказе*, будут отправлять запрос на смещения при создании. Количество смещения будет равно количеству созданного заказа (строки).
        - *Резерв* — заказы, имеющие статус *Резерв*, отправляют запрос смещения, если они либо зарезервированы для заказа, либо физически зарезервированы. Когда вы смещаете на статус *Резерв*, заказ отправит запрос смещения по всем новым статусам запасов, которые ближе всего к зарезервированному для комплектации (например, комплектация, разнесенная отборочная накладная или выставлен счет). Такое поведение наблюдается даже в том случае, если вы пропускаете резервирование в Supply Chain Management и переходите к другому статусу запасов (например, если вы переходите с выпуска на склад к комплектации и упаковке). Запрос будет запущен только один раз. Если он запускается на этапе комплектации, при разноске отборочной накладной дублирование смещения не выполняется. Количество смещения будет таким же, что и количество статуса складской проводки, когда было запущено смещение (другими словами, *Зарезервировано в заказанных*/*Зарезервировать физически* или более поздний статус, в соответствующей строке заказа).

1. Снова выполните вход в приложение видимости запасов, перейдите на страницу **Конфигурация**, затем на вкладке **Предварительное резервирование** проверьте иерархию предварительного резервирования по умолчанию. Добавьте в иерархию новые аналитики, если это необходимо.
1. В разделе **Настройка сопоставления предварительного резервирования** просмотрите параметры по умолчанию. По умолчанию количества по предварительному резервированию запасов будут записываться по физической мере `softreservephysical` источника данных `iv`. Вычисляемая мера *Доступно для резервирования* сопоставляется с `availabletoreserve`. Если требуется обновить вычисляемую меру `availabletoreserve`, перейдите на страницу **Конфигурация**, затем на вкладке **Вычисляемая мера** разверните и измените вычисляемую меру.

Дополнительные сведения см. в разделе [Настройка отображения запасов](inventory-visibility-configuration.md).

> [!NOTE]
> Иерархия резервирования описывает последовательность аналитик, которая должна быть указана при выполнении резервирования. Она функционирует так же, как и иерархия индексов для запросов в наличии, но она используется независимо, чтобы пользователи могли задавать сведения измерений для более точных резервирований.
>
> Иерархия предварительного резервирования должна содержать `SiteId` и `LocationId` в качестве компонентов, поскольку они создают конфигурацию раздела видимости запасов.

Дополнительные сведения о настройке резервирований см. в разделе [Конфигурация резервирования](inventory-visibility-configuration.md#reservation-configuration).

## <a name="use-the-reservation-feature-in-inventory-visibility"></a>Использование функции резервирования в видимости запасов

При вызове API резервирования система помечает резервирование указанных товаров и количеств.

Вот пример сценария и образец текста запроса API. Компания Contoso продает продукт D0002 (Шкаф) через веб-сайт электронной коммерции. Клиент размещает заказ на продажу для маленького красного шкафа через веб-сайт. Компания Contoso решила выполнить этот заказ, используя следующие аналитики:

- ИД организации = usmf
- Сайт = 1
- Склад = 11
- Продукт = D0002
- Цвет = красный
- Размер = маленький

Компания Contoso уже настроила соединение API для отображения запасов из собственной системы электронной коммерции. При получении заказа система сразу инициирует вызов API, чтобы сделать предварительное резервирование шкафа в модуле видимости запасов.

### <a name="create-soft-reservations-using-the-reservation-api"></a>Создание предварительных резервирований с помощью API резервирования

Резервирования выполняются в службе отображения запасов путем отправки запроса POST в URL-адрес службы, например `/api/environment/{environmentId}/onhand/reserve`.

Для резервирования текст запроса должен содержать код организации, идентификатор продукта, зарезервированные количества и аналитики.

При вызове API резервирования можно контролировать проверку резервирования путем указания логического параметра `ifCheckAvailForReserv` в тексте запроса. Значение `True` означает, что проверка является обязательной, а значение `False` означает, что проверка не является обязательной. Значение по умолчанию — `True`.

Если необходимо отменить резервирование или отказаться от указанного количества запасов, установите отрицательное значение количества и задайте для параметра `ifCheckAvailForReserv` значение `False` для пропуска проверки.

Вот пример тела запроса, который ссылается на заказ на продажу из предыдущего контекста.

```json
# Url

#Replace {endpoint} with your system endpoint.
    {endpoint}/api/environment/{environmentId}/onhand/reserve

# Method
Post

# Header
# replace {access_token} with the one get from security service
Api-version: "1.0"
Content-Type: "application/json"
Authorization: "Bearer {access_token}"

# Body
{
    "id": "Testrequest-0005",
    "organizationId": "usmf",
    "productId": "D0002",
    "dimensions": {
        "SiteId": "1",
        "LocationId": "11",
        "ColorId": "red",
        "SizeId": "small"
    },
    "quantityDataSource": "iv",
    "modifier": "softreservphysical",
    "quantity": 1,
    "ifCheckAvailForReserv": true
}
```

Успешный запрос предварительного резервирования возвращает *Код предварительного резервирования* для каждой записи резервирования. Код предварительного резервирования не является уникальным идентификатором для отдельной записи предварительного резервировании, а комбинацией кода продукта и значений аналитики, связанных с запросом на предварительное резервирование. Код предварительного резервирования можно записать в строку заказа при синхронизации успешно зарезервированных заказов с Supply Chain Management или другой ERP-системой для корреспонденции.

### <a name="offset-soft-reservations-in-supply-chain-management"></a><a name="offset-scm"></a>Смещение предварительных резервирований в Supply Chain Management

Можно корреспондировать предварительно зарезервированное количество после того, как количество в заказе физически вычитается в Supply Chain Management или другой ERP-системе. Видимость запасов предлагает готовую интеграцию корреспондирования предварительного резервирования с Supply Chain Management.

Выполните следующие действия для корреспондирования предварительного резервирования.

1. Войдите в Supply Chain Management.
1. Перейдите в раздел **Продажи и маркетинг \> Заказы на продажу \> Все заказы на продажу**.
1. В области действий выберите **Создать**.
1. Повторно создайте внешний заказ на продажу и добавьте строку заказа на продажу, в которой используются точно такие же значения кода продукта, организации, сайта, склада и аналитик.
1. На экспресс-вкладке **Строки заказа на продажу** выберите только что введенную строку продаж, затем на панели инструментов выберите **Запасы \> Код резервирования**.
1. Выполните одно из следующих действий.

    - Скопируйте код предварительного резервирования в ответ на запрос о предварительном резервировании и вставьте его в поле **Код резервирования**.
    - Оставьте поле **Код резервирования** пустым, но установите флажок **Автоматическая корреспонденция службы запасов**. Система автоматически определит, какие аналитики продуктов и продукты необходимо корреспондировать на основе кода номенклатуры и значений аналитики, введенных в выбранной строке.

1. Нажмите **ОК**.
1. Пока эта же строка продаж все еще выбрана, физическим зарезервируйте заказанное количество, выбрав **Запасы \> Резервирование** на панели инструментов экспресс-вкладки **Строки заказа на продажу**.
1. Если ранее в поле **Модификатор смещения резервирования** было указано значение *Зарезервировано*, смещение будет запущено, когда строка заказа имеет статус *Зарезервировать физические* или *Зарезервировать заказанное*. Пакетное задание выполняется один раз в минуту для синхронизации запросов корреспондирования из Supply Chain Management в видимость запасов.

> [!NOTE]
> Для статусов проводок, включающих указанный модификатор смещения, обновление проводки будет смещать соответствующую запись резервирования, когда выполняются все следующие условия:
>
> - Код резервирования в складской проводке совпадает с кодом резервирования записи о резервировании в видимости запасов.
> - Аналитики складской проводки соответствуют аналитикам записи о резервировании в видимости запасов.
> - Изменения статуса складских проводок запускают смещения для резервирований, когда статус складской проводки отражает тот факт, что процесс заказа был завершен или пропущен.

Количества смещения соответствуют количествам запасов, указанным в соответствующих складских проводках. Смещение вступит в силу только в том случае, если в видимости запасов остаются зарезервированные количества.

### <a name="cancel-or-revert-a-soft-reservation"></a>Отмена или возврат предварительного резервирования

Если исходная строка заказа отменена или удалена, и необходимо отменить соответствующее предварительное резервирование, выполните разноску отрицательного количества, которое будет иметь точно такую же информацию в теле запроса API.

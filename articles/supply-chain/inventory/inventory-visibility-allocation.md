---
title: Функция распределения запасов "Видимость запасов"
description: В этом разделе объясняется, как настроить и использовать функцию распределения запасов, которая позволяет отложить выделенные запасы, чтобы обеспечить выполнение самых выгодных каналов или клиентов.
author: yufeihuang
ms.date: 05/20/2022
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: yufeihuang
ms.search.validFrom: 2022-05-13
ms.dyn365.ops.version: 10.0.27
ms.openlocfilehash: 4293ead4ccfc9ba04e8b9da437134b4e97569026
ms.sourcegitcommit: 1877696fa05d66b6f51996412cf19e3a6b2e18c6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2022
ms.locfileid: "8786955"
---
# <a name="inventory-visibility-inventory-allocation"></a>Функция распределения запасов "Видимость запасов"

[!include [banner](../includes/banner.md)]

## <a name="business-background-and-purpose"></a>Сведения о деятельности и назначение

Во многих случаях производители, розничные магазины и другие компании, связанные с цепочкой поставок, должны предварительно распределить запасы для важных каналов продаж, местоположений или клиентов или для определенных событий продаж. Распределение запасов является типичным приемом в процессе планирования операций по продажам и выполняется перед фактическими действиями по продажам и созданием заказов на продажу.

Например, компания по продаже велосипедов имеет ограниченный запас популярной модели велосипеда. Эта компания осуществляет продажи как в Интернете, так и в магазине. В каждом канале продаж у компании есть несколько важных партнеров (marketplace и крупные розничные продавцы), требующих, чтобы для них была оставлена определенная часть запасов велосипеда. Таким образом, компания по продаже велосипедов должна иметь возможность сбалансировать распределение запасов по каналам, а также управлять ожиданиями VIP-партнеров. Наилучшим способом достижения обеих целей является использование распределения запасов, благодаря чему каждый канал и продавец могут получить определенное выделенное количество товара, которое может быть продано клиентам позже.

Распределение запасов имеет две основные цели:

- **Защита запасов (выделение на самостоятельный баланс)** — организации хотят предварительно распределить ограниченный запас по приоритетным каналам, регионам, VIP-клиентам и дочерним компаниям. Функция распределения "Видимость запасов" предназначена для защиты распределенных запасов для того, чтобы другие распределения, резервирования или другие потребности в продажах не влияли на ранее распределенные запасы.
- **Управление перепродажами** — функция распределения "Видимость запасов" предназначена для установки ограничения на ранее распределенное количество запасов для того, чтобы получающая сторона (например, канал или группа клиентов) не перерасходовала их на момент выполнения фактической проводки по продажам на основе предварительного резервирования.

## <a name="allocation-definition-in-inventory-visibility-service"></a>Определение распределения в службе видимости запасов

Хотя функция распределения в службе видимости запасов не размещает количество физических запасов, она обращается к доступному количеству физических запасов, чтобы определить начальное количество виртуального пула *Доступно для распределения*. Распределение запасов с помощью функции "Видимость запасов" является предварительным распределением. Это выполняется до осуществления фактических проводок продаж и не зависит от заказов на продажу. Например, можно распределить запасы на наиболее важные каналы продаж или крупные предприятия розничной торговли, прежде чем все конечные пользователи посетят этот канал продаж или магазин розничной торговли для покупки.

Разница между распределением запасов и [Предварительным резервированием запасов](inventory-visibility-reservations.md) состоит в том, что предварительное резервирование обычно связано с фактическими проводками по продажам (строки заказа на продажу). Таким образом, если предполагается использовать функции распределения и предварительного резервирования, рекомендуется сначала выполнить распределение запасов, а затем выполнить их предварительное резервирование в соответствии с распределенными количествами. Дополнительные сведения см. в разделе [Потребление в качестве предварительного резервирования](#consume-to-soft-reserved).

Функция распределения запасов позволяет планировщикам сбыта или управляющим основных счетов управлять и предварительно распределять важные запасы по группам распределения (например, по каналам, областям и группам клиентов). Она также поддерживает отслеживание в реальном времени, корректировку и аналитику потребления для распределенных количеств, чтобы можно было выполнить пополнение или распределение вовремя. Наличие функции видимости в режиме реального времени в распределении, потреблении и сальдо распределения особенно важно при быстрых продажах или рекламных акциях.

## <a name="terminology"></a>Терминология

Следующие термины и понятия помогут при обсуждении распределения запасов:

- **Группа распределения** — группа, которая владеет распределением, например канал продаж, группа клиентов или тип заказа.
- **Значение группы распределения** — значение каждой группы распределения. Например, *веб-сайт* или *магазин* могут быть значением группы распределения канала продаж, а *VIP* или *Обычный* могут быть значением группы распределения клиентов.
- **Иерархия распределения** — средство для объединения групп распределения в иерархическом порядке. Например, можно определить *канал* как уровень иерархии 1, *регион* — как уровень 2, а *группу клиентов* — как уровень 3. Во время распределения запасов нужно следовать последовательности иерархии распределения при указании значения группы распределения. Например, можно выделить 200 красных велосипедов для канала *веб-сайт*, региона *Лондон* и группы клиентов *VIP*.
- **Доступно для распределения** — *виртуальный общий пул*, который показывает количество, доступное для дальнейшего распределения. Это вычисляемая мера, которую можно свободно определять с помощью собственной формулы. Если используется также функция предварительного резервирования, рекомендуется использовать одну и ту же формулу для расчета доступных для распределения и доступных для резервирования запасов.
- **Распределено** — физическая мера, в которой отображается распределенная квота, которая может быть потреблена группами распределения.
- **Потреблено** — физическая мера, которая указывает на то, что количества были потреблены относительно исходного распределенного количества. При добавлении номеров в эту физическую меру, физическая мера "Распределено" автоматически уменьшается.

Следующая иллюстрация показывает рабочий процесс для распределения запасов.

![Рабочий процесс распределения видимости запасов](media/inventory-visibility-allocation-flow.png "Рабочий процесс распределения видимости запасов.")

## <a name="set-up-inventory-allocation"></a>Настройка распределения запасов

Функция распределения запасов состоит из указанных ниже компонентов.

- Предопределенные источник данных, физические меры и рассчитываемые меры, связанные с распределением.
- Настраиваемые группы распределения, которые имеют максимум 8 уровней.
- Набор интерфейсов прикладного программирования (API) распределения:

    - распределить
    - перераспределить
    - не распределять
    - использовать
    - запросить

Процесс настройки функции распределения состоит из двух этапов:

- Настройка [источника данных](inventory-visibility-configuration.md#data-source-configuration) и его [мер](inventory-visibility-configuration.md#data-source-configuration-physical-measures).
- Настройка имени и иерархии группы распределения.

### <a name="predefined-data-source"></a>Предопределенный источник данных

При включении функции распределения и вызове API обновления конфигурации функция видимости запасов создает один предопределенный источник данных и несколько начальных показателей.

Источник данных называется `@iv`.

Ниже приведены исходные физические меры:

- `@iv`

    - `@allocated`
    - `@cumulative_allocated`
    - `@consumed`
    - `@cumulative_consumed`

Ниже приведены исходные вычисляемые меры:

- `@iv`

    - `@iv.@available_to_allocate` = `??` – `??` – `@iv.@allocated`

### <a name="add-other-physical-measures-to-the-available-to-allocate-calculated-measure"></a>Добавьте другие физические меры в вычисляемую меру "Доступно для распределения"

Для использования распределения необходимо настроить вычисляемую меру "Доступно для распределения" (`@iv`.`@available_to_allocate`) Например, у вас есть источник данных `fno` и мера`onordered`, источник данных `pos` и мера`inbound`, и необходимо выполнить распределение имеющихся в наличии запасов для суммы `fno.onordered` и `pos.inbound`. В этом случае `@iv.@available_to_allocate` должно содержать `pos.inbound` и `fno.onordered` в формуле. Рассмотрим пример:

`@iv.@available_to_allocate` = `fno.onordered` + `pos.inbound` – `@iv.@allocated`

### <a name="change-the-allocation-group-name"></a>Изменение имени группы распределения

Можно задать не более восьми имен групп распределения. Группы имеют иерархию.

Имена групп задаются на странице **Настройка приложения Power App видимости запасов**. Чтобы открыть эту страницу, в среде Microsoft Dataverse откройте приложение "Видимость запасов" и выберите **Конфигурация \> Распределение**.

Например, если используются четыре имени группы, и для них заданы значения \[`channel`, `customerGroup`, `region`, `orderType`\], эти имена будут действительны для запросов, связанных с распределением, при вызове API обновления конфигурации.

### <a name="allcoation-using-tips"></a>Распределение с помощью советов

- Для каждого продукта функция распределения должна использоваться на том же уровне измерения, что и иерархия индексов продуктов, заданная в [конфигурации иерархии индекса продуктов](inventory-visibility-configuration.md#index-configuration). Например, иерархия индекса — это сайт, местоположение, цвет, размер. Вы выполняете распределение определенного количества для одного продукта на уровне сайта, местоположения, цвета. В следующий раз при распределении также следует использовать уровень сайта, местоположения, цвета; если вы будете использовать уровень сайта, местоположения, цвета и размера или уровень сайта и местоположения, данные не будут согласованы.
- Изменение имени группы распределения не повлияет на данные, сохраненные в службе.
- Распределение должно выполняться после того, как у продукта будет положительное количество в наличии.

### <a name="using-the-allocation-api"></a><a name="using-allocation-api"></a>Использование API распределения

В данный момент открыты пять API распределения:

- POST /api/environment/{environmentId}/allocation/allocate
- POST /api/environment/{environmentId}/allocation/unallocate
- POST /api/environment/{environmentId}/allocation/reallocate
- POST /api/environment/{environmentId}/allocation/consume
- POST /api/environment/{environmentId}/allocation/query

#### <a name="allocate"></a>Распределить

Вызовите API `Allocate` для распределения продукта с отдельными аналитиками. Вот схема для текста запроса.

```json
{
    "id": "string",
    "productId": "string",
    "dimensionDataSource": "string",
    "targetGroups": {
        "groupA": "string",
        "groupB": "string",
        "groupC": "string"
    },
    "quantity": 0,
    "organizationId": "string",
    "dimensions": {
        "dimension1": "string",
        "dimension2": "string",
        "dimension3": "string"
    }
}
```

Например, необходимо распределить количество 10 для продукта *Велосипед*, сайта *1*, местоположения *11*, цвета *красный*, канала *Интернет*, группы клиентов *VIP* и региона *США*. Чтобы выполнить это распределение, можно выполнить вызов, который имеет следующее содержание текста.

```json
{
    "id": "???",
    "productId": "Bike",
    "targetGroups": {
        "channel": "Online",
        "customerGroup": "VIP",
        "region": "US"
    },
    "quantity": 10,
    "organizationId": "usmf",
    "dimensions": {
        "siteId": "1",
        "locationId": "11",
        "colorId": "red"
    }
}
```

Количество должно быть всегда больше 0 (нуля).

#### <a name="unallocate"></a>Не распределять

Используйте API `Unallocate` для сторнирования операции `Allocate`. Отрицательное количество в операции `Allocate` не разрешено. Текст `Unallocate` совпадает с текстом `Allocate`.

#### <a name="reallocate"></a>Перераспределить

Используйте API `Reallocate` для перемещения некоторого распределенного количества в другую комбинацию группы. Вот схема для текста запроса.

```json
{
    "id": "string",
    "productId": "string",
    "dimensionDataSource": "string",
    "sourceGroups": {
        "groupA": "string",
        "groupB": "string",
        "groupC": "string"
    },
    "targetGroups": {
        "groupD": "string",
        "groupE": "string",
        "groupF": "string"
    },
    "quantity": 0,
    "organizationId": "string",
    "dimensions": {
        "dimension1": "string",
        "dimension2": "string",
        "dimension3": "string"
    }
}
```

Например, можно переместить два велосипеда с аналитиками \[сайт = 1, местоположение = 11, цвет = красный\] из группы распределения \[Интернет, VIP, США\] в группу распределения \[Интернет, VIP, ЕС\], вызвав API `Reallocate` и указав следующий текст.

```json
{
    "id": "???",
    "productId": "Bike",
    "sourceGroups": {
        "channel": "Online",
        "customerGroup": "VIP",
        "region": "US"
    },
    "targetGroups": {
        "channel": "Online",
        "customerGroup": "VIP",
        "region": "EU"
    },
    "quantity": 2,
    "organizationId": "usmf",
    "dimensions": {
        "siteId": "1",
        "locationId": "11",
        "colorId": "red"
    }
}
```

#### <a name="consume"></a>Потребление

Используйте API `Consume` для разноски количества потребления в соответствии с распределением. Например, этот API можно использовать для перемещения распределенного количества по некоторым реальным мерам. Вот схема для текста запроса.

```json
{
    "id": "string",
    "productId": "string",
    "dimensionDataSource": "string",
    "targetGroups": {
        "groupA": "string",
        "groupB": "string",
        "groupC": "string"
    },
    "quantity": 0,
    "organizationId": "string",
    "dimensions": {
        "dimension1": "string",
        "dimension2": "string",
        "dimension3": "string"
    },
    "physicalMeasures": {
        "datasource1": {
            "measure": "string" // Addition or Subtraction
        }
    }
}
```

Например, имеется восемь распределенных велосипедов с аналитиками \[сайт = 1, местоположение = 11, цвет = красный\] для группы распределения \[Интернет, VIP, США\]. Используется следующая формула "доступно для распределения":

`@iv.@available_to_allocate` = `fno.onordered` + `pos.inbound` – `@iv.@allocated`

Восемь велосипедов распределяются из меры `pos.inbound`.

После этого три велосипеда продаются, и они берутся из пула распределения. Чтобы зарегистрировать это перемещение, можно выполнить вызов, который имеет следующий текст запроса.

```json
{
    "id": "???",
    "organizationId": "usmf",
    "productId": "Bike",
    "dimensions": {
        "siteId": "1",
        "locationId": "11",
        "colorId": "red"
    },
    "targetGroups": {
        "channel": "Online",
        "customerGroup": "VIP",
        "region": "US"
    },
    "quantity": 3,
    "physicalMeasures": {
        "pos": {
            "inbound": "Subtraction"
        }
    }
}
```

После этого вызова распределенное количество для продукта будет уменьшено на 3. Кроме того, видимость запасов создаст событие изменения запасов в наличии, где `pos.inbound` = *-3*. В качестве альтернативы можно сохранить значение `pos.inbound` без изменений и потребить распределенное количество. Однако в этом случае необходимо либо создать другую физическую меру для сохранения потребленных количеств, либо использовать предопределенную меру `@iv.@consumed`.

Обратите внимание, что в этом запросе физическая мера, используемая в тексте запроса для потребления, должна использовать противоположный тип модификатора (сложение или вычитание) в сравнении с типом модификатора, используемым в рассчитываемой мере. Таким образом, в тексте для потребления `iv.inbound` имеет значение `Subtraction`, а не `Addition`.

Источник данных `fno`не может использоваться в тексте для потребления, так как всегда подчеркивалось, что видимость запасов не может изменить никакие данные для источника данных `fno`. Поток данных является однонаправленным, что означает, что все изменения количества для источника данных `fno` должны поступать из среды Supply Chain Management.

#### <a name="consume-as-a-soft-reservation"></a><a name="consume-to-soft-reserved"></a>Потребление в качестве предварительного резервирования

API-интерфейс `Consume` может также потреблять распределенное количество в качестве предварительного резервирования. В этом случае операция `Consume` приведет к уменьшению распределенного количества, а затем выполнит предварительное резервирование для этого количества. Для использования этого подхода необходимо также использовать функцию [предварительное резервирование](inventory-visibility-reservations.md) видимости запасов.

Например, вы установили модификатор предварительного резервирования (меру) как `iv.softreserved`. Для рассчитанной меры "доступно для резервирования" используется следующая формула:

`iv.available_to_reserve` = `fno.onordered` + `pos.inbound` – `iv.softreserved`

Чтобы использовать эту настройку с функцией распределения, необходимо добавить `@iv.@allocated` в `iv.available_to_reserve`, чтобы создать следующую формулу:

`iv.available_to_reserve` = `fno.onordered` + `pos.inbound` – `iv.softreserved` – `@iv.@allocated`

Затем обновите `@iv.@available_to_allocate` до того же значения.

Если необходимо потребить количество 3 и непосредственно зарезервировать это количество, можно выполнить вызов со следующим текстом запроса.

```json
{
    "id": "???",
    "organizationId": "usmf",
    "productId": "Bike",
    "dimensions": {
        "siteId": "1",
        "locationId": "11",
        "colorId": "red"
    },
    "targetGroups": {
        "channel": "Online",
        "customerGroup": "VIP",
        "region": "US"
    },
    "quantity": 3,
    "physicalMeasures": {
        "iv": {
            "softreserved": "Addition"
        }
    }
}
```

Обратите внимание, что данном запросе `iv.softreserved` имеет значение `Addition`, а не `Subtraction`.

#### <a name="query"></a>Запрос

Используйте API `Query` для получения сведений о распределении для некоторых продуктов. Можно использовать фильтры аналитик и фильтры групп распределения для сужения результатов. Аналитики должны точно соответствовать тому, что необходимо получить, например, \[сайт = 1, местоположение = 11\] будет иметь несвязанные результаты по сравнению с \[сайт = 1, местоположение = 11, цвет = красный\].

```json
{
    "productId": "string",
    "organizationId": "string",
    "dimensions": {
        "dimension1": "string",
        "dimension2": "string",
        "dimension3": "string"
    },
    "groups": {
        "additionalProp1": "string",
        "additionalProp2": "string",
        "additionalProp3": "string"
    },
}
```

Например, используйте \[сайт = 1, местоположение = 11, цвет = красный\] и пустые поля группы, чтобы получить все записи распределения:

```json
{
    "organizationId": "usmf",
    "productId": "Bike",
    "dimensions": {
        "siteId": "1",
        "locationId": "11",
        "colorId": "red"
    },
    "groups": {
        "channel": "Online",
        "customerGroup": "VIP",
        "region": "US"
    },
}
```

Используйте \[сайт = 1, местоположение = 11, цвет = красный\] и группы \[каналы = Интернет, группа клиентов = VIP, регион = США\], чтобы получить записи распределения для этой группы:

```json
{
    "organizationId": "usmf",
    "productId": "Bike",
    "dimensions": {
        "siteId": "1",
        "locationId": "11",
        "colorId": "red"
    },
    "groups": {
        "channel": "Online",
        "customerGroup": "VIP",
        "region": "US"
    },
}
```

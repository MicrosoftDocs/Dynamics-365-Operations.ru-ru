---
title: "Синхронизация заголовков и строк заказов на продажу из Finance and Operations в Sales"
description: "В этой теме рассматриваются шаблоны и базовые задачи, которые используются для синхронизации заголовков и строк заказов на продажу из Microsoft Dynamics 365 for Finance and Operations, Enterprise Edition с Microsoft Dynamics 365 for Sales."
author: ChristianRytt
manager: AnnBe
ms.date: 10/26/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-applications
ms.technology: 
ms.search.form: 
audience: Application User, IT Pro
ms.reviewer: yuyus
ms.search.scope: Core, Operations
ms.custom: 
ms.assetid: 
ms.search.region: global
ms.search.industry: 
ms.author: crytt
ms.dyn365.ops.version: July 2017 update
ms.search.validFrom: 2017-07-8
ms.translationtype: HT
ms.sourcegitcommit: 2771a31b5a4d418a27de0ebe1945d1fed2d8d6d6
ms.openlocfilehash: c7b2ff6430e99661ee284f65089086df9fa5a1ad
ms.contentlocale: ru-ru
ms.lasthandoff: 11/03/2017

---

# <a name="synchronize-sales-order-headers-and-lines-from-finance-and-operations-to-sales"></a>Синхронизация заголовков и строк заказов на продажу из Finance and Operations в Sales

[!include[banner](../includes/banner.md)]

В этой теме рассматриваются шаблоны и базовые задачи, которые используются для синхронизации заголовков и строк заказов на продажу из Microsoft Dynamics 365 for Finance and Operations, Enterprise Edition с Microsoft Dynamics 365 for Sales. 

## <a name="template-and-tasks"></a>Шаблон и задачи

Следующие шаблоны и базовые задачи используются для синхронизации заголовков и строк заказов на продажу из Finance and Operations в Sales:

- **Имя шаблона в интеграции данных** 

    - Заказы на продажу (из Fin and Ops в Sales)
    
- **Имена задач в проекте интеграции данных**

    - OrderHeader
    - OrderLine

Задачи синхронизации, которые необходимо выполнить перед синхронизацией заголовков и строк накладных по продажам:

- Продукты (из Fin and Ops в Sales)
- Счета (из Sales в Fin and Ops) (если используются)
- Из контактов в клиенты (из Sales в Fin and Ops) (если используются)

## <a name="entity-set"></a>Набор объектов

| Finance and Operations |    Common Data Service (CDS)         |     Прод.      |
|------------------------|----------------|----------------|
| Заголовки заказов на продажу CDS| SalesOrder     | SalesOrders |
| Строки заказа на продажу CDS  | SalesOrderLine | SalesOrderDetails|

## <a name="entity-flow"></a>Поток объектов

Заказы на продажу создаются в Finance and Operations и синхронизируются в Sales.

Фильтры в шаблоне позволяют гарантировать, что в синхронизацию включаются только необходимые заказы на продажу:

- И оформление заказа, и выставление накладной клиенту, указанному в заказе на поставку, которые берут начало в Sales, будут включаться в синхронизацию. В Finance and Operations поля **OrderingCustomerIsExternallyMaintained** и **InvoiceCustomerIsExternallyMaintained** используются для отслеживания синхронизации в информационных объектах.

- **Заказ на продажу** в Finance and Operations должен быть подтвержден. С Sales синхронизируются только подтвержденные заказы на продажу или заказы на продажу с более высоким статусом обработки, например "Отгружено" или "Выставлена накладная".

- После создания или изменения заказа на продажу необходимо выполнить в Finance and Operations пакетное задание **Рассчитать итоги продаж**. Синхронизироваться в CDS и Sales будут только заказы на продажу с рассчитанными итогами продаж.

> [!NOTE]
> Налоги, связанные с суммами в **заголовке заказа на продажу**, в настоящее время не включаются в синхронизацию из Finance and Operations в Sales. Это связано с тем, что в Sales не поддерживается налоговая информация на уровне заголовка. Налоги, связанные с суммами на уровне строки, включаются.

## <a name="prospect-to-cash-solution-for-sales"></a>Решение "Перспективный клиент в наличные деньги" для Sales

В объект **Заказ** добавляются новые поля и отображаются на странице:

- **Хранится во внешней системе** — имеет значение **Да**, когда заказ поступает из Finance and Operations.

- **Состояние обработки** — используется для отображения статуса обработки заказа в Finance and Operations. Возможные значения:

    - Активен
    - Подтверждено
    - Отборочная накладная
    - Выставлено накладных
    - Скомплектовано
    - Частично скомплектовано
    - Частично упаковано
    - Отгружено
    - Частично отправлено
    - Частично выставлен счет
    - Отменено

Параметр **Все продукты хранятся во внешней системе** используется в других сценариях с заказами на продажу (при синхронизации из Sales в Finance and Operation sync) для отслеживания того, состоит ли заказ на продажу исключительно из **продуктов, хранящихся во внешней системе** (в этом случае ведение продуктов осуществляется в Finance and Operations). Это гарантирует, что вы не будете пытаться синхронизировать строки заказов на продажу с продуктами, которые неизвестны Finance and Operations.
 
Кнопки **Создать накладную**, **Отменить заказ**, **Пересчитать**, **Получить продукты** и **Искать адрес** на странице **Заказ на продажу** для продуктов, хранящихся во внешней системе, скрываются, потому что накладные будут создаваться в Finance and Operations и синхронизироваться в Sales. Страница заказа недоступна для редактирования, потому что информация заказа на продажу будет синхронизироваться из Finance and Operations.
 
**Статус заказа на продажу** будет оставаться активным, чтобы гарантировать, что изменения из Finance and Operations будут передаваться в **заказ на продажу** в Sales. Это обеспечивается установкой **Statecode [Статус]** по умолчанию в значение **Active** в проекте интеграции данных.

## <a name="preconditions-and-mapping-setup"></a>Предварительные условия и настройка сопоставления 

Перед синхронизацией заказов на продажу необходимо задать в системах следующие параметры:

### <a name="setup-in-sales"></a>Настройка в Sales

- Убедитесь в наличии разрешений для группы, которой назначен пользователь (из вашего **набора подключений** Sales). Если вы используете демонстрационные данные, обычно пользователь — но не группа — имеет доступ администратора. Без этого при запуске проекта из интегратора данных вы получите сообщение об ошибке, что рабочая группа-участник отсутствует. 

    - Выбрав **Параметры** > **Безопасность** > **Группы**, выберите необходимую группу, нажмите **Управление ролями** и выберите роль с требуемыми разрешениями, например "Системный администратор".

- Выбрав **Параметры** > **Администрирование** > **Параметры системы** > **Продажи** убедитесь, что для параметра **Использовать системный расчет цен** установлено значение **Да**. 

- Выбрав **Параметры** > **Администрирование** > **Параметры системы** > **Продажи** убедитесь, что для параметра **Способ расчета скидки** установлено значение **Позиция строки**. 

### <a name="setup-in-finance-and-operations"></a>Настройка в Finance and Operations

Задайте **Продажи и маркетинг** > **Периодические задачи** > **Рассчитать итоги продаж** для выполнения в качестве пакетного задания, установив параметр **Рассчитанные итоги для заказов на продажу** в значение **Да**. Это важно, потому что синхронизироваться в CDS и Sales будут только заказы на продажу с рассчитанными итогами продаж. Частота пакетного задания должна соответствовать частоте синхронизации заказов на продажу.

### <a name="setup-in-the-data-integration-project"></a>Настройка в проекте интеграции данных

#### <a name="salesheader-task"></a>Задача SalesHeader

- Обновите сопоставление для кода организации CDS **Источник** > **CDS**.

    - Значение шаблона по умолчанию для **Account_Organization_OrganizationId** — ORG001.
    - Значение шаблона по умолчанию для **InvoiceAccount_Organization_OrganizationId** — ORG001.
    - Значение шаблона по умолчанию для **Organization_OrganizationId** — ORG001.

- Убедитесь, что существует необходимое сопоставление в **Источник** > **CDS для InvoiceCountryRegionId с BillingAddress_Country** и для **DeliveryCountryRegionId с DeliveryAddress_Country**.

    - Значение шаблона — **ValueMap** с количеством сопоставленных стран.

- Для создания заказов в Sales требуется **прайс-лист**. Измените **ValueMap** в **CDS** > **Место назначения** для **pricelevelid.name [имя прайс-листа]** на **прайс-лист**, используемый в Sales для данной валюты. Можно использовать либо **прайс-лист** по умолчанию для одной валюты, либо **ValueMap** если у вас есть **прайс-листы** в нескольких валютах.
    
    - Значение по умолчанию шаблона для **pricelevelid.name [имя прайс-листа]** — CRM Service USA (sample). 

#### <a name="salesline-task"></a>Задача SalesLine

- Обновите сопоставление для кода организации CDS **Источник** > **CDS**. 
    
    - Значение шаблона по умолчанию для **SalesOrder_Organization_OrganizationId** — ORG001.
    - Значение шаблона по умолчанию для **Product_Organization_OrganizationId** — ORG001.

- Убедитесь, что в **Источник** > **CDS** существует необходимое сопоставление для **DeliveryCountryRegionId** с **DeliveryAddress_Country**.

    - Значение шаблона — **ValueMap** с количеством сопоставленных стран.
    
- Убедитесь, что в **Источник** > **Сопоставление CDS** существует необходимая **ValueMap** для **SalesUnitSymbol** в Finance and Operations.

    - Значение шаблона с **ValueMap** определено для **SalesUnitSymbol с Quantity_UOM**.

## <a name="template-mapping-in-data-integrator"></a>Сопоставление шаблона в интеграторе данных

> [!NOTE]
> Поля **Условия оплаты**, **Условия фрахта**, **Условия поставки**, **Способ доставки** и **Режим доставки** не являются частью сопоставлений по умолчанию. Чтобы сопоставить эти поля, необходимо настроить преобразование значений, характерное для данных в организациях, между которыми синхронизируется объект.

На следующем рисунке показан пример сопоставления шаблона в интеграторе данных.

### <a name="orderheader"></a>OrderHeader

![Сопоставление шаблона в интеграторе данных](./media/sales-order-template-mapping-data-integrator-1.png)

![Сопоставление шаблона в интеграторе данных](./media/sales-order-template-mapping-data-integrator-2.png)

### <a name="orderline"></a>OrderLine

![Сопоставление шаблона в интеграторе данных](./media/sales-order-template-mapping-data-integrator-3.png)

![Сопоставление шаблона в интеграторе данных](./media/sales-order-template-mapping-data-integrator-4.png)


## <a name="related-topics"></a>Связанные разделы

[Синхронизация продуктов из Finance and Operations с продуктами в Sales](products-template-mapping.md)

[Синхронизация организаций из Finance and Operations с клиентами в Sales](accounts-template-mapping.md)

[Синхронизация контактов из Finance and Operations с контактами в Sales](contacts-template-mapping.md)

[Синхронизация заголовков и строк предложений по продажам из Sales с Finance and Operations](sales-quotation-template-mapping.md)

[Синхронизация заголовков и строк счетов продажи из Finance and Operations в Sales](sales-invoice-template-mapping.md)



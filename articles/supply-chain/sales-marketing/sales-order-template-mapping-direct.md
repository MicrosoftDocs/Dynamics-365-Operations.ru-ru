---
title: "Синхронизация заголовков и строк заказов на продажу непосредственно из Finance and Operations в Sales"
description: "В этой теме рассматриваются шаблоны и базовые задачи, которые используются для синхронизации заголовков и строк заказа на продажу непосредственно из Microsoft Dynamics 365 for Finance and Operations, Enterprise Edition в Microsoft Dynamics 365 for Sales."
author: ChristianRytt
manager: AnnBe
ms.date: 10/25/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-applications
ms.technology: 
ms.search.form: 
audience: Application User, IT Pro
ms.reviewer: yuyus
ms.search.scope: Core, Operations
ms.custom: 
ms.assetid: 
ms.search.region: global
ms.search.industry: 
ms.author: crytt
ms.dyn365.ops.intro: July 2017 update
ms.search.validFrom: 2017-07-8
ms.translationtype: HT
ms.sourcegitcommit: 2771a31b5a4d418a27de0ebe1945d1fed2d8d6d6
ms.openlocfilehash: cc0be50552ae680ba5291e72b7c482ee67e1e70e
ms.contentlocale: ru-ru
ms.lasthandoff: 11/03/2017

---

# <a name="synchronize-sales-order-headers-and-lines-directly-from-finance-and-operations-to-sales"></a>Синхронизация заголовков и строк заказов на продажу непосредственно из Finance and Operations в Sales

[!include[banner](../includes/banner.md)]

В этой теме рассматриваются шаблоны и базовые задачи, которые используются для синхронизации заголовков и строк заказа на продажу непосредственно из Microsoft Dynamics 365 for Finance and Operations, Enterprise Edition в Microsoft Dynamics 365 for Sales.

## <a name="data-flow-in-prospect-to-cash"></a>Поток данных в решение "Перспективный клиент в наличные деньги"

Решение "Перспективный клиент в наличные деньги" использует функцию интеграции данных для синхронизации данных между экземплярами Finance and Operations и Sales. Шаблоны "Перспективный клиент в наличные деньги", доступные в компоненте интеграции данных, обеспечивают движение данных об организациях, контактах, продуктах, предложениях по продажам, заказах на продажу и накладных по продажам между Finance and Operations и Sales. На следующем рисунке показано, как данные синхронизируются между Finance and Operations и Sales.

[![Поток данных в решение "Перспективный клиент в наличные деньги"](./media/prospect-to-cash-data-flow.png)](./media/prospect-to-cash-data-flow.png)

## <a name="templates-and-tasks"></a>Шаблоны и задачи

Чтобы получить доступ к доступным шаблонам, откройте [Центр администрирования PowerApps](https://preview.admin.powerapps.com/dataintegration). Выберите **Проекты**, затем в правом верхнем углу выберите **Создать проект**, чтобы выбрать общие шаблоны.

Следующий шаблон и базовые задачи используются для синхронизации заголовков и строк заказов на продажу из Finance and Operations в Sales:

- **Имя шаблона в интеграции данных:** "Заказы на продажу (из Fin and Ops в Sales) — напрямую"
- **Имена задач в проекте интеграции данных:**

    - OrderHeader
    - OrderLine

Перед синхронизацией заголовков и строк накладных по продаже требуются следующие задачи синхронизации:

- Продукты (из Fin and Ops в Sales) — напрямую
- Счета (из Sales в Fin and Ops) — напрямую (если используются)
- Из контактов в клиенты (из Sales в Fin and Ops) - напрямую (если используются)

## <a name="entity-set"></a>Набор объектов

| Finance and Operations  | Прод.             |
|-------------------------|-------------------|
| Заголовки заказов на продажу CDS | SalesOrders       |
| Строки заказа на продажу CDS   | SalesOrderDetails |

## <a name="entity-flow"></a>Поток объектов

Заказы на продажу создаются в Finance and Operations и синхронизируются в Sales.

Фильтры в шаблоне позволяют помочь гарантировать, что в синхронизацию включаются только необходимые заказы на продажу:

- В заказе на продажу как заказывающий клиент, так и клиент для выставления накладной, которые были взяты из Sales, будут включены в синхронизацию. В Finance and Operations поля **OrderingCustomerIsExternallyMaintained** и **InvoiceCustomerIsExternallyMaintained** используются для отслеживания синхронизации в информационных объектах.
- Заказ на продажу в Finance and Operations должен быть подтвержден. С Sales синхронизируются только подтвержденные заказы на продажу или заказы на продажу с более высоким статусом обработки, например **Отгружено** или **Выставлена накладная**.
- После того, как заказ на продажу создан или изменен, необходимо выполнить в Finance and Operations пакетное задание **Рассчитать итоги продаж**. Только заказы на продажу, для которых рассчитаны итоговые значения продаж, будут синхронизироваться с Sales.

> [!NOTE]
> В настоящее время налоги, связанные с суммами в заголовке заказа на продажу, не включаются в синхронизацию из Finance and Operations в Sales. Sales не поддерживает налоговую информацию на уровне заголовка. Однако налог, который относится к расходам на уровне строки, включается в синхронизацию.

## <a name="prospect-to-cash-solution-for-sales"></a>Решение "Перспективный клиент в наличные деньги" для Sales

В сущность **Заказ** добавлены новые поля, которые отображаются на странице:

- **Хранится во внешней системе** — задайте значение **Да**, когда заказ поступает из Finance and Operations.
- **Состояние обработки** — в этом поле отображается статус обработки заказа в Finance and Operations. Доступны следующие значения:

    - Активен
    - Подтверждено
    - Отборочная накладная
    - Выставлено накладных
    - Скомплектовано
    - Частично скомплектовано
    - Частично упаковано
    - Отгружено
    - Частично отправлено
    - Частично выставлен счет
    - Отменено

Параметр **Все продукты хранятся во внешней системе** используется в других сценариях с заказами на продажу (например, при синхронизации из Sales в Finance and Operation) для согласованного отслеживания того, состоит ли заказ на продажу исключительно из продуктов, хранящихся во внешней системе. Если заказ на продажу состоит исключительно из управляемых извне продуктов, продукты управляются в Finance and Operations. Эта настройка помогает гарантировать, что вы не будете пытаться синхронизировать строки заказа на продажу, содержащие продукты, которые неизвестны для Finance and Operations.

Кнопки **Создать накладную**, **Отменить заказ**, **Пересчитать**, **Получить продукты** и **Искать адрес** на странице **Заказ на продажу** скрываются для заказов, хранящихся во внешней системе, потому что накладные будут создаваться в Finance and Operations и синхронизироваться в Sales. Страница заказа не может редактироваться, потому что информация заказа на продажу будет синхронизироваться из Finance and Operations.

Статус заказа на продажу будет оставаться **Активный**, чтобы помочь гарантировать, что изменения из Finance and Operations будут передаваться в заказ на продажу в Sales. Для управления таким поведением задайте для **Statecode \[Статус\]** значение по умолчанию **Active** в проекте интеграции данных.

## <a name="preconditions-and-mapping-setup"></a>Предварительные условия и настройка сопоставления

Перед синхронизацией заказов на продажу необходимо обновить следующие параметры в системах.

### <a name="setup-in-sales"></a>Настройка в Sales

- Убедитесь, что настроены разрешения для группы, которой назначен пользователь, из вашего набора подключений Sales. Если вы используете демонстрационные данные, обычно пользователь имеет доступ администратора, но группа не имеет доступа администратора. Если группа также не имеет доступа администратора при запуске проекта из интеграции данных, вы получите сообщение об ошибке, в котором будет указано, что рабочая группа-участник отсутствует.

    Откройте **Параметры** > **Безопасность** > **Группы**, выберите необходимую группу, выберите **Управление ролями** и выберите роль с требуемыми разрешениями, например **Системный администратор**.

- Откройте **Параметры** > **Администрирование** > **Параметры системы** > **Продажи** и убедитесь, что используются следующие настройки:

    - Для параметра **Использовать системный расчет цен** установлено значение **Да**.
    - Для параметра **Способ расчета скидки** установлено значение **Номенклатура строки**.

### <a name="setup-in-finance-and-operations"></a>Настройка в Finance and Operations

Откройте **Продажи и маркетинг** > **Периодические задачи** > **Рассчитать итоги продаж** и настройте задание для выполнения в качестве пакетного задания. Задайте для параметра **Рассчитанные итоги для заказов на продажу** значение **Да**. Этот шаг важен, так как только заказы на продажу, для которых рассчитаны итоговые значения продаж, будут синхронизироваться с Sales. Частота пакетного задания должна соответствовать частоте синхронизации заказов на продажу.

### <a name="setup-in-the-data-integration-project"></a>Настройка в проекте интеграции данных

#### <a name="salesheader-task"></a>Задача SalesHeader

- Убедитесь, что существует необходимое сопоставление для **InvoiceCountryRegionId** в **BillingAddress\_Country** и для **DeliveryCountryRegionId** в **DeliveryAddress\_Country**.

    Значение шаблона является схемой значений, где сопоставляются нескольких стран или регионов.

- Для создания заказов в Sales требуется прайс-лист. Обновите схему сопоставления для **pricelevelid.name \[имя прайс-листа\]** на прайс-лист, используемый в Sales для данной валюты. Можно использовать прайс-лист по умолчанию для одной валюты. Если имеются прайс-листы в нескольких валютах, можно использовать схему сопоставления.

    Значение по умолчанию шаблона для **pricelevelid.name \[Имя прайс-листа\]** — **CRM Service USA (sample)**.

#### <a name="salesline-task"></a>Задача SalesLine

- Убедитесь в наличии необходимого сопоставления для **DeliveryCountryRegionId** в **DeliveryAddress\_Country**.

    Значение шаблона является схемой значений, где сопоставляются нескольких стран или регионов.

- Убедитесь, что существует требуемая схема сопоставления значений для **SalesUnitSymbol** в Finance and Operations.

    Значение шаблона, которое имеет сопоставление значений, определено для **SalesUnitSymbol** в **Quantity\_UOM**.

## <a name="template-mapping-in-data-integration"></a>Сопоставление шаблона в интеграции данных

> [!NOTE]
> Поля **Условия оплаты**, **Условия фрахта**, **Условия поставки**, **Способ доставки** и **Режим доставки** не включены в сопоставления по умолчанию. Чтобы сопоставить эти поля, необходимо настроить преобразование значений, характерное для данных в организациях, между которыми синхронизируется объект.

На следующем рисунке показан пример сопоставления шаблона в интеграции данных. 

> [!NOTE]
> Сопоставление показывает, какие данные полей будут синхронизированы из Sales в Finance and Operations.

### <a name="orderheader"></a>OrderHeader

![Сопоставление шаблона в интеграторе данных](./media/sales-order-direct-template-mapping-data-integrator-1.png)

### <a name="orderline"></a>OrderLine

![Сопоставление шаблона в интеграторе данных](./media/sales-order-direct-template-mapping-data-integrator-2.png)



## <a name="related-topics"></a>Связанные разделы

[Решение "Перспективный клиент в наличные деньги"](prospect-to-cash.md)

[Синхронизация организаций непосредственно из Sales с клиентами в Finance and Operations](accounts-template-mapping-direct.md)

[Прямая синхронизация продуктов из Finance and Operations с продуктами в Sales](products-template-mapping-direct.md)

[Синхронизация контактов непосредственно из Sales с контактами и клиентами в Finance and Operations](contacts-template-mapping-direct.md)

[Синхронизация заголовков и строк счетов продажи непосредственно из Finance and Operations в Sales](sales-invoice-template-mapping-direct.md)





---
title: "Синхронизация заголовков и строк предложений по продажам напрямую из Sales с Finance and Operations"
description: "В этой теме рассматриваются шаблоны и базовые задачи, которые используются для синхронизации заголовков и строк предложений по продаже непосредственно из Microsoft Dynamics 365 for Sales в Microsoft Dynamics 365 for Finance and Operations."
author: ChristianRytt
manager: AnnBe
ms.date: 11/14/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-applications
ms.technology: 
ms.search.form: 
audience: Application User, IT Pro
ms.reviewer: josaw
ms.search.scope: Core, Operations
ms.custom: 
ms.assetid: 
ms.search.region: global
ms.search.industry: 
ms.author: crytt
ms.dyn365.ops.version: July 2017 update
ms.search.validFrom: 2017-07-8
ms.translationtype: HT
ms.sourcegitcommit: a0739304723d19b910388893d08e8c36a1f49d13
ms.openlocfilehash: 97536c27dea113cc3c019473f22d1925e7617f8f
ms.contentlocale: ru-ru
ms.lasthandoff: 03/26/2018

---

# <a name="synchronize-sales-quotation-headers-and-lines-directly-from-sales-to-finance-and-operations"></a>Синхронизация заголовков и строк предложений по продажам напрямую из Sales с Finance and Operations

[!include [banner](../includes/banner.md)]

В этой теме рассматриваются шаблоны и базовые задачи, которые используются для синхронизации заголовков и строк предложений по продаже непосредственно из Microsoft Dynamics 365 for Sales в Microsoft Dynamics 365 for Finance and Operations.

> [!NOTE]
> Перед использованием решения "Перспективный клиент в наличные деньги" следует ознакомиться с разделом [Интеграция данных Dynamics 365](/common-data-service/entity-reference/dynamics-365-integration).

## <a name="template-and-tasks"></a>Шаблон и задачи

Следующий шаблон и базовые задачи используются для синхронизации заголовков и строк предложений по продажам напрямую из Sales с Finance and Operations:

- **Имя шаблона в интеграции данных:** "Предложения по продажам (из Sales в Fin and Ops) — напрямую"
- **Имена задач в проекте интеграции данных:**

    - QuoteHeader
    - QuoteLine

Перед синхронизацией заголовков и строк предложений по продажам требуются следующие задачи синхронизации:

- Продукты (из Fin and Ops в Sales) — напрямую
- Счета (из Sales в Fin and Ops) — напрямую (если используются)
- Из контактов в клиенты (из Sales в Fin and Ops) - напрямую (если используются)

## <a name="entity-set"></a>Набор объектов

| Прод.        | Finance and Operations     |
|--------------|----------------------------|
| Цитаты       | Заголовок предложения по продажам CDS |
| QuoteDetails | Строки предложения по продаже CDS  |

## <a name="entity-flow"></a>Поток объектов

Предложения по продажам создаются в Sales и синхронизируются с Finance and Operations.

Предложения по продажам из Sales синхронизируются, только если выполняются следующие условия:

- Все предлагаемые продукты в предложении по продаже управляются извне.
- После нажатия кнопки **Активировать предложение** это предложение по продажам становится активным.

## <a name="prospect-to-cash-solution-for-sales"></a>Решение "Перспективный клиент в наличные деньги" для Sales

Добавлено поле **Имеет только управляемые извне продукты** к объекту **Предложение по продаже** для постоянного отслеживания того, состоит ли предложение по продаже полностью из управляемых извне продуктов. Если предложение по продаже содержит только управляемые извне продукты, продукты управляются в Finance and Operations. Это поведение помогает гарантировать, что вы не будете пытаться синхронизировать строки предложения по продаже, которые содержат продукты, неизвестные для Finance and Operations.

Все предлагаемые продукты в предложении по продажам обновляются сведениями **Имеет только управляемые извне продукты** из заголовка предложения по продажам. Эти сведения находятся в поле **Предложения имеет только управляемые извне продукты** в объекте **QuoteDetails**.

Скидка может быть добавлена для продукта предложения с расценками и будет синхронизирована с Finance and Operations. Поля **Скидка**, **Расходы** и **Налог** в заголовке управляются настройкой в Finance and Operations. В настоящее время эта настройка не поддерживает сопоставление интеграции. В текущем дизайне поля **Цена**, **Скидка**, **Расходы** и **Налог** управляются и обрабатываются в Finance and Operations.

В Sales решение делает следующие поля доступными только для чтения, поскольку значения не синхронизируются с Finance and Operations:

- Доступные только для чтения поля в заголовке предложения по продаже: **% скидки**, **Скидка** и **Сумма транспортировки**
- Поля только для чтения в продуктах предложения с расценками: **Налог**

## <a name="preconditions-and-mapping-setup"></a>Предварительные условия и настройка сопоставления

Перед синхронизацией предложений по продажам необходимо обновить следующие параметры:

### <a name="setup-in-sales"></a>Настройка в Sales

- Убедитесь, что настроены разрешения для группы, которой назначен пользователь, из вашего набора подключений в Sales. Если вы используете демонстрационные данные, обычно пользователь имеет доступ администратора, но группа не имеет доступа администратора. Если группа не имеет доступа администратора при запуске проекта из интеграции данных, вы получите сообщение об ошибке, в котором будет указано, что рабочая группа-участник отсутствует.

    Чтобы настроить разрешения для группы, откройте **Параметры** &gt; **Контроль доступа** &gt; **Группы** и выберите соответствующую группу. Выберите **Управление ролями**, выберите роль с требуемыми разрешениями, например **Системный администратор**.

- Откройте **Параметры** &gt; **Администрирование** &gt; **Параметры системы** &gt; **Продажи** и убедитесь, что используются следующие настройки:

    - Для параметра **Использовать системный расчет цен** установлено значение **Да**.
    - Для параметра **Способ расчета скидки** установлено значение **Номенклатура строки**.

### <a name="setup-in-the-data-integration-project"></a>Настройка в проекте интеграции данных

#### <a name="quoteheader"></a>QuoteHeader

- Убедитесь в наличии необходимого сопоставления для **Shipto\_country** в **DeliveryAddressCountryRegionISOCode**. В схеме значений можно определить значение по умолчанию, которое используется, если значение не заполнено. Просто оставьте левой сторону пустой, а с правой стороны задайте нужную страну или регион. Таким образом, нет необходимости вводить страну или регион для заказов внутри страницы.

    Значение шаблона является схемой значений, где сопоставляются нескольких стран или регионов, и где пустое значение равно значению **США**.

#### <a name="quoteline"></a>QuoteLine

- Убедитесь, что существует требуемая схема сопоставления значений для **SalesUnitSymbol** в Finance and Operations.
- Убедитесь в том, что требуемые единицы определены в Sales.

    Значение шаблона, которое имеет сопоставление значений, определено для **oumid.name** в **SalesUnitSymbol**.

- Дополнительно: можно добавить следующие сопоставления для гарантии того, что строки этого предложения по продажам будут импортироваться в Finance and Operations, если отсутствует информация по умолчанию от клиента или продукта:

    - **SiteId** — сайт необходим для создания предложений и строк заказов на продажу в Finance and Operations. Не существует значения шаблона по умолчанию для **SiteId**.
    - **WarehouseId** — склад необходим для обработки предложений и строк заказов на продажу в Finance and Operations. Не существует значения шаблона по умолчанию для **WarehouseId**.

## <a name="template-mapping-in-data-integrator"></a>Сопоставление шаблона в интеграторе данных

> [!NOTE]
> - Поля **Скидка**, **Расходы** и **Налог** управляются сложной настройкой в Finance and Operations. В настоящее время эта настройка не поддерживает сопоставление интеграции. В текущем дизайне поля **Цена**, **Скидка**, **Расходы** и **Налог** обрабатываются в Finance and Operations.
> - Поля **Условия оплаты**, **Условия фрахта**, **Условия поставки**, **Способ доставки** и **Режим доставки** не являются частью сопоставлений по умолчанию. Чтобы сопоставить эти поля, необходимо настроить преобразование значений, характерное для данных в организациях, между которыми синхронизируется объект.

На следующем рисунке показан пример сопоставления шаблона в интеграторе данных.

### <a name="quoteheader"></a>QuoteHeader

![Сопоставление шаблона в интеграторе данных](./media/sales-quotation-direct-template-mapping-data-integrator-1.png)

### <a name="quoteline"></a>QuoteLine

![Сопоставление шаблона в интеграторе данных](./media/sales-quotation-direct-template-mapping-data-integrator-2.png)

## <a name="related-topics"></a>Связанные разделы

[Решение "Перспективный клиент в наличные деньги"](prospect-to-cash.md)



---
title: "Синхронизация заказов на выполнение работ в Field Service с заказами на продажу в Finance and Operations"
description: "В этом разделе описываются шаблоны и базовые задачи, которые используются для синхронизации заказов на выполнение работ в Field Service с заказами на продажу в Finance and Operations."
author: ChristianRytt
manager: AnnBe
ms.date: 04/09/2018
ms.topic: article
ms.prod: 
ms.service: dynamics-ax-applications
ms.technology: 
ms.search.form: 
audience: Application User, IT Pro
ms.reviewer: yuyus
ms.search.scope: Core, Operations
ms.custom: 
ms.assetid: 
ms.search.region: global
ms.search.industry: 
ms.author: crytt
ms.dyn365.ops.version: July 2017 update
ms.search.validFrom: 2017-07-8
ms.translationtype: HT
ms.sourcegitcommit: 08cfd2cfa24bef0f0c92126f5d1052a12ceba37a
ms.openlocfilehash: 854240bef9d6193c8f0f608687b68e6842fe272c
ms.contentlocale: ru-ru
ms.lasthandoff: 04/11/2018

---

# <a name="synchronize-work-orders-in-field-service-to-sales-orders-in-finance-and-operations"></a>Синхронизация заказов на выполнение работ в Field Service с заказами на продажу в Finance and Operations

[!include[banner](../includes/banner.md)]

В этой теме обсуждаются шаблоны и базовые задачи, которые используются для синхронизации заказов на выполнение работ в Microsoft Dynamics 365 for Field Service с заказами на продажу в Microsoft Dynamics 365 for Finance and Operations.

[![Синхронизация бизнес-процессов между Finance and Operations и Field Service](./media/field-service-integration.png)](./media/field-service-integration.png)

В этом разделе описываются шаблоны и базовые задачи, которые используются для синхронизации заказов на выполнение работ в Field Service с заказами на продажу в Finance and Operations.

## <a name="templates-and-tasks"></a>Шаблоны и задачи

Следующие шаблоны и базовые задачи используются для выполнения синхронизации заказов на выполнение работ в Field Service с заказами на продажу в Finance and Operations.

### <a name="names-of-the-templates-in-data-integration"></a>Имена шаблонов в интеграции данных

Шаблон **Заказы на выполнение работ с заказами на продажу (Field Service с Fin and Ops)** используется для выполнения синхронизации.

### <a name="names-of-the-tasks-in-the-data-integration-project"></a>Имена задач в проекте интеграции данных

- WorkOrderHeader
- WorkOrderServiceLineEstimate
- WorkOrderServiceLineUsed
- WorkOrderProductLineEstimate
- WorkOrderProductLineUsed

Перед синхронизацией заголовков и строк заказов на продажу требуются следующие задачи синхронизации:

- Продукты Field Service (из Fin and Ops в Field Service)
- Организации (из Sales в Fin and Ops) — напрямую

## <a name="entity-set"></a>Набор объектов

| **Field Service** | **Finance and Operations** |
|-------------------------|-------------------------|
| msdyn_workorders        | Заголовки заказов на продажу CDS |
| msdyn_workorderservices | Строки заказа на продажу CDS   |
| msdyn_workorderproducts | Строки заказа на продажу CDS   |

## <a name="entity-flow"></a>Поток объектов

Заказы на выполнение работ создаются в Field Service. Если заказы на выполнение работ включают только продукты, поддерживаемые извне, и если значение **Статус заказа на выполнение работ** отличается от **Открыто — Не запланировано** и **Закрыт — Отменен**, заказы на выполнение работ могут быть синхронизированы с Finance and Operations через проект интеграции данных CDS. Обновления заказов на выполнение работ синхронизируются как заказы на продажу в Finance and Operations. Эти обновления включают в себя информацию о типе источника и статус.

## <a name="estimated-versus-used"></a>Ожидаемые и использованные

В Field Service продукты и услуги в заказах на выполнение работ могут иметь значения **Оценка** и **Использовано** для количеств и сумм. Однако в Finance and Operations заказы на продажу не имеют таких же понятий **Оценка** и **Использовано**. Для поддержки распределения продукта, который использует ожидаемое количество по заказу на продажу в Finance and Operations, но сохранить использованное количество, которое должно быть использовано и за которое должен быть выставлен счет, два набора задач синхронизируют продукты и услуги по заказу на выполнение работ. Один набор задач предназначен для значений **Оценка**, второй набор задач предназначен для значений **Использовано**.

Это поведение поддерживает сценарии, в которых оценочные значения используются для распределения или резервирования в Finance and Operations, тогда как использованные значения используются для потребления и выставления счета.

### <a name="estimated"></a>Оценочный

Для синхронизации строк продуктов значения **Оценочный** используются, когда значение **Статус строки** равно **Оценочный**, для параметра **Распределенный** установлено значение **Да**, а значение **Состояние системы** не равно **Закрыто — Разнесено**.

Для синхронизации строк услуг значения **Оценочный** используются, когда значение **Статус строки** равно **Оценочный**, а значение **Состояние системы** не равно **Закрыто — Разнесено**.

### <a name="used"></a>Использовано

Значения **Использовано** используются для потребления и выставления счетов. В этих случаях синхронизируются значения **Использовано**.

В следующей таблице приведен обзор различных комбинаций для строк продуктов.

| Состояние системы <br>(Field Service) | Состояние строки <br>(Field Service) | Распределенный <br>(Field Service) |Синхронизируемое значение <br>(Finance and Operations) |
|--------------------|-------------|-----------|---------------------------------|
| Открыто — Запланировано   | Оценочный   | Да       | Оценочный                       |
| Открыто — Запланировано   | Оценочный   | Нет        | Использовано                            |
| Открыто — Запланировано   | Использовано        | Да       | Использовано                            |
| Открыто — Запланировано   | Использовано        | Нет        | Использовано                            |
| Открыто — В работе | Оценочный   | Да       | Оценочный                       |
| Открыто — В работе | Оценочный   | Нет        | Использовано                            |
| Открыто — В работе | Использовано        | Да       | Использовано                            |
| Открыто — В работе | Использовано        | Нет        | Использовано                            |
| Открыто — Завершено   | Оценочный   | Да       | Оценочный                       |
| Открыто — Завершено   | Оценочный   | Нет        | Использовано                            |
| Открыто — Завершено   | Использовано        | Да       | Использовано                            |
| Открыто — Завершено   | Использовано        | Нет        | Использовано                            |
| Закрыто — Разнесено    | Оценочный   | Да       | Использовано                            |
| Закрыто — Разнесено    | Оценочный   | Нет        | Использовано                            |
| Закрыто — Разнесено    | Использовано        | Да       | Использовано                            |
| Закрыто — Разнесено    | Использовано        | Нет        | Использовано                            |

В следующей таблице приведен обзор различных комбинаций для строк услуг.

| Состояние системы <br>(Field Service) | Состояние строки <br>(Field Service) | Синхронизируемое значение <br>(Finance and Operations) |
|--------------------|-------------|-----------|
| Открыто — Запланировано   | Оценочный   | Оценочный |
| Открыто — Запланировано   | Использовано        | Использовано      |
| Открыто — В работе | Оценочный   | Оценочный |
| Открыто — В работе | Использовано        | Использовано      |
| Открыто — Завершено   | Оценочный   | Оценочный |
| Открыто — Завершено   | Использовано        | Использовано      |
| Закрыто — Разнесено    | Оценочный   | Использовано      |
| Закрыто — Разнесено    | Использовано        | Использовано      |

Управление синхронизацией значений **Оценочный** или значений **Использовано** осуществляется с помощью двух наборов задач для строк продуктов и строк услуг. Встроенные фильтры запускают правильную задачу, а соответствующее сопоставление помогает гарантировать, что синхронизируются правильные значения для **Ожидалось** и **Использовано**.

### <a name="example"></a>Пример

1. Заказ на выполнение работ создается и планируется в Field Service.

    Значение **Состояния системы** равно **Открыто — Запланировано**.

    - **Строка продукта:** Оценочное кол-во = 5 шт., Использованное кол-во = 0 шт., Состояние строки = Оценочный, Распределенный = Нет
    - **Строка услуги:** Оценочное кол-во = 2 часа, Использованное кол-во = 0 часов, Состояние строки = Оценочный

    В этом примере значение продукта **Использованное кол-во**, равное **0** (ноль), и значение услуги **Оценочное кол-во**, равное **2 ч**, синхронизируются с Finance and Operations.

2. Продукты распределяются в Field Service.

    Значение **Состояния системы** равно **Открыто — Запланировано**.

    - **Строка продукта:** Оценочное кол-во = 5 шт., Использованное кол-во = 0 шт., Состояние строки = Оценочный, Распределенный = Да
    - **Строка услуги:** Оценочное кол-во = 2 часа, Использованное кол-во = 0 часов, Состояние строки = Оценочный

    В этом примере значение продукта **Оценочное кол-во**, равное **5 шт.**, и значение услуги **Оценочное кол-во**, равное **2 ч**, синхронизируются с Finance and Operations.

3. Сервисный специалист начинает работу над заказом на выполнение работ и регистрирует расход материала 6.

    Значение **Состояния системы** равно **Открыто — В работе**.

    - **Строка продукта:** Оценочное кол-во = 5 шт., Использованное кол-во = 6 шт., Состояние строки = Использовано, Распределенный = Да
    - **Строка услуги:** Оценочное кол-во = 2 часа, Использованное кол-во = 0 часов, Состояние строки = Оценочный

    В этом примере значение продукта **Использованное кол-во**, равное **6**, и значение услуги **Оценочное кол-во**, равное **2 ч**, синхронизируются с Finance and Operations.

4. Сервисный специалист выполняет заказ на выполнение работ и регистрирует затраченное время 1,5 часа.

    Значение **Состояния системы** равно **Открыто — Завершено**.

    - **Строка продукта:** Оценочное кол-во = 5 шт., Использованное кол-во = 6 шт., Состояние строки = Использовано, Распределенный = Да
    - **Строка услуги:** Оценочное кол-во = 2 часа, Использованное кол-во = 1,5 часа, Состояние строки = Использовано

    В этом примере значение продукта **Использованное кол-во**, равное **6**, и значение услуги **Оценочное кол-во**, равное **1,5 ч**, синхронизируются с Finance and Operations.

## <a name="sales-order-origin-and-status"></a>Происхождение и статус заказа на продажу

### <a name="sales-origin"></a>Происхождение заказа на продажу

Для отслеживания заказов на продажу в Finance and Operations, источником которых были заказы на выполнение работ, можно создать происхождение продаж, где для параметра **Назначение типа источника** задано значение **Да**, а в поле **Тип источника продаж** задано значение **Интеграция заказов на выполнение работ**.

По умолчанию сопоставление выбирает происхождения продажи для типа происхождения продаж **Интеграция заказов на выполнение работ** для всех заказов на продажу, созданных из заказов на выполнение работ. Это поведение может быть полезно при работе с заказом на продажу в Finance and Operations. Необходимо убедиться, что заказы на продажу, созданные на основе заказов на выполнение работ, не синхронизируются обратно в Field Service как заказы на выполнение работ.

Сведения о том, как создать правильную настройку происхождения продаж в Finance and Operations, см. в пункте "Предварительные условия и настройка сопоставления" этого раздела.

### <a name="status"></a>Состояние

Когда заказ на продажу происходит из заказа на выполнение работ, поле **Статус внешнего заказа на выполнение работ** появляется на вкладке **Настройка** в заголовке заказа на продажу. Это поле показывает состояние системы из заказа на выполнение работ в Field Service, чтобы помочь отслеживать состояние синхронизации заказов на выполнение работ для заказов на продажу в Finance and Operations. Это поле также может помочь пользователю Finance and Operations определить, когда заказ на продажу должен быть отгружен или за него должен быть выставлен счет.

Поле **Статус внешнего заказа на выполнение работ** может иметь следующие значения:

- Открыто — Запланировано
- Открыто — В работе
- Открыто — Завершено
- Закрыто — Разнесено

## <a name="field-service-crm-solution"></a>Решение Field Service CRM

Для поддержки интеграции между Field Service и Finance and Operations требуется дополнительная функциональная возможность решения Field Service CRM. Это решение включает в себя следующие изменения.

### <a name="work-order-entity"></a>Объект заказа на выполнение работ

Поле **Имеет только управляемые извне продукты** было добавлено в объект **Заказ на выполнение работ** и отображается на странице. Оно используется для постоянного отслеживания того, состоит ли заказ на выполнение работ только из управляемых извне продуктов. Заказ на выполнение работ состоит исключительно из управляемых извне продуктов, когда все соответствующие продукты управляются в Finance and Operations. Это поле помогает гарантировать, что пользователи не будут синхронизировать заказы на выполнение работ, содержащие продукты, которые неизвестны для Finance and Operations.

### <a name="work-order-product-entity"></a>Объект продукта заказа на выполнение работ

- Поле **Заказ имеет только управляемые извне продукты** было добавлено в объект **Продукт заказа на выполнение работ** и отображается на странице. Оно используется для постоянного отслеживания того, управляется ли продукт заказа на выполнение работ в Finance and Operations. Это поле помогает гарантировать, что пользователи не будут синхронизировать продукты заказа на выполнение работ, которые неизвестны для Finance and Operations.
- Поле **Состояние системы заголовка** было добавлено в объект **Продукт заказа на выполнение работ** и отображается на странице. Оно используется для постоянного отслеживания статуса системы для заказа на выполнение работ и помогает гарантировать правильную фильтрацию, когда продукты заказа на выполнение работ синхронизируются с Finance and Operations. Если фильтры настроены для задач интеграции, информация **Состояние системы заголовка** также используется для определения того, какие значения требуется синхронизировать: оценочные или использованные.
- Поле **Сумма единиц измерения, за которые выставлен счет** показывает сумму, на которую выставлен счет на фактически использованную единицу измерения. Это значение рассчитывается как значение **Общая сумма**, деленное на значение **Фактическое количество**. Это поле используется для интеграции с системами, которые не поддерживают различные значения для использованного количества и количества в счете. Это поле не отображается в пользовательском интерфейсе (UI). 
- Поле **Сумма скидки по выставленным счетам** рассчитывается как значение **Сумма скидки** плюс округление из расчета значения **Сумма единиц измерения, за которые выставлен счет**. Это поле используется для интеграции и не отображается в пользовательском интерфейсе.
- В поле **Десятичное количество** хранится значение из поля **Количество** в виде десятичного числа. Это поле используется для интеграции и не отображается в пользовательском интерфейсе. 
- Значение в полях **Использовано** сбрасывается на **0** (нуль), если значение **Статус строки** продукта из заказа на выполнение работ изменяется с **Использовано** на **Оценочный**. Это изменение позволяет избежать ситуаций, в которых использованное количество, которое было введено по ошибке, используется для синхронизации, когда значение **Статус строки** равно **Оценочный** и параметр **Распределенный** имеет значение **Нет**.

### <a name="work-order-service-entity"></a>Объект услуги из заказа на выполнение работ

- Поле **Заказ имеет только управляемые извне продукты** было добавлено в объект **Услуга заказа на выполнение работ** и отображается на странице. Оно используется для постоянного отслеживания того, управляется ли услуга заказа на выполнение работ в Finance and Operations. Это поле помогает гарантировать, что пользователи не будут синхронизировать услуги заказа на выполнение работ, которые неизвестны для Finance and Operations.
- Поле **Состояние системы заголовка** было добавлено в объект **Услуга заказа на выполнение работ** и отображается на странице. Оно используется для постоянного отслеживания статуса системы для заказа на выполнение работ и помогает гарантировать правильную фильтрацию, когда услуги заказа на выполнение работ синхронизируются с Finance and Operations. Если фильтры настроены для задач интеграции, информация **Состояние системы заголовка** также используется для определения того, какие значения требуется синхронизировать: оценочные или использованные.
- В поле **Длительность в часах** хранится значение из поля **Длительность** после преобразования этого значения из минут в часы. Это поле используется для интеграции и не отображается в пользовательском интерфейсе.
- В поле **Оценочная длительность в часах** хранится значение из поля **Оценочная длительность** после преобразования этого значения из минут в часы. Это поле используется для интеграции и не отображается в пользовательском интерфейсе.
- Поле **Сумма единиц измерения, за которые выставлен счет** хранит сумму, на которую выставлен счет на фактически использованную единицу измерения. Это значение рассчитывается как значение **Общая сумма**, деленное на значение **Фактическое количество**. Это поле используется для интеграции с системами, которые не поддерживают различные значения для использованного количества и количества в счете. Это поле не отображается в пользовательском интерфейсе.
- Поле **Сумма скидки по выставленным счетам** рассчитывается как значение **Сумма скидки** плюс округление из расчета значения **Сумма единиц измерения, за которые выставлен счет**. Это поле используется для интеграции и не отображается в пользовательском интерфейсе.
- Поле **Заказ внешней строки** представляет собой расчетный отрицательный номер заказа строки, который может использоваться во внешних системах, где объединяются продукт заказа на выполнение работ и строки услуг. Это поле обеспечивает, что вставленные продукты заказа на выполнение работ имеют положительное номера строк, а услуги заказа на выполнение работ имеют отрицательные номера строк. Значение этого поля рассчитывается как значение **Заказ строки**, умноженное -1. Это поле не отображается в пользовательском интерфейсе.
- Значение в полях **Использовано** сбрасывается на **0** (нуль), если значение **Статус строки** услуги из заказа на выполнение работ изменяется с **Использовано** на **Оценочный** по какой-то причине. Это изменение позволяет избежать ситуаций, в которых использованное количество, которое было введено по ошибке, используется для синхронизации, когда значение **Статус строки** равно **Оценочный** и параметр **Состояние системы заголовка** имеет значение **Закрыто — Разнесено**.

## <a name="preconditions-and-mapping-setup"></a>Предварительные условия и настройка сопоставления

Перед синхронизацией заказов на выполнение работ необходимо обновить следующие параметры в системах.

### <a name="setup-in-field-service"></a>Настройка в Field Service

- Убедитесь в том, что номерные серии, используемые для заказов на выполнение работ в Field Service, не пересекаются с номерной серией, которая используется для заказов на продажу в Finance and Operations. В противном случае существующие заказы на продажу могут быть неправильно обновлены в Field Service или Finance and Operations.
- В поле **Создания накладной для заказа на выполнение работ** должно быть установлено значение **Никогда**, потому что выставление накладных будет выполнено из Finance and Operations. Перейдите в **Field Service** \> **Настройки** \> **Администрирование** \> **Настройки Field Service**, затем убедитесь, что в поле **Создания накладной для заказа на выполнение работ** задано значение **Никогда**.

### <a name="setup-in-finance-and-operations"></a>Настройка в Finance and Operations

Для интеграции заказов на выполнение работа требуется, чтобы вы настроили происхождение заказов на продажу. Происхождение заказов на продажу используется для различения заказов на продажу в Finance and Operations, которые были созданы на основе заказов на выполнение работ в Field Service. Когда заказ на продажу имеет происхождение продаж типа **Интеграция заказов на выполнение работ**, поле **Статус внешнего заказа на выполнение работ** появляется в заголовке заказа на продажу. Кроме того, происхождение заказов на продажу помогает гарантировать, что заказы на продажу, которые были созданы на основе заказов на выполнение работ в Field Service, исключаются при фильтрации во время синхронизации заказов на продажу из Finance and Operations в Field Service.

1. Перейдите в раздел **Продажи и маркетинг** \> **Настройка** \> **Заказы на продажу** \> **Происхождение заказа на продажу**.
2. Выберите **Создать** для создания нового происхождения заказов на продажу.
3. В поле **Происхождение заказа на продажу** введите имя происхождения заказа на продажу, например **WorkOrder**.
4. В поле **Описание** введите описание, например **Заказ на выполнение работ из Field Service**.
5. Установите флажок **Назначение типа источника**.
6. Задайте в поле **Тип источника продаж** значение **Интеграция заказов на выполнение работ**.
7. Выберите **Сохранить**.

### <a name="template-mapping-in-data-integration"></a>Сопоставление шаблона в интеграции данных

(Скоро ожидается)


---
title: Планирование очистки данных истории продаж
description: В этой статье описывается, как можно повысить производительность системы, планируя периодическое задание по очистке журнала обновлений продаж с регулярным интервалом.
author: myvakalo
ms.date: 08/09/2022
ms.topic: article
ms.search.form: ''
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: myvakalo
ms.search.validFrom: 2021-09-29
ms.dyn365.ops.version: 10.0.19
ms.openlocfilehash: e9a4dd5372afa8a0452449d1cb9121107e6e1610
ms.sourcegitcommit: 203c8bc263f4ab238cc7534d4dd902fd996d2b0f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2022
ms.locfileid: "9335514"
---
# <a name="schedule-sales-history-data-cleanup"></a>Планирование очистки данных истории продаж

[!include [banner](../includes/banner.md)]

В рамках своей стандартной работы Microsoft Dynamics 365 Supply Chain Management создает и сохраняет данные обновления истории продаж на постоянной основе. Со временем в системе могут накапливаться большие объемы устаревших данных истории продаж. Эти накопленные данные могут вызывать проблемы производительности и функциональности при разноске документов, связанных с заказами на продажу. (Эти документы включают подтверждения заказов на продажу, отборочные накладные по продаже, листы подбора по продаже и накладные.) Поэтому следует настроить и запланировать периодическую задачу *Очистка истории обновления продаж* с регулярным интервалом. Эта задача будет удалять все более ненужные данные обновления истории продаж.

При использовании периодической задачи *Очистка истории обновления продаж* рекомендуется включить функцию *Улучшение производительности очистки истории продаж*, которая повышает эффективность выполнения этой задачи. (Тем не менее, эту задачу можно также выполнить без включения этой функции.)

## <a name="turn-on-the-sales-history-cleanup-features"></a>Включение функций очистки истории продаж

Чтобы настроить и использовать периодическую задачу *Очистка истории обновления продаж* вместе со всеми функциями, описанными в этой статье, необходимо включить функции *Улучшения производительности очистки истории продаж* и *Очистить историю обновления продаж на основе срока* в управлении функциями, как описано в следующих подразделах.

### <a name="sales-history-cleanup-performance-improvements"></a>Повышение производительности очистки истории продаж

Периодическое пакетное задание **Очистка истории обработки продаж** может занять много времени, если она редко выполняется в средах с большим объемом обновлений продаж. В этих ситуациях функция *Улучшения производительности очистки истории продаж* может помочь сократить длительность выполнения и повысить надежность.

Функция улучшает существующее задание очистки следующими способами:

- Она разделяет очистку на пакеты (можно изменять размер пакета через настройки).
- Она будет работать в течение максимум 2 часов (продолжительность можно изменить через настройки).
- Там, где это возможно, используются возможности базы данных для минимизации блокирующих конфликтов и во избежание присоединения таблиц проводок во время очистки.

После включения функции пакетное задание **Очистка истории обработки продаж** (**Продажи и маркетинг \> Периодические задачи \> Очистка \> Очистка истории обработки продаж**) будет запускаться как прежде, но с лучшей производительностью и максимум на 2 часа. Это означает, что может потребоваться несколько раз выполнить очистку всех данных для определенного интервала времени хранения.

Прежде чем использовать эту функцию, ее необходимо включить для системы. Администраторы могут использовать параметры [управления компонентами](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) для проверки статуса функции и ее включения. В рабочей области **Управление функциями** эта функция перечисляется следующими способами:

- **Модуль:** *Продажи и маркетинг*
- **Название функции:** *Улучшения производительности очистки истории продаж*

### <a name="clean-up-sales-update-history-based-on-age"></a>Очистить историю обновления продаж на основании срока

Функция *Очистить историю обновления продаж на основании срока* позволяет указать максимальный срок давности записей, которые будут сохраняться при запуске периодической задачи *Очистка журнала обновлений продаж*. Более старые записи будут удалены. Эта функция полезна, когда вы настраиваете периодическое выполнение задачи, поскольку срок всегда вычисляется относительно даты выполнения задачи. Если вы не используете эту функцию, можно настроить только определенную дату для сохранения более старых записей.

Чтобы использовать эту функцию, ее необходимо включить для системы. В Supply Chain Management версии 10.0.29 эта функция обязательна и не может быть отключена. При запуске версии, более старой, чем 10.0.29, администраторы могут включать или выключать эту функцию путем поиска функции *Очистить историю обновления продаж на основании срока* в рабочей области [Управление функциями](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md).

## <a name="set-up-and-schedule-the-sales-history-cleanup-periodic-task"></a>Настройка и планирование периодической задачи очистки истории продаж

Чтобы настроить и планировать периодическую задачу *Очистка журнала продаж*, выполните следующие действия.

1. Проанализируйте бизнес-потребности, чтобы определить, сколько дней исторических данных разноски заказов на продажу необходимо сохранять. Обычно рекомендуется выполнять задачу очистки каждые три месяца и максимум каждые шесть месяцев.
1. Перейти в раздел **Продажи и маркетинг \> Периодические задачи \> Очистка \> Очистка истории обновления продаж**.
1. В диалоговом окне **Очистка истории обновления продаж** на экспресс-вкладке **Параметры** установите следующие поля:

    - **Очистка** — выберите одно из следующих значений, чтобы указать тип записей для очистки:

        - **Выполнено** — удаление только тех записей, которые были полностью обработаны. Так как вряд ли вы будете использовать эти записи в дальнейшем, этот параметр является самым безопасным.
        - **Выполнено и ошибочные** — удаление как полностью обработанных записей, так и записей, в которых произошла ошибка. Этот параметр используется наиболее часто. Возможно потребуется проверка и даже исправление ошибочных записей вместо автоматической их очистки. Однако многие компании выбирают, чтобы эти записи были также очищены примерно через месяц, потому что они, вероятно, больше не будут важны к этому времени.
        - **Все** — удаление выполненных, ошибочных и ожидающих записей. Ожидающие записи действительны, но еще не полностью обработаны. В большинстве случаев их не нужно удалять автоматически. Однако в некоторых ситуациях они могут быть автоматически удалены после истечения определенного периода времени.

    - **Сохранять записи по сроку** — укажите, нужно ли очищать записи на основе их срока в день выполнения задачи, или удалять записи, которые были созданы до фиксированной даты. При планировании очистки в качестве повторяющейся задачи следует установить для этого параметра значение *Да*, поскольку срок всегда вычисляется относительно даты выполнения задачи.

        - Установите для этого параметра значение *Да*, чтобы включить поле **Максимальный срок**. Это поле используется для указания максимального срока хранения записей при каждом выполнении задачи. Поле **Создано до** игнорируется.
        - Установите для этого параметра значение *Нет*, чтобы включить поле **Создано до**. Это поле используется для указания самой старой даты создания сохраняемых записей при выполнении задачи. Поле **Максимальный срок** игнорируется.

    - **Создано до** — этот параметр применяется только в том случае, если для параметра **Сохранять записи по сроку** установлено значение *Нет*. Укажите самую старую дату создания записей, которые будут сохраняться при выполнении задачи. Записи, которые были созданы до этой даты, будут удалены.
    - **Максимальный срок** — этот параметр применяется только в том случае, если для параметра **Сохранять записи по сроку** установлено значение *Да*. Укажите максимальный срок (в днях) хранения записей при каждом выполнении задачи. Более старые записи будут удалены.

1. На экспресс-вкладке **Выполнять в фоновом режиме** укажите как, когда и как часто выполняется задача. Используйте эти параметры, чтобы реализовать график, определенный на шаге 1. Поля работают так же, как они работают для других типов [пакетных заданий](../../fin-ops-core/dev-itpro/sysadmin/batch-processing-overview.md) в Supply Chain Management.
1. Выберите **ОК**, чтобы применить настройки и закрыть диалоговое окно.

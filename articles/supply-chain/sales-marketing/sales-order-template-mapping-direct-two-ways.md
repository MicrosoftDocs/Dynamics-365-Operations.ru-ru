---
title: Синхронизация заказов на продажу напрямую между Sales и Supply Chain Management
description: В этой теме рассматриваются шаблоны и базовые задачи, которые используются для выполнения синхронизации заказов на продажу напрямую между Dynamics 365 Sales и Dynamics 365 Supply Chain Management.
author: ChristianRytt
manager: AnnBe
ms.date: 05/09/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
ms.search.form: ''
audience: Application User, IT Pro
ms.reviewer: josaw
ms.search.scope: Core, Operations
ms.custom: ''
ms.assetid: ''
ms.search.region: global
ms.search.industry: ''
ms.author: crytt
ms.dyn365.ops.version: July 2017 update
ms.search.validFrom: 2017-07-8
ms.openlocfilehash: 7c8831203ae30991ff8acf1926aafc2d1839aeb2
ms.sourcegitcommit: 2460d0da812c45fce67a061386db52e0ae46b0f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/30/2019
ms.locfileid: "2251278"
---
# <a name="synchronization-of-sales-orders-directly-between-sales-and-supply-chain-management"></a>Синхронизация заказов на продажу напрямую между Sales и Supply Chain Management

[!include [banner](../includes/banner.md)]

В этой теме рассматриваются шаблоны и базовые задачи, которые используются для выполнения синхронизации заказов на продажу напрямую между Dynamics 365 Sales и Dynamics 365 Supply Chain Management.

## <a name="data-flow-in-prospect-to-cash"></a>Поток данных в решение "Перспективный клиент в наличные деньги"

Решение "Перспективный клиент в наличные деньги" использует функцию интеграции данных для синхронизации данных между экземплярами Supply Chain Management и Sales. Шаблоны "Перспективный клиент в наличные деньги", доступные в компоненте интеграции данных, обеспечивают движение данных для организаций, контактов, продуктов, предложений по продажам, заказов на продажу и накладных по продажам между Supply Chain Management и Sales. На следующем рисунке показано, как данные синхронизируются между Supply Chain Management и Sales.

[![Поток данных в решение "Перспективный клиент в наличные деньги"](./media/prospect-to-cash-data-flow.png)](./media/prospect-to-cash-data-flow.png)

## <a name="templates-and-tasks"></a>Шаблоны и задачи

Чтобы получить доступ к доступным шаблонам, откройте [Центр администрирования PowerApps](https://preview.admin.powerapps.com/dataintegration). Выберите **Проекты**, затем в правом верхнем углу выберите **Создать проект**, чтобы выбрать общие шаблоны.

Следующие шаблоны и базовые задачи используются для выполнения синхронизации заказов на продажу напрямую между Sales и Supply Chain Management:

- **Имена шаблонов в интеграции данных:** 

    - Заказы на продажу (из Sales в Supply Chain Management) — напрямую
    - Заказы на продажу (из Supply Chain Management в Sales) — напрямую

- **Имена задач в проекте интеграции данных:**

    - OrderHeader
    - OrderLine

Перед синхронизацией заголовков и строк накладных по продаже требуются следующие задачи синхронизации:

- Продукты (из Supply Chain Management в Sales) — напрямую
- Счета (из Sales в Supply Chain Management) — напрямую (если используется)
- Из контактов в клиенты (из Sales в Supply Chain Management) - напрямую (если используются)

## <a name="entity-set"></a>Набор объектов

| Управление цепочкой поставок  | Прод.             |
|-------------------------|-------------------|
| Заголовки заказов на продажу CDS | SalesOrders       |
| Строки заказа на продажу CDS   | SalesOrderDetails |

## <a name="entity-flow"></a>Поток объектов

Заказы на продажу создаются в Sales и синхронизируются в Supply Chain Management, когда запущена команда **Выполнить проект** для проекта, основанного на шаблоне **Заказы на продажу (из Sales в Supply Chain Management) - напрямую**. Можно активировать и синхронизировать заказы из Sales только в том случае, если весь **Заказ продуктов** состоит только из продуктов, которые управляются извне. Таким образом, не может быть вписываемых продуктов. После активизации заказа заказ на продажу становится доступным только для чтения в интерфейсе пользователя (UI). На этом этапе обновления выполняются из Supply Chain Management. После того как заказ на продажу получает статус **Подтверждено**, проект на основе шаблона **Заказы на продажу (из Supply Chain Management в Sales) - напрямую** может использоваться для синхронизации любых обновлений или статуса выполнения из Supply Chain Management в Sales.

Не нужно создавать заказы в Sales. Вместо этого можно создавать новые заказы на продажу в Supply Chain Management. После того как заказ на продажу получил статус **Подтверждено**, он синхронизируется с Sales, как описано в предыдущем параграфе.

В Supply Chain Management фильтры в шаблоне помогают гарантировать, что в синхронизацию включаются только необходимые заказы на продажу:

- В заказе на продажу как заказывающий клиент, так и клиент для выставления накладной должны быть взяты из Sales, чтобы они включались в синхронизацию. В Supply Chain Management поля **OrderingCustomerIsExternallyMaintained** и **InvoiceCustomerIsExternallyMaintained** используются для фильтрации заказов на продажу из информационных объектов.
- Заказ на продажу в Supply Chain Management должен быть подтвержден. С Sales синхронизируются только подтвержденные заказы на продажу или заказы на продажу с более высоким статусом обработки, например **Отгружено** или **Выставлена накладная**.
- После того, как заказ на продажу создан или изменен, необходимо выполнить в Supply Chain Management пакетное задание **Рассчитать итоги продаж**. Только заказы на продажу, для которых рассчитаны итоговые значения продаж, будут синхронизироваться с Sales.

## <a name="freight-tax"></a>Налог на фрахт

Sales не поддерживает налог на уровне заголовка, так как налог хранится на уровне строк. Для поддержки налога на уровне заголовка из Supply Chain Management, например налога на фрахт, система синхронизирует налог с Sales как вписанный продукт с именем **Налог на фрахт**, который имеет сумму налога из Supply Chain Management. Таким образом, стандартный расчет цены в Sales может использоваться для итоговых значений, даже если налог на уровне заголовка взят из Supply Chain Management.

## <a name="discount-calculation-and-rounding"></a>Расчет и округление скидок

Модель расчета скидки в Sales отличается от модели расчета скидки в Supply Chain Management. В Supply Chain Management конечная сумма скидка по строке продаж могут возникнуть в результате сочетания сумм скидок и процентов скидок. Если эта конечная сумма скидки делится на количество в строке, может произойти округление. Однако это округление не учитывается, если округленная сумма скидки на единицу синхронизируется с Sales. Чтобы обеспечить, чтобы полная сумма скидки из строки продаж в Supply Chain Management правильно синхронизировалась с Sales, должна синхронизироваться полная сумма без деления на количество в строке. Таким образом, необходимо определить **Способ расчета скидки** как **Позиция строки** в Sales.

Когда строки заказа на продажу синхронизируется из Sales в Supply Chain Management, используется полная сумма скидки по строке. Поскольку в Supply Chain Management нет поля для хранения полной суммы скидки для строки, эта сумма делится на количество и хранится в поле **Скидка по строке**. Все округления, возникающие при этом делении, хранятся в поле **Накладные расходы на продажи** в строке продажи.

### <a name="example"></a>Пример

**Синхронизация из Sales в Supply Chain Management**

- **Sales:** количество = 3, скидка по строке = $10,00
- **Supply Chain Management** : количество = 3, сумма скидки по строке = $3,33, накладные расходы на продажи =-$0,01 

**Синхронизация из Supply Chain Management в Sales**

- **Supply Chain Management** : количество = 3, сумма скидки по строке = $3,33, накладные расходы на продажи =-$0,01
- **Sales:** количество = 3, скидка по строке = (3 × $3,33) + $0,01 = $10,00

## <a name="prospect-to-cash-solution-for-sales"></a>Решение "Перспективный клиент в наличные деньги" для Sales

В сущность **Заказ** добавлены новые поля, которые отображаются на странице:

- **Хранится во внешней системе** — задайте значение **Да**, когда заказ поступает из Supply Chain Management.
- **Состояние обработки** — в этом поле отображается статус обработки заказа в Supply Chain Management. Доступны следующие значения:

    - **Черновик** — исходный статус, когда заказ создается в Sales. В Sales только заказы с этим статусом обработки допускают редактирование.
    - **Активный** — статус после того, как заказ активируется в Sales с помощью кнопки **Активировать**.
    - **Подтверждено**
    - **Отборочная накладная**
    - **Выставлена накладная**
    - **Скомплектовано**
    - **Частично скомплектовано**
    - **Частично упаковано**
    - **Отгружено**
    - **Частично отправлено**
    - **Частично выставлен счет**
    - **Отменено**

Настройка **Имеет только управляемые извне продукты** используется при активации заказа для постоянного отслеживания того, состоит ли заказ на продажу полностью из управляемых извне продуктов. Если заказ на продажу состоит исключительно из управляемых извне продуктов, продукты управляются в Supply Chain Management. Эта настройка помогает гарантировать, что вы не будете активировать и пытаться синхронизировать строки заказа на продажу, содержащие продукты, которые неизвестны для Supply Chain Management.

Кнопки **Создать накладную**, **Отменить заказ**, **Пересчитать**, **Получить продукты** и **Искать адрес** на странице **Заказ на продажу** скрываются для заказов, хранящихся во внешней системе, потому что накладные будут создаваться в Supply Chain Management и синхронизироваться в Sales. Эти заказы не могут редактироваться, потому что информация заказа на продажу будет синхронизироваться из Supply Chain Management после активации.

Статус заказа на продажу будет оставаться **Активный**, чтобы помочь гарантировать, что изменения из Supply Chain Management будут передаваться в заказ на продажу в Sales. Для управления таким поведением задайте для **Statecode \[Статус\]** значение по умолчанию **Active** в проекте интеграции данных.

## <a name="preconditions-and-mapping-setup"></a>Предварительные условия и настройка сопоставления

Перед синхронизацией заказов на продажу необходимо обновить следующие параметры в системах.

### <a name="setup-in-sales"></a>Настройка в Sales

- Убедитесь, что настроены разрешения для группы, которой назначен пользователь, из вашего набора подключений Sales. Если вы используете демонстрационные данные, обычно пользователь имеет доступ администратора, но группа не имеет доступа администратора. Если группа не имеет доступа администратора при запуске проекта из интеграции данных, вы получите сообщение об ошибке, в котором будет указано, что рабочая группа-участник отсутствует.

    Откройте **Параметры** &gt; **Безопасность** &gt; **Группы**, выберите необходимую группу, выберите **Управление ролями** и выберите роль с требуемыми разрешениями, например **Системный администратор**.

- Для обеспечения правильного расчета скидок как в Sales, так и в Supply Chain Management для параметра **Способ расчета скидки** должно быть установлено значение **Номенклатура строки**.
- Откройте **Параметры** &gt; **Администрирование** &gt; **Параметры системы** &gt; **Продажи** и убедитесь, что используются следующие настройки:

    - Для параметра **Использовать системный расчет цен** установлено значение **Да**.
    - Для параметра **Способ расчета скидки** установлено значение **Номенклатура строки**.

### <a name="setup-in-supply-chain-management"></a>Настройка в Supply Chain Management

- Откройте **Продажи и маркетинг** &gt; **Периодические задачи** &gt; **Рассчитать итоги продаж** и настройте задание для выполнения в качестве пакетного задания. Задайте для параметра **Рассчитанные итоги для заказов на продажу** значение **Да**. Этот шаг важен, так как только заказы на продажу, для которых рассчитаны итоговые значения продаж, будут синхронизироваться с Sales. Частота пакетного задания должна соответствовать частоте синхронизации заказов на продажу.

Если используется также интеграция заказов на работу, необходимо настроить происхождение заказа на продажу. Происхождение заказов на продажу используется для различения заказов на продажу в Supply Chain Management, которые были созданы на основе заказов на выполнение работ в Field Service. Когда заказ на продажу имеет происхождение продаж типа **Интеграция заказов на выполнение работ**, поле **Статус внешнего заказа на выполнение работ** появляется в заголовке заказа на продажу. Кроме того, происхождение заказов на продажу гарантирует, что заказы на продажу, которые были созданы на основе заказов на выполнение работ в Field Service, исключаются при фильтрации во время синхронизации заказов на продажу из Supply Chain Management в Field Service.

1. Перейдите в раздел **Продажи и маркетинг** \> **Настройка** \> **Заказы на продажу** \> **Происхождение заказа на продажу**.
2. Выберите **Создать** для создания нового происхождения заказов на продажу.
3. В поле **Происхождение заказа на продажу** введите имя происхождения заказа на продажу, например **SalesOrder**.
4. В поле **Описание** введите описание, например **Заказ на продажу из Sales**.
5. Установите флажок **Назначение типа источника**.
6. Задайте в поле **Тип источника продаж** значение **Интеграция заказов на продажу**.
7. Нажмите **Сохранить**.

### <a name="setup-in-the-sales-orders-sales-to-supply-chain-management---direct-data-integration-project"></a>Настройка в проекте интеграции данных "Заказы на продажу (из Sales в Supply Chain Management) - напрямую"

- Убедитесь в наличии необходимого сопоставления для **Shipto\_country** в **DeliveryAddressCountryRegionISOCode**. Можно сделать пустым значение по умолчанию в карте соответствия, чтобы избежать необходимости ввода страны для заказов внутри страны. Задайте в левой стороне значение "Пусто", а с правой стороны задайте нужную страну или регион.

    Значение шаблона является схемой значений, где сопоставляются нескольких стран или регионов, и где "Пусто" = США.

### <a name="setup-in-the-sales-orders-supply-chain-management-to-sales---direct-data-integration-project"></a>Настройка в проекте интеграции данных "Заказы на продажу (из Supply Chain Management в Sales) - напрямую"

#### <a name="salesheader-task"></a>Задача SalesHeader

- Для создания заказов в Sales требуется прайс-лист. Обновите схему сопоставления для **pricelevelid.name \[имя прайс-листа\]** на прайс-лист, используемый в Sales для данной валюты. Можно использовать прайс-лист по умолчанию для одной валюты. Если имеются прайс-листы в нескольких валютах, можно использовать схему сопоставления.

    Значение по умолчанию шаблона для **pricelevelid.name \[имя прайс-листа\]** — **CRM Service USA (sample)**.

#### <a name="salesline-task"></a>Задача SalesLine

- Убедитесь, что существует требуемая схема сопоставления значений для **SalesUnitSymbol** в Supply Chain Management.
- Убедитесь в том, что требуемые единицы определены в Sales.

    Значение шаблона, которое имеет сопоставление значений, определено для **SalesUnitSymbol** в **oumid.name**.

## <a name="template-mapping-in-data-integration"></a>Сопоставление шаблона в интеграции данных

> [!NOTE]
> Поля **Условия оплаты**, **Условия фрахта**, **Условия поставки**, **Способ доставки** и **Режим доставки** не являются частью сопоставлений по умолчанию. Чтобы сопоставить эти поля, необходимо настроить преобразование значений, характерное для данных в организациях, между которыми синхронизируется объект.

На следующем рисунке показан пример сопоставления шаблона в интеграции данных.

> [!NOTE]
> Сопоставление показывает, какие данные полей будут синхронизированы из Sales в Supply Chain Management или из Supply Chain Management в Sales.

### <a name="sales-orders-supply-chain-management-to-sales---direct-orderheader"></a>Заказы на продажу (из Supply Chain Management в Sales) — напрямую: OrderHeader

[![Сопоставление шаблона в интеграции данных](./media/sales-order-direct-template-mapping-data-integrator-1.png)](./media/sales-order-direct-template-mapping-data-integrator-1.png)

### <a name="sales-orders-supply-chain-management-to-sales---direct-orderline"></a>Заказы на продажу (из Supply Chain Management в Sales) — напрямую: OrderLine

[![Сопоставление шаблона в интеграции данных](./media/sales-order-direct-template-mapping-data-integrator-2.png)](./media/sales-order-direct-template-mapping-data-integrator-2.png)

### <a name="sales-orders-sales-to-supply-chain-management---direct-orderheader"></a>Заказы на продажу (из Sales в Supply Chain Management) — напрямую: OrderHeader

[![Сопоставление шаблона в интеграции данных](./media/sales-order-direct-template-mapping-data-integrator-3.png)](./media/sales-order-direct-template-mapping-data-integrator-3.png)

### <a name="sales-orders-sales-to-supply-chain-management---direct-orderline"></a>Заказы на продажу (из Sales в Supply Chain Management) — напрямую: OrderLine

[![Сопоставление шаблона в интеграции данных](./media/sales-order-direct-template-mapping-data-integrator-4.png)](./media/sales-order-direct-template-mapping-data-integrator-4.png)

## <a name="related-topics"></a>Связанные разделы

[Решение "Перспективный клиент в наличные деньги"](prospect-to-cash.md)

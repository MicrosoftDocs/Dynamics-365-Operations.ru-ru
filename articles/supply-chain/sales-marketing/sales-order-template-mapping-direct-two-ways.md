---
title: Синхронизация заказов на продажу непосредственно между Sales и Finance and Operations
description: В этой теме рассматриваются шаблоны и базовые задачи, которые используются для выполнения синхронизации заказов на продажу напрямую между Microsoft Dynamics 365 for Sales и Microsoft Dynamics 365 for Finance and Operations.
author: ChristianRytt
manager: AnnBe
ms.date: 05/09/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
ms.search.form: ''
audience: Application User, IT Pro
ms.reviewer: josaw
ms.search.scope: Core, Operations
ms.custom: ''
ms.assetid: ''
ms.search.region: global
ms.search.industry: ''
ms.author: crytt
ms.dyn365.ops.version: July 2017 update
ms.search.validFrom: 2017-07-8
ms.openlocfilehash: a427bff3cd07adbf4d3d81f98bdf7f85a194730b
ms.sourcegitcommit: 3f02d8a874d1696cbf21d100f1ad205c57224e4b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/09/2019
ms.locfileid: "1539122"
---
# <a name="synchronization-of-sales-orders-directly-between-sales-and-finance-and-operations"></a><span data-ttu-id="fff58-103">Синхронизация заказов на продажу напрямую между Sales и Finance and Operations</span><span class="sxs-lookup"><span data-stu-id="fff58-103">Synchronization of sales orders directly between Sales and Finance and Operations</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="fff58-104">В этой теме рассматриваются шаблоны и базовые задачи, которые используются для выполнения синхронизации заказов на продажу напрямую между Microsoft Dynamics 365 for Sales и Microsoft Dynamics 365 for Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="fff58-104">The topic discusses the templates and underlying tasks that are used to run synchronization of sales orders directly between Microsoft Dynamics 365 for Sales and Microsoft Dynamics 365 for Finance and Operations.</span></span>

## <a name="data-flow-in-prospect-to-cash"></a><span data-ttu-id="fff58-105">Поток данных в решение "Перспективный клиент в наличные деньги"</span><span class="sxs-lookup"><span data-stu-id="fff58-105">Data flow in Prospect to cash</span></span>

<span data-ttu-id="fff58-106">Решение "Перспективный клиент в наличные деньги" использует функцию интеграции данных для синхронизации данных между экземплярами Finance and Operations и Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-106">The Prospect to cash solution uses the Data integration feature to synchronize data across instances of Finance and Operations and Sales.</span></span> <span data-ttu-id="fff58-107">Шаблоны "Перспективный клиент в наличные деньги", доступные в компоненте интеграции данных, обеспечивают движение данных для организаций, контактов, продуктов, предложений по продажам, заказов на продажу и накладных по продажам между Finance and Operations и Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-107">The Prospect to cash templates that are available with the Data integration feature enable the flow of data for accounts, contacts, products, sales quotations, sales orders, and sales invoices between Finance and Operations and Sales.</span></span> <span data-ttu-id="fff58-108">На следующем рисунке показано, как данные синхронизируются между Finance and Operations и Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-108">The following illustration shows how the data is synchronized between Finance and Operations and Sales.</span></span>

<span data-ttu-id="fff58-109">[![Поток данных в решение "Перспективный клиент в наличные деньги"](./media/prospect-to-cash-data-flow.png)](./media/prospect-to-cash-data-flow.png)</span><span class="sxs-lookup"><span data-stu-id="fff58-109">[![Data flow in Prospect to cash](./media/prospect-to-cash-data-flow.png)](./media/prospect-to-cash-data-flow.png)</span></span>

## <a name="templates-and-tasks"></a><span data-ttu-id="fff58-110">Шаблоны и задачи</span><span class="sxs-lookup"><span data-stu-id="fff58-110">Templates and tasks</span></span>

<span data-ttu-id="fff58-111">Чтобы получить доступ к доступным шаблонам, откройте [Центр администрирования PowerApps](https://preview.admin.powerapps.com/dataintegration).</span><span class="sxs-lookup"><span data-stu-id="fff58-111">To access the available templates, open [PowerApps Admin Center](https://preview.admin.powerapps.com/dataintegration).</span></span> <span data-ttu-id="fff58-112">Выберите **Проекты**, затем в правом верхнем углу выберите **Создать проект**, чтобы выбрать общие шаблоны.</span><span class="sxs-lookup"><span data-stu-id="fff58-112">Select **Projects**, and then, in the upper-right corner, select **New project** to select public templates.</span></span>

<span data-ttu-id="fff58-113">Следующие шаблоны и базовые задачи используются для выполнения синхронизации заказов на продажу напрямую между Sales и Finance and Operations:</span><span class="sxs-lookup"><span data-stu-id="fff58-113">The following templates and underlying tasks are used to run synchronization of sales orders directly between Sales and Finance and Operations:</span></span>

- <span data-ttu-id="fff58-114">**Имена шаблонов в интеграции данных:**</span><span class="sxs-lookup"><span data-stu-id="fff58-114">**Names of the templates in Data integration:**</span></span> 

    - <span data-ttu-id="fff58-115">Заказы на продажу (из Sales в Fin and Ops) - напрямую</span><span class="sxs-lookup"><span data-stu-id="fff58-115">Sales Orders (Sales to Fin and Ops) - Direct</span></span>
    - <span data-ttu-id="fff58-116">Заказы на продажу (из Fin and Ops в Sales) - напрямую</span><span class="sxs-lookup"><span data-stu-id="fff58-116">Sales Orders (Fin and Ops to Sales) - Direct</span></span>

- <span data-ttu-id="fff58-117">**Имена задач в проекте интеграции данных:**</span><span class="sxs-lookup"><span data-stu-id="fff58-117">**Names of the tasks in the Data integration project:**</span></span>

    - <span data-ttu-id="fff58-118">OrderHeader</span><span class="sxs-lookup"><span data-stu-id="fff58-118">OrderHeader</span></span>
    - <span data-ttu-id="fff58-119">OrderLine</span><span class="sxs-lookup"><span data-stu-id="fff58-119">OrderLine</span></span>

<span data-ttu-id="fff58-120">Перед синхронизацией заголовков и строк накладных по продаже требуются следующие задачи синхронизации:</span><span class="sxs-lookup"><span data-stu-id="fff58-120">The following synchronization tasks are required before synchronization of sales invoice headers and lines can occur:</span></span>

- <span data-ttu-id="fff58-121">Продукты (из Fin and Ops в Sales) — напрямую</span><span class="sxs-lookup"><span data-stu-id="fff58-121">Products (Fin and Ops to Sales) - Direct</span></span>
- <span data-ttu-id="fff58-122">Счета (из Sales в Fin and Ops) — напрямую (если используются)</span><span class="sxs-lookup"><span data-stu-id="fff58-122">Accounts (Sales to Fin and Ops) - Direct (if used)</span></span>
- <span data-ttu-id="fff58-123">Из контактов в клиенты (из Sales в Fin and Ops) - напрямую (если используются)</span><span class="sxs-lookup"><span data-stu-id="fff58-123">Contacts to Customers (Sales to Fin and Ops) - Direct (if used)</span></span>

## <a name="entity-set"></a><span data-ttu-id="fff58-124">Набор объектов</span><span class="sxs-lookup"><span data-stu-id="fff58-124">Entity set</span></span>

| <span data-ttu-id="fff58-125">Finance and Operations</span><span class="sxs-lookup"><span data-stu-id="fff58-125">Finance and Operations</span></span>  | <span data-ttu-id="fff58-126">Прод.</span><span class="sxs-lookup"><span data-stu-id="fff58-126">Sales</span></span>             |
|-------------------------|-------------------|
| <span data-ttu-id="fff58-127">Заголовки заказов на продажу CDS</span><span class="sxs-lookup"><span data-stu-id="fff58-127">CDS sales order headers</span></span> | <span data-ttu-id="fff58-128">SalesOrders</span><span class="sxs-lookup"><span data-stu-id="fff58-128">SalesOrders</span></span>       |
| <span data-ttu-id="fff58-129">Строки заказа на продажу CDS</span><span class="sxs-lookup"><span data-stu-id="fff58-129">CDS sales order lines</span></span>   | <span data-ttu-id="fff58-130">SalesOrderDetails</span><span class="sxs-lookup"><span data-stu-id="fff58-130">SalesOrderDetails</span></span> |

## <a name="entity-flow"></a><span data-ttu-id="fff58-131">Поток объектов</span><span class="sxs-lookup"><span data-stu-id="fff58-131">Entity flow</span></span>

<span data-ttu-id="fff58-132">Заказы на продажу создаются в Sales и синхронизируются в Finance and Operations, когда запущена команда **Выполнить проект** для проекта, основанного на шаблоне **Заказы на продажу (из Sales в Fin and Ops) - напрямую**.</span><span class="sxs-lookup"><span data-stu-id="fff58-132">Sales orders are created in Sales and synchronized to Finance and Operations when **Run project** is triggered for a project based on the **Sales Orders (Sales to Fin and Ops) - Direct** template.</span></span> <span data-ttu-id="fff58-133">Можно активировать и синхронизировать заказы из Sales только в том случае, если весь **Заказ продуктов** состоит только из продуктов, которые управляются извне.</span><span class="sxs-lookup"><span data-stu-id="fff58-133">You can only activate and synchronize orders from Sales if all **Order Products** consist of products that are externally maintained.</span></span> <span data-ttu-id="fff58-134">Таким образом, не может быть вписываемых продуктов.</span><span class="sxs-lookup"><span data-stu-id="fff58-134">Therefore, there can be no write-in products.</span></span> <span data-ttu-id="fff58-135">После активизации заказа заказ на продажу становится доступным только для чтения в интерфейсе пользователя (UI).</span><span class="sxs-lookup"><span data-stu-id="fff58-135">After the order is activated, the sales order becomes read-only in the user interface (UI).</span></span> <span data-ttu-id="fff58-136">На этом этапе обновления выполняются из Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="fff58-136">At that point, the updates are made from Finance and Operations.</span></span> <span data-ttu-id="fff58-137">После того как заказ на продажу получает статус **Подтверждено**, проект на основе шаблона **Заказы на продажу (из Fin and Ops в Sales) - напрямую** может использоваться для синхронизации любых обновлений или статуса выполнения из Finance and Operations в Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-137">After the sales order has a status of **Confirmed**, the a project based on the **Sales Orders (Fin and Ops to Sales) - Direct** template can be used to synchronize updates or fulfillment status from Finance and Operations to Sales.</span></span>

<span data-ttu-id="fff58-138">Не нужно создавать заказы в Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-138">You don't have to create orders in Sales.</span></span> <span data-ttu-id="fff58-139">Вместо этого можно создавать новые заказы на продажу в Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="fff58-139">You can create new sales orders in Finance and Operations instead.</span></span> <span data-ttu-id="fff58-140">После того как заказ на продажу получил статус **Подтверждено**, он синхронизируется с Sales, как описано в предыдущем параграфе.</span><span class="sxs-lookup"><span data-stu-id="fff58-140">After a sales order has a status of **Confirmed**, it's synchronized to Sales as described in the previous paragraph.</span></span>

<span data-ttu-id="fff58-141">В Finance and Operations фильтры в шаблоне помогают гарантировать, что в синхронизацию включаются только необходимые заказы на продажу:</span><span class="sxs-lookup"><span data-stu-id="fff58-141">In Finance and operations, filters in the template help guarantee that only the relevant sales orders are included in the synchronization:</span></span>

- <span data-ttu-id="fff58-142">В заказе на продажу как заказывающий клиент, так и клиент для выставления накладной должны быть взяты из Sales, чтобы они включались в синхронизацию.</span><span class="sxs-lookup"><span data-stu-id="fff58-142">On the sales order, both the ordering customer and the invoicing customer have to originate from Sales to be included in the synchronization.</span></span> <span data-ttu-id="fff58-143">В Finance and Operations поля **OrderingCustomerIsExternallyMaintained** и **InvoiceCustomerIsExternallyMaintained** используются для фильтрации заказов на продажу из информационных объектов.</span><span class="sxs-lookup"><span data-stu-id="fff58-143">In Finance and Operations, the **OrderingCustomerIsExternallyMaintained** and **InvoiceCustomerIsExternallyMaintained** fields are used to filter sales orders from the data entities.</span></span>
- <span data-ttu-id="fff58-144">Заказ на продажу в Finance and Operations должен быть подтвержден.</span><span class="sxs-lookup"><span data-stu-id="fff58-144">The sales order in Finance and Operations must be confirmed.</span></span> <span data-ttu-id="fff58-145">С Sales синхронизируются только подтвержденные заказы на продажу или заказы на продажу с более высоким статусом обработки, например **Отгружено** или **Выставлена накладная**.</span><span class="sxs-lookup"><span data-stu-id="fff58-145">Only confirmed sales orders or sales orders that have a higher processing status, such as **Shipped** or **Invoiced**, are synchronized to Sales.</span></span>
- <span data-ttu-id="fff58-146">После того, как заказ на продажу создан или изменен, необходимо выполнить в Finance and Operations пакетное задание **Рассчитать итоги продаж**.</span><span class="sxs-lookup"><span data-stu-id="fff58-146">After a sales order is created or modified, the **Calculate sales totals** batch job in Finance and Operations must be run.</span></span> <span data-ttu-id="fff58-147">Только заказы на продажу, для которых рассчитаны итоговые значения продаж, будут синхронизироваться с Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-147">Only sales orders where sales totals are calculated will be synchronized to Sales.</span></span>

## <a name="freight-tax"></a><span data-ttu-id="fff58-148">Налог на фрахт</span><span class="sxs-lookup"><span data-stu-id="fff58-148">Freight tax</span></span>

<span data-ttu-id="fff58-149">Sales не поддерживает налог на уровне заголовка, так как налог хранится на уровне строк.</span><span class="sxs-lookup"><span data-stu-id="fff58-149">Sales doesn't support tax at the header level, because tax is stored at the line level.</span></span> <span data-ttu-id="fff58-150">Для поддержки налога на уровне заголовка из Finance and Operations, например налога на фрахт, система синхронизирует налог с Sales как вписанный продукт с именем **Налог на фрахт**, который имеет сумму налога из Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="fff58-150">To support tax at the header level from Finance and Operations, such as tax on freight, the system synchronizes tax to Sales as a write-in product that is named **Freight Tax**, and that has the tax amount from Finance and Operations.</span></span> <span data-ttu-id="fff58-151">Таким образом, стандартный расчет цены в Sales может использоваться для итоговых значений, даже если налог на уровне заголовка взят из Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="fff58-151">In this way, the standard price calculation in Sales can be used for totals, even when there is tax at the header level from Finance and Operations.</span></span>

## <a name="discount-calculation-and-rounding"></a><span data-ttu-id="fff58-152">Расчет и округление скидок</span><span class="sxs-lookup"><span data-stu-id="fff58-152">Discount calculation and rounding</span></span>

<span data-ttu-id="fff58-153">Модель расчета скидки в Sales отличается от модели расчета скидки в Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="fff58-153">The discount calculation model in Sales differs from the discount calculation model in Finance and Operations.</span></span> <span data-ttu-id="fff58-154">В Finance and Operations конечная сумма скидка по строке продаж могут возникнуть в результате сочетания сумм скидок и процентов скидок.</span><span class="sxs-lookup"><span data-stu-id="fff58-154">In Finance and Operations, the final discount amount on a sales line can be the result of a combination of discount amounts and discount percentages.</span></span> <span data-ttu-id="fff58-155">Если эта конечная сумма скидки делится на количество в строке, может произойти округление.</span><span class="sxs-lookup"><span data-stu-id="fff58-155">If this final discount amount is divided by the quantity on the line, rounding can occur.</span></span> <span data-ttu-id="fff58-156">Однако это округление не учитывается, если округленная сумма скидки на единицу синхронизируется с Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-156">However, this rounding isn't considered if a rounded per-unit discount amount is synchronized to Sales.</span></span> <span data-ttu-id="fff58-157">Чтобы обеспечить, чтобы полная сумма скидки из строки продаж в Finance and Operations правильно синхронизировалась с Sales, должна синхронизироваться полная сумма без деления на количество в строке.</span><span class="sxs-lookup"><span data-stu-id="fff58-157">To help guarantee that the full discount amount from a sales line in Finance and Operations is correctly synchronized to Sales, the full amount must be synchronized without being divided by the line quantity.</span></span> <span data-ttu-id="fff58-158">Таким образом, необходимо определить **Способ расчета скидки** как **Позиция строки** в Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-158">Therefore, you must define the **Discount calculation method** as **Line item** in Sales.</span></span>

<span data-ttu-id="fff58-159">Когда строки заказа на продажу синхронизируется из Sales в Finance and Operations, используется полная сумма скидки по строке.</span><span class="sxs-lookup"><span data-stu-id="fff58-159">When a sales order line is synchronized from Sales to Finance and Operations, the full line discount amount is used.</span></span> <span data-ttu-id="fff58-160">Поскольку в Finance and Operations нет поля для хранения полной суммы скидки для строки, эта сумма делится на количество и хранится в поле **Скидка по строке**.</span><span class="sxs-lookup"><span data-stu-id="fff58-160">Because Finance and Operations has no field that can store the full discount amount for a line, the amount is divided by the quantity and stored in the **Line discount** field.</span></span> <span data-ttu-id="fff58-161">Все округления, возникающие при этом делении, хранятся в поле **Накладные расходы на продажи** в строке продажи.</span><span class="sxs-lookup"><span data-stu-id="fff58-161">Any rounding that occurs in this division is stored in the **Sales charges** field on the sales line.</span></span>

### <a name="example"></a><span data-ttu-id="fff58-162">Пример</span><span class="sxs-lookup"><span data-stu-id="fff58-162">Example</span></span>

<span data-ttu-id="fff58-163">**Синхронизация из Sales в Finance and Operations**</span><span class="sxs-lookup"><span data-stu-id="fff58-163">**Synchronization from Sales to Finance and Operations**</span></span>

- <span data-ttu-id="fff58-164">**Sales:** количество = 3, скидка по строке = $10,00</span><span class="sxs-lookup"><span data-stu-id="fff58-164">**Sales:** Quantity = 3, per-line discount = $10.00</span></span>
- <span data-ttu-id="fff58-165">**Finance and Operations:** количество = 3, сумма скидки по строке = $3,33, накладные расходы на продажи =-$0,01</span><span class="sxs-lookup"><span data-stu-id="fff58-165">**Finance and Operations:** Quantity = 3, line discount amount = $3.33, sales charge = -$0.01</span></span> 

<span data-ttu-id="fff58-166">**Синхронизация из Finance and Operations в Sales**</span><span class="sxs-lookup"><span data-stu-id="fff58-166">**Synchronization from Finance and Operations to Sales**</span></span>

- <span data-ttu-id="fff58-167">**Finance and Operations:** количество = 3, сумма скидки по строке = $3,33, накладные расходы на продажи =-$0,01</span><span class="sxs-lookup"><span data-stu-id="fff58-167">**Finance and Operations:** Quantity = 3, line discount amount = $3.33, sales charge = -$0.01</span></span>
- <span data-ttu-id="fff58-168">**Sales:** количество = 3, скидка по строке = (3 × $3,33) + $0,01 = $10,00</span><span class="sxs-lookup"><span data-stu-id="fff58-168">**Sales:** Quantity = 3, per-line discount = (3 × $3.33) + $0.01 = $10.00</span></span>

## <a name="prospect-to-cash-solution-for-sales"></a><span data-ttu-id="fff58-169">Решение "Перспективный клиент в наличные деньги" для Sales</span><span class="sxs-lookup"><span data-stu-id="fff58-169">Prospect to cash solution for Sales</span></span>

<span data-ttu-id="fff58-170">В сущность **Заказ** добавлены новые поля, которые отображаются на странице:</span><span class="sxs-lookup"><span data-stu-id="fff58-170">New fields have been added to the **Order** entity and appear on the page:</span></span>

- <span data-ttu-id="fff58-171">**Хранится во внешней системе** — задайте значение **Да**, когда заказ поступает из Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="fff58-171">**Is Maintained Externally** – Set this option to **Yes** when the order is coming from Finance and Operations.</span></span>
- <span data-ttu-id="fff58-172">**Состояние обработки** — в этом поле отображается статус обработки заказа в Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="fff58-172">**Processing status** – This field shows the processing status of the order in Finance and Operations.</span></span> <span data-ttu-id="fff58-173">Доступны следующие значения:</span><span class="sxs-lookup"><span data-stu-id="fff58-173">The following values are available:</span></span>

    - <span data-ttu-id="fff58-174">**Черновик** — исходный статус, когда заказ создается в Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-174">**Draft** – The initial status when an order is created in Sales.</span></span> <span data-ttu-id="fff58-175">В Sales только заказы с этим статусом обработки допускают редактирование.</span><span class="sxs-lookup"><span data-stu-id="fff58-175">In Sales, only orders with this processing status can be edited.</span></span>
    - <span data-ttu-id="fff58-176">**Активный** — статус после того, как заказ активируется в Sales с помощью кнопки **Активировать**.</span><span class="sxs-lookup"><span data-stu-id="fff58-176">**Active** – The status after the order is activated in Sales by using the **Activate** button.</span></span>
    - <span data-ttu-id="fff58-177">**Подтверждено**</span><span class="sxs-lookup"><span data-stu-id="fff58-177">**Confirmed**</span></span>
    - <span data-ttu-id="fff58-178">**Отборочная накладная**</span><span class="sxs-lookup"><span data-stu-id="fff58-178">**Packing Slip**</span></span>
    - <span data-ttu-id="fff58-179">**Выставлена накладная**</span><span class="sxs-lookup"><span data-stu-id="fff58-179">**Invoiced**</span></span>
    - <span data-ttu-id="fff58-180">**Скомплектовано**</span><span class="sxs-lookup"><span data-stu-id="fff58-180">**Picked**</span></span>
    - <span data-ttu-id="fff58-181">**Частично скомплектовано**</span><span class="sxs-lookup"><span data-stu-id="fff58-181">**Partially Picked**</span></span>
    - <span data-ttu-id="fff58-182">**Частично упаковано**</span><span class="sxs-lookup"><span data-stu-id="fff58-182">**Partially Packed**</span></span>
    - <span data-ttu-id="fff58-183">**Отгружено**</span><span class="sxs-lookup"><span data-stu-id="fff58-183">**Shipped**</span></span>
    - <span data-ttu-id="fff58-184">**Частично отправлено**</span><span class="sxs-lookup"><span data-stu-id="fff58-184">**Partially Shipped**</span></span>
    - <span data-ttu-id="fff58-185">**Частично выставлен счет**</span><span class="sxs-lookup"><span data-stu-id="fff58-185">**Partially Invoiced**</span></span>
    - <span data-ttu-id="fff58-186">**Отменено**</span><span class="sxs-lookup"><span data-stu-id="fff58-186">**Cancelled**</span></span>

<span data-ttu-id="fff58-187">Настройка **Имеет только управляемые извне продукты** используется при активации заказа для постоянного отслеживания того, состоит ли заказ на продажу полностью из управляемых извне продуктов.</span><span class="sxs-lookup"><span data-stu-id="fff58-187">The **Has Externally Maintained Products Only** setting is used during order activation to consistently track whether a sales order consists entirely of externally maintained products.</span></span> <span data-ttu-id="fff58-188">Если заказ на продажу состоит исключительно из управляемых извне продуктов, продукты управляются в Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="fff58-188">If a sales order consists entirely of externally maintained products, the products are maintained in Finance and Operations.</span></span> <span data-ttu-id="fff58-189">Эта настройка помогает гарантировать, что вы не будете активировать и пытаться синхронизировать строки заказа на продажу, содержащие продукты, которые неизвестны для Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="fff58-189">This setting helps guarantee that you don't activate and try to synchronize sales order lines that have products that are unknown to Finance and Operations.</span></span>

<span data-ttu-id="fff58-190">Кнопки **Создать накладную**, **Отменить заказ**, **Пересчитать**, **Получить продукты** и **Искать адрес** на странице **Заказ на продажу** скрываются для заказов, хранящихся во внешней системе, потому что накладные будут создаваться в Finance and Operations и синхронизироваться в Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-190">The **Create Invoice**, **Cancel Order**, **Recalculate**, **Get Products**, and **Lookup Address** buttons on the **Sales order** page are hidden for externally maintained orders, because invoices will be created in Finance and Operations and synchronized to Sales.</span></span> <span data-ttu-id="fff58-191">Эти заказы не могут редактироваться, потому что информация заказа на продажу будет синхронизироваться из Finance and Operations после активации.</span><span class="sxs-lookup"><span data-stu-id="fff58-191">These orders can't be edited, because sales order information will be synchronized from Finance and Operations after activation.</span></span>

<span data-ttu-id="fff58-192">Статус заказа на продажу будет оставаться **Активный**, чтобы помочь гарантировать, что изменения из Finance and Operations будут передаваться в заказ на продажу в Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-192">The sales order status will remain **Active** to help guarantee that changes from Finance and Operations can flow to the sales order in Sales.</span></span> <span data-ttu-id="fff58-193">Для управления таким поведением задайте для **Statecode \[Статус\]** значение по умолчанию **Active** в проекте интеграции данных.</span><span class="sxs-lookup"><span data-stu-id="fff58-193">To control this behavior, set the default **Statecode \[Status\]** value to **Active** in the Data integration project.</span></span>

## <a name="preconditions-and-mapping-setup"></a><span data-ttu-id="fff58-194">Предварительные условия и настройка сопоставления</span><span class="sxs-lookup"><span data-stu-id="fff58-194">Preconditions and mapping setup</span></span>

<span data-ttu-id="fff58-195">Перед синхронизацией заказов на продажу необходимо обновить следующие параметры в системах.</span><span class="sxs-lookup"><span data-stu-id="fff58-195">Before you synchronize sales orders, it's important that you update the following settings in the systems.</span></span>

### <a name="setup-in-sales"></a><span data-ttu-id="fff58-196">Настройка в Sales</span><span class="sxs-lookup"><span data-stu-id="fff58-196">Setup in Sales</span></span>

- <span data-ttu-id="fff58-197">Убедитесь, что настроены разрешения для группы, которой назначен пользователь, из вашего набора подключений Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-197">Make sure that permissions are set up for the team that the user from your Sales connection set is assigned to.</span></span> <span data-ttu-id="fff58-198">Если вы используете демонстрационные данные, обычно пользователь имеет доступ администратора, но группа не имеет доступа администратора.</span><span class="sxs-lookup"><span data-stu-id="fff58-198">If you're using demo data, the user usually has admin access, but the team doesn't have admin access.</span></span> <span data-ttu-id="fff58-199">Если группа не имеет доступа администратора при запуске проекта из интеграции данных, вы получите сообщение об ошибке, в котором будет указано, что рабочая группа-участник отсутствует.</span><span class="sxs-lookup"><span data-stu-id="fff58-199">If the team doesn't have admin access, when you run the project from Data integration, you will receive an error message that states that the Principal team is missing.</span></span>

    <span data-ttu-id="fff58-200">Откройте **Параметры** &gt; **Безопасность** &gt; **Группы**, выберите необходимую группу, выберите **Управление ролями** и выберите роль с требуемыми разрешениями, например **Системный администратор**.</span><span class="sxs-lookup"><span data-stu-id="fff58-200">Go to **Settings** &gt; **Security** &gt; **Teams**, select the relevant team, select **Manage Roles**, and select a role that has the desired permissions, such as **System Administrator**.</span></span>

- <span data-ttu-id="fff58-201">Для обеспечения правильного расчета скидок как в Sales, так и в Finance and Operations для параметра **Способ расчета скидки** должно быть установлено значение **Номенклатура строки**.</span><span class="sxs-lookup"><span data-stu-id="fff58-201">To ensure correct calculation of discounts in both Sales and Finance and Operations **Discount calculation method** must be set to **Line item**.</span></span>
- <span data-ttu-id="fff58-202">Откройте **Параметры** &gt; **Администрирование** &gt; **Параметры системы** &gt; **Продажи** и убедитесь, что используются следующие настройки:</span><span class="sxs-lookup"><span data-stu-id="fff58-202">Go to **Settings** &gt; **Administration** &gt; **System settings** &gt; **Sales**, and make sure that the following settings are used:</span></span>

    - <span data-ttu-id="fff58-203">Для параметра **Использовать системный расчет цен** установлено значение **Да**.</span><span class="sxs-lookup"><span data-stu-id="fff58-203">The **Use system prizing calculation system** option is set to **Yes**.</span></span>
    - <span data-ttu-id="fff58-204">Для параметра **Способ расчета скидки** установлено значение **Номенклатура строки**.</span><span class="sxs-lookup"><span data-stu-id="fff58-204">The **Discount calculation method** field is set to **Line item**.</span></span>

### <a name="setup-in-finance-and-operations"></a><span data-ttu-id="fff58-205">Настройка в Finance and Operations</span><span class="sxs-lookup"><span data-stu-id="fff58-205">Setup in Finance and Operations</span></span>

- <span data-ttu-id="fff58-206">Откройте **Продажи и маркетинг** &gt; **Периодические задачи** &gt; **Рассчитать итоги продаж** и настройте задание для выполнения в качестве пакетного задания.</span><span class="sxs-lookup"><span data-stu-id="fff58-206">Go to **Sales and marketing** &gt; **Periodic tasks** &gt; **Calculate sales totals**, and set the job to run as a batch job.</span></span> <span data-ttu-id="fff58-207">Задайте для параметра **Рассчитанные итоги для заказов на продажу** значение **Да**.</span><span class="sxs-lookup"><span data-stu-id="fff58-207">Set the **Calculate totals for sales orders** option to **Yes**.</span></span> <span data-ttu-id="fff58-208">Этот шаг важен, так как только заказы на продажу, для которых рассчитаны итоговые значения продаж, будут синхронизироваться с Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-208">This step is important, because only sales orders where sales totals are calculated will be synchronized to Sales.</span></span> <span data-ttu-id="fff58-209">Частота пакетного задания должна соответствовать частоте синхронизации заказов на продажу.</span><span class="sxs-lookup"><span data-stu-id="fff58-209">The frequency of the batch job should be aligned with the frequency of sales order synchronization.</span></span>

<span data-ttu-id="fff58-210">Если используется также интеграция заказов на работу, необходимо настроить происхождение заказа на продажу.</span><span class="sxs-lookup"><span data-stu-id="fff58-210">If you also use work order integration, you need to set up the sales origin.</span></span> <span data-ttu-id="fff58-211">Происхождение заказов на продажу используется для различения заказов на продажу в Finance and Operations, которые были созданы на основе заказов на выполнение работ в Field Service.</span><span class="sxs-lookup"><span data-stu-id="fff58-211">The sales origin is used to distinguish sales orders in Finance and Operations that were created from work orders in Field Service.</span></span> <span data-ttu-id="fff58-212">Когда заказ на продажу имеет происхождение продаж типа **Интеграция заказов на выполнение работ**, поле **Статус внешнего заказа на выполнение работ** появляется в заголовке заказа на продажу.</span><span class="sxs-lookup"><span data-stu-id="fff58-212">When a sales order has a sales origin of the **Work order integration** type, the **External work order status** field appears on the sales order header.</span></span> <span data-ttu-id="fff58-213">Кроме того, происхождение заказов на продажу обеспечивает, что заказы на продажу, которые были созданы на основе заказов на выполнение работ в Field Service, исключаются при фильтрации во время синхронизации заказов на продажу из Finance and Operations в Field Service.</span><span class="sxs-lookup"><span data-stu-id="fff58-213">Additionally, the sales origin ensures that sales orders that were created from work orders in Field Service are filtered out during sales order synchronization from Finance and Operations to Field Service.</span></span>

1. <span data-ttu-id="fff58-214">Перейдите в раздел **Продажи и маркетинг** \> **Настройка** \> **Заказы на продажу** \> **Происхождение заказа на продажу**.</span><span class="sxs-lookup"><span data-stu-id="fff58-214">Go to **Sales and marketing** \> **Setup** \> **Sales orders** \> **Sales origin**.</span></span>
2. <span data-ttu-id="fff58-215">Выберите **Создать** для создания нового происхождения заказов на продажу.</span><span class="sxs-lookup"><span data-stu-id="fff58-215">Select **New** to create a new sales origin.</span></span>
3. <span data-ttu-id="fff58-216">В поле **Происхождение заказа на продажу** введите имя происхождения заказа на продажу, например **SalesOrder**.</span><span class="sxs-lookup"><span data-stu-id="fff58-216">In the **Sales origin** field, enter a name for the sales origin, such as **SalesOrder**.</span></span>
4. <span data-ttu-id="fff58-217">В поле **Описание** введите описание, например **Заказ на продажу из Sales**.</span><span class="sxs-lookup"><span data-stu-id="fff58-217">In the **Description** field, enter a description, such as **Sales Order from Sales**.</span></span>
5. <span data-ttu-id="fff58-218">Установите флажок **Назначение типа источника**.</span><span class="sxs-lookup"><span data-stu-id="fff58-218">Select the **Origin type assignment** check box.</span></span>
6. <span data-ttu-id="fff58-219">Задайте в поле **Тип источника продаж** значение **Интеграция заказов на продажу**.</span><span class="sxs-lookup"><span data-stu-id="fff58-219">Set the **Sales origin type** field to **Sales order integration**.</span></span>
7. <span data-ttu-id="fff58-220">Нажмите **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="fff58-220">Select **Save**.</span></span>

### <a name="setup-in-the-sales-orders-sales-to-fin-and-ops---direct-data-integration-project"></a><span data-ttu-id="fff58-221">Настройка в проекте интеграции данных "Заказы на продажу (из Sales в Fin and Ops) - напрямую"</span><span class="sxs-lookup"><span data-stu-id="fff58-221">Setup in the Sales Orders (Sales to Fin and Ops) - Direct Data integration project</span></span>

- <span data-ttu-id="fff58-222">Убедитесь в наличии необходимого сопоставления для **Shipto\_country** в **DeliveryAddressCountryRegionISOCode**.</span><span class="sxs-lookup"><span data-stu-id="fff58-222">Make sure that the required mapping exists for **Shipto\_country** to **DeliveryAddressCountryRegionISOCode**.</span></span> <span data-ttu-id="fff58-223">Можно сделать пустым значение по умолчанию в карте соответствия, чтобы избежать необходимости ввода страны для заказов внутри страны.</span><span class="sxs-lookup"><span data-stu-id="fff58-223">You can make blank a default value in the value map to avoid having to type country for national orders.</span></span> <span data-ttu-id="fff58-224">Задайте в левой стороне значение "Пусто", а с правой стороны задайте нужную страну или регион.</span><span class="sxs-lookup"><span data-stu-id="fff58-224">Set the left side to 'Blank', and set the right side to the desired country or region.</span></span>

    <span data-ttu-id="fff58-225">Значение шаблона является схемой значений, где сопоставляются нескольких стран или регионов, и где "Пусто" = США.</span><span class="sxs-lookup"><span data-stu-id="fff58-225">The template value is a value map where several countries or regions are mapped, and where 'Blank' = US.</span></span>

### <a name="setup-in-the-sales-orders-fin-and-ops-to-sales---direct-data-integration-project"></a><span data-ttu-id="fff58-226">Настройка в проекте интеграции данных "Заказы на продажу (из Fin and Ops в Sales) - напрямую"</span><span class="sxs-lookup"><span data-stu-id="fff58-226">Setup in the Sales Orders (Fin and Ops to Sales) - Direct Data integration project</span></span>

#### <a name="salesheader-task"></a><span data-ttu-id="fff58-227">Задача SalesHeader</span><span class="sxs-lookup"><span data-stu-id="fff58-227">SalesHeader task</span></span>

- <span data-ttu-id="fff58-228">Для создания заказов в Sales требуется прайс-лист.</span><span class="sxs-lookup"><span data-stu-id="fff58-228">A price list is required in order to create orders in Sales.</span></span> <span data-ttu-id="fff58-229">Обновите схему сопоставления для **pricelevelid.name \[имя прайс-листа\]** на прайс-лист, используемый в Sales для данной валюты.</span><span class="sxs-lookup"><span data-stu-id="fff58-229">Update the value map for **pricelevelid.name \[Price List Name\]** to the price list that is used in Sales per currency.</span></span> <span data-ttu-id="fff58-230">Можно использовать прайс-лист по умолчанию для одной валюты.</span><span class="sxs-lookup"><span data-stu-id="fff58-230">You can use the default price list for a single currency.</span></span> <span data-ttu-id="fff58-231">Если имеются прайс-листы в нескольких валютах, можно использовать схему сопоставления.</span><span class="sxs-lookup"><span data-stu-id="fff58-231">Alternatively, if you have price lists in multiple currencies, you can use a value map.</span></span>

    <span data-ttu-id="fff58-232">Значение по умолчанию шаблона для **pricelevelid.name \[имя прайс-листа\]** — **CRM Service USA (sample)**.</span><span class="sxs-lookup"><span data-stu-id="fff58-232">The default template value for **pricelevelid.name \[Price List Name\]** is **CRM Service USA (sample)**.</span></span>

#### <a name="salesline-task"></a><span data-ttu-id="fff58-233">Задача SalesLine</span><span class="sxs-lookup"><span data-stu-id="fff58-233">SalesLine task</span></span>

- <span data-ttu-id="fff58-234">Убедитесь, что существует требуемая схема сопоставления значений для **SalesUnitSymbol** в Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="fff58-234">Make sure that the required value map for **SalesUnitSymbol** in Finance and Operations exists.</span></span>
- <span data-ttu-id="fff58-235">Убедитесь в том, что требуемые единицы определены в Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-235">Make sure that the required units are defined in Sales.</span></span>

    <span data-ttu-id="fff58-236">Значение шаблона, которое имеет сопоставление значений, определено для **SalesUnitSymbol** в **oumid.name**.</span><span class="sxs-lookup"><span data-stu-id="fff58-236">A template value that has a value map is defined for **SalesUnitSymbol** to **oumid.name**.</span></span>

## <a name="template-mapping-in-data-integration"></a><span data-ttu-id="fff58-237">Сопоставление шаблона в интеграции данных</span><span class="sxs-lookup"><span data-stu-id="fff58-237">Template mapping in Data integration</span></span>

> [!NOTE]
> <span data-ttu-id="fff58-238">Поля **Условия оплаты**, **Условия фрахта**, **Условия поставки**, **Способ доставки** и **Режим доставки** не являются частью сопоставлений по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="fff58-238">The **Payment terms**, **Freight terms**, **Delivery terms**, **Shipping method**, and **Delivery mode** fields aren't part of the default mappings.</span></span> <span data-ttu-id="fff58-239">Чтобы сопоставить эти поля, необходимо настроить преобразование значений, характерное для данных в организациях, между которыми синхронизируется объект.</span><span class="sxs-lookup"><span data-stu-id="fff58-239">To map these fields, you must set up a value mapping that is specific to the data in the organizations that the entity is synchronized between.</span></span>

<span data-ttu-id="fff58-240">На следующем рисунке показан пример сопоставления шаблона в интеграции данных.</span><span class="sxs-lookup"><span data-stu-id="fff58-240">The following illustrations show an example of a template mapping in Data integration.</span></span>

> [!NOTE]
> <span data-ttu-id="fff58-241">Сопоставление показывает, какие данные полей будут синхронизированы из Sales в Finance and Operations или из Finance and Operations в Sales.</span><span class="sxs-lookup"><span data-stu-id="fff58-241">The mapping shows which field information will be synchronized from Sales to Finance and Operations, or from Finance and Operations to Sales.</span></span>

### <a name="sales-orders-fin-and-ops-to-sales---direct-orderheader"></a><span data-ttu-id="fff58-242">Заказы на продажу (из Fin and Ops в Sales) - напрямую: OrderHeader</span><span class="sxs-lookup"><span data-stu-id="fff58-242">Sales Orders (Fin and Ops to Sales) - Direct: OrderHeader</span></span>

<span data-ttu-id="fff58-243">[![Сопоставление шаблона в интеграции данных](./media/sales-order-direct-template-mapping-data-integrator-1.png)](./media/sales-order-direct-template-mapping-data-integrator-1.png)</span><span class="sxs-lookup"><span data-stu-id="fff58-243">[![Template mapping in Data integration](./media/sales-order-direct-template-mapping-data-integrator-1.png)](./media/sales-order-direct-template-mapping-data-integrator-1.png)</span></span>

### <a name="sales-orders-fin-and-ops-to-sales---direct-orderline"></a><span data-ttu-id="fff58-244">Заказы на продажу (из Fin and Ops в Sales) - напрямую: OrderLine</span><span class="sxs-lookup"><span data-stu-id="fff58-244">Sales Orders (Fin and Ops to Sales) - Direct: OrderLine</span></span>

<span data-ttu-id="fff58-245">[![Сопоставление шаблона в интеграции данных](./media/sales-order-direct-template-mapping-data-integrator-2.png)](./media/sales-order-direct-template-mapping-data-integrator-2.png)</span><span class="sxs-lookup"><span data-stu-id="fff58-245">[![Template mapping in Data integration](./media/sales-order-direct-template-mapping-data-integrator-2.png)](./media/sales-order-direct-template-mapping-data-integrator-2.png)</span></span>

### <a name="sales-orders-sales-to-fin-and-ops---direct-orderheader"></a><span data-ttu-id="fff58-246">Заказы на продажу (из Sales в Fin and Ops) - напрямую: OrderHeader</span><span class="sxs-lookup"><span data-stu-id="fff58-246">Sales Orders (Sales to Fin and Ops) - Direct: OrderHeader</span></span>

<span data-ttu-id="fff58-247">[![Сопоставление шаблона в интеграции данных](./media/sales-order-direct-template-mapping-data-integrator-3.png)](./media/sales-order-direct-template-mapping-data-integrator-3.png)</span><span class="sxs-lookup"><span data-stu-id="fff58-247">[![Template mapping in Data integration](./media/sales-order-direct-template-mapping-data-integrator-3.png)](./media/sales-order-direct-template-mapping-data-integrator-3.png)</span></span>

### <a name="sales-orders-sales-to-fin-and-ops---direct-orderline"></a><span data-ttu-id="fff58-248">Заказы на продажу (из Sales в Fin and Ops) - напрямую: OrderLine</span><span class="sxs-lookup"><span data-stu-id="fff58-248">Sales Orders (Sales to Fin and Ops) - Direct: OrderLine</span></span>

<span data-ttu-id="fff58-249">[![Сопоставление шаблона в интеграции данных](./media/sales-order-direct-template-mapping-data-integrator-4.png)](./media/sales-order-direct-template-mapping-data-integrator-4.png)</span><span class="sxs-lookup"><span data-stu-id="fff58-249">[![Template mapping in Data integration](./media/sales-order-direct-template-mapping-data-integrator-4.png)](./media/sales-order-direct-template-mapping-data-integrator-4.png)</span></span>

## <a name="related-topics"></a><span data-ttu-id="fff58-250">Связанные разделы</span><span class="sxs-lookup"><span data-stu-id="fff58-250">Related topics</span></span>

[<span data-ttu-id="fff58-251">Решение "Перспективный клиент в наличные деньги"</span><span class="sxs-lookup"><span data-stu-id="fff58-251">Prospect to cash</span></span>](prospect-to-cash.md)

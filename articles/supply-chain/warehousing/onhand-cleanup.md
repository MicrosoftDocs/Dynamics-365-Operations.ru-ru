---
title: Задание очистки записей в наличии для управления складом
description: В этом разделе описываются задания очистки записей в наличии, которые помогают повысить производительность системы, определяя и удаляя связанные, но ненужные записи.
author: perlynne
manager: tfehr
ms.date: 04/23/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
ms.search.form: SysOperationTemplateForm
audience: Application User
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: perlynne
ms.search.validFrom: 2020-04-03
ms.dyn365.ops.version: Release 10.0.12
ms.openlocfilehash: f045b9686bbdfcf3e82f5158f0fd28860354b7d7
ms.sourcegitcommit: b6686265314499056690538eaa95ca51cff7c720
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2021
ms.locfileid: "5014491"
---
# <a name="warehouse-management-on-hand-entries-cleanup-job"></a><span data-ttu-id="c7a03-103">Задание очистки записей в наличии для управления складом</span><span class="sxs-lookup"><span data-stu-id="c7a03-103">Warehouse management on-hand entries cleanup job</span></span>

<span data-ttu-id="c7a03-104">Количество запросов, используемых для расчета запасов в наличии, зависит от количества записей в задействованных таблицах.</span><span class="sxs-lookup"><span data-stu-id="c7a03-104">The performance of queries that are used to calculate on-hand inventory is affected by the number of records in the tables that are involved.</span></span> <span data-ttu-id="c7a03-105">Одним из способов улучшения производительности является уменьшение количества записей, которые должна учитывать база данных.</span><span class="sxs-lookup"><span data-stu-id="c7a03-105">One way to help improve the performance is to reduce the number of records that the database must consider.</span></span>

<span data-ttu-id="c7a03-106">В этом разделе описываются задания очистки записей в наличии, которые удаляют ненужные записи в таблицах InventSum и WHSInventReserve.</span><span class="sxs-lookup"><span data-stu-id="c7a03-106">This topic describes the on-hand entries cleanup job, which deletes unneeded records in the InventSum and WHSInventReserve tables.</span></span> <span data-ttu-id="c7a03-107">В этих таблицах хранятся сведения "в наличии" для номенклатур, включенных в обработку управления складом.</span><span class="sxs-lookup"><span data-stu-id="c7a03-107">These tables store on-hand information for items that are enabled for warehouse management processing.</span></span> <span data-ttu-id="c7a03-108">(Эти номенклатуры называются номенклатурами WHS.) Удаление этих записей может значительно повысить производительность при расчетах "в наличии".</span><span class="sxs-lookup"><span data-stu-id="c7a03-108">(These items are referred to as WHS items.) Deletion of these records can significantly improve the performance of on-hand calculations.</span></span>

## <a name="what-the-cleanup-job-does"></a><span data-ttu-id="c7a03-109">Что делает задание очистки</span><span class="sxs-lookup"><span data-stu-id="c7a03-109">What the cleanup job does</span></span>

<span data-ttu-id="c7a03-110">Задание очистки записей в наличии удаляет все записи в таблицах WHSInventReserve и InventSum, где все значения полей равны *0* (нулю).</span><span class="sxs-lookup"><span data-stu-id="c7a03-110">The on-hand entries cleanup job deletes any records in the WHSInventReserve and InventSum tables where all the field values are *0* (zero).</span></span> <span data-ttu-id="c7a03-111">Эти записи могут быть удалены, так как они не влияют на информацию "в наличии".</span><span class="sxs-lookup"><span data-stu-id="c7a03-111">These records can be deleted because they don't contribute to the on-hand information.</span></span> <span data-ttu-id="c7a03-112">Задание удаляет только записи, расположенные под уровнем **Местоположение**.</span><span class="sxs-lookup"><span data-stu-id="c7a03-112">The job deletes only records that are below the **Location** level.</span></span>

<span data-ttu-id="c7a03-113">Если отрицательные физические запасы разрешены, задание очистки может не суметь удалить все соответствующие записи.</span><span class="sxs-lookup"><span data-stu-id="c7a03-113">If negative physical inventory is allowed, the cleanup job might not be able to delete all the relevant entries.</span></span> <span data-ttu-id="c7a03-114">Причиной этого ограничения является то, что для задания должно быть разрешен специальный сценарий, в котором у грузоместа есть несколько серийных номеров, и один из этих серийных номеров стал отрицательным.</span><span class="sxs-lookup"><span data-stu-id="c7a03-114">The reason for this limitation is that the job must allow for a special scenario where a license plate has multiple serial numbers, and one of those serial numbers has become negative.</span></span> <span data-ttu-id="c7a03-115">Например, в системе будет нулевое "в наличии" на уровне грузоместа, когда у грузоместа есть +1 шт. серийного номера 1 и –1 шт. серийного номера 2.</span><span class="sxs-lookup"><span data-stu-id="c7a03-115">For example, the system will have zero on hand at the license plate level when a license plate has +1 pcs of serial number 1 and –1 pcs of serial number 2.</span></span> <span data-ttu-id="c7a03-116">Для этого специального сценария задание выполнит удаление в ширину, когда оно сначала попытается удалить с нижних уровней.</span><span class="sxs-lookup"><span data-stu-id="c7a03-116">For this special scenario, the job does a breadth-first deletion, where it tries to delete from lower levels first.</span></span>

## <a name="schedule-and-configure-the-cleanup-job"></a><span data-ttu-id="c7a03-117">Планирование и настройка задания очистки</span><span class="sxs-lookup"><span data-stu-id="c7a03-117">Schedule and configure the cleanup job</span></span>

<span data-ttu-id="c7a03-118">Задание очистки записей "в наличии" доступно в **Управление запасами \> Периодические задачи \> Очистка \> Задание очистки записей в наличии для управления складом**.</span><span class="sxs-lookup"><span data-stu-id="c7a03-118">The on-hand entries cleanup job is available at **Inventory management \> Periodic tasks \> Clean up \> Warehouse management on-hand entries cleanup**.</span></span> <span data-ttu-id="c7a03-119">Используйте стандартные параметры задания для управления областью и графиком выполнения задания.</span><span class="sxs-lookup"><span data-stu-id="c7a03-119">Use the standard job settings to control the scope and schedule for running the job.</span></span> <span data-ttu-id="c7a03-120">Кроме того, предоставляются следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="c7a03-120">In addition, the following settings are provided:</span></span>

- <span data-ttu-id="c7a03-121">**Удалить, если не обновлялось в течение этого количества дней** — введите минимальное количество дней ожидания до удаления задания, после чего удаляется запись "в наличии", в которой количество стало равным нулю.</span><span class="sxs-lookup"><span data-stu-id="c7a03-121">**Delete if not updated for this many days** – Enter the minimum number of days that the job should wait before it deletes an on-hand entry that has dropped to zero quantity.</span></span> <span data-ttu-id="c7a03-122">Используйте этот параметр, чтобы уменьшить риск удаления записей "в наличии", которые еще используются.</span><span class="sxs-lookup"><span data-stu-id="c7a03-122">Use this setting to help reduce the risk of deleting on-hand entries that are still being used.</span></span> <span data-ttu-id="c7a03-123">Если требуется, чтобы очистка выполнялась как можно скорее, введите *0* (ноль) или оставьте поле пустым.</span><span class="sxs-lookup"><span data-stu-id="c7a03-123">If you want cleanup to occur as soon as possible, either enter *0* (zero) or leave the field blank.</span></span>
- <span data-ttu-id="c7a03-124">**Максимальное время выполнения (часы)** — введите максимальное время выполнения задания очистки в часах.</span><span class="sxs-lookup"><span data-stu-id="c7a03-124">**Maximum execution time (hours)** – Enter the maximum execution time of the cleanup job, in hours.</span></span> <span data-ttu-id="c7a03-125">Если задание не было завершено до окончания этого времени, оно сохранит уже завершенную работу, а затем закроет себя.</span><span class="sxs-lookup"><span data-stu-id="c7a03-125">If the job isn't completed before this time passes, it will save the work that it has completed so far and then close itself.</span></span> <span data-ttu-id="c7a03-126">Эта возможность особенно важна для тех реализаций, в которых используется высокая интенсивность использования запасов.</span><span class="sxs-lookup"><span data-stu-id="c7a03-126">This capability is especially relevant for implementations that have high inventory use.</span></span> <span data-ttu-id="c7a03-127">В таких случаях задание должно запускаться в запланированное время, когда загрузка системы минимальная.</span><span class="sxs-lookup"><span data-stu-id="c7a03-127">In these cases, you should schedule the job to run at times when the system load is as light as possible.</span></span> <span data-ttu-id="c7a03-128">Если необходимо, чтобы пакетное задание выполнялось до завершения, введите *0* (ноль) или оставьте поле пустым.</span><span class="sxs-lookup"><span data-stu-id="c7a03-128">If you want the batch job to continue to run until it's completed, either enter *0* (zero) or leave the field blank.</span></span> <span data-ttu-id="c7a03-129">Этот параметр доступен только в том случае, если [в системе включена соответствующая функция](#max-execution-time).</span><span class="sxs-lookup"><span data-stu-id="c7a03-129">This setting is available only if the related feature has been [turned on in your system](#max-execution-time).</span></span>

<span data-ttu-id="c7a03-130">Хотя задание можно выполнять в обычное рабочее время, рекомендуется его использовать вне рабочего дня.</span><span class="sxs-lookup"><span data-stu-id="c7a03-130">Although you can run the job during regular business hours, we recommend that you run it outside working hours.</span></span> <span data-ttu-id="c7a03-131">Таким образом можно предотвратить конфликты, которые могут возникать, если пользователь работает с записью, которая также очищается.</span><span class="sxs-lookup"><span data-stu-id="c7a03-131">In this way, you help prevent conflicts that can occur if a user is working with a record that is also being cleaned up.</span></span>

<span data-ttu-id="c7a03-132">Если задание пытается удалить запись для номенклатуры, в то время как эта запись используется другим пользователем, возникает ошибка взаимоблокировки для задания очистки или пользователя.</span><span class="sxs-lookup"><span data-stu-id="c7a03-132">If the job tries to delete a record for an item while that record is being used by another user, a deadlock error occurs for either the cleanup job or the user.</span></span>

<span data-ttu-id="c7a03-133">При выполнении задания его фиксированный размер равен 100.</span><span class="sxs-lookup"><span data-stu-id="c7a03-133">When the job runs, it has a commit size of 100.</span></span> <span data-ttu-id="c7a03-134">Другими словами, оно попытается подтвердить выполнение один раз для каждых 100 удалений.</span><span class="sxs-lookup"><span data-stu-id="c7a03-134">In other words, it will try to commit one time for every 100 deletions.</span></span> <span data-ttu-id="c7a03-135">Однако в связи с тем, что некоторые удаления устанавливаются на основе наборов, в одной и той же проводке могут быть удалены более 100 записей.</span><span class="sxs-lookup"><span data-stu-id="c7a03-135">However, because some deletions are set-based, there might be scenarios where more than 100 records can be deleted in the same transaction.</span></span> <span data-ttu-id="c7a03-136">Таким образом, эскалации блокировки могут случаться.</span><span class="sxs-lookup"><span data-stu-id="c7a03-136">Therefore, lock escalations can still sometimes occur.</span></span>

## <a name="possible-user-impact"></a><span data-ttu-id="c7a03-137">Возможное воздействие пользователя</span><span class="sxs-lookup"><span data-stu-id="c7a03-137">Possible user impact</span></span>

<span data-ttu-id="c7a03-138">Пользователи могут повлиять на то, что задание по очистке записей "в наличии" удаляет все записи для данного уровня (например, уровня грузоместа).</span><span class="sxs-lookup"><span data-stu-id="c7a03-138">Users might be affected if the on-hand entries cleanup job deletes all the records for a given level (such as the license plate level).</span></span> <span data-ttu-id="c7a03-139">В этом случае функции для просмотра того, что запасы ранее были доступны "в наличии" для грузоместа, могут работать не так, как ожидалось, так как соответствующие записи "в наличии" исчезают.</span><span class="sxs-lookup"><span data-stu-id="c7a03-139">In this case, the functionality for seeing that inventory was previously available on-hand at a license plate might not work as expected because the relevant on-hand entries are no longer available.</span></span> <span data-ttu-id="c7a03-140">Это можно, например, проявляться в следующих ситуациях:</span><span class="sxs-lookup"><span data-stu-id="c7a03-140">This can, for example, be experienced in the following situations:</span></span>

- <span data-ttu-id="c7a03-141">В пункте **Список в наличии**, когда пользователь отменяет выбор условия **Количество \<\> 0** или выбирает условие **Закрытые проводки** в параметрах **Отображение аналитик**.</span><span class="sxs-lookup"><span data-stu-id="c7a03-141">On the **On-hand list**, when the user deselects the condition **Quantity \<\> 0** or selects the condition **Closed transactions** in the **Dimensions display** settings.</span></span>
- <span data-ttu-id="c7a03-142">В отчете **Физические запасы по складским аналитикам** для прошлых периодов, когда пользователь устанавливает параметр **По состоянию на дату**.</span><span class="sxs-lookup"><span data-stu-id="c7a03-142">In a **Physical inventory by inventory dimension** report for past periods, when the user sets the **As of date** parameter.</span></span>

<span data-ttu-id="c7a03-143">Однако повышение производительности, предоставляемое заданием очистки, должно компенсировать эти небольшие потери в функциональности.</span><span class="sxs-lookup"><span data-stu-id="c7a03-143">However, the performance improvement that the cleanup job provides should make up for these small losses in functionality.</span></span>

## <a name="make-the-maximum-execution-time-setting-available"></a><a name="max-execution-time"></a><span data-ttu-id="c7a03-144">Включение параметра максимального времени выполнения</span><span class="sxs-lookup"><span data-stu-id="c7a03-144">Make the Maximum execution time setting available</span></span>

<span data-ttu-id="c7a03-145">По умолчанию параметр **Максимальное время выполнения** недоступен.</span><span class="sxs-lookup"><span data-stu-id="c7a03-145">By default, the **Maximum execution time** setting isn't available.</span></span> <span data-ttu-id="c7a03-146">Если его необходимо использовать, в [управлении функциями](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) включите соответствующую функцию в своей системе.</span><span class="sxs-lookup"><span data-stu-id="c7a03-146">If you want to use it, you must use [feature management](../../fin-ops-core/fin-ops/get-started/feature-management/feature-management-overview.md) to turn on the related feature in your system.</span></span> <span data-ttu-id="c7a03-147">В рабочей области **Управление функциями** эта функция перечисляется следующими способами:</span><span class="sxs-lookup"><span data-stu-id="c7a03-147">In the **Feature management** workspace, the feature is listed in the following way:</span></span>

- <span data-ttu-id="c7a03-148">**Модуль:** *Управление складом*</span><span class="sxs-lookup"><span data-stu-id="c7a03-148">**Module:** *Warehouse management*</span></span>
- <span data-ttu-id="c7a03-149">**Имя функции:** *максимальное время выполнения для задания очистки записей "в наличии" для управления складом*</span><span class="sxs-lookup"><span data-stu-id="c7a03-149">**Feature name:** *Maximum execution time for the warehouse management on-hand entries cleanup job*</span></span>

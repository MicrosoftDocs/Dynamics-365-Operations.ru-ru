---
title: Развертывание пограничных единиц масштабирования на пользовательском оборудовании с помощью LBD (предварительная версия)
description: В этой теме объясняется, как подготавливать локальные пограничные единицы масштабирования с помощью пользовательского оборудования и развертывания на основе локальных бизнес-данных (LBD).
author: cabeln
ms.date: 04/22/2021
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: kamaybac
ms.search.region: Global
ms.author: cabeln
ms.search.validFrom: 2021-04-13
ms.dyn365.ops.version: 10.0.19
ms.openlocfilehash: 0ebbdaab9d6f040497d3158db2712e102b6e9aa8
ms.sourcegitcommit: 1e5a46271bf7fae2f958d2b1b666a8d2583e04a8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2021
ms.locfileid: "7678989"
---
# <a name="deploy-edge-scale-units-on-custom-hardware-using-lbd-preview"></a>Развертывание пограничных единиц масштабирования на пользовательском оборудовании с помощью LBD (предварительная версия)

[!include [banner](../includes/banner.md)]
[!include [preview banner](../includes/preview-banner.md)] <!--KFM: Until 11/1/2021 -->

Пограничные единицы масштабирования играют важную роль в распределенной гибридной топологии для управления цепочкой поставок. В гибридной топологии можно распределить рабочие нагрузки между облачным центром Supply Chain Management и дополнительными единицами масштабирования в облаке или на пограничном уровне.

Пограничные единицы масштабирования могут быть развернуты путем создания локальных бизнес-данных (LBD) [в локальной среде](../../fin-ops-core/dev-itpro/deployment/on-premises-deployment-landing-page.md), а затем настроены для функционирования в качестве единицы масштабирования в распределенной гибридной топологии для управления цепочкой поставок. Это достигается путем связывания локальной среды LBD со средой Supply Chain Management в облаке, которая была настроена для работы в качестве концентратора.  

В настоящее время пограничные единицы масштабирования — используются как предварительная версия. Таким образом, среду этого типа можно использовать только в соответствии с [условиями предварительной версии](https://aka.ms/scmcnepreviewterms).

В этой теме описывается, как настроить локальную среду LBD в качестве пограничной единицы масштабирования и затем связать ее с концентратором.

## <a name="deployment-overview"></a>Обзор развертывания

Ниже приведены шаги развертывания.

1. **Включите слот LBD в проекте LBD в Microsoft Dynamics Lifecycle Services (LCS).**

    Во время предварительной версии, пограничная единица масштабирования LBD относятся к существующим клиентам LBD. Дополнительный ограниченный 60-дневный слот "песочницы" LBD будет предоставляться только в особых ситуациях для клиентов.

1. **Установка и развертывание среды LBD с *пустой* базой данных.**

    LCS можно использовать для развертывания среды LBD с последней топологией и пустой базой данных. Дополнительные сведения см. в разделе [Настройка и развертывание среды LBD с пустой базой данных](#set-up-deploy) далее в этой теме. Следует использовать версию Supply Chain Management 10.0.19 с обновлением платформы 43 или новее в средах концентратора и единицей масштабирования.

1. **Отправка целевых пакетов в активы проекта LBD в LCS.**

    Подготовка пакетов приложений, платформ и настроек, которые используются в концентраторе и в пограничных единицах масштабирования. Дополнительные сведения см. в разделе [Отправка целевых пакетов в активы проекта LBD в LCS](#upload-packages) далее в этой теме.

1. **Обслуживание среды LBD с целевыми пакетами.**

    Этот шаг гарантирует, что в концентраторе и луче развернуты те же сборка и настройки. Дополнительные сведения см. в разделе [Обслуживание среды LBD с целевыми пакетами](#service-target-packages) далее в этой теме.

1. **Выполните настройку единиц масштабирования и назначение рабочей нагрузки.**

    Дополнительные сведения см. в разделе [Назначение пограничной единицы масштабирования LBD концентратору](#assign-edge-to-hub) далее в этой теме.

В остальных разделах этой темы приведены дополнительные сведения о выполнении этих шагов.

## <a name="set-up-and-deploy-an-lbd-environment-with-an-empty-database"></a><a name="set-up-deploy"></a>Установка и развертывание среды LBD с пустой базой данных

На этом шаге создается функциональная среда LBD. Однако среда не обязательно должна иметь одинаковую версию приложения и платформы в качестве среды концентратора. Кроме того, еще не хватает настроек, и она не может работать в качестве единицы масштабирования.

1. Следуйте инструкциям по [установке и развертыванию локальных сред (обновление платформы 41 и новее)](../../fin-ops-core/dev-itpro/deployment/setup-deploy-on-premises-pu41.md). Следует использовать версию Supply Chain Management 10.0.19 с обновлением платформы 43 или новее в средах концентратора и единицей масштабирования.

    > [!IMPORTANT]
    > Ознакомьтесь с оставшейся частью данного раздела **перед** выполнением шагов, описанных в этом разделе.

1. Перед описанием конфигурации в файле infrastructure\\ConfigTemplate.xml выполните следующий сценарий:

    ```powershell
    .\Configure-ScriptsForEdgeScaleUnits.ps1 -ConfigurationFilePath .\ConfigTemplate.xml
    ```

    > [!NOTE]
    > Этот сценарий удалит все конфигурации, которые не требуются для развертывания пограничных единиц масштабирования.

1. Настройте базу данных, содержащую пустые данные, как описано в разделе [Настройка баз данных](../../fin-ops-core/dev-itpro/deployment/setup-deploy-on-premises-pu41.md#configuredb). Для этого шага используйте пустой файл data.bak.
1. Настройте скрипт, выполняемый перед развертыванием. Дополнительные сведения см. в разделе [Сценарии, выполняемые перед развертыванием и после развертывания локального агента](../../fin-ops-core/dev-itpro/lifecycle-services/pre-post-scripts.md).

    1. Скопируйте содержимое папки **ScaleUnit** в разделе **Сценарии инфраструктуры** в папку **Scripts** в общей папке хранилища файлов агента, которая была настроена в среде. Типичным путем является \\\\lbdiscsi01\\agent\\Scripts.
    2. Создайте сценарий **PreDeployment.ps1**, который будет вызывать сценарии с использованием обязательных параметров. Сценарий, выполняемый перед развертыванием, должен быть помещен в папку **Scripts** в общем ресурсе хранилища файлов агента. В противном случае он не может быть выполнен. Типичным путем является \\\\lbdiscsi01\\agent\\Scripts\\PreDeployment.ps1.

        Содержимое сценария PreDeployment.ps1 будет аналогичным в следующем примере.

        ```powershell
        $agentShare = '\\lbdiscsi01\agent'
        
        Write-Output "AgentShare is set to $agentShare" 
        & $agentShare\Scripts\Configure-CloudandEdge.ps1 -AgentShare $agentShare -InstanceId '@A' -DatabaseServer 'lbdsqla01.contoso.com' -DatabaseName 'AXDB'
        ```

        > [!NOTE]
        > Параметр InstanceId должен состоять из двух символов. Первый символ — @, второй — любая прописная буква английского алфавита.
        >
        > - Допустимые значения:
        >   - @D
        >   - @X
        > - Недопустимые значения:
        >   - @a
        >   - @4
        >   - @#

1. Разверните среду, используя последнюю доступную базовую топологию.

## <a name="upload-target-packages-into-lbd-project-assets-in-lcs"></a><a name="upload-packages"></a>Отправка целевых пакетов в активы проекта LBD в LCS

Этот шаг позволяет подготовить версию приложения, версию платформы и настройки, которые будут перенесены в среду единицы масштабирования LBD.

1. Отправьте одинаковый комбинированный пакет приложения/платформы, который был применен к среде концентратора, в библиотеку активов локального проекта LCS.
1. Получите копию настраиваемого развертываемого пакета, который был применен к среде концентратора, и отправьте в библиотеку активов локального проекта LCS.

## <a name="service-the-lbd-environment-with-target-packages"></a><a name="service-target-packages"></a>Обслуживание среды LBD с целевыми пакетами

Этот шаг сопоставляет версию приложения, версию платформы и настройки в среде единицы масштабирования LBD с концентратором.

1. Обслуживание среды LBD с объединенным пакетом приложения/платформы, который был отправлен на предыдущем шаге.
1. Обслуживание среды LBD с настраиваемым развертываемым пакетом, который был отправлен на предыдущем шаге.

    ![Выбор Поддержка > Применение обновлений в LCS.](media/cloud_edge-LBD-LCS-ServiceLBDEnv1.png "Выбор Поддержка > Применение обновлений в LCS")

    ![Выбор вашего пакета настройки.](media/cloud_edge-LBD-LCS-ServiceLBDEnv2.png "Выбор вашего пакета настройки")

## <a name="assign-your-lbd-edge-scale-unit-to-a-hub"></a><a name="assign-edge-to-hub"></a>Назначение пограничной единицы масштабирования LBD концентратору

Хотя пограничные единицы масштабирования все еще находятся в предварительной версии, необходимо использовать [средства развертывания и настройки единиц масштабирования](https://github.com/microsoft/SCMScaleUnitDevTools), доступные в GitHub, чтобы присвоить пограничную единицу масштабирования LBD концентратору. Этот процесс позволяет конфигурации LBD работать в качестве пограничной единицы масштабирования и связывает ее с концентратором. Процесс аналогичен настройке одноблочной среды разработки.

1. Загрузите последнюю версию [SCMScaleUnitDevTools](https://github.com/microsoft/SCMScaleUnitDevTools/releases) и распакуйте содержимое файла.
1. Создайте копию файла `UserConfig.sample.xml` и присвойте ей имя `UserConfig.xml`.
1. Создайте приложение Microsoft Azure Active Directory (Azure AD) в вашем клиенте Azure AD, как упоминалось в [руководстве по развертыванию для единиц масштабирования и рабочих нагрузок](https://github.com/microsoft/SCMScaleUnitDevTools/wiki/Step-by-step-usage-guide#aad-application-registrations).
    1. После создания перейдите в форму приложений Azure AD (SysAADClientTable) в своем концентраторе.
    1. Создайте новую запись и задайте **Идентификатор клиента** для идентификатора созданного приложения. Задайте **Имя** как *ScaleUnits* и **Идентификатор пользователя** как *Администратор*.

1. Создайте приложение службы федерации Active Directory (AD FS), как упоминалось в [руководстве по развертыванию для единиц масштабирования и рабочих нагрузок](https://github.com/microsoft/SCMScaleUnitDevTools/wiki/Step-by-step-usage-guide#adfs-application-registrations).
    1. После создания перейдите в форму приложений Azure AD (SysAADClientTable) в своей пограничной единице масштабирования.
    1. Создайте новую запись и задайте **Идентификатор клиента** для идентификатора созданного приложения. Задайте **Идентификатор пользователя** как *Администратор*.

1. Измените файл `UserConfig.xml`.
    1. В разделе `InterAOSAADConfiguration` введите данные ранее созданного приложения Azure AD.
        - В элементе `AppId` введите идентификатор приложения Azure.
        - В элементе `AppSecret` введите секрет приложения Azure.
        - Элемент `Authority` должен содержать URL-адрес, указывающий администратора безопасности для вашего клиента.

        ```xml
        <InterAOSAADConfiguration>
            <AppId>8dab14f6-97b1-48e3-b51b-350b45f6ede5</AppId>
            <AppSecret>k6em-_7.lopty56TGUedDTVhtER-j_6anY1</AppSecret>
            <Authority>https://login.windows.net/contoso.onmicrosoft.com</Authority>
        </InterAOSAADConfiguration>
        ```

    1. В разделе `ScaleUnitConfiguration` для первого `ScaleUnitInstance` измените раздел `AuthConfiguration`.
        - В элементе `AppId` введите идентификатор приложения Azure.
        - В элементе `AppSecret` введите секрет приложения Azure.
        - Элемент `Authority` должен содержать URL-адрес, указывающий администратора безопасности для вашего клиента.

        ```xml
        <AuthConfiguration>
            <AppId>8dab14f6-97b1-48e3-b51b-350b45f6ede5</AppId>
            <AppSecret>k6em-_7.lopdz.6d3DTVOtf9Lo-j_6anY1</AppSecret>
            <Authority>https://login.windows.net/contoso.onmicrosoft.com</Authority>
        </AuthConfiguration>
        ```

    1. Кроме того, для того же `ScaleUnitInstance` задайте следующие значения:
        - В элементе `Domain` укажите URL-адрес концентратора. Например: `https://cloudhub.sandbox.operations.dynamics.com/`
        - Убедитесь, что в элементе `EnvironmentType` задано значение `LCSHosted`.

    1. В разделе `ScaleUnitConfiguration` для второго `ScaleUnitInstance` измените раздел `AuthConfiguration`.
        - В элементе `AppId` введите идентификатор приложения AD FS.
        - В элементе `AppSecret` введите секрет приложения ADFS.
        - Элемент `Authority` должен содержать URL-адрес своего экземпляра AD FS.

        ```xml
        <AuthConfiguration>
            <AppId>26b16f25-21d8-4d36-987b-62df292895aa</AppId>
            <AppSecret>iZFfObgI6lLtY9kEbBjEFV98NqI5_YZ0e5SBcWER</AppSecret>
            <Authority>https://adfs.contoso.com/adfs</Authority>
        </AuthConfiguration>
        ```

    1. Кроме того, для того же `ScaleUnitInstance` задайте следующие значения:
        - В элементе `Domain` укажите URL-адрес пограничной единицы масштабирования. Например: https://ax.contoso.com/
        - Убедитесь, что в элементе `EnvironmentType` задано значение LBD.
        - В элементе `ScaleUnitId` введите то же значение, которое указано для `InstanceId` при настройке сценария `Configure-CloudandEdge.ps1`, выполняемого перед развертыванием.

        > [!NOTE]
        > Если не используется идентификатор по умолчанию (@A), обязательно обновите ScaleUnitId для каждой ConfiguredWorkload в разделе "Рабочие нагрузки".

1. Откройте PowerShell и перейдите к папке, содержащей файл `UserConfig.xml`.

1. Запустите этот инструмент с помощью этой команды.

    ```powershell
    .\CLI.exe
    ```

    > [!NOTE]
    > После каждого действия снова потребуется запустить инструмент.

1. В инструменте выберите **2. Подготовка сред для установки рабочей нагрузки**. Затем выполните следующие шаги:
    1. Выберите **1. Подготовьте концентратор**.
    1. Выберите **2. Подготовить единицу масштабирования**.

    > [!NOTE]
    > Если эта команда не выполняется из чистой установки, и происходит сбой, выполните следующие действия:
    >
    > - Уделите все папки из папки `aos-storage` (кроме `GACAssemblies`).
    > - Выполните следующую команду SQL в бизнес-базе данных (AXDB):
    >
    > ```sql 
    > delete from storagefoler
    > ```

1. Выполните следующие команды SQL в бизнес-базе данных (AXDB):

    ```sql
    delete from FEATUREMANAGEMENTMETADATA
    delete from FEATUREMANAGEMENTSTATE
    delete from NUMBERSEQUENCESCOPE
    ```

1. Убедитесь, что в бизнес-базе данных включено отслеживание изменений (AXDB).
    1. Запустите SQL Server Management Studio (SSMS).
    1. Щелкните правой кнопкой мыши бизнес-базу данных (AXDB) и выберите свойства.
    1. В открывшемся окне выберите **Отслеживание изменений** и выполните следующие настройки:

        - **Отслеживание изменений:** *Истина*
        - **Период хранения:** *7*
        - **Единицы удержания:** *дни*
        - **Автоматическая очистка:** *Истина*

1. В инструменте выберите **3. Установка рабочих нагрузок**. Затем выполните следующие шаги:
    1. Выберите **1. Установка в концентраторе**.
    1. Выберите **2. Установка в единице масштабирования**.

[!INCLUDE [cloud-edge-privacy-notice](../../includes/cloud-edge-privacy-notice.md)]

[!INCLUDE[footer-include](../../includes/footer-banner.md)]

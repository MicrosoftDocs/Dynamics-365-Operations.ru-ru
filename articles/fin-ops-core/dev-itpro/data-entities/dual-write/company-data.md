---
title: Концепция компании в Dataverse
description: Эта тема описывает интеграцию данных компаний между Finance and Operations и Dataverse.
author: RamaKrishnamoorthy
manager: AnnBe
ms.date: 08/04/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
ms.search.form: ''
audience: Application User, IT Pro
ms.reviewer: rhaertle
ms.custom: ''
ms.assetid: ''
ms.search.region: global
ms.search.industry: ''
ms.author: ramasri
ms.dyn365.ops.version: ''
ms.search.validFrom: 2019-07-15
ms.openlocfilehash: bbe634b87b3cb30ed993f9b3afeb4321d70f07e6
ms.sourcegitcommit: 7e1be696894731e1c58074d9b5e9c5b3acf7e52a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/17/2020
ms.locfileid: "4744887"
---
# <a name="company-concept-in-dataverse"></a><span data-ttu-id="2e1c1-103">Концепция компании в Dataverse</span><span class="sxs-lookup"><span data-stu-id="2e1c1-103">Company concept in Dataverse</span></span>

[!include [banner](../../includes/banner.md)]

[!include [rename-banner](~/includes/cc-data-platform-banner.md)]


<span data-ttu-id="2e1c1-104">В Finance and Operations концепция *компании* является как правовой конструкцией, так и бизнес-конструкцией.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-104">In Finance and Operations, the concept of a *company* is both a legal construct and a business construct.</span></span> <span data-ttu-id="2e1c1-105">Она также задает границу безопасности и видимости для данных.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-105">It's also a security and visibility boundary for data.</span></span> <span data-ttu-id="2e1c1-106">Пользователи всегда работают в контексте одной компании, и большая часть данных ограничивается компанией.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-106">Users always work in the context of a single company, and most of the data is striped by company.</span></span>

<span data-ttu-id="2e1c1-107">В Dataverse нет эквивалентной концепции.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-107">Dataverse doesn't have an equivalent concept.</span></span> <span data-ttu-id="2e1c1-108">Ближайшей концепцией является *бизнес-подразделение*, которое в первую очередь является границей безопасности и видимости для пользовательских данных.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-108">The closest concept is *business unit*, which is primarily a security and visibility boundary for user data.</span></span> <span data-ttu-id="2e1c1-109">Эта концепция не имеет тех же юридических или деловых последствий, как концепция компании.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-109">This concept doesn't have the same legal or business implications as the company concept.</span></span>

<span data-ttu-id="2e1c1-110">Поскольку бизнес-подразделение и компания не являются эквивалентными понятиями, невозможно принудительно задать взаимно-однозначное (1:1) сопоставление между ними в целях интеграции Dataverse.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-110">Because business unit and company aren't equivalent concepts, it isn't possible to force a one-to-one (1:1) mapping between them for the purpose of Dataverse integration.</span></span> <span data-ttu-id="2e1c1-111">Однако поскольку пользователи должны, по умолчанию, иметь возможность видеть одинаковые строки в приложении и Dataverse, корпорация Майкрософт представила новую таблицу в Dataverse, которая называется cdm\_Company.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-111">However, because users must, by default, be able to see the same rows in the application and Dataverse, Microsoft has introduced a new table in Dataverse that is named cdm\_Company.</span></span> <span data-ttu-id="2e1c1-112">Эта таблица эквивалентна таблице компании в приложении.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-112">This table is equivalent to the Company table in the application.</span></span> <span data-ttu-id="2e1c1-113">Чтобы помочь гарантировать, что видимость строк эквивалентна между приложением и Dataverse в готовом виде, рекомендуется следующая настройка данных в Dataverse:</span><span class="sxs-lookup"><span data-stu-id="2e1c1-113">To help guarantee that visibility of rows is equivalent between the application and Dataverse out of the box, we recommend the following setup for data in Dataverse:</span></span>

+ <span data-ttu-id="2e1c1-114">Для каждой строки компании Finance and Operations, которая включена для двойной записи, создается связанная строка cdm\_Company.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-114">For each Finance and Operations Company row that is enabled for dual-write, an associated cdm\_Company row is created.</span></span>
+ <span data-ttu-id="2e1c1-115">Когда строка cdm\_Company создается и включается для двойной записи, создается бизнес-подразделение по умолчанию, которое имеет то же имя.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-115">When a cdm\_Company row is created and enabled for dual-write, a default business unit is created that has the same name.</span></span> <span data-ttu-id="2e1c1-116">Хотя рабочая группа по умолчанию автоматически создается для этого бизнес-подразделения, бизнес-подразделение не используется.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-116">Although a default team is automatically created for that business unit, the business unit isn't used.</span></span>
+ <span data-ttu-id="2e1c1-117">Создается отдельная рабочая группа владельцев с тем же именем.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-117">A separate owner team is created that has the same name.</span></span> <span data-ttu-id="2e1c1-118">Она также связана с бизнес-подразделением.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-118">It's also associated with the business unit.</span></span>
+ <span data-ttu-id="2e1c1-119">По умолчанию владелец любой строки, созданной и записанной для двойной записи в Dataverse, задается для рабочей группы "DW Owner", которая связана с соответствующим бизнес-подразделением.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-119">By default, the owner of any row that is created and dual-written to Dataverse is set to the "DW Owner" team that is linked to the associated business unit.</span></span>

<span data-ttu-id="2e1c1-120">На следующем рисунке приведен пример такой настройки данных в Dataverse.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-120">The following illustration shows an example of this data setup in Dataverse.</span></span>

![Настройка данных в Dataverse](media/dual-write-company-1.png)

<span data-ttu-id="2e1c1-122">Из-за этой конфигурации любая строка, которая связана с компанией USMF, будет принадлежать рабочей группе, которая связана с бизнес-подразделением USMF в Dataverse.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-122">Because of this configuration, any row that is related to the USMF company will be owned by a team that is linked to the USMF business unit in Dataverse.</span></span> <span data-ttu-id="2e1c1-123">Таким образом, любой пользователь, который имеет доступ к этому бизнес-подразделению через роль безопасности, для которой установлена видимость на уровне бизнес-подразделения, теперь может видеть эти строки.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-123">Therefore, any user who has access to that business unit through a security role that is set to business unit–level visibility can now see those rows.</span></span> <span data-ttu-id="2e1c1-124">Ниже приводится пример, как рабочие группы могут быть использованы для обеспечения правильного доступа к этим строкам.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-124">The following example shows how teams can be used to provide the correct access to those rows.</span></span>

+ <span data-ttu-id="2e1c1-125">Роль "Менеджер по продажам" назначается членам рабочей группы "USMF Sales".</span><span class="sxs-lookup"><span data-stu-id="2e1c1-125">The "Sales Manager" role is assigned to members of the "USMF Sales" team.</span></span>
+ <span data-ttu-id="2e1c1-126">Пользователи, имеющие роль "Менеджер по продажам", могут получить доступ к любым строкам организации, которые являются членами того же бизнес-подразделения, в которое они входят.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-126">Users who have the "Sales Manager" role can access any account rows that are members of the same business unit that they are members of.</span></span>
+ <span data-ttu-id="2e1c1-127">Рабочая группа "USMF Sales" связана с бизнес-подразделением USMF, о котором говорилось ранее.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-127">The "USMF Sales" team is linked to the USMF business unit that was mentioned earlier.</span></span>
+ <span data-ttu-id="2e1c1-128">Таким образом, участники рабочей группы "USMF Sales" могут видеть любую организацию, которая принадлежит пользователю "USMF DW", которая поступила бы из таблицы компании USMF в Finance and Operations.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-128">Therefore, members of the "USMF Sales" team can see any account that is owned by the "USMF DW" user, which would have come from the USMF Company table in Finance and Operations.</span></span>

![Как можно использовать рабочие группы](media/dual-write-company-2.png)

<span data-ttu-id="2e1c1-130">Как показано на предыдущей иллюстрации, это сопоставление 1:1 между бизнес-подразделением, компанией и рабочей группой является лишь отправной точкой.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-130">As the preceding illustration shows, this 1:1 mapping between business unit, company, and team is just a starting point.</span></span> <span data-ttu-id="2e1c1-131">В этом примере новое бизнес-подразделение "Европа" создается вручную в Dataverse качестве родительского как для DEMF, так и для ESMF.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-131">In this example, a new "Europe" business unit is manually created in Dataverse as the parent for both DEMF and ESMF.</span></span> <span data-ttu-id="2e1c1-132">Это новое корневое бизнес-подразделение не имеет отношения к двойной записи.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-132">This new root business unit is unrelated to dual-write.</span></span> <span data-ttu-id="2e1c1-133">Тем не менее оно может быть использовано для предоставления членам рабочей группы "EUR Sales" доступа к данным организации как в DEMF, так и в ESMF, путем задания для видимости данных значения **Родительское/дочернее бизнес-подразделение** в связанной роли безопасности.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-133">However, it can be used to give members of the "EUR Sales" team access to account data in both DEMF and ESMF by setting the data visibility to **Parent/Child BU** in the associated security role.</span></span>

<span data-ttu-id="2e1c1-134">Последней темой для обсуждения является то, как двойная запись определяет, какой рабочей группе владельцев следует назначить строки.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-134">A final topic to discuss is how dual-write determines which owner team it should assign rows to.</span></span> <span data-ttu-id="2e1c1-135">Это поведение контролируется столбцом **Ответственная рабочая группа по умолчанию** в строке cdm\_Company.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-135">This behavior is controlled by the **Default owning team** column on the cdm\_Company row.</span></span> <span data-ttu-id="2e1c1-136">Когда строка cdm\_Company включена для двойной записи, подключаемый модуль автоматически создает связанное бизнес-подразделение и ответственную рабочую группу (если она еще не существует) и задает столбец **Ответственная рабочая группа по умолчанию**.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-136">When a cdm\_Company row is enabled for dual-write, a plug-in automatically creates the associated business unit and owner team (if it doesn't already exist), and sets the **Default owning team** column.</span></span> <span data-ttu-id="2e1c1-137">Администратор может изменить этот столбец на другое значение.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-137">The admin can change this column to a different value.</span></span> <span data-ttu-id="2e1c1-138">Однако администратор не может очистить этот столбец до тех пор, пока таблица включена для двойной записи.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-138">However, the admin can't clear the column as long as the table is enabled for dual-write.</span></span>

> [!div class="mx-imgBorder"]
<span data-ttu-id="2e1c1-139">![Столбец ответственной рабочей группы по умолчанию](media/dual-write-default-owning-team.jpg)</span><span class="sxs-lookup"><span data-stu-id="2e1c1-139">![Default owning team column](media/dual-write-default-owning-team.jpg)</span></span>

## <a name="company-striping-and-bootstrapping"></a><span data-ttu-id="2e1c1-140">Разделение компаний и начальная загрузка</span><span class="sxs-lookup"><span data-stu-id="2e1c1-140">Company striping and bootstrapping</span></span>

<span data-ttu-id="2e1c1-141">Интеграция Dataverse обеспечивает параллелизм компаний с помощью идентификатора компании для разделения данных.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-141">Dataverse integration brings company parity by using a company identifier to stripe data.</span></span> <span data-ttu-id="2e1c1-142">Как показано на следующем рисунке, все таблицы, специфичные для компании, расширяются таким образом, чтобы они имели отношения "многие к одному" (N:1) с таблицей cdm\_Company.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-142">As the following illustration shows, all company-specific tables are extended so that they have a many-to-one (N:1) relationship with the cdm\_Company table.</span></span>

> [!div class="mx-imgBorder"]
<span data-ttu-id="2e1c1-143">![Отношения N:1 между специфической для компании таблицей и таблицей cdm_Company](media/dual-write-bootstrapping.png)</span><span class="sxs-lookup"><span data-stu-id="2e1c1-143">![N:1 relationship between a company-specific table and the cdm_Company table](media/dual-write-bootstrapping.png)</span></span>

+ <span data-ttu-id="2e1c1-144">Для строк, после добавления и сохранения компании, значение становится доступно только для чтения.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-144">For rows, after a company is added and saved, the value becomes read-only.</span></span> <span data-ttu-id="2e1c1-145">Таким образом, пользователи должны убедиться, что они выбирают правильную компанию.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-145">Therefore, users should make sure that they select the correct company.</span></span>
+ <span data-ttu-id="2e1c1-146">Только строки, которые имеют данные компании, могут использоваться для двойной записи между приложением и Dataverse.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-146">Only rows that have company data are eligible for dual-write between the application and Dataverse.</span></span>
+ <span data-ttu-id="2e1c1-147">Для существующих данных Dataverse вскоре будет доступна возможность начальной загрузки под руководством администратора.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-147">For existing Dataverse data, an admin-led bootstrapping experience will soon be available.</span></span>


## <a name="autopopulate-company-name-in-customer-engagement-apps"></a><span data-ttu-id="2e1c1-148">Автозаполнение названия компании в приложениях Customer Engagement</span><span class="sxs-lookup"><span data-stu-id="2e1c1-148">Autopopulate company name in customer engagement apps</span></span>

<span data-ttu-id="2e1c1-149">Имеется несколько способов автоматического заполнения названия компании в приложениях Customer Engagement.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-149">There are several ways to auto-populate the company name in customer engagement apps.</span></span>

+ <span data-ttu-id="2e1c1-150">Если вы являетесь системным администратором, вы можете настроить компанию по умолчанию, перейдя к пункту **Дополнительные параметры > Система > Безопасность > Пользователи**.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-150">If you are a system administrator, you can set the default company by navigating to **Advanced Settings > System > Security > Users**.</span></span> <span data-ttu-id="2e1c1-151">Откройте форму **Пользователь** и в разделе **Сведения об организации** задайте значение **Компания по умолчанию в формах**.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-151">Open the **User** form, and in the **Organization Information** section, set the **Company to default on Forms** value.</span></span>

    :::image type="content" source="media/autopopulate-company-name-1.png" alt-text="Настройка компании по умолчанию в разделе сведений об Организации.":::

+ <span data-ttu-id="2e1c1-153">Если имеется доступ для **Записи** к таблице **SystemUser** для уровня **Подразделение**, можно изменить компанию по умолчанию в любой форме, выбрав компанию из раскрывающегося меню **Компания**.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-153">If you have **Write** access to the **SystemUser** table for the **Business Unit** level, then you can change the default company on any form by selecting a company from the **Company** drop-down menu.</span></span>

    :::image type="content" source="media/autopopulate-company-name-2.png" alt-text="Изменение названия компании в новой организации.":::

+ <span data-ttu-id="2e1c1-155">Если имеется доступ для **Записи** к данным в нескольких компаниях, можно изменить компанию по умолчанию, выбрав строку, принадлежащую другой компании.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-155">If you have **Write** access to data in more than one company, then you can change the default company by choosing a row that belongs to different company.</span></span>

    :::image type="content" source="media/autopopulate-company-name-3.png" alt-text="Выбор строки изменяет компанию по умолчанию.":::

+ <span data-ttu-id="2e1c1-157">Если вы являетесь системным конфигуратором или администратором и хотите автоматически заполнить данные компании в пользовательской форме, можно использовать [события формы](https://docs.microsoft.com/powerapps/developer/model-driven-apps/clientapi/events-forms-grids).</span><span class="sxs-lookup"><span data-stu-id="2e1c1-157">If you are a system configurator or administrator, and you want to auto-populate company data on a custom form, then you can use [form events](https://docs.microsoft.com/powerapps/developer/model-driven-apps/clientapi/events-forms-grids).</span></span> <span data-ttu-id="2e1c1-158">Добавьте ссылку JavaScript на **msdyn_/DefaultCompany.js** и используйте следующие события:</span><span class="sxs-lookup"><span data-stu-id="2e1c1-158">Add a JavaScript reference to **msdyn_/DefaultCompany.js** and use the following events.</span></span> <span data-ttu-id="2e1c1-159">Можно использовать любую готовую форму, например форму **Организация**.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-159">You can use any out-of-the-box form, for example, the **Account** form.</span></span>

    + <span data-ttu-id="2e1c1-160">Событие **OnLoad** для формы: установите значение в столбце **defaultCompany**.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-160">**OnLoad** event for the form: Set the **defaultCompany** column.</span></span>
    + <span data-ttu-id="2e1c1-161">Событие **onChange** для столбца **Компания**: установите значение в столбце **updateDefaultCompany**.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-161">**OnChange** event for the **Company** column: Set the **updateDefaultCompany** column.</span></span>

## <a name="apply-filtering-based-on-the-company-context"></a><span data-ttu-id="2e1c1-162">Применение фильтрации на основе контекста компании</span><span class="sxs-lookup"><span data-stu-id="2e1c1-162">Apply filtering based on the company context</span></span>

<span data-ttu-id="2e1c1-163">Чтобы применить фильтрацию на основе контекста компании в настраиваемых формах или в настраиваемых столбцах подстановки, добавленных к стандартным формам, откройте форму и воспользуйтесь разделом **Фильтрация связанных записей**, чтобы применить фильтр компании.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-163">To apply filtering based on the company context on your custom forms or on custom lookup columns added to the standard forms, open the form and use the **Related Records Filtering** section to apply the company filter.</span></span> <span data-ttu-id="2e1c1-164">Необходимо задать это значение для каждого столбца подстановки, которое требует фильтрации на основе базовой компании для данной строки.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-164">You must set this for each lookup column that requires filtering based on the underlying company on a given row.</span></span> <span data-ttu-id="2e1c1-165">Этот параметр показан для **Организации** на следующем рисунке.</span><span class="sxs-lookup"><span data-stu-id="2e1c1-165">The setting is shown for **Account** in the following illustration.</span></span>

:::image type="content" source="media/apply-company-context.png" alt-text="Применение контекста компании":::


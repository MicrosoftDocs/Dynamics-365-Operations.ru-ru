---
title: Концепция компании в Dataverse
description: Эта тема описывает интеграцию данных компаний между Finance and Operations и Dataverse.
author: RamaKrishnamoorthy
ms.date: 08/04/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ''
audience: Application User, IT Pro
ms.reviewer: rhaertle
ms.custom: ''
ms.assetid: ''
ms.search.region: global
ms.search.industry: ''
ms.author: ramasri
ms.dyn365.ops.version: ''
ms.search.validFrom: 2019-07-15
ms.openlocfilehash: 6a858135d377b30d6e8885ae18b2dc50da11813b
ms.sourcegitcommit: a202bf67c3c2c054e2a47cb7b3145cb7c0ee635e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/25/2021
ms.locfileid: "5941037"
---
# <a name="company-concept-in-dataverse"></a>Концепция компании в Dataverse

[!include [banner](../../includes/banner.md)]

[!include [rename-banner](~/includes/cc-data-platform-banner.md)]


В Finance and Operations концепция *компании* является как правовой конструкцией, так и бизнес-конструкцией. Она также задает границу безопасности и видимости для данных. Пользователи всегда работают в контексте одной компании, и большая часть данных ограничивается компанией.

В Dataverse нет эквивалентной концепции. Ближайшей концепцией является *бизнес-подразделение*, которое в первую очередь является границей безопасности и видимости для пользовательских данных. Эта концепция не имеет тех же юридических или деловых последствий, как концепция компании.

Поскольку бизнес-подразделение и компания не являются эквивалентными понятиями, невозможно принудительно задать взаимно-однозначное (1:1) сопоставление между ними в целях интеграции Dataverse. Однако поскольку пользователи должны, по умолчанию, иметь возможность видеть одинаковые строки в приложении и Dataverse, корпорация Майкрософт представила новую таблицу в Dataverse, которая называется cdm\_Company. Эта таблица эквивалентна таблице компании в приложении. Чтобы помочь гарантировать, что видимость строк эквивалентна между приложением и Dataverse в готовом виде, рекомендуется следующая настройка данных в Dataverse:

+ Для каждой строки компании Finance and Operations, которая включена для двойной записи, создается связанная строка cdm\_Company.
+ Когда строка cdm\_Company создается и включается для двойной записи, создается бизнес-подразделение по умолчанию, которое имеет то же имя. Хотя рабочая группа по умолчанию автоматически создается для этого бизнес-подразделения, бизнес-подразделение не используется.
+ Создается отдельная рабочая группа владельцев с тем же именем. Она также связана с бизнес-подразделением.
+ По умолчанию владелец любой строки, созданной и записанной для двойной записи в Dataverse, задается для рабочей группы "DW Owner", которая связана с соответствующим бизнес-подразделением.

На следующем рисунке приведен пример такой настройки данных в Dataverse.

![Настройка данных в Dataverse](media/dual-write-company-1.png)

Из-за этой конфигурации любая строка, которая связана с компанией USMF, будет принадлежать рабочей группе, которая связана с бизнес-подразделением USMF в Dataverse. Таким образом, любой пользователь, который имеет доступ к этому бизнес-подразделению через роль безопасности, для которой установлена видимость на уровне бизнес-подразделения, теперь может видеть эти строки. Ниже приводится пример, как рабочие группы могут быть использованы для обеспечения правильного доступа к этим строкам.

+ Роль "Менеджер по продажам" назначается членам рабочей группы "USMF Sales".
+ Пользователи, имеющие роль "Менеджер по продажам", могут получить доступ к любым строкам организации, которые являются членами того же бизнес-подразделения, в которое они входят.
+ Рабочая группа "USMF Sales" связана с бизнес-подразделением USMF, о котором говорилось ранее.
+ Таким образом, участники рабочей группы "USMF Sales" могут видеть любую организацию, которая принадлежит пользователю "USMF DW", которая поступила бы из таблицы компании USMF в Finance and Operations.

![Как можно использовать рабочие группы](media/dual-write-company-2.png)

Как показано на предыдущей иллюстрации, это сопоставление 1:1 между бизнес-подразделением, компанией и рабочей группой является лишь отправной точкой. В этом примере новое бизнес-подразделение "Европа" создается вручную в Dataverse качестве родительского как для DEMF, так и для ESMF. Это новое корневое бизнес-подразделение не имеет отношения к двойной записи. Тем не менее оно может быть использовано для предоставления членам рабочей группы "EUR Sales" доступа к данным организации как в DEMF, так и в ESMF, путем задания для видимости данных значения **Родительское/дочернее бизнес-подразделение** в связанной роли безопасности.

Последней темой для обсуждения является то, как двойная запись определяет, какой рабочей группе владельцев следует назначить строки. Это поведение контролируется столбцом **Ответственная рабочая группа по умолчанию** в строке cdm\_Company. Когда строка cdm\_Company включена для двойной записи, подключаемый модуль автоматически создает связанное бизнес-подразделение и ответственную рабочую группу (если она еще не существует) и задает столбец **Ответственная рабочая группа по умолчанию**. Администратор может изменить этот столбец на другое значение. Однако администратор не может очистить этот столбец до тех пор, пока таблица включена для двойной записи.

> [!div class="mx-imgBorder"]
![Столбец ответственной рабочей группы по умолчанию](media/dual-write-default-owning-team.jpg)

## <a name="company-striping-and-bootstrapping"></a>Разделение компаний и начальная загрузка

Интеграция Dataverse обеспечивает параллелизм компаний с помощью идентификатора компании для разделения данных. Как показано на следующем рисунке, все таблицы, специфичные для компании, расширяются таким образом, чтобы они имели отношения "многие к одному" (N:1) с таблицей cdm\_Company.

> [!div class="mx-imgBorder"]
![Отношения N:1 между специфической для компании таблицей и таблицей cdm_Company](media/dual-write-bootstrapping.png)

+ Для строк, после добавления и сохранения компании, значение становится доступно только для чтения. Таким образом, пользователи должны убедиться, что они выбирают правильную компанию.
+ Только строки, которые имеют данные компании, могут использоваться для двойной записи между приложением и Dataverse.
+ Для существующих данных Dataverse вскоре будет доступна возможность начальной загрузки под руководством администратора.


## <a name="autopopulate-company-name-in-customer-engagement-apps"></a>Автозаполнение названия компании в приложениях Customer Engagement

Имеется несколько способов автоматического заполнения названия компании в приложениях Customer Engagement.

+ Если вы являетесь системным администратором, вы можете настроить компанию по умолчанию, перейдя к пункту **Дополнительные параметры > Система > Безопасность > Пользователи**. Откройте форму **Пользователь** и в разделе **Сведения об организации** задайте значение **Компания по умолчанию в формах**.

    :::image type="content" source="media/autopopulate-company-name-1.png" alt-text="Настройка компании по умолчанию в разделе сведений об Организации.":::

+ Если имеется доступ для **Записи** к таблице **SystemUser** для уровня **Подразделение**, можно изменить компанию по умолчанию в любой форме, выбрав компанию из раскрывающегося меню **Компания**.

    :::image type="content" source="media/autopopulate-company-name-2.png" alt-text="Изменение названия компании в новой организации.":::

+ Если имеется доступ для **Записи** к данным в нескольких компаниях, можно изменить компанию по умолчанию, выбрав строку, принадлежащую другой компании.

    :::image type="content" source="media/autopopulate-company-name-3.png" alt-text="Выбор строки изменяет компанию по умолчанию.":::

+ Если вы являетесь системным конфигуратором или администратором и хотите автоматически заполнить данные компании в пользовательской форме, можно использовать [события формы](/powerapps/developer/model-driven-apps/clientapi/events-forms-grids). Добавьте ссылку JavaScript на **msdyn_/DefaultCompany.js** и используйте следующие события: Можно использовать любую готовую форму, например форму **Организация**.

    + Событие **OnLoad** для формы: установите значение в столбце **defaultCompany**.
    + Событие **onChange** для столбца **Компания**: установите значение в столбце **updateDefaultCompany**.

## <a name="apply-filtering-based-on-the-company-context"></a>Применение фильтрации на основе контекста компании

Чтобы применить фильтрацию на основе контекста компании в настраиваемых формах или в настраиваемых столбцах подстановки, добавленных к стандартным формам, откройте форму и воспользуйтесь разделом **Фильтрация связанных записей**, чтобы применить фильтр компании. Необходимо задать это значение для каждого столбца подстановки, которое требует фильтрации на основе базовой компании для данной строки. Этот параметр показан для **Организации** на следующем рисунке.

:::image type="content" source="media/apply-company-context.png" alt-text="Применение контекста компании":::



[!INCLUDE[footer-include](../../../../includes/footer-banner.md)]
---
title: Интеграция закупок между Supply Chain Management и Field Service
description: В этой статье описывается, как интеграция двойной записи поддерживает создание и обновления заказов на покупку из Supply Chain Management и Field Service.
author: RamaKrishnamoorthy
ms.date: 11/11/2020
ms.topic: article
audience: Application User
ms.reviewer: sericks
ms.search.region: Global
ms.author: tfehr
ms.search.validFrom: 2020-11-11
ms.dyn365.ops.version: Release 10.0.17
ms.openlocfilehash: a2e5ac6911e7fb4753e1dbd0b78b26691dbe3105
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/12/2022
ms.locfileid: "9288865"
---
# <a name="integrate-procurement-between-supply-chain-management-and-field-service"></a>Интеграция закупок между Supply Chain Management и Field Service

[!include [banner](../../includes/banner.md)]

[!include [banner](../../includes/preview-banner.md)]

Microsoft Dynamics 365 Supply Chain Management предоставляет надежные функции закупок. Dynamics 365 Field Service предлагает аналогичные функции, поддерживающие процессы закупок, связанные с процессом обслуживания. Функциональные возможности этих двух приложений интегрированы через двойную запись, и в результирующих вариантах перекрестного функционального использования могут быть включены через сопоставления таблиц, логику решений, представления и формы.

Эта интеграция поддерживает создание заказов на покупку и, в большинстве случаев, обновления из обоих приложений. Однако Supply Chain Management управляет ценами, адресами и поступлением продуктов. Для организаций, использующих как Field Service, так и Supply Chain Management, включены некоторые мощные варианты перекрестного функционального использоватия. Эти случаи использования позволяют инициировать закупки и отслеживать их в обеих системах.

На следующем рисунке показаны таблицы в обеих системах и они сопоставляются друг с другом. Заказы на покупку в Field Service ссылаются на строку *счета*, тогда как заказы на покупку в Supply Chain Management ссылаются на строку *поставщика*. Для разрешения интеграции двойная запись использует ссылку, чтобы связать строки *поставщика* со строками *счетов*. Дополнительные сведения см. в разделе [Интегрированный справочник поставщиков](vendor-mapping.md).

![Сопоставления для закупки.](media/scm-field-service-tables.png)

## <a name="prerequisites"></a>Необходимые условия

Чтобы интегрировать Supply Chain Management с Field Service, необходимо установить следующие компоненты:

- Field Service версии 8.8.31.60 или более поздней, для комплексной интеграции заказов на покупку
- Supply Chain Management версии 10.0.14 или новее
- Двойная запись для запуска решения OneFSSCM

## <a name="installation-guidelines"></a>Руководства по установке

### <a name="prerequisites"></a>Необходимые условия

- **Двойная запись** — дополнительные сведения см. в разделе [Главная страница двойной записи](dual-write-home-page.md#dual-write-setup).
- **Dynamics 365 Field Service** — дополнительные сведения см. в разделе [Как установить Dynamics 365 Field Service](/dynamics365/field-service/install-field-service#step-1-install-dynamics-365-field-service).

Когда они включены в Microsoft Dataverse, двойная запись и Field Service обеспечивают несколько слоев решений, расширяющих среду новыми метаданными, формами, представлениями и логикой. Эти решения могут быть включены в любом порядке, но обычно они устанавливаются в указанном здесь порядке:

1. **Field Service Common** — Field Service Common устанавливается, когда Field Service установлено в среде.
2. **Field Service (Anchor)** — Field Service (Anchor) устанавливается, когда Field Service установлено в среде. 
3. **Supply Chain Management Extended** — Supply Chain Management Extended устанавливается автоматически, когда в среде включена двойная запись. 
4. **Решение OneFSSCM** — OneFSSCM автоматически устанавливается в зависимости от того, какое решение (Field Service или Supply Chain Management) устанавливается последним.

    - Если решение Field Service уже установлено в среде, и включается двойная запись, которая устанавливает Supply Chain Management Extended, устанавливается OneFSSCM.
    - Если решение Supply Chain Management Extended уже установлено в среде, и вы устанавливаете Field Service, устанавливается OneFSSCM.

## <a name="initial-synchronization"></a>Начальная синхронизация

Чтобы создать новые заказы на покупку и работать с существующими заказами на покупку, необходимо синхронизировать ссылочные данные между Supply Chain Management и Dataverse. Функция первоначальной записи используется для обнаружения отношений таблиц и для поиска таблиц, которые необходимо включить для данной карты.

Необходимо выполнить синхронизацию следующих таблиц:

- Шаблоны продуктов

    При выполнении первоначальной записи вы получите полный список необходимых таблиц. Ниже приведены несколько примеров таких шаблонов:

    - Все продукты
    - Выпущенные продукты V2
    - Уникально идентифицируемые продукты, выпущенные Dataverse

- Сайты
- Склады
- Шаблоны категорий закупок

    Ниже приведены несколько примеров таких шаблонов:

    - Категории закупаемой продукции
    - Pro
    - Иерархия категорий продуктов
    - Назначения категорий продуктов

- Шаблоны поставщиков, такие как "Поставщик V2"
- Шаблоны контактного лица, например, Контакты Dataverse V2
- Шаблоны работников, например "Работник"

Синхронизация таблиц гарантирует, что все документы (заказы на покупку и поступления продуктов) в Supply Chain Management доступны в Dataverse.

### <a name="account-and-vendor-tables"></a>Таблицы организаций и поставщиков

Заказы на покупку в Field Service полагаются на талицу организаций для отслеживания поставщиков. Таким образом, таблицы Dataverse для заказов на покупку используют организации для отслеживания поставщиков. Чтобы учесть эти ключевые различия, необходимо активировать четыре следующих рабочих процесса, чтобы обеспечить синхронизацию организаций и поставщиков: 

- Создание поставщиков в таблице "Организации"
- Создание поставщиков в таблице "Поставщики"
- Обновление поставщиков в таблице "Организации"
- Обновление поставщиков в таблице "Поставщики"

Если решение OneFSSCM установлено, так как установлены Field Service и Supply Chain Management Extended, эти рабочие процессы автоматически активируются. Если решение Field Service не установлено, но необходимо интегрировать таблицы заказов на покупку с Dataverse, необходимо активировать эти рабочие процессы. В обоих случаях, если вы не начнете с нуля, вам, возможно, придется обеспечить, чтобы все поставщики были созданы как организации в Dataverse перед созданием заказов на покупку. В противном случае может произойти ошибка.

### <a name="initial-synchronization"></a>Начальная синхронизация

После выполнения всех необходимых условий, если необходимо, чтобы существующие заказы на покупку и поступления продуктов были доступны в обеих системах, необходимо выполнить начальную синхронизацию следующих шаблонов:

- Заголовок заказа на покупку V2
- Строка заказа на покупку CDS
- Мягкое удаление строки заказа на покупку CDS
- Приход по заказу на покупку
- Продукт поступления по заказу на покупку

## <a name="mappings-with-logic"></a>Сопоставления с логикой

Интеграция закупок расширяет сопоставление продуктов со следующей логикой, чтобы убедиться в том, что столбец **Тип продукта Field Service** правильно установлен в таблице продуктов в Dataverse:

- Если для параметра **Тип продукта** выбрано значение *Продукт*, для параметра **Группа номенклатурных моделей, Учитываемый в запасах** задано значение *True*, а для параметра **Тип продукта Field Service** задано значение *Запасы*.
- Если для параметра **Тип продукта** выбрано значение *Продукт*, для параметра **Группа номенклатурных моделей, Учитываемый в запасах** задано значение *False*, а для параметра **Тип продукта Field Service** задано значение *Нескладские*.
- Если для параметра **Тип продукта** установлено значение *Сервис*, а в поле **Тип продукта Field Service** задано значение *Сервис*.

Кроме того, Dataverse включает в себя логику, сопоставляющую поставщиков со связанными организациями. Эта логика устанавливает организацию поставщика накладной по умолчанию. При создании подключаемая логика на стороне сервера устанавливает организацию поставщика накладной по умолчанию от поставщика, который связан с этой организацией. Поставщик имеет ссылку на счет накладной, используемый для задания этого значения.

## <a name="supported-scenarios"></a>Поддерживаемые сценарии

- Заказы на покупку могут создаваться и обновляться пользователями Dataverse. Однако процесс и данные контролируются через Supply Chain Management. Ограничения на обновления столбцов заказов на покупку в Supply Chain Management применяются, когда обновления поступают из Field Service. Например, невозможно обновить заказ на покупку, если он был завершен. 
- Если заказ на покупку контролируется управлением изменениями в Supply Chain Management, пользователь Field Service может обновлять заказ на покупку только тогда, когда статус утверждения Supply Chain Management имеет значение *Черновик*.
- Несколько столбцов управляются только Supply Chain Management и не могут быть обновлены в Field Service. Чтобы узнать, какие столбцы невозможно обновить, просмотрите таблицы сопоставления в продукте. Для простоты большая часть этих столбцов устанавливается как только для чтения на страницах Dataverse. 

    Например, столбцы сведений о ценах управляются Supply Chain Management. Supply Chain Management имеет торговые соглашения, из которых может извлекаться выгода для Field Service. Такие столбцы , как **Цена за единицу**, **Скидка** и **Чистая сумма**, берутся только из Supply Chain Management. Чтобы гарантировать синхронизацию цены с Field Service, следует использовать функцию **Синхронизировать** на страницах **Заказ на покупку** и **Продукт заказа на покупку** в Dataverse, когда данные заказа на покупку были введены. Дополнительные сведения см. в разделе [Синхронизация с данными о закупках по требованию Dynamics 365 Supply Chain Management](#sync-procurement).

- Столбец **Итоги** доступен только в Field Service, поскольку в Supply Chain Management отсутствуют актуальные итоговые суммы по заказу на покупку. Итоги в Supply Chain Management рассчитываются на основе нескольких параметров, которые недоступны в Field Service.
- Строки заказа на покупку, для которых указана только категория закупаемой продукции или указанный продукт является номенклатурой с типом продукта *Сервис* или типом продукта Field Service, могут быть инициированы только в Supply Chain Management. Затем строки синхронизируются с Dataverse и отображаются в Field Service.
- Если установлено только решение Field Service, но не Supply Chain Management, столбец **Склад** обязателен в заказе на покупку. Однако, если решение Supply Chain Management установлено, это требование ослабляется, поскольку Supply Chain Management допускает строки заказов на покупку, для которых в некоторых ситуациях не указан склад.
- Поступления продуктов (приходы по заказу на покупку в Dataverse) управляются с помощью Supply Chain Management и не могут быть созданы из Dataverse, если решение Supply Chain Management установлено. Поступления продуктов из Supply Chain Management синхронизируются из Supply Chain Management с Dataverse.
- Недопоставка разрешена в Supply Chain Management. Решение OneFSSCM добавляет логику таким образом, чтобы после создания или обновления строки прихода продукта (или продукта прихода заказа на покупку в Dataverse) создается строка журнала запасов в Dataverse для корректировки оставшегося количества, которое находится в заказе для сценариев недопоставки.

## <a name="unsupported-scenarios"></a>Неподдерживаемые сценарии

- Field Service предотвращает добавление строк в отмененный заказ на покупку в Supply Chain Management. В качестве временного решения можно изменить статус системы для заказа на покупку в Field Service, а затем добавить новую строку в Field Service или Supply Chain Management.
- Хотя строки закупок влияют на уровни складских запасов в обеих системах, эта интеграция не гарантирует выравнивание запасов между Supply Chain Management и Field Service. В Field Service и Supply Chain Management имеются другие процессы, которые обновляют уровни запасов. Эти процессы выходят за рамки закупок.

## <a name="status-management"></a>Управление состоянием

Состояния заказов на покупку в Field Service отличается от состояний в Supply Chain Management.

### <a name="field-service-purchase-order-and-purchase-order-product-statuses"></a>Состояния заказа на покупку и продукта заказа на покупку в Field Service

| Заголовок — статус системы | Заголовок — статус утверждения | Статус номенклатуры |
|---|---|---|
| <ul><li>Черновой</li><li>Отправлена</li><li>Отменено</li><li>Продукт получен</li><li>Счет выставлен</li></ul> | <ul><li>NULL</li><li>Одобрено</li><li>Аннулировано</li></ul> | <ul><li>Ожидает</li><li>Получение</li><li>Отменено</li></ul> |

### <a name="supply-chain-management-purchase-order-and-purchase-order-line-statuses"></a>Состояния заказа на покупку и строки заказа на покупку в Supply Chain Management

Статусы утверждения строки активны только в том случае, если имеется рабочий процесс строки.

| Заголовок — статус документов | Заголовок — статус утверждения | Статус строки | Статус утверждения строки |
|---|---|---|---|
| <ul><li>Открытый заказ (Невыполненный заказ)</li><li>Получение</li><li>Оприходовано</li><li>Отменено</li></ul> | <ul><li>Черновой</li><li>На рассмотрении</li><li>Одобрено</li><li>Аннулировано</li><li>На внешнем рассмотрении</li><li>Подтверждено</li><li>Завершенo</li></ul> | <ul><li>Открытый заказ (невыполненный заказ)</li><li>Получение</li><li>Оприходовано</li><li>Отменено</li></ul> | <ul><li>Не отправлено</li><li>На рассмотрении</li><li>Одобрено</li><li>Аннулировано</li></ul> |

К столбцам состояния применяются следующие правила:

- Статус в Supply Chain Management невозможно обновить из Field Service. Однако в некоторых случаях статус в Field Service будет обновляться при изменении статуса заказа на покупку в Supply Chain Management.
- Если заказ на покупку в Supply Chain Management находится под управлением изменениями, а изменение обрабатывается, статус утверждения — *Черновик* или *На рассмотрении*. В этом случае статус утверждения в Field Service будет иметь значение *Null*.
- Если статус утверждения заказа на покупку в Supply Chain Management имеет значение *Утверждено*, *На внешнем рассмотрении*, *Подтверждено* или *Завершено*, статус утверждения заказа на покупку в Field Service будет установлен как *Утверждено*.
- Если статус утверждения заказа на покупку в Supply Chain Management имеет значение *Отклонено*, , статус утверждения заказа на покупку в Field Service будет установлен как *Отклонено*.
- Если статус заголовка документа в Supply Chain Management изменяется на *Открытый заказ (Невыполненный заказ)*, а заказ на покупку в Field Service имеет статус *Черновик* или *Отменено*, статус заказа на покупку в Field Service будет изменен на *Отправлено*.
- Если статус заголовка документа в Supply Chain Management изменяется на *Отменено*, и продукты прихода заказа на покупку в Field Service связаны с заказом на покупку (с помощью продуктов заказа на покупку), поле статуса системы Field Service имеет значение *Отменено*.
- Если статус строки заказа на покупку в Supply Chain Management имеет значение *Отменено*, статус продукта заказа на покупку в Field Service устанавливается на *Отменено*. Кроме того, если статус строки заказа на покупку в Supply Chain Management изменяется с *Отменено* на *Невыполненный заказ*, статус номенклатуры продукта заказа на покупку в Field Service устанавливается как *Ожидание*.

## <a name="sync-with-the-supply-chain-management-procurement-data-on-demand"></a><a id="sync-procurement"></a>Синхронизация с данными о закупках Supply Chain Management по требованию

Supply Chain Management включает в себя данные о закупках, которые обрабатывают торговые соглашения, скидки и другие сценарии, полагающиеся на вторичные процессы в Supply Chain Management. Механизм закупок использует сложные правила для определения наилучшей цены для данного заказа на покупку. При использовании двойной записи данные не всегда хранятся синхронно в двух средах, особенно в сценариях, в которых строка была создана или обновлена из Dataverse, и могут запускать дальнейшие процессы в Supply Chain Management.

## <a name="sync-the-procurement-data-from-supply-chain-management"></a>Синхронизация данных о закупках из Supply Chain Management

1. В Dataverse перейдите в раздел **Запасы \> Заказ на покупку**.
2. Выберите **Создать**, чтобы создать новый заказ на покупку, или выберите строку для существующего заказа на покупку.
3. Из заказа на покупку или из строки заказа на покупку.
4. На панели операций выберите **Синхронизировать**.

Синхронизируются все столбцы из Dataverse и Field Service, к которым предоставлен общий доступ из Supply Chain Management.

Ниже приведены ситуации, в которых можно использовать функцию **Синхронизировать**:

- Если выполняется несколько последовательных изменений в одной строке из Dataverse, запустите функцию **Синхронизировать**.
- Если нет уверенности в том, что изменение может быть вторым последовательным изменением из Dataverse, может иметь смысл выполнить функцию **Синхронизировать**.
- Если получено сообщение об ошибке обновления значения из Supply Chain Management, запустите функцию **Синхронизировать** и повторите попытку обновления в Dataverse.

## <a name="cancelling-the-posting-process"></a>Отмена процесса разноски

Если процесс разноски поступления продуктов отменен во время обработки, то при двойной записи может быть создана строка поступления продуктов в Dataverse, но не создана строка поступления продуктов в Supply Chain Management. Такая ситуация возникает потому, что двойная запись не поддерживает распределенные транзакции.

## <a name="templates"></a>Шаблоны

Следующие шаблоны доступны для интеграции документов, связанных с закупками.

| Управление цепочкой поставок | Field Service | описание |
|---|---|---|
| [Заголовок заказа на покупку V2](mapping-reference.md#183) | msdyn\_Purchaseorders | Эта таблица содержит столбцы, представляющие заголовок заказа на покупку. |
| [Объект строки заказа на покупку](mapping-reference.md#181) | msdyn\_PurchaseOrderProducts | Эта таблица содержит строки, представляющие строки заказа на покупку. Номер продукта используется для синхронизации. Он определяет продукт как единицу хранения запасов (SKU), включая аналитики продукта. Дополнительные сведения об интеграции продукта с Dataverse см. в разделе [Единый подход к работе с продуктами](product-mapping.md). |
| [Заголовок поступления продуктов](mapping-reference.md#185) | msdyn\_purchaseorderreceipts | Эта таблица содержит заголовки поступлений продуктов, которые создаются при разноске поступления продуктов в Supply Chain Management. |
| [Строка поступления продуктов](mapping-reference.md#184) | msdyn\_purchaseorderreceiptproducts | Эта таблица содержит строки поступлений продуктов, которые создаются при разноске поступления продуктов в Supply Chain Management. |
| [Объект обратимо удаленной строки заказа на покупку](mapping-reference.md#182) | msdyn\_purchaseorderproducts | Данная таблица содержит информацию о строках заказа на покупку, которые были обратимо удалены. Строка заказа на покупку в Supply Chain Management может быть обратимо удалена только в том случае, если заказ на покупку был подтвержден или утвержден, если включено управление изменениями. Строка существует в базе данных Supply Chain Management и помечена как **Удалена**. Поскольку в Dataverse нет концепции обратимого удаления, важно, чтобы эти данные были синхронизированы с Dataverse. Таким образом, строки с обратимым удалением в Supply Chain Management могут быть автоматически удалены из Dataverse. В этом случае логика для удаления строки в Dataverse находится в модуле Supply Chain Management Extended. |

[!INCLUDE[footer-include](../../../../includes/footer-banner.md)]

---
title: Обновление модели субъекта и глобальной адресной книги
description: В этом разделе описывается обновление данных с двойной записью для стороны и модели глобальной адресной книги.
author: RamaKrishnamoorthy
ms.date: 03/10/2022
ms.topic: article
audience: Application User, IT Pro
ms.reviewer: josaw
ms.search.region: global
ms.author: ramasri
ms.search.validFrom: 2021-03-31
ms.openlocfilehash: 95d272d9076f1ab25230e4efa98e321bdd618062
ms.sourcegitcommit: 6dc2b877cf8ea9185a07964ec05c5ddb7a78471b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2022
ms.locfileid: "8407803"
---
# <a name="upgrade-to-the-party-and-global-address-book-model"></a>Обновление модели субъекта и глобальной адресной книги

[!include [banner](../../includes/banner.md)]



[Шаблоны фабрики данных Microsoft Azure](https://github.com/microsoft/Dynamics-365-FastTrack-Implementation-Assets/tree/master/Dual-write/Upgrade%20data%20to%20dual-write%20Party-GAB%20schema) помогают обновлять следующие существующие данные с двойной записью для субъекта и модели глобальной адресной книги: данные в таблицах **Организация**, **Контакт** и **Поставщик**, а также почтовые и электронные адреса.

Представлены следующие три шаблона фабрики данных. Они помогают выверять данные как из приложений для финансов и операций, так и из приложений для взаимодействия с клиентами.

- **[Шаблон субъекта](https://github.com/microsoft/Dynamics-365-FastTrack-Implementation-Assets/blob/master/Dual-write/Upgrade%20data%20to%20dual-write%20Party-GAB%20schema/arm_template.json) (обновление данных для двойной записи субъекта-глобальной адресной книги schema/arm_template.json)** — этот шаблон помогает обновлять данные **Субъекта** и **Контакта**, связанные с данными **Организация**, **Контакт** и **Поставщик**.
- **[Шаблон почтового адреса субъекта](https://github.com/microsoft/Dynamics-365-FastTrack-Implementation-Assets/blob/master/Dual-write/Upgrade%20data%20to%20dual-write%20Party-GAB%20schema/Upgrade%20to%20Party%20Postal%20Address%20-%20GAB/arm_template.json) (обновление данных до двойной записи схемы субъект-глобальная адресная книга/обновление почтового адреса субъекта — глобальная адресная книга/arm_template.json)** — этот шаблон помогает обновлять почтовые адреса, связанные с данными **Организация**, **Контакт** и **Поставщик**.
- **[Шаблон электронного адреса субъекта](https://github.com/microsoft/Dynamics-365-FastTrack-Implementation-Assets/blob/master/Dual-write/Upgrade%20data%20to%20dual-write%20Party-GAB%20schema/Upgrade%20to%20Party%20Electronic%20Address%20-%20GAB/arm_template.json) (обновление данных до двойной записи схемы субъект-глобальная адресная книга/обновление электронного адреса субъекта — глобальная адресная книга/arm_template.json)** — этот шаблон помогает обновлять электронные адреса, связанные с данными **Организация**, **Контакт** и **Поставщик**.

В конце процесса создаются следующие файлы значений с разделителями-запятыми (.csv).

| Имя файла | Целевые назначения |
|---|---|
| FONewParty.csv | Этот файл помогает создать новые записи **Субъект** в приложении для финансов и операций. |
| ImportFONewPostalAddressLocation.csv | Этот файл помогает создавать новые записи **Местоположение почтового адреса** в приложении для финансов и операций. |
| ImportFONewPartyPostalAddress.csv | Этот файл помогает создавать новые записи **Почтовый адрес субъекта** в приложении для финансов и операций. |
| ImportFONewPostalAddress.csv | Этот файл помогает создавать новые записи **Почтовый адрес** в приложении для финансов и операций. |
| ImportFONewElectronicAddress.csv | Этот файл помогает создавать новые записи **Электронный адрес** в приложении для финансов и операций. |

В этом разделе объясняется, как использовать шаблоны фабрики данных и обновлять данные. При отсутствии каких-либо настроек можно использовать шаблоны как есть. Однако если имеются настройки для данных **Учетная запись**, **Контактное лицо** и **Поставщик**, необходимо изменить шаблоны, как описано в этой теме.

> [!IMPORTANT]
> При работе с шаблонами почтового адреса субъекта и электронного адреса субъекта имеются специальные инструкции. Сначала необходимо выполнить шаблон субъекта, затем шаблон почтового адреса субъекта, а затем шаблон электронного адреса субъекта. Каждый шаблон предназначен для импорта в отдельную фабрику данных.

## <a name="prerequisites"></a>Необходимые условия

Для обновления субъекта и модели глобальной адресной книги необходимо, чтобы выполнялись следующие условия:

+ Необходимо иметь [подписку Azure](https://portal.azure.com/).
+ Вы должны иметь доступ к [шаблонам](https://github.com/microsoft/Dynamics-365-FastTrack-Implementation-Assets/tree/master/Dual-write/Upgrade%20data%20to%20dual-write%20Party-GAB%20schema).
+ Вы должны быть существующим клиентом с двойной записью.

## <a name="prepare-for-the-upgrade"></a>Подготовка к обновлению

Для обновления требуется следующая подготовка:

+ **Полная синхронизация**: среда Finance and Operations и среда взаимодействия с клиентами полностью синхронизированы для таблиц **Учетная запись (Клиент)**, **Контактное лицо** и **Поставщик**.
+ **Ключи интеграции:** таблицы **Учетная запись (клиент)**, **Контактное лицо** и **Поставщик** в приложениях взаимодействия с клиентами используют готовые ключи интеграции. При настройке ключей интеграции необходимо настроить шаблон.
+ **Номер субъекта**: все записи **Учетная запись (клиент)**, **Контактное лицо** и **Поставщик**, для которых будет выполнено обновление, имеют номер субъекта. Записи, не имеющие номера субъекта, будут пропущены. Если необходимо обновить эти записи, добавьте к ним номер субъекта перед началом процесса обновления.
+ **Отключение системы**: в ходе процесса обновления вам придется в автономном режиме использовать как среду Finance and Operations, так и среду взаимодействия с клиентами.
+ **Моментальный снимок:** создание моментальных снимков приложений для финансов и операций и приложений для взаимодействия с клиентами. Затем при необходимости можно использовать эти моментальные снимки для восстановления предыдущего состояния.

## <a name="deployment"></a>Развертывание

1. Загрузите шаблоны из [Dynamics-365-FastTrack-Implementation-Assets](https://github.com/microsoft/Dynamics-365-FastTrack-Implementation-Assets/tree/master/Dual-write/Upgrade%20data%20to%20dual-write%20Party-GAB%20schema).
2. Выполните вход на [портал Azure](https://portal.azure.com/).
3. Создайте [группу ресурсов](/azure/azure-resource-manager/management/manage-resource-groups-portal).
4. Создайте [учетную запись хранения](/azure/storage/common/storage-account-create?tabs=azure-portal) в созданной группе ресурсов.
5. Создайте [фабрику данных](/azure/data-factory/quickstart-create-data-factory-portal) в созданной группе ресурсов.
6. Откройте фабрику данных и выберите плитку **Автор и Монитор**.
7. На вкладке **Управление** выберите **шаблон ARM**.
8. Выберите **Импортировать шаблон ARM**, чтобы импортировать шаблон **Субъект**.
9. Импортируйте шаблон в фабрику данных. Введите следующие значения для **сведений о проекте** и **сведения об экземпляре**.

    | Поле | Значение |
    |---|---|
    | Подписка | Подписка Azure |
    | Группа ресурсов | Укажите тот же ресурс, под которым создается учетная запись хранения. |
    | Область | Регион |
    | Название фабрики | Название фабрики |
    | FO Linked Service_service Principal Key | Ключ приложения |
    | Azure Blob Storage_connection String | Строка подключения хранилища BLOB-объектов Azure |
    | Dynamics Crm Linked Service_password | Пароль для учетной записи пользователя, указанной в качестве имени пользователя |
    | FO Linked Service_properties_type Properties_url | `https://sampledynamics.sandbox-operationsdynamics.com/data` |
    | FO Linked Service_properties_type Properties_tenant | Сведения о клиенте (доменное имя или код клиента), под которым приложение расположено |
    | FO Linked Service_properties_type Properties_aad Resource Id | `https://sampledynamics.sandboxoperationsdynamics.com` |
    | FO Linked Service_properties_type Properties_service Principal Id | Идентификатор клиента приложения |
    | Dynamics Crm Linked Service_properties_type Properties_username | Имя пользователя, которое используется для подключения к Dynamics 365 |

    Дополнительные сведения см. в следующих разделах:

    - [Ручное распространение шаблона Resource Manager для каждой среды](/azure/data-factory/continuous-integration-deployment#manually-promote-a-resource-manager-template-for-each-environment)
    - [Свойства связанной службы](/azure/data-factory/connector-dynamics-ax#linked-service-properties)
    - [Копировать данные с помощью Фабрики данных Azure](/azure/data-factory/connector-dynamics-crm-office-365#dynamics-365-and-dynamics-crm-online)

10. После развертывания проверьте наборы данных, поток данных и связанную службу фабрики данных.

    ![Наборы данных, поток данных и связанная служба.](media/data-factory-validate.png)

11. Перейдите к пункту **Управление**. В **Подключения** выберите **связанная служба**. Затем выберите **DynamicsCrmLinkedService**. В диалоговом окне **Изменение связанной службы (Dynamics CRM)** введите следующие значения.

    | Поле | Значение |
    |---|---|
    | Имя | DynamicsCrmLinkedService |
    | описание | Связанные службы для подключения к экземпляру CRM для получения данных сущностей |
    | Подключение через среду выполнения интеграции | AutoResolvelntegrationRuntime |
    | Тип развертывания | Интерактивный режим |
    | URI службы | `https://<organization-name>.crm[x].dynamics.com` |
    | Тип проверки подлинности | Office365 |
    | Имя пользователя | |
    | Пароль или Azure Key Vault | Пароль |
    | Пароль | |

## <a name="prepare-to-run-the-data-factory-templates"></a>Подготовка к запуску шаблонов фабрики данных

В этом разделе описана настройка, необходимая перед запуском шаблонов фабрики данных почтового адреса субъекта и электронного адреса субъекта.

### <a name="setup-to-run-the-party-postal-address-template"></a>Настройка для запуска шаблона почтового адреса субъекта

1. Выполните вход в приложения для взаимодействия с клиентами и перейдите к пункту **Параметры** \> **Параметры персонализации**. Затем на вкладке **Общие** настройте параметр часового пояса для учетной записи системного администратора. Часовой пояс должен иметь значение в формате UTC, чтобы обновить даты "действительно с" и "действительно по" для почтовых адресов из приложений для финансов и операций.

    ![Настройка часового пояса для учетной записи системного администратора.](media/ADF-1.png)

2. В фабрике данных на вкладке **Управление** в области **Глобальные параметры** создайте следующий глобальный параметр.

    | Номер | Имя | Тип | Значение |
    |---|---|---|---|
    | 1 | PostalAddressIdPrefix | строка | Этот параметр добавляет серийный номер к вновь созданным почтовым адресам в качестве префикса. Не забудьте предоставить строку, не конфликтующую с почтовыми адресами в приложениях для финансов и операций и приложениях для взаимодействия с клиентами. В этом примере будет использоваться **ADF-PAD-**. |

    ![Глобальный параметр PostalAddressIdPrefix, созданный на вкладке «Управление».](media/ADF-2.png)

3. Закончив, выберите **Опубликовать все**.

    ![Кнопка «Опубликовать все».](media/ADF-3.png)

### <a name="setup-to-run-the-party-electronic-address-template"></a>Настройка для запуска шаблона электронного адреса субъекта

1. В фабрике данных на вкладке **Управление** в области **Глобальные параметры** создайте следующие глобальные параметры.

    | Номер | Имя | Тип | Значение |
    |---|---|---|---|
    | 1 | IsFOSource | логический | Этот параметр определяет, какие основные системные адреса заменяются в случае конфликтов. Если значение **true**, основные адреса в приложениях для финансов и операций заменят основные адреса в приложениях для взаимодействия с клиентами. Если значение **false**, основные адреса в приложениях для взаимодействия с клиентами заменят основные адреса в приложениях для финансов и операций. |
    | 2 | ElectronicAddressIdPrefix | строка | Этот параметр добавляет серийный номер к вновь созданным электронным адресам в качестве префикса. Не забудьте предоставить строку, не конфликтующую с электронными адресами в приложениях для финансов и операций и приложениях для взаимодействия с клиентами. В этом примере будет использоваться **ADF-EAD-**. |

    ![Глобальные параметры IsFOSource и ElectronicAddressIdPrefix, созданные на вкладке «Управление».](media/ADF-4.png)

2. Закончив, выберите **Опубликовать все**.

## <a name="run-the-templates"></a>Выполнение шаблонов

1. Остановите сопоставления двойной записи **Субъект**, **Учетная запись**, **Контактное лицо** и **Поставщик**, которые используют приложения для управления финансами и операциями:

    + Субъекты CDS (msdyn_parties) 
    + Клиенты V3 (accounts)
    + Клиенты V3 (контакты)
    + CDS Контакты V2 (контакты)
    + CDS Контакты V2 (контакты)
    + Поставщик V2 (msdyn_vendor)
    + Контакты V2 (msdyn_contactforparties)
    + Расположения почтовых адресов субъекта CDS (msdyn_partypostaladdresses)
    + Журнал почтовых адресов CDS V2 (msdyn_postaladdresses)
    + Расположения почтовых адресов CDS (msdyn_postaladdresscollections)
    + Контакты субъекта V3 (msdyn_partyelectronicaddresses)

2. Убедитесь, что сопоставления удалены из таблицы **msdy_dualwriteruntimeconfig** в Dataverse.
3. Установка [решений стороны с двойной записью и глобальной адресной книги](https://aka.ms/dual-write-gab) из AppSource.
4. В приложении для финансов и операций выполните действие **Начальная синхронизация** для следующих таблиц, если они содержат данные.

    + Приветствия
    + Типы характеров людей
    + Заключение
    + Обращения к контактному лицу
    + Роли принятия решений
    + Уровни лояльности

5. В приложении взаимодействия с клиентами отключите следующие шаги подключаемого модуля:

    + Обновление учетной записи

        + Microsoft.Dynamics.GABExtended.Plugins.UpdatePartyAttributesFromAccountEntity: Обновление учетной записи
        + Microsoft.Dynamics.FinanceExtended.Plugins.TriggerNotesForCustomerTypeCodes: Обновление учетной записи

    + Обновление контактного лица

        + Microsoft.Dynamics.GABExtended.Plugins.UpdatePartyAttributesFromContactEntity: Обновление контактного лица
        + Microsoft.Dynamics.FinanceExtended.Plugins.TriggerNotesForSellableContact: Обновление контактного лица

    + Обновление msdyn_party

        + Microsoft.Dynamics.GABExtended.Plugins.UpdatePartyAttributesFromPartyEntity: Обновление msdyn_party

    + Обновление msdyn_vendor

        + Microsoft.Dynamics.GABExtended.Plugins.UpdatePartyAttributesFromVendorEntity: Обновление msdyn_vendor

    + Customeraddress

        + Создать

            + Microsoft.Dynamics.GABExtended.Plugins.CreatePartyAddress: создание customeraddress

        + Обновить 

            + Microsoft.Dynamics.GABExtended.Plugins.CreatePartyAddress: обновление customeraddress

        + Удаление

            + Microsoft.Dynamics.GABExtended.Plugins.DeleteCustomerAddress: удаление customeraddress

    + msdyn_partypostaladdress

        + Создать

            + Microsoft.Dynamics.GABExtended.Plugins.CreateCustomerAddress: создание msdyn_partypostaladdress
            + Microsoft.Dynamics.GABExtended.Plugins.PartyPostalAddress: создание msdyn_partypostaladdress

        + Обновить 

            + Microsoft.Dynamics.GABExtended.Plugins.CreateCustomerAddress: обновление msdyn_partypostaladdress
            + Microsoft.Dynamics.GABExtended.Plugins.PartyPostalAddress: обновление msdyn_partypostaladdress

    + msdyn_postaladdress

        + Создать

            + Microsoft.Dynamics.GABExtended.Plugins.PostalAddress: создание msdyn_postaladdress
            + Microsoft.Dynamics.GABExtended.Plugins.PostalAddressPostCreate: создание msdyn_postaladdress
            + Microsoft.Dynamics.GABExtended.Plugins.UpdateCustomerAddress: создание msdyn_postaladdress

        + Обновить 

            + Microsoft.Dynamics.GABExtended.Plugins.PostalAddressUpdate: обновление msdyn_postaladdress
            + Microsoft.Dynamics.GABExtended.Plugins.UpdateCustomerAddress: обновление msdyn_postaladdress

    + msdyn_partyelectronicaddress

        + Создать

            + Microsoft.Dynamics.GABExtended.Plugins.PartyElectronicAddressSync: создание msdyn_partyelectronicaddress

        + Обновить 

            + Microsoft.Dynamics.GABExtended.Plugins.PartyElectronicAddressSync: обновление msdyn_partyelectronicaddress

        + Удаление

            + Microsoft.Dynamics.GABExtended.Plugins.DeletePartyElectronicAddressSync: удаление msdyn_partyelectronicaddress

6. В приложении взаимодействия с клиентами отключите следующие workflow-процессы:

    + Создание поставщиков в таблице "Организации"
    + Создание поставщиков в таблице "Организации"
    + Создание поставщиков типа "респондент" в таблице "Контакты"
    + Создание поставщиков типа "Физическое лицо" в таблице "Поставщики"
    + Обновление поставщиков в таблице "Организации"
    + Обновление поставщиков в таблице "Поставщики"
    + Обновление поставщиков типа "Физическое лицо" в таблице "Контакты"
    + Обновление поставщиков типа "Физическое лицо" в таблице "Поставщики"

7. В фабрике данных выполните шаблон, выбрав **Активировать сейчас**, как показано на следующей иллюстрации. Этот процесс может занять несколько часов в зависимости от объема данных.

    ![Выполнение шаблона.](media/data-factory-trigger.png)

    > [!NOTE]
    > Если имеются настройки для **Учетная запись**, **Контактное лицо** и **Поставщик**, необходимо изменить шаблон.

8. Импортируйте новые записи **Субъект** в приложение для финансов и операций.

    1. Загрузите файл **FONewParty.csv** из хранилища BLOB-объектов Azure. Путь: **partybootstrapping/output/FONewParty.csv**.
    2. Преобразуйте файл **FONewParty.csv** в файл Excel и импортируйте файл Excel в приложение для финансов и операций. Если вам подходит импорт CSV, можно также напрямую импортировать файл CSV. Этот шаг может занять несколько часов в зависимости от объема данных. Дополнительные сведения см. в разделе [Обзор заданий импорта и экспорта данных](../data-import-export-job.md).

    ![Импорт записей субъекта Dataverse.](media/data-factory-import-party.png)

9. В фабрике данных выполните шаблоны почтового адреса субъекта и электронного адреса субъекта, один за другим.

    + Шаблон почтового адреса субъекта обновляет и вставляет все записи почтового адреса в приложение для взаимодействия с клиентами и связывает их с соответствующими записями **Организация**, **Контакт** и **Поставщик**. Он также создает три CSV-файла: ImportFONewPostalAddressLocation.csv, ImportFONewPartyPostalAddress.csv и ImportFONewPostalAddress.csv.
    + Шаблон электронного адреса субъекта обновляет и вставляет все электронные адреса в приложение для взаимодействия с клиентами и связывает их с соответствующими записями **Организация**, **Контакт** и **Поставщик**. Он также создает один CSV-файл: ImportFONewElectronicAddress.csv.

    ![Выполнение шаблонов почтового адреса субъекта и электронного адреса субъекта.](media/ADF-7.png)

10. Чтобы обновить приложение для финансов и операций, используя эти данные, необходимо преобразовать CSV-файлы в рабочую книгу Excel и [импортировать их в приложение для финансов и операций](/data-entities/data-import-export-job). Если вам подходит импорт CSV, можно также напрямую импортировать файлы CSV. Этот шаг может занять несколько часов в зависимости от объема.

    ![Успешный импорт.](media/ADF-8.png)

11. В приложении для взаимодействия с клиентами включите следующие шаги подключаемого модуля:

    + Обновление учетной записи

        + Microsoft.Dynamics.GABExtended.Plugins.UpdatePartyAttributesFromAccountEntity: Обновление учетной записи
        + Microsoft.Dynamics.FinanceExtended.Plugins.TriggerNotesForCustomerTypeCodes: Обновление учетной записи

    + Обновление контактного лица

        + Microsoft.Dynamics.GABExtended.Plugins.UpdatePartyAttributesFromContactEntity: Обновление контактного лица
        + Microsoft.Dynamics.FinanceExtended.Plugins.TriggerNotesForSellableContact: Обновление контактного лица

    + Обновление msdyn_party

        + Microsoft.Dynamics.GABExtended.Plugins.UpdatePartyAttributesFromPartyEntity: Обновление msdyn_party

    + Обновление msdyn_vendor

        + Microsoft.Dynamics.GABExtended.Plugins.UpdatePartyAttributesFromVendorEntity: Обновление msdyn_vendor

    + msdyn_partypostaladdress

        + Создать

            + Microsoft.Dynamics.GABExtended.Plugins.CreateCustomerAddress: создание msdyn_partypostaladdress
            + Microsoft.Dynamics.GABExtended.Plugins.PartyPostalAddress: создание msdyn_partypostaladdress

        + Обновить 

            + Microsoft.Dynamics.GABExtended.Plugins.CreateCustomerAddress: обновление msdyn_partypostaladdress
            + Microsoft.Dynamics.GABExtended.Plugins.PartyPostalAddress: обновление msdyn_partypostaladdress

    + msdyn_postaladdress

        + Создать

            + Microsoft.Dynamics.GABExtended.Plugins.PostalAddress: создание msdyn_postaladdress
            + Microsoft.Dynamics.GABExtended.Plugins.PostalAddressPostCreate: создание msdyn_postaladdress
            + Microsoft.Dynamics.GABExtended.Plugins.UpdateCustomerAddress: создание msdyn_postaladdress

        + Обновить 

            + Microsoft.Dynamics.GABExtended.Plugins.PostalAddressUpdate: обновление msdyn_postaladdress
            + Microsoft.Dynamics.GABExtended.Plugins.UpdateCustomerAddress: обновление msdyn_postaladdress
 
    + msdyn_partyelectronicaddress

        + Создать

            + Microsoft.Dynamics.GABExtended.Plugins.PartyElectronicAddressSync: создание msdyn_partyelectronicaddress

        + Обновить 

            + Microsoft.Dynamics.GABExtended.Plugins.PartyElectronicAddressSync: обновление msdyn_partyelectronicaddress

        + Удаление

            + Microsoft.Dynamics.GABExtended.Plugins.DeletePartyElectronicAddressSync: удаление msdyn_partyelectronicaddress

12. В приложении взаимодействия с клиентами активируйте следующие рабочие процессы, если они были ранее деактивированы:

    + Создание поставщиков в таблице "Организации"
    + Создание поставщиков в таблице "Организации"
    + Создание поставщиков типа "респондент" в таблице "Контакты"
    + Создание поставщиков типа "Физическое лицо" в таблице "Поставщики"
    + Обновление поставщиков в таблице "Организации"
    + Обновление поставщиков в таблице "Поставщики"
    + Обновление поставщиков типа "Физическое лицо" в таблице "Контакты"
    + Обновление поставщиков типа "Физическое лицо" в таблице "Поставщики"

13. Выполните сопоставления, связанные с записью **Субъект**, как описано в разделе [Субъект и глобальная адресная книга](party-gab.md).

## <a name="explanation-of-the-data-factory-templates"></a>Объяснение шаблонов фабрики данных

В этом разделе описаны шаги в каждом шаблоне фабрики данных.

### <a name="steps-in-the-party-template"></a>Шаги в шаблоне субъекта

1. Шаги с 1 по 6 идентифицируют компании, для которых разрешена двойная запись, и создают для них предложение фильтра.
2. Шаги с 7-1 по 7-9 извлекают данные из приложения для финансов и операций и приложения для взаимодействия с клиентами и подготовить эти данные для обновления.
3. Шаги с 8 по 9 сравнивают номер субъекта для записей **Организация**, **Контакт** и **Поставщик** между приложением для финансов и операций и приложением для взаимодействия с клиентами. Любые записи, не имеющие номера субъекта, будут пропущены.
4. На шаге 10 создаются два CSV-файла для записей субъекта, которые должны быть созданы в приложении для взаимодействия с клиентами и в приложении для финансов и операций.

    - **FOCDSParty.csv** — этот файл содержит все записи субъектов для обеих систем, независимо от того, активирована ли в компании двойная запись.
    - **FONewParty.csv** — этот файл содержит подмножество записей субъекта, которые известны Dataverse (например, счета типа **Перспективный клиент**).

5. На шаге 11 создаются субъекты в приложении для взаимодействия с клиентами.
6. На шаге 12 извлекают глобальные уникальные идентификаторы (GUID) субъектов из приложения для взаимодействия с клиентами и подготавливает их, что они могли быть связаны с записями **Организация**, **Контакт** и **Поставщик** в последующих шагах.
7. Шаг 13 связывает записи **Организация**, **Контакт** и **Поставщик** с идентификаторами GUID субъекта.
8. Шаги с 14-1 по 14-3 обновляют записи **Организация**, **Контакт** и **Поставщик** в приложении для взаимодействия с клиентами с идентификаторами GUID субъектов.
9. Шаги с 15-1 по 15-3 подготавливают записи **Контакт для субъекта** для записей **Организация**, **Контакт** и **Поставщик**.
10. Шаги с 16-1 по 16-7 извлекают справочные данные, такие как приветствия и личные типы символов, и связывают их с записями **Контакт для субъекта**.
11. Шаг 17 объединяет записи **Контакт для субъекта** для записей **Организация**, **Контакт** и **Поставщик**.
12. На шаге 18 выполняется импорт записей **Контакт для субъекта** в приложение для взаимодействия с клиентами.

### <a name="steps-in-the-party-postal-address-template"></a>Шаги в шаблоне почтового адреса субъекта

1. Шаги с 1-1 по 1-10 извлекают данные из приложения для финансов и операций и приложения для взаимодействия с клиентами и подготовить эти данные для обновления.
2. Шаг 2 отменяет нормализацию данных почтового адреса в приложении для финансов и операций путем объединения почтового адреса и почтового адреса субъекта.
3. Шаг 3 отменяет дублирование и слияние данных адреса организации, контакта и поставщика из приложения для взаимодействия с клиентами.
4. На шаге 4 создаются CSV-файлы для приложения для финансов и операций, чтобы создать новые данные адресов на основе адресов организаций, контактов и поставщиков.
5. На шаге 5-1 создаются файлы с расширением .csv для приложения для взаимодействия с клиентами, чтобы создать все данные адресов на основе приложения для финансов и операций и приложения для взаимодействия с клиентами.
6. Шаг 5-2 преобразует файлы .csv в формат импорта для финансов и операций для ручного импорта.

    - ImportFONewPostalAddressLocation.csv
    - ImportFONewPartyPostalAddress.csv
    - ImportFONewPostalAddress.csv

7. На шаге 6 данные коллекции почтовых адресов импортируются в приложение для взаимодействия с клиентами.
8. На шаге 7 данные коллекции почтовых адресов извлекаются из приложения для взаимодействия с клиентами.
9. На шаге 8 создаются данные адреса клиента и связывается код коллекции почтовых адресов.
10. Шаги с 9-1 по 9-2 связывают субъект и коды коллекций почтовых адресов с почтовыми адресами и почтовыми адресами субъекта.
11. На шагах с 10-1 по 10-3 импортируются адреса клиентов, почтовые адреса и почтовые адреса субъектов в приложение для взаимодействия с клиентами.

### <a name="steps-in-the-party-electronic-address-template"></a>Шаги в шаблоне электронного адреса субъекта

1. Шаги с 1-1 по 1-5 извлекают данные из приложения для финансов и операций и приложения для взаимодействия с клиентами и подготовить эти данные для обновления.
2. Шаг 2 консолидирует электронные адреса в приложении для взаимодействия с клиентами из сущностей организации, контакта и поставщика.
3. На шаге 3 осуществляется слияние данных основного электронного адреса из приложения для взаимодействия с клиентами и приложения для финансов и операций.
4. На шаге 4 создаются файлы .csv.

    - Создайте новые данные электронного адреса для приложения для финансов и операций на основе адресов организаций, контактов и поставщиков.
    - Создайте новые данные электронного адреса для приложения для взаимодействия с клиентами на основе электронного адреса, адресов организации, контакта и поставщика в приложении для финансов и операций.

5. На шаге 5-1 выполняется импорт электронных адресов в приложение для взаимодействия с клиентами.
6. На шаге 5-2 создаются файлы .csv для обновления основных адресов для организаций и контактов в приложении для взаимодействия с клиентами.
7. На шагах с 6-1 по 6-2 выполняется импорт основных адресов организаций и контактов в приложение для взаимодействия с клиентами.

## <a name="troubleshooting"></a>Устранение неполадок

1. Если процесс завершился с ошибкой, перезапустите фабрику данных. Начните со сбойного действия.
2. Некоторые файлы, которые создаются фабрикой данных, можно использовать для проверки данных.
3. Фабрика данных выполняется на основе файлов CSV. Поэтому если в значение любого поля входит запятая, это может повлиять на результаты. Необходимо удалить все запятые из значений полей.
4. Вкладка **Мониторинг** содержит сведения обо всех шагах и данных ,которые были обработаны. Выбор конкретного шага для его отладки.

    ![Вкладка "Мониторинг".](media/data-factory-monitor.png)

## <a name="learn-more-about-the-template"></a>Дополнительные сведения о шаблоне

Дополнительные сведения о шаблоне см. в разделе [Комментарии к файлу сведений для шаблона фабрики данных Azure](https://github.com/microsoft/Dynamics-365-FastTrack-Implementation-Assets/blob/master/Dual-write/Upgrade%20data%20to%20dual-write%20Party-GAB%20schema/readme.md).

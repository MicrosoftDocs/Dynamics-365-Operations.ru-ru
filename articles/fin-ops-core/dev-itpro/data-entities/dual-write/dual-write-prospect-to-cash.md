---
title: Продажа перспективному клиенту в случае двойной записи
description: В этом разделе приводятся сведения о продаже перспективному клиенту в случае двойной записи.
author: RamaKrishnamoorthy
ms.date: 01/07/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ''
audience: Application User, IT Pro
ms.reviewer: rhaertle
ms.custom: ''
ms.assetid: ''
ms.search.region: global
ms.search.industry: ''
ms.author: ramasri
ms.dyn365.ops.version: ''
ms.search.validFrom: 2020-01-27
ms.openlocfilehash: 33ed1c7f69fa92bbd123042a139dd8fd0ee3e73a
ms.sourcegitcommit: 074b6e212d19dd5d84881d1cdd096611a18c207f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2021
ms.locfileid: "5754096"
---
# <a name="prospect-to-cash-in-dual-write"></a>Продажа перспективному клиенту в случае двойной записи

[!include [banner](../../includes/banner.md)]



Важной целью большинства компаний является преобразование перспективных клиентов в клиентов и последующее построение долговременных деловых отношений с этими клиентами. В приложениях Microsoft Dynamics 365 обработка перспективных клиентов осуществляется с помощью предложений с расценками или рабочих процессов обработки заказов, и финансовые средства выверяются и опознаются. Интеграция продажи перспективному клиенту с двойной записью создает рабочий процесс, который принимает предложение с расценками и заказ, исходящий из Dynamics 365 Sales или Dynamics 365 Supply Chain Management, и делает предложение с расценками и заказ доступными в обоих приложениях.

В интерфейсах приложения в реальном времени можно получить доступ к статусам обработки и сведениям о счете. Таким образом, можно упростить управление функциями, такими как хранение товаров, управление запасами и выполнение в Supply Chain Management без повторного создания предложений с расценками и заказов.

![Поток данных при двойной записи в случае продажи перспективному клиенту](../dual-write/media/dual-write-prospect-to-cash[1].png)

Сведения об интеграции клиентов и контактов см. в разделе [Интегрированный справочник клиентов](customer-mapping.md). Сведения об интеграции продукта см. в разделе [Единый подход к работе с продуктами](product-mapping.md).

> [!NOTE]
> В Dynamics 365 Sales и перспективный клиент, и клиент ссылаются на запись в таблице **Учетная запись**, где столбец **RelationshipType** — это **Перспективный клиент** или **Клиент**. Если бизнес-логика включает процесс квалификации **Учетная запись**, когда запись **Учетная запись** создается и квалифицируется как перспективный клиент сначала, а затем как клиент, эта запись синхронизируется с приложением Finance and Operations только тогда, когда он является клиентом (`RelationshipType=Customer`). Если вы хотите, чтобы строка **Учетная запись** синхронизировалась как перспективный клиент, то необходимо создать пользовательское сопоставление для интеграции данных перспективных клиентов.

## <a name="prerequisites-and-mapping-setup"></a>Необходимые условия и настройка сопоставления

Прежде чем выполнять синхронизацию предложений с расценками по продажам, необходимо обновить следующие настройки.

### <a name="setup-in-sales"></a>Настройка в Sales

В Sales откройте **Параметры \> Администрирование \> Параметры системы \> Продажи** и убедитесь, что используются следующие настройки:

- Для системного параметра **Использовать системный расчет цен** установлено значение **Да**.
- Для столбца **Способ расчета скидки** установлено значение **Номенклатура строки**.

### <a name="sites-and-warehouses"></a>Сайты и склады

В Supply Chain Management столбцы **Сайт** и **Склад** являются обязательными для строк предложений с расценками и строк заказа. Если задан сайт и склад в параметрах заказа по умолчанию, эти столбцы будут автоматически установлены при добавлении продукта в строку предложения с расценками или в строку заказа. 

### <a name="number-sequences-for-quotations-and-orders"></a>Номерные серии для предложений и заказов

Номерные серии для Supply Chain Management и Sales не подключаются, если предложения и заказы созданы и синхронизированы в Sales и Supply Chain Management. Если заказ на продажу, созданный в модуле Sales, синхронизирован с Supply Chain Management, он имеет тот же номер заказа на продажу, что и в Supply Chain Management. Чтобы гарантировать, что номер заказа на продажу не дублируется, следует использовать другие системы номерных серий в двух приложениях.

Например, номерная серия в Supply Chain Management — **1, 2, 3, 4, 5, ...**, номерная серия в Sales — **100, 99, 98, ...**. При создании 100 заказов на продажу в модуле Sales в конечном итоге будет создан номер заказа, который уже существует в Supply Chain Management. Другими словами, две номерные серии будут в конечном итоге перекрываться по мере создания заказов на продажу в модулях Supply Chain Management и Sales. Вместо этого можно использовать номерную серию, такую как **F1, F2, F3, ...** в Supply Chain Management и номерную серии, например **C1, C2, C3, ...** в модуле Sales. Эти номерные серии никогда не будут создавать дубликаты номеров заказов на продажу.

## <a name="sales-quotations"></a>Предложения по продажам

Предложения по продажам создаются в Sales или Supply Chain Management. При создании предложения в модуле Sales оно синхронизируется с Supply Chain Management в реальном времени. Аналогично, при создании предложения в модуле Supply Chain Management оно синхронизируется с Sales в реальном времени. Обратите внимание на следующие аспекты:

+ К продукту в предложении можно добавить скидку. В этом случае скидка будет синхронизирована с Supply Chain Management. Столбцы **Скидка**, **Расходы** и **Налог** в заголовке управляются настройкой в Supply Chain Management. Эта настройка не поддерживает сопоставление интеграции. Вместо этого столбцы **Цена**, **Скидка**, **Расходы** и **Налог** управляются и обрабатываются в Supply Chain Management.
+ Столбцы **% скидки**, **Скидка** и **Сумма транспортировки** в заголовке предложения по продаже доступны только для чтения.
+ Столбцы **Условия фрахта**, **Условия поставки**, **Способ доставки** и **Режим доставки** не являются частью сопоставлений по умолчанию. Чтобы сопоставить эти столбцы, необходимо настроить преобразование значений, характерное для данных в организациях, между которыми синхронизируется таблица.

Если используется также решение Field Service, обязательно снова включите параметр **Быстрое создание строки предложения**. Повторное включение этого параметра позволяет продолжить создание строк предложения с помощью функции быстрого создания.
1. Перейдите к приложению Dynamics 365 Sales.
2. Выберите значок настройки на верхней панели навигации.
3. Выберите **Дополнительные параметры**.
4. Выберите пункт **Настроить систему**.
5. Выберите пункт меню **Строка предложения**.
6. Перейдите к разделу **Службы данных** и установите флажок **Разрешить быстрое создание**.

## <a name="sales-orders"></a>Заказы на продажу

Заказы на продажу создаются в Sales или Supply Chain Management. При создании заказа на продажу в модуле Sales он синхронизируется с Supply Chain Management в реальном времени. Аналогично, при создании заказа на продажу в модуле Supply Chain Management он синхронизируется с Sales в реальном времени. Обратите внимание на следующие аспекты:

+ Вписываемые продукты в Dynamics 365 Sales будут отображаться как категории продуктов в Dynamics 365 Supply Chain Management.
+ Расчет и округление скидок:

    - Модель расчета скидки в Sales отличается от модели расчета скидки в Supply Chain Management. В Supply Chain Management конечная сумма скидка по строке продаж могут возникнуть в результате сочетания сумм скидок и процентов скидок. Если эта конечная сумма скидки делится на количество в строке, может произойти округление. Однако это округление не учитывается, если округленная сумма скидки на единицу синхронизируется с Sales. Чтобы обеспечить, чтобы полная сумма скидки из строки продаж в Supply Chain Management правильно синхронизировалась с Sales, должна синхронизироваться полная сумма без деления на количество в строке. Таким образом, необходимо определить способ расчета скидки как **Позиция строки** в Sales.
    - Когда строки заказа на продажу синхронизируется из Sales в Supply Chain Management, используется полная сумма скидки по строке. Поскольку в Supply Chain Management нет столбца для хранения полной суммы скидки для строки, эта сумма делится на количество и хранится в столбце **Скидка по строке**. Все округления, возникающие при этом делении, хранятся в столбце **Накладные расходы на продажи** в строке продажи.

### <a name="example-synchronization-from-sales-to-supply-chain-management"></a>Пример: синхронизация из Sales в Supply Chain Management

Имеются следующие заказы на продажу:

+ **Sales:** количество = 3, скидка по строке = $10,00
+ **Supply Chain Management** : количество = 3, сумма скидки по строке = $3,33, накладные расходы на продажи = –$0,01

Если выполняется синхронизация из Supply Chain Management с Sales, будет получен следующий результат:

+ **Supply Chain Management** : количество = 3, сумма скидки по строке = $3,33, накладные расходы на продажи = –$0,01
+ **Sales:** количество = 3, скидка по строке = (3 × $3,33) + $0,01 = $10,00

## <a name="dual-write-solution-for-sales"></a>Решение двойной записи для Sales

В таблице **Заказ** добавлены новые столбцы, которые отображаются на странице. Большая часть этих столбцов отображается на вкладке **Интеграция** в модуле Sales. Для получения дополнительных сведений о том, как сопоставляются столбцы статуса, см. раздел [Настройка сопоставления для столбцов статуса заказа на продажу](sales-status-map.md).

+ Кнопки **Создать накладную** и **Отменить заказ** на странице **Заказ на продажу** скрыты в Sales.
+ Значение **Статус заказа на продажу** будет оставаться **Активный**, чтобы помочь гарантировать, что изменения из Supply Chain Management будут передаваться в заказ на продажу в Sales. Для управления таким поведением задайте для параметра **Statecode \[Статус\]** значение по умолчанию **Active**.

## <a name="invoices"></a>Накладные

Накладные по продажам создаются в Supply Chain Management и синхронизируются с Sales. Обратите внимание на следующие аспекты:

+ Столбец **Номер накладной** был добавлен в таблицу **Накладная** и отображается на странице.
+ Кнопка **Создать накладную** на странице **Заказ на продажу** скрывается, потому что накладные будут создаваться в Supply Chain Management и синхронизироваться в Sales. Страница **Накладная** недоступна для редактирования, потому что накладные будут синхронизироваться из Supply Chain Management.
+ Значение **Статус заказа на продажу** меняется автоматически на **Выставлена накладная** после того как соответствующая накладная из Supply Chain Management синхронизируется в Sales. Кроме того, владелец заказа на продажу, из которого была создана накладная, назначается в качестве владельца накладной. Таким образом, владелец заказа на продажу может просмотреть накладную.
+ Столбцы **Условия фрахта**, **Условия поставки** и **Способ доставки** не включены в сопоставления по умолчанию. Чтобы сопоставить эти столбцы, необходимо настроить преобразование значений, характерное для данных в организациях, между которыми синхронизируется таблица.

## <a name="templates"></a>Шаблоны

Продажи перспективному клиенту включают коллекцию сопоставлений основных таблиц, которые работают совместно во время взаимодействия данных клиентов, как показано в следующей таблице.

| Приложения Finance and Operations | Приложения для взаимодействия с клиентами | описание |
|-----------------------------|-----------------------------------|-------------|
| Заголовки накладной заказа на продажу V2    | накладные                          | Таблица заголовков счетов на продажу v2 в приложении Finance and Operations содержит накладные для заказов на продажу и накладных с произвольным текстом. Фильтр применяется в Dataverse для двойной записи, которая отфильтровывает все документы накладных с произвольным текстом. |
| Строки накладной заказа на продажу V2      | invoicedetails                    |             |
| Заголовки заказов на продажу CDS     | salesorders                       |             |
| Строки заказа на продажу CDS       | salesorderdetails                 |             |
| Коды происхождения заказов на продажу    | msdyn\_salesorderorigins          |             |
| Заголовок предложения по продаже CDS  | предложения                            |             |
| Строки предложения по продаже CDS   | quotedetails                      |             |

Ниже приведены соответствующие сопоставления базовых таблиц для продажи перспективному клиенту:

+ [Клиенты V3 -> организации](customer-mapping.md#customers-v3-to-accounts)
+ [Контакты CDS V2 -> контакты](customer-mapping.md#cds-contacts-v2-to-contacts)
+ [Клиенты V3 -> контакты](customer-mapping.md#customers-v3-to-contacts)
+ [Выпущенные продукты V2 -> msdyn_sharedproductdetails](product-mapping.md#released-products-v2-to-msdyn_sharedproductdetails)
+ [Все продукты -> msdyn_globalproducts](product-mapping.md#all-products-to-msdyn_globalproducts)
+ [Прайс-лист](product-mapping.md)

## <a name="limitations"></a>Ограничения
- Заказы на возврат не поддерживаются.
- Кредит-ноты не поддерживаются.
- Финансовые аналитики должны быть настроены для справочника, например клиента и поставщика. Когда клиент добавляется в предложение с расценками или заказ на продажу, финансовые аналитики, связанные с записью клиента, автоматически перетекают в заказ. В настоящее время двойная запись не включает данные финансовых аналитик для справочника. 

[!include [symbols](../../includes/dual-write-symbols.md)]

[!include [sales invoice](includes/SalesInvoiceHeaderV2Entity-invoice.md)]

[!include [sales invoice line](includes/SalesInvoiceLineV2Entity-invoicedetail.md)]

[!include [sales order header](includes/SalesOrderHeaderCDSEntity-salesorder.md)]

[!include [sales order line](includes/SalesOrderLineCDSEntity-salesorderdetails.md)]

[!include [sales order origin](includes/SalesOrderOriginEntity-msdyn-salesorderorigin.md)]

[!include [sales quotation header](includes/SalesQuotationHeaderCDSEntity-quote.md)]

[!include [sales quotation line](includes/SalesQuotationLineCDSEntity-QuoteDetails.md)]


[!INCLUDE[footer-include](../../../../includes/footer-banner.md)]
---
title: Устранение неполадок при начальной настройке
description: В этой статье содержатся сведения об устранении неполадок, которые могут полезны при разрешении проблем, возникающих в процессе начальной настройки интеграции двойной записи.
author: RamaKrishnamoorthy
ms.date: 08/10/2021
ms.topic: article
audience: Application User, IT Pro
ms.reviewer: sericks
ms.search.region: global
ms.author: ramasri
ms.search.validFrom: 2020-03-16
ms.openlocfilehash: d33fc6f4895b53f16cc6957a3a2fc6b1abe90a2f
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/12/2022
ms.locfileid: "9289525"
---
# <a name="troubleshoot-issues-during-initial-setup"></a>Устранение неполадок при начальной настройке

[!include [banner](../../includes/banner.md)]

Эта статья предоставляет информацию по устранению неполадок для интеграции двойной записи между приложениями для управления финансами и операциями и Dataverse. Конкретно, в этом разделе содержатся сведения об устранении неполадок, которые могут возникнуть в процессе начальной настройки интеграции двойной записи.

> [!IMPORTANT]
> Для устранения некоторых проблем, рассмотренных в этой статье, может потребоваться роль системного администратора или учетные данные администратора клиента Microsoft Azure Active Directory (Azure AD). В разделе для каждого выпуска объясняется, требуются ли конкретная роль или учетные данные.

## <a name="you-cant-link-a-finance-and-operations-app-to-dataverse"></a>Невозможно связать приложение для управления финансами и операциями с Dataverse

**Необходимая роль для настройки двойной записи:** системный администратор в приложениях для управления финансами и операциями и Dataverse.

Ошибки на странице **Настройка ссылки на Dataverse** обычно вызываются проблемами с неполной настройкой или разрешениями. Убедитесь, что вся проверка работоспособности пройдена на странице **Настройка ссылки на Dataverse**, как показано на следующем рисунке. Связывание двойной записи возможно только после полной проверки работоспособности.

![Успешная проверка работоспособности.](media/health_check.png)

Необходимы учетные данные администратора клиента Azure AD, чтобы можно было связать среды для управления финансами и операциями и Dataverse. После связывания сред пользователи могут войти в систему, используя учетные данные своих учетных записей, и обновить существующее сопоставление таблиц.

## <a name="find-the-limit-on-the-number-of-legal-tables-or-companies-that-can-be-linked-for-dual-write"></a>Определение предельного числа юридических лиц или компаний, которые могут быть связаны с двойной записью

При попытке включения сопоставлений может появиться следующее сообщение об ошибке:

*Ошибка двойной записи - сбой регистрации подключаемого модуля: [(Не удается получить карту разделов для проекта DWM-1ae35e60-4bc2-4905-88ea-69efd3b29260-7f12cb89-1550-42e2-858e-4761fc1443ea. Ошибка Превышено максимальное число разделов, допустимое для сопоставления DWM-1ae35e60-4bc2-4905-88ea-69efd3b29260-7f12cb89-1550-42e2-858e-4761fc1443ea)], Возникла одна или несколько ошибок.*

Текущий предел при связывании сред составляет примерно 40 юридических лиц. Эта ошибка возникает, если при попытке включить сопоставления между этими средами связано более 40 юридических лиц.

## <a name="connection-set-failed-while-linking-environment"></a>Во время связывания среды не удалось установить подключение

При связывании среды с двойной записью выполнение действия завершается сообщением об ошибке:

*Ошибка при сохранении набора соединений! Элемент с таким же ключом уже добавлен.*

Двойная запись не поддерживает несколько юридических лиц/компаний с одинаковым именем. Например, если в Dataverse имеется две компании с именем DAT, будет получено сообщение об ошибке.

Чтобы разблокировать клиента, удалите повторяющиеся записи из таблицы **cdm_company** в Dataverse. Кроме того, если таблица **cdm_company** имеет записи с пустым именем, удалите или исправьте эти записи.

## <a name="error-when-opening-the-dual-write-page-in-finance-and-operations-apps"></a>Ошибка при открытии страницы двойной записи в приложениях для управления финансами и операциями

При попытке связать среду Dataverse для двойной записи может появиться следующее сообщение об ошибке:

*Код статуса отклика не указывает на успешное выполнение: 404 (Не найден).*

Эта ошибка возникает, когда шаг разрешения приложения не был завершен. Можно проверить, предоставлено ли разрешение с помощью входа в систему `portal.azure.com` с использованием учетной записи администратора клиента, и проверить, отображается ли стороннее приложение с идентификатором `33976c19-1db5-4c02-810e-c243db79efde` в списке корпоративных приложений AAD. В противном случае повторно выполните шаг разрешения, как описано в следующем разделе.

### <a name="providing-app-consent"></a>Обеспечение согласия приложения

+ Откройте следующий URL-адрес, используя учетные данные администратора.

    `https://login.microsoftonline.com/common/oauth2/authorize?client_id=33976c19-1db5-4c02-810e-c243db79efde&response_type=code&prompt=admin_consent`

+ Выберите **Принять** для согласия. Вы даете согласие установить приложение (с `id=33976c19-1db5-4c02-810e-c243db79efde`) в клиенте.
+ Это приложение требуется для Dataverse для связи с приложениями для управления финансами и операциями.

    ![Устранение неполадок при настройке первоначальной синхронизации.](media/Initial-sync-setup-troubleshooting-1.png)

> [!NOTE]
> Если это не сработает, запустите URL-адрес в частном режиме Microsoft Edge или в режиме инкогнито в Chrome.

## <a name="finance-and-operations-environment-is-not-discoverable"></a>Среда для управления финансами и операциями не является видимой

Возможно следующее сообщение об ошибке:

*Среда приложений для управления финансами и операциями \*\*\*.cloudax.dynamics.com не обнаруживается.*

Есть две вещи, которые могут стать причиной проблем со средой, которая не может быть обнаружена:

+ Пользователь, используемый для входа, не является тем же клиентом, что и экземпляр среды для управления финансами и операциями.
+ Существуют устаревшие экземпляры среды для управления финансами и операциями, которые были размещены корпорацией Microsoft и которые столкнулись с проблемой обнаружения. Чтобы исправить это, обновите экземпляр среды для управления финансами и операциями. Среда становится видимой с любым обновлением.

## <a name="403-forbidden-error-while-connections-are-being-created"></a>Ошибка 403 (запрещено) во время создания подключений

В процессе создания связи с двойной записью два подключения Power Apps (называемые также подключениями *Apihub*) создаются от имени пользователя в связанной среде Dataverse. Если у клиента нет лицензии для среды Power Apps, создание подключений ApiHub завершается сбоем и отображается сообщение об ошибке 403 (запрещено). Ниже приведен пример сообщения об ошибке.

> MSG=\[Не удалось настроить среду для двойной записи. Сведения об ошибке: код статуса отклика не указывает на успешное выполнение: 403 (запрещено). - Код состояния ответа не указывает на успешное выполнение: 403 (запрещено).\] STACKTRACE=\[   в Microsoft.Dynamics.Integrator.ProjectManagementService.DualWrite.DualWriteConnectionSetProcessor.\<CreateDualWriteConnectionSetAsync\>d\_\_29.MoveNext() in X:\\bt\\1158727\\repo\\src\\ProjectManagementService\\DualWrite\\DualWriteConnectionSetProcessor.cs:строка 297 --- Конец трассировки стека из предыдущего местоположения, где было вызвано исключение --- в System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() в System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) в Microsoft.Dynamics.Integrator.ProjectManagementService.Controllers.DualWriteEnvironmentManagementController.\<SetupDualWriteEnvironmentAsync\>d\_\_34.MoveNext() in X:\\bt\\1158727\\repo\\src\\ProjectManagementService\\Controllers\\DualWriteEnvironmentManagementController.cs:строка 265\]

Эта ошибка происходит из-за отсутствия лицензии Power Apps. Назначьте пользователю соответствующую лицензию (например, пробный план 2 Power Apps), чтобы у него было разрешение на создание подключений. Для проверки лицензии клиент может перейти на сайт [Моя учетная запись](https://portal.office.com/account/?ref=MeControl#subscriptions), чтобы посмотреть лицензии, которые в настоящее время назначены пользователю.

Дополнительные сведения о лицензии Power Apps см. в следующих статьях:

- [Назначение лицензий пользователям](/microsoft-365/admin/manage/assign-licenses-to-users?view=o365-worldwide)
- [Приобретение Power Apps для организации](/power-platform/admin/signup-for-powerapps-admin)

[!INCLUDE[footer-include](../../../../includes/footer-banner.md)]


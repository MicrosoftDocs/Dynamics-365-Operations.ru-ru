---
title: Настройка импорта данных из SharePoint
description: В этой теме объясняется, как импортировать данные из Microsoft SharePoint.
author: NickSelin
manager: AnnBe
ms.date: 11/19/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: 220314
ms.assetid: 2685df16-5ec8-4fd7-9495-c0f653e82567
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2018-04-01
ms.dyn365.ops.version: Release 8.0
ms.openlocfilehash: 1f7754a3e69238ab1760b3f7eb8f5e2c792b451b
ms.sourcegitcommit: 659375c4cc7f5524cbf91cf6160f6a410960ac16
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/05/2020
ms.locfileid: "4680910"
---
# <a name="configure-data-import-from-sharepoint"></a>Настройка импорта данных из SharePoint

[!include[banner](../includes/banner.md)]

Чтобы импортировать данные из входящего файла с помощью платформы для электронной отчетности (электронной отчетности), необходимо конфигурировать формат электронной отчетности, которая поддерживает импорт, и запустить соответствие модели типу **К месту назначения**, в котором используется данный формат в качестве источника данных. Чтобы импортировать данные, необходимо перейти к файлу, который требуется импортировать. Входящий файл может быть вручную выбран пользователем. При помощи новых возможностей электронной отчетности для поддержки импорта данных из Microsoft SharePoint можно настроить этот процесс как не требующий участия пользователя. Чтобы выполнить импорт данных из файлов, которые хранятся в папках Microsoft SharePoint можно использовать конфигурации аварийного восстановления. В этом разделе объясняется, как выполнить импорт из SharePoint. В примерах используются транзакции по поставщику по поставщику в качестве бизнес-данных.

## <a name="prerequisites"></a>Необходимые условия
Чтобы завершить примеры из этой темы необходимы следующие возможности доступа:

- Доступ к одной из следующих ролей:

    - Разработчик электронной отчетности
    - Консультант по функциональным возможностям электронной отчетности
    - Системный администратор

- Откройте экземпляр Microsoft SharePoint Server, который настроен для использования с приложением.
- Конфигурации формата и модели электронной отчетности для платежей по форме 1099.

### <a name="create-required-er-configurations"></a>Создать необходимые конфигурации электронной отчетности
Запустите проводники по задаче **Импорт данных электронной отчетности из файла Microsoft Excel**, входящие в состав бизнес-процесса **7.5.4.3 Приобретение/разработка компонентов ИТ-услуг и решений (10677)**. Эти проводники по задаче объясняет процесс разработки и использования конфигураций электронной отчетности для интерактивного импорта проводок по поставщику из файлов Microsoft Excel. Дополнительные сведения см. в разделе [Разбор входящих документов в формате Excel](parse-incoming-documents-excel.md). После завершения руководств по задачам вы будете иметь следующие настройки.

#### <a name="er-configurations"></a>Конфигурации электронной отчетности

- Конфигурация модели электронной отчетности, **Модель платежей по форме 1099**
- Конфигурации формата электронной отчетности, **Формат для импорта проводок поставщиков из Excel**

![Конфигурации электронной отчетности для импорта данных из SharePoint](./media/GERImportFromSharePoint-01-Configurations.PNG)

#### <a name="sample-of-the-incoming-file-for-data-import"></a>Образец входящего файла для импорта данных

- Файл Excel **1099import data.xlsx**, с транзакциями поставщика, которые должны быть импортированы.

![Образец файла Excel для импорта из SharePoint](./media/GERImportFromSharePoint-02-Excel.PNG)
    
> [!NOTE]
> Формат для импорта проводок поставщика выбран в качестве сопоставление модели по умолчанию. Таким образом, если выполнить сопоставление модели **Модель платежей по форме 1099** и это сопоставления модели типа **К месту назначения**, сопоставление модели выполняет этот формат, чтобы импортировать данные из внешних файлов. Затем эти данные используются для обновления таблицы приложения.

## <a name="configure-access-to-sharepoint-for-file-storage"></a>Настройка доступа к SharePoint для хранения файлов
Для хранения файлов электронных отчетов в расположении SharePoint необходимо настроить доступ к экземпляру SharePoint Server, который будет использоваться текущей компанией. В этом примере это компания USMF. Инструкции см. в разделе [Настройка хранения в SharePoint](../../fin-ops/organization-administration/configure-document-management.md#configure-sharepoint-storage).

1. Выполните шаги из раздела [Настройка хранения в SharePoint](../../fin-ops/organization-administration/configure-document-management.md#configure-sharepoint-storage).
2. Откройте настроенный сайт SharePoint.
3. Создайте следующие папки, в которых будут храниться входящие файлы электронной отчетности:

     - Источник импорта файлов (основной) (пример показан на снимке экрана ниже)
     - Источник импорта файлов (альтернативный)

    ![Источник импорта файлов (основной)](./media/GERImportFromSharePoint-04-SharePointFolder1.png)

4. (Необязательно) Создайте следующие папки, в которых будут храниться файлы после импорта. 

    - Папка архива файлов — эта папка предназначена для успешно импортированных файлов.
    - Папка для файлов с предупреждениями — эта папка предназначена для файлов, которые были импортированы с предупреждением.
    - Папка для файлов с ошибками — эта папка предназначена для файлов, импорт которых завершился сбоем.

4. Выберите **Управление организацией > Управление документами > Типы документов**.
5. Создайте следующие типы документов, которые будут использоваться для доступа к папкам SharePoint, которые созданы. Инструкции см. в разделе [Настройка типов документов](../../fin-ops/organization-administration/configure-document-management.md#configure-document-types).

|Вид документа       | Групповое              | Местоположение      | Папка SharePoint      |
|--------------------|--------------------|---------------|------------------------|
|Основной полуфабрикат             |Хранилище файлов                |SharePoint     |Источник импорта файлов (основной)|
|Альтернативный полуфабрикат             |Хранилище файлов                |SharePoint     |Источник импорта файлов (альтернативный)|
|Архив SP             |Хранилище файлов                |SharePoint     |Папка архива файлов|
|Предупреждение SP             |Хранилище файлов                |SharePoint     |Папка для файлов с предупреждениями|
|Ошибка SP             |Хранилище файлов                |SharePoint     |Папка для файлов с ошибками|

![Настройка SharePoint — новый тип документа](./media/GERImportFromSharePoint-06-SharePointDocumentTypesSetup.png)

## <a name="configure-er-sources-for-the-er-format"></a>Настроить источники электронной отчетности для формата электронной отчетности
1. Перейдите в раздел **Управление организацией** \> **Электронная отчетность** \> **Источник электронной отчетности**.
2. На странице **Источник электронной отчетности** настройте исходные файлы для импорта данных с использованием сконфигурированного формата электронной отчетности.
3. Определите маску имени файла, таким образом, чтобы импортировались только файлы с расширением .xlsx. Маска имени файла является необязательной и используется только в том случае, если она была определена. Можно определить только одну маску для каждого формата электронной отчетности.
4. Измените значение параметра **Сортировать файлы перед импортом** на **Не сортировать**, если существует несколько файлов для импорта и не важен порядок импорта
5. Выберите все папки SharePoint, которые были созданы ранее.

    [![Настройка источника файлов электронной отчетности](./media/GERImportFromSharePoint-07-FormatSourceSetup.PNG)](./media/GERImportFromSharePoint-07-FormatSourceSetup.PNG)

> [!NOTE]
> - *Источник* электронной отчетности определяется индивидуально для каждой компании приложения. Напротив, *Конфигурации* электронной отчетности используются совместно несколькими компаниями.
> - При удалении настройки источника электронной отчетности в формате электронной отчетности также удаляются все состояния связанного файла (см. ниже) при подтверждении.

## <a name="review-the-files-states-for-the-er-format"></a>Просмотрите состояния файлов для формата электронной отчетности
1. На странице **Источник электронной отчетности** выберите **Состояния файлов для источников** для просмотра содержимого источников файлов, настроенных для текущего формата электронной отчетности.
2. В разделе **Файлы** просмотрите список файлов. Этот список будут включены следующие:

    - Исходные файлы, которые применимы на основе маски имя файла (если маска файла определена), и готовые для импорта данных. Для этих файлов раздел **Журналы источников для формата импорта** пуст.
    - Ранее импортированные файлы. Для каждого из этих файлов, в разделе **Журналы источников для формата импорта** можно просмотреть историю импорта этого файла.

Можно также открыть страницу **Состояния файлов для источников**, выбрав **Управление организацией** \> **Электронная отчетность** \> **Состояния файлов для источников**. В этом случае страница предоставляет сообщение об источниках файла для всех форматов электронной отчетности, которые были сконфигурированы для источников файлов в компании, в которую выполнен вход в данный момент.

## <a name="import-data-from-excel-files-that-are-in-a-sharepoint-folder"></a>Импорт данных из файлов Excel, которые находятся в папке SharePoint
1. В SharePoint необходимо отправить файл Microsoft Excel **1099import data.xlsx**, содержащий транзакции поставщика, в папку SharePoint **Источник импорта файлов (основной)**, созданную ранее.

    [![Содержимое SharePoint — файл Microsoft Excel для импорта](./media/GERImportFromSharePoint-08-UploadFile.png)](./media/GERImportFromSharePoint-08-UploadFile.png)

2. На странице **Состояния файлов для источников** выберите **Обновить** для обновления страницы. Файл Excel, отправленный в SharePoint, появился на этой странице со статусом **Готово**. На данный момент поддерживаются следующие статусы:

    - **Готово** — назначается автоматически для каждого нового файла в папке SharePoint. Этот статус означает, что файл готов для импорта.
    - **Выполняется импорт** — назначается автоматически отчетом по электронной отчетности, когда файл будет заблокирован процессом импорта для предотвращения использования другими процессами (при одновременном запуске многие из них).
    - **Импортировано** — назначается автоматически отчетом по электронной отчетности после успешного завершения импорта файлов. Этот статус означает, что импортируемый файл был удален из конфигурированного источника файлов (папка SharePoint).
    - **Сбой** — назначается автоматически отчетом по электронной отчетности, когда импорт файла завершается с ошибками или исключениями.
    - **Заблокировано** — назначается вручную пользователем на этой странице. Этот статус означает, что файл не будут импортированы в данный момент. Этот статус используется для откладывания некоторых файлов импорта.

    [![Обновленная страница состояния файла электронной отчетности для выбранных источников](./media/GERImportFromSharePoint-09-FileStatesForm.png)](./media/GERImportFromSharePoint-09-FileStatesForm.png)

## <a name="import-data-from-sharepoint-files"></a>Импорт данных из файлов SharePoint
1. Откройте дерево конфигурации электронной отчетности, выберите **Модель платежей по форме 1099** и разверните список компонентов модели электронной отчетности.
2. Выберите имя сопоставления модели, чтобы открыть список сопоставлений модели конфигурации выбранной модели электронной отчетности.

    [![Страница конфигурации](./media/GERImportFromSharePoint-10-SelectModelMapping.PNG)](./media/GERImportFromSharePoint-10-SelectModelMapping.PNG)

3. Выберите **Выполнить** для выполнения сопоставления выбранной модели электронной отчетности. Так как источники файла для формата электронной отчетности были сконфигруированы, можно изменять настройку параметра **Источник файла**, если требуется. Если сохранить настройку этого параметра, файлы .xslx импортируются из конфигурируемых источников (в данном примере, папки SharePoint).

    В этом примере импортируется только один файл. Тем не менее если имеется множественные файлы, они будут выбраны для импорта в том порядке, в котором они были добавлены в папку SharePoint. Каждое выполнения формата электронной отчетности импортирует один выбранный файл.

    [![Импорт из SharePoint и выполнение сопоставления модели электронной отчетности](./media/GERImportFromSharePoint-11-RunModelMapping.PNG)](./media/GERImportFromSharePoint-11-RunModelMapping.PNG)

4. Сопоставление модели может запускаться [автоматически](#limitations) в пакетном режиме. В этом случае каждый раз, когда пакетное задание будет выполнять этот формат электронной отчетности, будет импортироваться один файл из конфигурированных источников файлов.

    Когда файл из папки SharePoint успешно импортирован, он удаляется из этой папки и перемещается в папку для успешно импортированных файлов или в папку для импортированных файлов с предупреждениями. В противном случае он перемещается в папку для файлов со сбоями или остается в этой папке, если папка для файлов со сбоями не настроена. 

5. Введите идентификатор ваучера, например **V-00001**, а затем выберите **OK**.

    [![Запустить сопоставление моделиэлектронной отчетности](./media/GERImportFromSharePoint-12-ModelMappingRunFinished.PNG)](./media/GERImportFromSharePoint-12-ModelMappingRunFinished.PNG)

6. На странице **Состояния файлов для источников** выберите **Обновить** для обновления страницы.

    [![Страница состояния файла электронной отчетности для выбранных источников](./media/GERImportFromSharePoint-13-FileStatesForm.PNG)](./media/GERImportFromSharePoint-13-FileStatesForm.PNG)

7. В разделе **Файлы** просмотрите список файлов. Раздел **Журналы источников для формата импорта** содержит журнал импорта файлов Excel. Так как этот файл был успешно завершен, он помечается как **Удалено** в папке SharePoint.
8. Проверьте папку SharePoint **Источник импорта файлов (основной)**. Файлы Excel, которые были успешно импортированы, были удалены из этой папки.
9. Перейдите в раздел **Расчеты с поставщиками** \> **Периодические задачи** \> **Налог по форме 1099** \> **Сопоставление поставщика для формы 1099**.
10. В полях **Дата начала** и **Дата окончания** введите соответствующие значения. Затем выберите **транзакции по форме 1099 вручную**.

    транзакции поставщика, которые были импортированы из файлов Excel на сайте SharePoint для ваучера **V-00001**, будут показаны на странице.

    [![Страница проводок поставщика по форме 1099](./media/GERImportFromSharePoint-14-ImportedTransactions.PNG)](./media/GERImportFromSharePoint-14-ImportedTransactions.PNG)

## <a name="prepare-an-excel-file-for-import"></a>Подготовить файл Excel к импорту
1. Открытие файла Excel, который использовался ранее. В строке 1 столбца 3 добавьте код поставщика, который не существует в приложении. Добавьте дополнительную дополнительную ложную информацию поставщика в строку.

    [![Образец файла Microsoft Excel для импорта из SharePoint](./media/GERImportFromSharePoint-15-Excel.PNG)](./media/GERImportFromSharePoint-15-Excel.PNG)

2. Отправьте обновленный файл Excel, содержащий транзакции поставщиков, в папку SharePoint **Источник импорта файлов (основной)**.
3. Откройте дерево конфигурации электронной отчетности, выберите **Модель платежей по форме 1099** и разверните список компонентов модели электронной отчетности.
4. Выберите имя сопоставления модели, чтобы обновить сопоставление модели таким образом, чтобы неверный код поставщика был оценен как ошибка во время импорта данных.
5. Выберите **Конструктор**.
6. На вкладке **Проверки** необходимо изменить действие после проверки для правила проверки, которое было настроено для оценки наличия счета поставщика, который был импортирован в приложении. Обновите значение поля **Действия после проверки** на **Остановить выполнение**, сохранить изменения и закрыть страницу.

    [![Страница конструктора сопоставления модели электронной отчетности](./media/GERImportFromSharePoint-16-UpdateModelMapping.PNG)](./media/GERImportFromSharePoint-16-UpdateModelMapping.PNG)

7. Сохраните изменения и закройте конструктор сопоставления модели электронной отчетности.
8. Выберите **Выполнить** для выполнения сопоставления модифицированной модели электронной отчетности.
9. Введите идентификатор ваучера, например **V-00002**, а затем выберите **OK**.

    В окне Infolog содержатся уведомления о том, что в папке SharePoint находится файл, который содержит неверный код поставщика и не может быть импортирован.

    [![Готовое сопоставление модели электронной отчетности](./media/GERImportFromSharePoint-17-ModelMappingRunFinished.PNG)](./media/GERImportFromSharePoint-17-ModelMappingRunFinished.PNG)

10. На странице **Состояния файла для источников** выберите **Обновить** и затем в разделе **Файлы** просмотрите список файлов.

    [![Страница состояния файла ER для выбранных источников](./media/GERImportFromSharePoint-18-FileStatesForm.PNG)](./media/GERImportFromSharePoint-18-FileStatesForm.PNG)

   Раздел **Журналы источников для формата импорта** указывает, что произошла ошибка при импорте и файл до сих пор находится в папке SharePoint для файлов с ошибками (флажок **Удален** не установлен). Если исправить этот файл на сайте SharePoint, добавив правильный код поставщика, затем переместить его в папку SharePoint источника импорта файлов (основного), можно импортировать этот файл еще раз.

11. Выберите **Расчеты с поставщиками** \> **Периодические задачи** \> **Налог по форме 1099** \> **Сопоставление записей поставщика по форме 1099**, введите соответствующие значения в поля **Дата начала** и **Дата окончания**, а затем выберите **транзакции пр форме 1099 вручную**.

    Доступны только транзакции для ваучера V-00001. Нет проводок для ваучера V-00002, несмотря на то, что была обнаружена ошибка в последней импортированной транзакции в файле Excel.

## <a name=""></a><a name="limitations">Ограничения</a>

Платформа электронной отчетности не предлагает возможности запуска нового пакетного задания, которое будет выполнять сопоставление модели в автоматическом режиме для импорта данных. Для этого необходимо разработать новую логику, чтобы настроенное сопоставление модели электронной отчетности можно было вызывать из пользовательского интерфейса приложения для импорта данных из входящих файлов. Поэтому требуются некоторые технологические работы. 

Для получения дополнительных сведений о соответствующем API электронной отчетности см. раздел [Код для выполнения сопоставления формата для импорта данных](er-apis-app73.md#code-to-run-a-format-mapping-for-data-import) в теме [Изменения в API платформы электронной отчетности для Application update 7.3](er-apis-app73.md).

Просмотрите код в классе `BankImport_RU` модели `Application Suite`, чтобы увидеть, как можно реализовать пользовательскую логику. Этот класс расширяет класс `RunBaseBatch`. В частности, проверьте метод `runER()`, в котором объект `ERIModelMappingDestinationRun` создается в качестве средства для выполнения сопоставления модели электронной отчетности.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Обзор электронной отчетности](general-electronic-reporting.md)

[Изменения в API платформы электронной отчетности для Application update 7.3](er-apis-app73.md)



[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
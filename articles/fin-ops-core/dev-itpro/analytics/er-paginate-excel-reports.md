---
title: Разработка формата электронной отчетности для разбивки на страницы документов, созданных в Excel
description: В этой статье объясняется, как разработать формат электронной отчетности (ER), который разбивает на страницы создаваемый документ в Microsoft Excel.
author: NickSelin
ms.date: 09/14/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: EROperationDesigner
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: 220314
ms.assetid: 2685df16-5ec8-4fd7-9495-c0f653e82567
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2021-08-01
ms.dyn365.ops.version: Version 10.0.22
ms.openlocfilehash: e8edc8bba62f74b4f81d423cf75b5fb87c01e43f
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2022
ms.locfileid: "8909288"
---
# <a name="design-an-er-format-to-paginate-generated-documents-in-excel"></a>Разработка формата электронной отчетности для разбивки на страницы документов, созданных в Excel

[!include [banner](../includes/banner.md)]

В этой статье поясняется, как пользователь с ролью "Системный администратор" или "Функциональный консультант по электронной отчетности" может настроить формат [электронной отчетности (ER)](general-electronic-reporting.md) для создания исходящих документов в Microsoft Excel и управления разбивкой документов на страницы.

В этом примере изменяется формат электронной отчетности, предоставленный корпорацией Майкрософт, который используется для печати контрольного отчета при [создании](../../../finance/localizations/tasks/eur-00002-eu-intrastat-declaration.md) декларации Интрастат. Этот отчет позволяет наблюдать отчеты по проводкам Интрастат. Изменения позволяют управлять разбивкой на страницы создаваемых контрольных отчетов.

Процедуры в этой статье могут быть выполнены в компании **DEMF**. Написание кода не требуется. Перед началом необходимо загрузить и сохранить следующие файлы.

| описание       | Имя файла |
|-------------------|-----------| 
| Шаблон отчета 1 | [ERIntrastatReportDemo1.xlsx](https://download.microsoft.com/download/7/2/a/72ae292a-8bb2-4b9d-8397-9764218f6fa8/ERIntrastatReportDemo1%20.xlsx) |
| Шаблон отчета 2 | [ERIntrastatReportDemo2.xlsx](https://download.microsoft.com/download/7/d/1/7d15858d-6260-4afa-9dda-d8b955e59b1a/ERIntrastatReportDemo2.xlsx) |

## <a name="configure-the-er-framework"></a>Настройка платформы электронной отчетности

Выполните шаги из раздела [Настройка платформы электронной отчетности](er-quick-start2-customize-report.md#ConfigureFramework), чтобы настроить минимальный набор параметров электронной отчетности. Необходимо завершить эту настройку до начала использования платформы электронной отчетности для разработки пользовательской версии стандартного формата электронной отчетности.

## <a name="import-the-standard-er-format-configuration"></a>Импорт стандартной конфигурации формата электронной отчетности

Следуйте шагам в разделе [Импорт стандартной конфигурации формата электронной отчетности](er-quick-start2-customize-report.md#ImportERSolution1), чтобы добавить стандартные конфигурации электронной отчетности в текущий экземпляр Dynamics 365 Finance. Импортируйте версию **1.9** конфигурации формата **отчета Интрастат**. Базовая версия 1 базовой конфигурации **модели Интрастат** автоматически импортируется из репозитория.

## <a name="customize-the-standard-er-format"></a>Настройка стандартного формата электронной отчетности

### <a name="create-the-custom-er-format"></a>Создание пользовательского формата электронной отчетности

В этом сценарии вы являетесь представителем компании Litware, Inc., которая в настоящее время выбрана в качестве активного поставщика конфигурации электронной отчетности. Необходимо создать новую конфигурацию формата электронной отчетности, используя конфигурацию **отчета Интрастат** в качестве базы.

1. Перейдите в раздел **Администрирование организации** \> **Электронная отчетность** \> **Конфигурации**.
2. На странице **Конфигурации** в дереве конфигураций на левой панели разверните **Модель Интрастат**, затем выберите **Отчет Интрастат**. Litware, Inc. будет использовать конфигурацию формата электронной отчетности версии 1.9 в качестве основы для пользовательской версии.
3. Выберите **Создать конфигурацию**, чтобы открыть раскрывающееся диалоговое окно. Вы можете использовать диалоговое окно, чтобы создать новую конфигурацию для пользовательского формата платежей.
4. В группе полей **Создать** выберите параметр **Производное от имени: отчет Интрастат, Microsoft**.
5. В поле **Имя** введите **Отчет Интрастат Litware**.
6. Выберите **Создать конфигурацию**, чтобы создать новый формат.

Создана версии 1.9.1 конфигурация формата электронной отчетности **Отчет Интрастат Litware**. Эта версия имеет [статус](general-electronic-reporting.md#component-versioning) **Черновик** и может редактироваться. Текущее содержимое пользовательского формата электронной отчетности соответствует содержимому формата, предоставленного корпорацией Майкрософт.

### <a name="make-the-custom-format-runnable"></a>Подготовка пользовательского формата к запуску

Теперь, когда была создана первая версия пользовательского формата и она имеет статус **Черновик**, формат можно запустить для целей тестирования. Для выполнения отчета обработайте платеж поставщику с помощью метода платежа, который ссылается на пользовательский формат электронной отчетности. По умолчанию при вызове формата электронной отчетности из приложения [учитываются](general-electronic-reporting.md#component-versioning) только те версии, которые имеют статус **Завершено** и **Общие**. Это позволяет предотвратить использование в форматах электронной отчетности незаконченных макетов. Однако для выполнения тестов можно заставить приложение использовать версию формата электронной отчетности, имеющую статус **Черновик**. Таким образом, можно откорректировать текущую версию формата, если требуется внести изменения. Дополнительные сведения см. в разделе [Применимость](electronic-reporting-destinations.md#applicability).

Чтобы использовать черновую версию формата электронной отчетности, необходимо явно пометить формат электронной отчетности.

1. Перейдите в раздел **Администрирование организации** \> **Электронная отчетность** \> **Конфигурации**.
2. На странице **Конфигурации** в области действий на вкладке **Конфигурации** в группе **Дополнительные параметры** выберите **Параметры пользователя**.
3. В диалоговом окне **Параметры пользователя** установите для параметра **Параметры выполнения** значение **Да**, затем выберите **ОК**.
4. При необходимости выберите **Правка**, чтобы сделать текущую страницу редактируемой.
5. В дереве конфигураций в левой области выберите **Отчет Интрастат Litware**.
6. Установите для параметра **Выполнить черновик** значение **Да**, затем выберите **Сохранить**.

    ![Параметр "Выполнить черновик" на странице конфигурации.](./media/er-paginate-excel-reports-derived-format-configuration.png)

## <a name="set-up-foreign-trade-parameters-to-use-the-custom-er-format"></a>Настройка параметров внешней торговли для использования настраиваемого формата электронной отчетности

Выполните следующие действия, чтобы настроить параметры внешней торговли, чтобы можно было использовать пользовательский формат.

1. Перейдите в раздел **Налог** \> **Настройка** \> **Внешняя торговля** \> **Параметры внешней торговли**.
2. На странице **Параметры внешней торговки** на экспресс-вкладке **Электронная отчетность** в поле **Сопоставление форматов файлов** выберите **Отчет Интрастат Litware**.
3. В поле **Сопоставление форматов отчетов** выберите **Отчет Интрастат Litware**.
4. Нажмите **Сохранить**.

## <a name="configure-the-custom-format-to-use-the-downloaded-report-template"></a>Настройка пользовательского формата для использования загруженного шаблона отчета

### <a name="review-the-first-downloaded-excel-template"></a>Проверка первого загруженного шаблона Excel

1. В классическом приложении Excel откройте файл шаблона **ERIntrastatReportDemo1.xlsx**, который был загружен ранее.
2. Убедитесь, что шаблон содержит именованные диапазоны, чтобы создать разделы заголовка отчета, данных отчета и нижнего колонтитула отчета в созданных документах.

    ![Скомпонуйте макет шаблона Excel 1 в классическом приложении.](./media/er-paginate-excel-reports-template1.gif)

### <a name="replace-the-current-excel-template-in-the-custom-er-format"></a><a id="replace-template"></a>Замена текущего шаблона Excel в пользовательском формате электронной отчетности

Необходимо добавить новый шаблон Excel к пользовательскому формату электронной отчетности.

1. Перейдите в раздел **Администрирование организации** \> **Электронная отчетность** \> **Конфигурации**.
2. На странице **Конфигурации** в дереве конфигураций на левой панели разверните **Модель Интрастат** \> **Отчет Интрастат** и выберите конфигурацию **Отчет Интрастат Litware**.
3. Выберите **Конструктор**.
4. На странице **Конструктор форматов** в области действий выберите **Показать сведения**.
5. Убедитесь, что выбран компонент корневого формата **Интрастат: Excel**, затем в области действий на вкладке **Импорт** в группе **Импорт** выберите **Обновить из Excel**.
6. В диалоговом окне **Обновление из Excel** выберите **Шаблон обновления**.
7. В диалоговом окне **Открыть** найдите и выберите файл **ERIntrastatReportDemo1.xlsx**, который загрузили ранее, затем выберите **Открыть**.
8. Нажмите **ОК**.
9. Нажмите **Сохранить**.

![Структура формата в конструкторе форматов электронной отчетности после добавления нового шаблона Excel.](./media/er-paginate-excel-reports-format1.png)

## <a name="change-the-data-binding-to-show-the-item-description-on-a-generated-report"></a>Изменение привязки данных для отображения описания номенклатуры в созданном отчете

1. На странице **Конструктор формата** выберите вкладку **Сопоставление**.
2. Разверните **Интрастат** \> **Строки отчета** и выберите компонент **Код товара**.
3. Выберите **Изменить формулу**.
4. Измените формулу привязки с `@.CommodityCode` на `CONCATENATE(@.CommodityCode, " ", @.ProductName)`.
5. Нажмите **Сохранить**.

![Настроенная привязка для отображения описания номенклатуры в конструкторе форматов электронной отчетности.](./media/er-paginate-excel-reports-format1a.png)

## <a name="generate-an-intrastat-declaration-control-report"></a><a id="generate-intrastat-control-report"></a>Создание контрольного отчета по декларации Интрастат

Сначала убедитесь, что у вас имеются проводки Интрастат для отчетности на странице **Интрастат**.

![Проводки на странице Интрастат.](./media/er-paginate-excel-reports-transactions1.gif)

Затем воспользуйтесь пользовательским форматом электронной отчетности для создания контрольного отчета декларации Интрастат.

1. Перейдите в раздел **Налог** \> **Декларации** \> **Внешняя торговля** \> **Интрастат**.
2. На странице **Интрастат** на панели операций выберите **Вывод** \> **Отчет**.
3. В диалоговом окне **Отчет Интрастат** выполните следующие действия, чтобы выполнить отчет:

    1. Задайте значения в полях **Начальная дата** и **Конечная дата**, чтобы включить в отчет конкретные проводки Интрастат.
    2. Для параметра **Создать файл** выберите значение **Нет**.
    3. Для параметра **Создать отчет** выберите значение **Да**.
    4. Нажмите **ОК**.

4. Загрузите и сохраните созданный документ.
5. Откройте документ в Excel и проверьте его.

    ![Созданный документ Excel в классическом приложении.](./media/er-paginate-excel-reports-document1.png)

## <a name="configure-the-custom-format-to-paginate-generated-documents"></a>Настройка пользовательского формата для разбиения созданных документов на страницы

### <a name="review-the-second-downloaded-excel-template"></a>Проверка второго загруженного шаблона Excel

1. В Excel откройте файл шаблона **ERIntrastatReportDemo2.xlsx**, который был загружен ранее.
2. Сравните этот шаблон с шаблоном **ERIntrastatReportDemo1.xlsx** и убедитесь, что он содержит несколько новых имен Excel для создания и заполнения специальных разделов страниц в созданных документах:

    - Диапазон **ReportPageHeader** добавляется для создания заголовков страниц.
    - Диапазон **ReportPageFooter** добавляется для создания нижних колонтитулов страниц.
    - Ячейка **ReportPageFooter\_PageLines** настраивается для отображения количества проводок на странице.
    - Ячейка **ReportPageFooter\_PageAmount** настраивается для отображения общей суммы проводок на странице.
    - Ячейка **ReportPageFooter\_PageWeight** настраивается для отображения общей массы для проводок на странице.
    - Ячейка **ReportPageFooter\_RunningCounterLines** настроена для отображения нарастающего счетчика проводок с начала отчета по текущую страницу.
    - Ячейка **ReportPageFooter\_RunningTotalAmount** настроена для отображения нарастающей общей суммы всех проводок с начала отчета по текущую страницу.
    - Ячейка **ReportPageFooter\_RunningTotalWeight** настроена для отображения нарастающей общей массы всех проводок с начала отчета по текущую страницу.

    ![Скомпонуйте макет шаблона Excel 2 в классическом приложении.](./media/er-paginate-excel-reports-template2a.gif)

    Ячейка **CommodityCode** этого шаблона настроена для переноса текста ячейки. Так как строка сведений о транзакциях настроена таким образом, что она автоматически соответствует высоте строки, высота всей строки должна автоматически изменяться при переносе текста в ячейке **CommodityCode**.

    ![Для ячейки CommodityCode настроен перенос текста ячейки.](./media/er-paginate-excel-reports-template2b.gif)

### <a name="repeat-the-replacement-of-the-current-excel-template-in-the-custom-er-format"></a>Повторение замены текущего шаблона Excel в пользовательском формате электронной отчетности

1. Выполните шаги, указанные в разделе [Замена текущего шаблона Excel в пользовательском формате электронной отчетности](#replace-template) данной статьи. Однако на шаге 7 выберите файл **ERIntrastatReportDemo2.xlsx**.
2. На странице **Конструктор форматов** разверните **Интрастат**.
3. Назовите элементы формата [Диапазон](er-fillable-excel.md#range-component), которые были добавлены в редактируемый формат электронной отчетности для синхронизации структуры со структурой примененного шаблона Excel:

    1. Выберите компонент **Диапазон**, связанный с названием Excel **ReportPageHeader**.
    2. На вкладке **Формат** в поле **Имя** введите **Заголовок страницы отчета**.
    3. Выберите компонент **Диапазон**, связанный с названием Excel **ReportPageFooter**.
    4. На вкладке **Формат** в поле **Имя** введите **Нижний колонтитул страницы отчета**.

4. Нажмите **Сохранить**.

![Структура формата в конструкторе форматов электронной отчетности после замены шаблона Excel.](./media/er-paginate-excel-reports-format2.png)

### <a name="change-the-format-structure-to-implement-document-pagination"></a>Изменение структуры формата для реализации разбивки документов на страницы

1. На странице **Конструктор форматов** в дереве форматов в левой области выберите корневой компонент **Интрастат**.
2. Выберите **Добавить**.
3. В диалоговом окне **Добавление** выберите компонент [Страница](er-fillable-excel.md#page-component) в группе **Excel** компонентов.
4. В диалоговом окне **Свойства компонента** в поле **Имя** введите **Страница отчета**. Затем выберите **OK**.
5. Чтобы использовать компонент **Заголовок страницы отчета** в качестве заголовка страницы на каждой создаваемой странице, выполните следующие действия:

    1. Выберите компонент **Заголовок страницы отчета**, затем выберите **Вырезать**.
    2. Выберите компонент **Страница отчета**, затем выберите **Вставить**.
    3. Разверните элемент **Страница отчета**.
    4. Чтобы заставить компонент **Страница** [считать](er-fillable-excel.md#page-component-structure) этот диапазон верхним колонтитулом страницы, выберите **Заголовок страницы отчета**, затем на вкладке **Формат** в поле **Направление репликации** выберите значение **Нет репликации**.

6. Чтобы разбить созданный документ на страницы так, чтобы учитывалось содержимое строк отчета, выполните следующие действия:

    1. Выберите компонент **Строки отчета**, затем выберите **Вырезать**.
    2. Выберите компонент **Страница отчета**, затем выберите **Вставить**.

7. Чтобы включить нижний колонтитул отчета после строк отчета, но до окончательного нижнего колонтитула, выполните следующие действия:

    1. Выберите компонент **Нижний колонтитул отчета**, затем выберите **Вырезать**.
    2. Выберите компонент **Страница отчета**, затем выберите **Вставить**.

8. Чтобы использовать компонент **Нижний колонтитул страницы отчета** в качестве нижнего колонтитула страницы на каждой создаваемой странице, выполните следующие действия:

    1. Выберите компонент **Нижний колонтитул страницы отчета**, затем выберите **Вырезать**.
    2. Выберите компонент **Страница отчета**, затем выберите **Вставить**.
    3. Чтобы заставить компонент **Страница** [считать](er-fillable-excel.md#page-component-structure) этот диапазон нижним колонтитулом страницы, выберите **Нижний колонтитул страницы отчета**, затем на вкладке **Формат** в поле **Направление репликации** выберите значение **Нет репликации**.

![Структура формата в конструкторе форматов электронной отчетности после реализации разбивки документа на страницы.](./media/er-paginate-excel-reports-format3.png)

### <a name="add-data-sources-to-calculate-page-footer-totals"></a>Добавление источников данных для расчета итоговых значений нижних колонтитулов страницы

Необходимо настроить новые источники данных для расчета итоговых значений по странице, нарастающего счетчика и нарастающих итоговых значений, а также отобразить их в разделе нижнего колонтитула страницы. Для этой цели рекомендуется использовать источники данных [Сбор данных](er-data-collection-data-sources.md).

1. На странице **Конструктор формата** выберите вкладку **Сопоставление**.
2. Выберите **Добавить корень**, затем выполните следующие действия:

    1. В диалоговом окне **Добавление источника данных** в разделе **Общие** выберите **Пустой контейнер**.
    2. В диалоговом окне **Свойства источника данных "Пустой контейнер"** в поле **Имя** введите **Итого**.
    3. Нажмите **ОК**.

3. Выберите источник данных **Итого**, выберите **Добавить**, затем выполните следующие действия:

    1. В диалоговом окне **Добавление источника данных** в разделе **Общие** выберите **Пустой контейнер**.
    2. В диалоговом окне **Свойства источника данных "Пустой контейнер"** в поле **Имя** введите **Страница**.
    3. Нажмите **ОК**.

4. Снова выберите **Добавить**, а затем выполните следующие действия:

    1. В диалоговом окне **Добавление источника данных** в разделе **Общие** выберите **Пустой контейнер**.
    2. В диалоговом окне **Свойства источника данных "Пустой контейнер"** в поле **Имя** введите **Нарастающий**.
    3. Нажмите **ОК**.

5. Выберите источник данных **Total.Page**, выберите **Добавить**, затем выполните следующие действия:

    1. В диалоговом окне **Добавление источника данных** в разделе **Функции** выберите **Сбор данных**.
    2. В диалоговом окне **Свойства источника данных "Сбор данных"** в поле **Имя** введите **Сумма**.
    3. В поле **Тип элемента** выберите **Вещественный**.
    4. Установите для параметра **Собрать все значения** значение **Да**.
    5. Нажмите **ОК**.

6. Снова выберите **Добавить**, а затем выполните следующие действия:

    1. В диалоговом окне **Добавление источника данных** в разделе **Функции** выберите **Сбор данных**.
    2. В диалоговом окне **Свойства источника данных "Сбор данных"** в поле **Имя** введите **Масса**.
    3. В поле **Тип элемента** выберите **Вещественный**.
    4. Установите для параметра **Собрать все значения** значение **Да**.
    5. Нажмите **ОК**.

7. Выберите источник данных **Total.Running**, выберите **Добавить**, затем выполните следующие действия:

    1. В диалоговом окне **Добавление источника данных** в разделе **Функции** выберите **Сбор данных**.
    2. В диалоговом окне **Свойства источника данных "Сбор данных"** в поле **Имя** введите **Сумма**.
    3. В поле **Тип элемента** выберите **Вещественный**.
    4. Установите для поля **Собрать все значения** значение **Да**.
    5. Нажмите **ОК**.

8. Снова выберите **Добавить**, а затем выполните следующие действия:

    1. В диалоговом окне **Добавление источника данных** в разделе **Функции** выберите **Сбор данных**.
    2. В диалоговом окне **Свойства источника данных "Сбор данных"** в поле **Имя** введите **Масса**.
    3. В поле **Тип элемента** выберите **Вещественный**.
    4. Установите для поля **Собрать все значения** значение **Да**.
    5. Нажмите **ОК**.

9. Снова выберите **Добавить**, а затем выполните следующие действия:

    1. В диалоговом окне **Добавление источника данных** в разделе **Функции** выберите **Сбор данных**.
    2. В диалоговом окне **Свойства источника данных "Сбор данных"** в поле **Имя** введите **Строки**.
    3. В поле **Тип элемента** выберите **Целочисленный**.
    4. Установите для поля **Собрать все значения** значение **Да**.
    5. Нажмите **ОК**.

10. Нажмите **Сохранить**.

### <a name="add-data-sources-to-control-page-footer-visibility"></a>Добавление источников данных для управления видимостью нижних колонтитулов страниц

Если требуется управлять видимостью нижних колонтитулов, и вы не планируете включать нижний колонтитул на последней странице, если она содержит проводки, настройте новый источник данных для расчета необходимого нарастающего счетчика.

1. На странице **Конструктор формата** выберите вкладку **Сопоставление**.
2. Выберите источник данных **Total.Running**, выберите **Добавить**.
3. В диалоговом окне **Добавление источника данных** в разделе **Функции** выберите **Сбор данных**.
4. В диалоговом окне **Свойства источника данных "Сбор данных"** в поле **Имя** введите **Строки2**.
5. В поле **Тип элемента** выберите **Целочисленный**.
6. Установите для параметра **Собрать все значения** значение **Да**.
7. Нажмите **ОК**.
8. Нажмите **Сохранить**.

![Добавлены источники данных в конструкторе формата электронной отчетности.](./media/er-paginate-excel-reports-format4.png)

### <a name="configure-bindings-to-collect-total-values"></a>Настройка привязок для сбора итоговых значений

1. На странице **Конструктор формата** в дереве формата разверните компонент **Строки отчета** и выберите вложенный компонент **Сумма по накладной**.
2. Выберите **Изменить формулу**.
3. Измените формулу привязки с `NUMBERVALUE(NUMBERFORMAT(@.InvoiceValue, "F"&TEXT(model.Parameters.IntrastatAmountDecimals)), ".", "")` на `Total.Page.Amount.Collect(NUMBERVALUE(NUMBERFORMAT(@.InvoiceValue, "F"&TEXT(model.Parameters.IntrastatAmountDecimals)), ".", ""))`.

    > [!NOTE]
    > В дополнение к помещению значения суммы в ячейку Excel для каждой итерации по проводке, эта привязка собирает значение в источнике данных **Total.Page.Amount** коллекции данных.

4. Выберите вложенный компонент **Масса**.
5. Выберите **Изменить формулу**.
6. Измените формулу привязки с `@.'$RoundedWeight'` на `Total.Page.Weight.Collect(@.'$RoundedWeight')`.

    > [!NOTE]
    > В дополнение к помещению значения массы в ячейку Excel для каждой итерации по проводке, эта привязка собирает значение в источнике данных **Total.Page.Weight**.

![Настроенные привязки для сбора итоговых значений в конструкторе формата электронной отчетности.](./media/er-paginate-excel-reports-format5.png)

### <a name="configure-bindings-to-fill-in-page-footer-totals"></a>Настройка привязок для заполнения итоговых значений в нижних колонтитулах страницы

1. На странице **Конструктор формата** в дереве формата разверните компонент **Нижний колонтитул страницы отчета** выберите вложенный компонент **Диапазон**, который ссылается на ячейку Excel **ReportPageFooter\_PageAmount**, затем выполните следующие действия:

    1. В дереве источников данных в правой области выберите пункт **Total.Page.Amount.Sum()**.
    2. Выберите **Связать**.
    3. Выберите **Изменить формулу**.
    4. Обновите формулу на `Total.Page.Amount.Sum(false)`.

    > [!NOTE]
    > Необходимо указать для аргумента этой функции значение **False**, чтобы сохранить собранные данные для текущей страницы, так как эти данные необходимы для расчета нарастающего итога, общего количества строк на странице и нарастающего счетчика строк.

2. В дереве формата выберите вложенный компонент **Диапазон**, ссылающийся на ячейку Excel **ReportPageFooter\_PageWeight**, затем выполните следующие действия:

    1. В дереве источников данных в правой области выберите пункт **Total.Page.Weight.Sum()**.
    2. Выберите **Связать**.
    3. Выберите **Изменить формулу**.
    4. Обновите формулу на `Total.Page.Weight.Sum(false)`.

### <a name="configure-bindings-to-fill-in-page-running-totals"></a>Настройка привязок для заполнения нарастающих итоговых значений на странице

1. На странице **Конструктор формата** в дереве формата разверните компонент **Нижний колонтитул страницы отчета** выберите вложенный компонент **Диапазон**, который ссылается на ячейку Excel **ReportPageFooter\_RunningTotalAmount**, затем выполните следующие действия:

    1. В дереве источников данных в правой области выберите пункт **Total.Running.Amount.Collect()**.
    2. Выберите **Связать**.
    3. Выберите **Изменить формулу**.
    4. Обновите формулу на `Total.Running.Amount.Sum(false)+Total.Running.Amount.Collect(Total.Page.Amount.Sum(true))`.

    > [!NOTE]
    > Операнд `Total.Running.Amount.Sum(false)` возвращает ранее собранную сумму нарастающего итога. Операнд `Total.Running.Amount.Collect(Total.Page.Amount.Sum(true))` возвращает общую сумму текущей страницы. Необходимо указать аргумент вложенной функции второго операнда как **True**, чтобы сбросить коллекцию данных `Total.Page.Amount` сразу после помещения этого значения в коллекцию нарастающего итога `Total.Running.Amount`. Указанный аргумент должен начинаться со значения 0 (нуля) для сбора итога следующей страницы.
    >
    > Функция `Total.Running.Amount.Sum(false)` вызывается для ввода суммы нарастающего итога в ячейку Excel **ReportPageFooter\_RunningTotalAmount** на текущей странице.

2. В дереве формата выберите вложенный компонент **Диапазон**, ссылающийся на ячейку Excel **ReportPageFooter\_RunningTotalWeight**, затем выполните следующие действия:

    1. В дереве источников данных в правой области выберите пункт **Total.Running.Weight.Collect()**.
    2. Выберите **Связать**.
    3. Выберите **Изменить формулу**.
    4. Обновите формулу на `Total.Running.Weight.Sum(false)+Total.Running.Weight.Collect(Total.Page.Weight.Sum(true))`.

### <a name="configure-bindings-to-fill-in-the-page-running-counter"></a>Настройка привязок для заполнения нарастающего счетчика на странице

1. На странице **Конструктор формата** в дереве формата разверните компонент **Нижний колонтитул страницы отчета** выберите вложенный компонент **Диапазон**, который ссылается на ячейку Excel **ReportPageFooter\_RunningCounterLines**.
2. Выберите **Изменить формулу**.
3. Добавьте формулу `Total.Running.Lines.Collect(COUNT(Total.Page.Amount.Result))`.

    > [!NOTE]
    > Эта формула возвращает число собранных значений сумм для всего отчета. Это число равно числу проводок, которые были итерированы на текущий момент времени. В то же время формула собирает возвращаемое значение в коллекции **Total.Running.Lines**.

### <a name="configure-bindings-to-fill-in-the-page-footer-counter"></a>Настройка привязок для заполнения счетчика нижнего колонтитула на странице

1. На странице **Конструктор формата** в дереве формата разверните компонент **Нижний колонтитул страницы отчета** выберите вложенный компонент **Диапазон**, который ссылается на ячейку Excel **ReportPageFooter\_PageLines**.
2. Выберите **Изменить формулу**.
3. Добавьте формулу `COUNT(Total.Page.Amount.Result)-Total.Running.Lines.Sum(false)`.

    > [!NOTE]
    > Эта формула вычисляет количество проводок на текущей странице как разницу между числом проводок, собранных в **Total.Page.Amount.Result** для всего отчета и числом проводок, сохраненных на этом этапе в **Total.Running.Lines.Sum**. Так как количество проводок для текущей страницы хранится в **Total.Running.Lines** в привязке компонента **Диапазон**, который ссылается на ячейку Excel **ReportPageFooter\_RunningCounterLines**, число проводок на текущей странице еще не включено. Таким образом, это различие равно количеству проводок на текущей странице.

![Настроенные привязки для заполнения счетчика нижнего колонтитула на странице в конструкторе формата электронной отчетности.](./media/er-paginate-excel-reports-format6.png)

### <a name="configure-component-visibility"></a>Настройка видимости компонентов

Можно изменить видимость верхних и нижних колонтитулов страницы на определенной странице созданного документа, чтобы скрыть следующие элементы:

- Заголовок страницы на первой странице, так как заголовок отчета уже содержит заголовки столбцов
- Верхний колонтитул на любой странице, не имеющий проводок, что может произойти для последней страницы
- Нижний колонтитул на любой странице, не имеющий проводок, что может произойти для последней страницы

Чтобы изменить видимость, обновите свойство **Включено** для компонентов **Заголовок страницы отчета** и **Нижний колонтитул страницы отчета**.

1. На странице **Конструктор формата** в дереве формата разверните компонент **Страница отчета** и выберите вложенный компонент **Заголовок страницы отчета**, затем выполните следующие действия:

    1. Выберите **Изменить** для поля **Включено**.
    2. На странице **Конструктор формул** в поле **Формула** введите следующее выражение:

        `AND(`<br>
        `COUNT(Total.Page.Amount.Result)<>0,`<br>
        `COUNT(Total.Page.Amount.Result)<>COUNT(model.CommodityRecord)`<br>
        `)`

2. В дереве формата выберите вложенный компонент **Нижний колонтитул страницы отчета**, затем выполните следующие действия:

    1. Выберите **Изменить** для поля **Включено**.
    2. На странице **Конструктор формул** в поле **Формула** введите следующее выражение:

        `(`<br>
        `COUNT(Total.Page.Amount.Result)-Total.Running.Lines2.Sum(false)+`<br>
        `0*Total.Running.Lines2.Collect(COUNT(Total.Page.Amount.Result))`<br>
        `)<>0`

    > [!NOTE]
    > Конструкция `COUNT(Total.Page.Amount.Result)-Total.Running.Lines2.Sum(false)` используется для расчета количества проводок на текущей странице. Конструкция `0*Total.Running.Lines2.Collect(COUNT(Total.Page.Amount.Result)` используется для добавления числа проводок на текущей странице в коллекцию, чтобы правильно управлять видимостью нижнего колонтитула следующей страницы.
    >
    > Здесь нельзя повторно использовать коллекцию `Total.Running.Lines`, так как свойство **Включено** базового компонента обрабатывается **после** обработки привязок вложенных компонентов. Когда свойство **Включено** обрабатывается, коллекция `Total.Running.Lines` уже увеличена на число транзакций на текущей странице.

3. Нажмите **Сохранить**.

## <a name="generate-an-intrastat-declaration-control-report-updated"></a>Создание контрольного отчета по декларации Интрастат (обновлено)

1. Убедитесь, что у вас имеются 24 проводки на странице **Интрастат**. Повторите шаги в разделе [Создание контрольного отчета по декларации Интрастат](#generate-intrastat-control-report) данной статьи, чтобы создать и просмотреть контрольный отчет.

    Все проводки представлены на первой странице. Итоговые значения и счетчики страницы равны итоговым значениями и счетчикам отчета. Диапазон заголовка страницы скрыт на первой странице, так как заголовок отчета уже содержит заголовки столбцов. Верхние и нижние колонтитулы страницы скрыты на второй странице, так как эта страница не содержит проводок.

    ![Созданный документ Excel в классическом приложении.](./media/er-paginate-excel-reports-document2.gif)

2. Обновите две проводки на странице **Интрастат**, изменив код **Номер номенклатуры** с **D00006** на **L0010**. Обратите внимание, что название продукта для новой номенклатуры, **Стереофоническая пара активных динамиков**, длиннее, чем имя продукта исходной номенклатуры, **Стандартный динамик**. Эта ситуация приводит к переносу текста в соответствующей ячейке созданного документа. Разбивка документа на страницы и суммирование и подсчет по страницам должны быть теперь обновлены. Повторите шаги в разделе [Создание контрольного отчета по декларации Интрастат](#generate-intrastat-control-report), чтобы создать и просмотреть контрольный отчет.

    В настоящее время проводки представлены на двух страницах, а итоги и счетчики по страницам рассчитываются правильно. Диапазон заголовков страниц правильно скрыт на первой странице и отображается на второй странице. Нижний колонтитул отображается на обеих страницах, так как они содержат проводки.

    ![Обновленный созданный документ Excel в классическом приложении.](./media/er-paginate-excel-reports-document3.gif)

## <a name="frequently-asked-questions"></a>Вопросы и ответы

### <a name="is-there-any-way-to-recognize-when-the-final-page-is-processed-by-the-page-format-component"></a>Есть ли способ определить, когда конечная страница обрабатывается компонентом формата страниц?

Компонент **Страница** [не предоставляет](er-fillable-excel.md#page-component-limitations) сведений о номере обработанной страницы и общем количестве страниц в созданном документе. Тем не менее, [формулы](er-formula-language.md) электронной отчетности можно настроить так, чтобы они распознавали последнюю страницу. Рассмотрим пример:

- Рассчитайте общее число проводок, которые уже обработаны с помощью компонента **Страница отчета**. Этот расчет можно сделать с помощью формулы `COUNT(Total.Page.Amount.Result)`. 
- Рассчитайте общее число проводок, которые должны быть обработаны на основе привязки `model.CommodityRecord`, настроенной для компонента **Строки отчета**. Этот расчет можно сделать с помощью формулы `COUNT(model.CommodityRecord)`.
- Сравните два числа, чтобы определить последнюю страницу. Если оба значения равны, создана последняя страница.

> [!NOTE]
> Этот подход рекомендуется использовать только в том случае, если свойство **Включено** компонента **Строки отчета** не содержит формулы, которые могут вернуть значение [False](er-formula-supported-data-types-primitive.md#boolean) во время выполнения для некоторых итераций [записей](er-formula-supported-data-types-composite.md#record) в связанном [Списке записей](er-formula-supported-data-types-composite.md#record-list).

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Разработка конфигурации для создания документов в формате Excel](er-fillable-excel.md)
- [Использование источников данных СБОР ДАННЫХ в форматах электронной отчетности (ER)](er-data-collection-data-sources.md)

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]

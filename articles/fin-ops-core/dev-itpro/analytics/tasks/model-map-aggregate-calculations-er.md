---
title: Использование конфигураций сопоставления модели для агрегированных расчетов на уровне базы данных
description: В этой теме описывается, как разрабатывать новые конфигурации сопоставления модели электронной отчетности и использовать встроенных функций электронной отчетности для эффективного агрегирования расчетов.
author: NickSelin
manager: AnnBe
ms.date: 12/12/2017
ms.topic: business-process
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
audience: Application User
ms.reviewer: kfend
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-06-30
ms.dyn365.ops.version: Version 7.0.0
ms.openlocfilehash: 6a392697f6b91bc6555d0d72d09ecd7da32e1a3f
ms.sourcegitcommit: 5192cfaedfd861faea63d8954d7bcc500608a225
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2021
ms.locfileid: "5094273"
---
# <a name="use-model-mapping-configurations-for-aggregate-calculations-at-the-database-level"></a>Использование конфигураций сопоставления модели для агрегированных расчетов на уровне базы данных

[!include [banner](../../includes/banner.md)]

В этой процедуре предоставляются сведения о создании новой конфигурации сопоставления модели электронной отчетности (ER) и использовании встроенных функций ER для эффективного агрегирования расчетов. В этой процедуре вам предстоит создать конфигурацию для компании-образца Litware, Inc. 

Эта процедура предназначена для пользователей, которым назначена роль "Системный администратор" или "Разработчик электронной отчетности". Эти шаги можно выполнить с использованием любого набора данных.

 Для выполнения этих шагов сначала необходимо выполнить шаги процедуры "Электронная отчетность повышает эффективность агрегированных расчетов путем их выполнения на уровне базы данных (Часть 1. Подготовка конфигураций)".

1. Перейдите в раздел "Управление организацией" > "Электронная отчетность" > "Конфигурации".
2. В дереве разверните узел "Модель Интрастат".
3. В дереве выберите "Модель Интрастат\Сопоставление образца Интрастат".
4. Выберите Конструктор.
5. Выберите Конструктор.
6. В дереве выберите узел "Dynamics 365 for Operations\Записи таблиц".
7. Щелкните "Добавить корень".
    * Добавьте новый источник данных, представляющий записи, которые требуется сгруппировать.  
8. В поле "Имя" введите "Проводки".
    * Транзакции  
9. В поле "Таблица" введите "Интрастат".
    * Интрастат  
10. Нажмите кнопку "OК".
11. В дереве выберите "Функции\Группировка по".
    * Этот тип источника данных используется для ввода нового источника данных во время выполнения для группировки записей и вычисления требуемых агрегирований.  
12. Щелкните "Добавить корень".
13. В поле "Имя" введите TransactionsGroups.
    * TransactionsGroups  
14. Щелкните "Изменить группу по".
15. В дереве выберите "Проводки".
    * Выберите добавленный источник данных типа "Список записей", представляющий записи, которые требуется сгруппировать.  
16. Щелкните "Добавить поле в".
17. Щелкните "Элементы для группировки".
18. В дереве разверните узел "Проводки".
19. В дереве выберите "Проводки\Направление".
20. Щелкните "Добавить поле в".
21. Щелкните "Сгруппированные поля".
    * Выберите поле, чтобы указать уровень группировки. На основе этого выбора источник данных будет возвращать во время выполнения столько групп проводок, сколько имеется кодов направлений, которые будут отвечать условиям в таблице Интрастат.  
22. В дереве выберите "Проводки\Сумма накладной(сумма MST)".
    * Выберите поле для указания источника расчета агрегирования.  
23. Щелкните "Добавить поле в".
24. Щелкните "Поля агрегирования".
25. В списке пометьте выбранную строку.
26. В поле "Метод" выберите "Сумма".
    * Выберите тип агрегирования.  
27. В поле "Имя" введите SumOfAmountMST.
    * Укажите имя этого агрегирования в настроенном источнике данных.  
28. Нажмите кнопку Сохранить.
    * Обратите внимание, что поле "Место выполнения" указывает, что эта группировка будет выполняться во время выполнения в базе данных SQL.  
29. Закройте страницу.
30. Нажмите кнопку "OК".
31. В дереве разверните "Итоги".
32. В дереве разверните "Группы проводок".
33. В дереве разверните "Группы проводок\агрегировано".
34. В дереве выберите "Группы проводок\агрегировано\Сумма MST".
35. В дереве выберите "Итоги\Общая стоимость накладной(общая стоимость накладной) = IF(ISEMPTY(IntrastatTotals), 0.0, IntrastatTotals.aggregated.'$AmountMSTRounded')".
36. Щелкните "Связать".
    * На основании этого параметра этот источник данных будет рассчитывать суммарное значение поля AmountMST для каждой группы проводок. Этот расчет агрегирования будет доступен как элемент TransactionsGroups.aggregated.TotalAmount.  
37. В дереве разверните "Группы проводок".
38. В дереве выберите "Группы проводок".
39. Щелкните "Изменить".
40. Щелкните "Изменить группу по".
41. В дереве разверните узел "Проводки".
42. В дереве выберите "Проводки\Сумма накладной(сумма MST)".
43. Щелкните "Добавить поле в".
44. Щелкните "Поля агрегирования".
45. В списке пометьте выбранную строку.
46. В поле "Метод" выберите "Макс.".
47. В поле "Имя" введите MaxOfAmountMST.
48. Нажмите кнопку "Сохранить".
    * В настоящее время выполнение источников данных GROUPBY можно перевести на уровень базы данных SQL с некоторыми ограничениями. Перевод можно выполнять либо для источников данных типа "Список записей", либо источников данных, представленных как выражение с помощью функции FILTER. Это также можно сделать, только если настроено одно агрегирование для одного поля записей группировки.  
    * Обратите внимание, что несмотря на то что было настроено несколько агрегирований для поля AmountMST, поле "Место выполнения" по-прежнему указывает, что эта группировка будет выполняться во время выполнения в базе данных SQL. Это происходит потому, что только одно агрегирование привязано к элементу модели данных и будет использоваться во время выполнения для извлечения данных из этого источника данных.  
49. Закройте страницу.
50. Нажмите кнопку "OК".
51. В дереве разверните "Группы проводок".
52. В дереве разверните "Группы проводок\агрегировано".
53. В дереве выберите "Группы проводок\агрегировано\Макс. сумма MST".
54. В дереве выберите "Итоги\Итоговая статистическая стоимость(итоговая статистическая стоимость) = IF(ISEMPTY(IntrastatTotals), 0.0, IntrastatTotals.aggregated.'$StatisticalValueRounded')".
55. Щелкните "Связать".
56. В дереве разверните "Группы проводок".
57. В дереве выберите "Группы проводок".
58. Выберите Изменить.
59. Щелкните "Изменить группу по".
    * Обратите внимание, что поле "Место выполнения" указывает, что эта группировка будет выполняться во время выполнения в памяти, поскольку оба агрегирования одного и того же поля привязаны к элементам модели данных.   
60. В списке отметьте все строки или отмените отметку всех строк.
61. Нажмите кнопку Удалить.
62. Щелкните Да.
63. Нажмите кнопку Удалить.
64. Щелкните Да.
65. Щелкните "Добавить поле в".
66. Щелкните "Элементы для группировки".
67. В дереве разверните "Запись товара(Интрастат)".
68. Нажмите кнопку Сохранить.
    * Обратите внимание, что поле "Место выполнения" указывает, эта группировка будет выполняться во время выполнения в памяти, несмотря на то что не существуют определенные агрегирования и выбранный источник данных типа "Записи таблицы" ссылается на одну и ту же таблицу "Интрастат". Это происходит потому, что источник данных содержит некоторые вычисляемые поля, которые еще невозможно перевести на уровень базы данных SQL.  


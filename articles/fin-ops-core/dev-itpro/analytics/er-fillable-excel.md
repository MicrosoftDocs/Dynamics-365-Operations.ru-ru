---
title: Разработка конфигурации для создания документов в формате Excel
description: В этом разделе приводятся сведения о создании формата электронной отчетности (ER) для заполнения шаблона Excel, а затем создание исходящих документов в формате Excel.
author: NickSelin
manager: AnnBe
ms.date: 11/02/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
ms.search.form: EROperationDesigner, ERParameters
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: 220314
ms.assetid: 2685df16-5ec8-4fd7-9495-c0f653e82567
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2016-06-30
ms.dyn365.ops.version: Version 7.0.0
ms.openlocfilehash: d5733e40c67f9c97b04f126f7c3cfea9d4f8f5b5
ms.sourcegitcommit: 659375c4cc7f5524cbf91cf6160f6a410960ac16
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/05/2020
ms.locfileid: "4686546"
---
# <a name="design-a-configuration-for-generating-documents-in-excel-format"></a>Разработка конфигурации для создания документов в формате Excel

[!include[banner](../includes/banner.md)]

Можно разработать конфигурацию формата [электронной отчетности (ER)](general-electronic-reporting.md), имеющую [компонент формата](general-electronic-reporting.md#FormatComponentOutbound) ER, который можно настроить для создания исходящего документа в формате книги Microsoft Excel. Для этой цели необходимо использовать специальный компонент формата ER.

Для получения дополнительных сведений об этой возможности следуйте указаниям в разделе [Создание конфигурации для создания отчетов в формате OPENXML](tasks/er-design-reports-openxml-2016-11.md).

## <a name="add-a-new-er-format"></a>Добавление нового формата ER

При добавлении новой конфигурации формата ER для создания исходящего документа в формате книги Excel необходимо либо выбрать значение **Excel** для атрибута **типа формата** для формата, либо оставить атрибут **тип формата** пустым.

- При выборе **Excel** можно настроить формат для создания исходящего документа только в формате Excel.
- Если оставить этот атрибут пустым, можно настроить формат для создания исходящего документа в любом формате, поддерживаемом структурой ER.

Чтобы настроить компонент "формат ER" конфигурации, выберите **конструктор** на панели операций и откройте компонент формата ER для редактирования в конструкторе операций ER.

![Страница конфигураций](./media/er-excel-format-add-format.png)

## <a name="excel-file-component"></a>Компонент файла Excel

### <a name="manual-entry"></a>Ручной ввод

Для создания исходящего документа в формате Excel необходимо добавить компонент **файла\\Excel** в настроенный формат ER.

![Компонент Excel\файл](./media/er-excel-format-add-file-component.png)

Чтобы указать макет для исходящего документа, вложите в компонент **файл\\Excel** книгу Excel с расширением .xlsx в качестве шаблона для исходящих документов.

> [!NOTE]
> При присоединении шаблона вручную необходимо использовать [тип документа](https://docs.microsoft.com/dynamics365/fin-ops-core/fin-ops/organization-administration/configure-document-management#configure-document-types), который был настроен для этой цели в [параметрах ER](electronic-reporting-er-configure-parameters.md#parameters-to-manage-documents).

![Добавление вложения в компонент Excel\файл](./media/er-excel-format-add-file-component2.png)

Чтобы указать, как будет заполняться заданный шаблон при выполнении настроенного формата ER, необходимо добавить вложенные компоненты **Лист**, **Диапазон**, и **Ячейка** к компоненту **Excel\\файл**. Каждый вложенный компонент должен быть связан с именованной номенклатурой Excel.

### <a name="template-import"></a>Импорт шаблона

Можно выбрать **Импорт из Excel** на вкладке **Импорт** панели операций для импорта нового шаблона в пустой формат ER. В этом примере компонент **Excel\\файл** будет создан автоматически, и к нему будет присоединяться импортированный шаблон. Все необходимые компоненты ER также будут созданы автоматически на основе списка обнаруженных именованных номенклатур Excel.

![Выберите Импорт из Excel](./media/er-excel-format-import-template.png)

> [!NOTE]
> Если требуется создать необязательный элемент **Лист** в редактируемом формате ER, установите для параметра **Создать элемент формата листа Excel** значение **Да**.

## <a name="sheet-component"></a>Компонент листа

Компонент **Лист** указывает лист прилагаемой книги Excel, который должен быть заполнен. Имя листа в шаблоне Excel определяется в свойстве **Лист** этого компонента.

> [!NOTE]
> Этот компонент не является обязательным для книг Excel, содержащих один лист.

На вкладке **Сопоставление** в конструкторе операций ER можно настроить свойство **Включено** для компонента **листа**, чтобы указать, должен ли компонент быть помещен в созданный документ:

- Если выражение свойства **Включено** настроено так, что оно возвращает значение **истина** во время выполнения, или если какое-либо выражение не настроено, в созданный документ будет помещен соответствующий лист.
- Если выражение свойства **Включено** настроено на возврат значения **Ложь** во время выполнения, созданный документ не будет содержать лист.

![Пример компонента листа](./media/er-excel-format-sheet-component.png)

## <a name="range-component"></a>Компонент Диапазон

Компонент **диапазон** указывает диапазон Excel, который должен управляться этим компонентом ER. Имя диапазона определяется в свойстве **Диапазон Excel** этого компонента.

Свойство **Направление репликации** определяет, будет ли и каким образом повторяться диапазон в созданном документе:

- Если для свойства **Направление репликации** установлено значение **Без репликации** , соответствующий диапазон Excel не будет повторяться в созданном документе.
- Если для свойства **Направление репликации** установлено значение **Вертикально** , соответствующий диапазон Excel будет повторяться в созданном документе. Каждый реплицируемый диапазон помещается под исходным диапазоном шаблона Excel. Число повторов определяется числом записей в источнике данных типа **списка записей**, привязанного к этому компоненту ER.
- Если для свойства **Направление репликации** установлено значение **Горизонтально** , соответствующий диапазон Excel будет повторяться в созданном документе. Каждый реплицируемый диапазон помещается справа от исходным диапазоном шаблона Excel. Число повторов определяется числом записей в источнике данных типа **списка записей**, привязанного к этому компоненту ER.

Для получения дополнительных сведений о горизонтальной репликации выполните шаги разделе [Использование горизонтально разворачивающихся диапазонов для динамического добавления столбцов в отчеты Excel](tasks/er-horizontal-1.md).

Компонент **диапазон** может иметь другие вложенные компоненты ER, которые используются для ввода значений в соответствующие именованные диапазоны Excel.

- Если какой-либо компонент группы **Текст** используется для ввода значений, значение вводится в диапазон Excel в виде текстового значения.

    > [!NOTE]
    > Этот шаблон используется для форматирования введенных значений на основе языкового стандарта, определенного в приложении.

- Если для ввода значений используется компонент **ячейка** группы **Excel**, значение вводится в диапазон Excel как значение типа данных, которое определяется привязкой этого компонента **ячейка** (например, **Строка**, **Вещественный** или **Целочисленный**).

    > [!NOTE]
    > Этот шаблон используется для того, чтобы приложение Excel могло форматировать введенные значения на основе языкового стандарта локального компьютера, открывающего исходящий документ.

На вкладке **Сопоставление** в конструкторе операций ER можно настроить свойство **Включено** для компонента **Диапазон**, чтобы указать, должен ли компонент быть помещен в созданный документ:

- Если выражение свойства **Включено** настроено так, что оно возвращает значение **истина** во время выполнения, или если какое-либо выражение не настроено, в созданный документ будет помещен соответствующий диапазон.
- Если выражение свойства **Включено** настроено так, что оно возвращает значение **Ложь** во время выполнения, и если этот диапазон не представляет все строки или столбцы, в созданный документ не будет помещен соответствующий диапазон.
- Если выражение свойства **Включено** настроено так, что оно возвращает значение **Ложь** во время выполнения, и этот диапазон представляет все строки или столбцы, созданный документ будет содержать эти строки и столбцы в виде скрытых строк и столбцов.

## <a name="cell-component"></a>Компонент ячейка

Компонент **ячейка** используется для заполнения именованных ячеек, фигур и изображений Excel. Чтобы указать имя объекта Excel, которое должно быть заполнено компонентом ER **ячейка**, необходимо указать название этого объекта в свойстве **диапазон Excel** для компонента **ячейка**.

На вкладке **Сопоставление** в конструкторе операций ER можно настроить свойство **Включено** для компонента **Ячейка**, чтобы указать, должен ли объект быть помещен в созданный документ:

- Если выражение свойства **Включено** настроено так, что оно возвращает значение **истина** во время выполнения, или если какое-либо выражение не настроено, в созданный документ будет помещен соответствующий объект. Привязка этого компонента **ячейка** указывает значение, помещаемое в соответствующий объект.
- Если выражение свойства **Включено** настроено на возврат значения **Ложь** во время выполнения, соответствующий объект не будет помещен в созданном документе.

Когда компонент **ячейка** настраивается на ввод значения в ячейку, она может быть привязана к источнику данных, который возвращает значение примитивного типа данных (например, **Строка**, **Вещественный** или **Целочисленный**). В этом случае значение вводится в ячейку как значение того же типа данных.

Когда компонент **ячейка** настраивается на ввод значения в форму Excel, она может быть привязана к источнику данных, который возвращает значение примитивного типа данных (например, **Строка**, **Вещественный** или **Целочисленный**). В этом случае значение вводится в форму Excel как текст этой формы. Для значений типов данных, не являющихся **строками**, преобразование в текст выполняется автоматически.

> [!NOTE]
> Можно настроить компонент **ячейка** для заполнения формы только в тех случаях, когда поддерживается свойство текста формы.

Когда компонент **ячейка** настраивается на ввод значения в изображение Excel, она может быть привязана к источнику данных, который возвращает значение типа данных **Контейнер**, который представляет изображение в двоичном формате. В этом случае значение вводится в изображение Excel в виде изображения.

> [!NOTE]
> Все изображения и формы Excel перекрепляются по верхнему левому углу в конкретную ячейку или диапазон Excel. Если требуется копировать изображение или форму Excel, необходимо настроить ячейку или диапазон, для которых она была привязана, в качестве копируемой ячейки или диапазона.

Дополнительные сведения о внедрении изображений и форм см. в разделе [Внедрение изображений и фигур в документы, создаваемые с помощью электронной отчетности](electronic-reporting-embed-images-shapes.md).

## <a name="page-break-component"></a>Компонент Разрыв страницы

Компонент **Разрыв страниц** заставляет Excel начать новую страницу. Этот компонент не требуется, если необходимо использовать разбиение по страницам Excel по умолчанию, но его следует использовать, если требуется, чтобы Excel использовал формат ER для структурирования разбиения.

## <a name="edit-an-added-er-format"></a>Редактирование добавленного формата ER

### <a name="update-a-template"></a>Обновление шаблона

Можно выбрать **Обновление из Excel** на вкладке **Импорт** панели операций для импорта обновленного шаблона в редактируемый формат ER. В ходе этого процесса шаблон выбранного компонента **Excel\\Файл** будет заменен новым шаблоном. Содержимое редактируемого формата ER будет синхронизировано с содержимым обновленного шаблона ER.

- Новый компонент формата ER будет создан автоматически для каждого имени Excel, если компонент формата ER не найден в редактируемом формате.
- Если соответствующее имя Excel не найдено, все компоненты формата ER будут удалены из редактируемого формата ER.

> [!NOTE]
> Задайте для параметра **Создать элемент формата листа Excel** значение **Да**, если требуется создать необязательный элемент **Лист** в редактируемом формате ER.
>
> Если редактируемый формат ER первоначально содержал элементы **лист**, рекомендуется настроить для параметра **Создать элемент формата листа Excel** значение **Да**, если импортируется обновленный шаблон. В противном случае все вложенные элементы исходного элемента **лист** будут создаваться "с нуля". Таким образом, все привязки повторно созданных элементов формата будут потеряны в обновленном формате ER.

![Параметр "Создать элемент формата листа Excel" в диалоговом окне Обновление из Excel](./media/er-excel-format-update-template.png)

Чтобы получить дополнительные сведения об этой функции, выполните действия, описанные в разделе [Изменение форматов электронной отчетности путем повторного применения шаблонов Excel](modify-electronic-reporting-format-reapply-excel-template.md).

## <a name="validate-an-er-format"></a>Проверяет формат ER

При проверке формата ER, который может быть изменен, выполняется проверка согласованности, чтобы убедиться в том, что в используемом в данный момент шаблоне Excel присутствует имя Excel. Будет выведено уведомление о любых несоответствиях. Для некоторых несоответствий будет предложено автоматическое исправление вопросов.

![Сообщения об ошибка проверки](./media/er-excel-format-validate.png)

## <a name="control-the-calculation-of-excel-formulas"></a>Управление вычислением формул Excel

При создании исходящего документа в формате книги Microsoft Excel некоторые ячейки данного документа могут содержать формулы Excel. Когда функция **Включить использование библиотеки EPPlus в платформе электронной отчетности** включена, можно управлять моментом вычисления формул путем изменения значения [параметра](https://support.microsoft.com/office/change-formula-recalculation-iteration-or-precision-in-excel-73fc7dac-91cf-4d36-86e8-67124f6bcce4#ID0EAACAAA=Windows) **Параметры расчета** в используемом шаблоне Excel:

- Выберите **Автоматически**, чтобы пересчитать все зависимые формулы каждый раз, когда сформированный документ дополняется новыми диапазонами, ячейками и т. д.
    >[!NOTE]
    > Это может привести к снижению производительности для шаблонов Excel, которые содержат несколько связанных формул.
- Выберите **Вручную**, чтобы избежать пересчета формулы при создании документа.
    >[!NOTE]
    > Пересчет формул вручную выполняется принудительно при открытии созданного документа для предварительного просмотра с помощью Excel.
    > Не используйте этот параметр, если вы настраиваете место назначение электронной отчетности, которое предполагает использование созданного документа без предварительного просмотра в Excel (преобразование в PDF, электронная почта и т. д.), так как созданный документ может не содержать значений в ячейках, содержащих формулы.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Обзор электронной отчетности](general-electronic-reporting.md)

[Разработка конфигурации для создания отчетов в формате OPENXML](tasks\er-design-reports-openxml-2016-11.md)

[Изменение форматов электронной отчетности путем повторного применения шаблонов Excel](modify-electronic-reporting-format-reapply-excel-template.md)

[Использование горизонтально разворачивающихся диапазонов для динамического добавления столбцов в отчеты Excel](tasks/er-horizontal-1.md)

[Внедрение изображений и фигур в документы, создаваемые с помощью электронной отчетности](electronic-reporting-embed-images-shapes.md)

[Настройка электронной отчетности (ER) для загрузки данных в Power BI](general-electronic-reporting-report-configuration-get-data-powerbi.md)


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]
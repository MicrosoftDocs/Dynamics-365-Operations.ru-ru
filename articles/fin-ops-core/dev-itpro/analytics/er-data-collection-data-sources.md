---
title: Использование источников данных СБОР ДАННЫХ в форматах электронной отчетности
description: В этой статье объясняется, как использовать источники данных СБОР ДАННЫХ в форматах электронной отчетности (ER).
author: NickSelin
ms.date: 08/23/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: EROperationDesigner
audience: Application User, IT Pro
ms.reviewer: kfend
ms.custom: 58771
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2021-01-01
ms.dyn365.ops.version: AX 10.0.16
ms.openlocfilehash: 7591bed5d01ce2c2f434f0e7c81e441eda98483e
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2022
ms.locfileid: "8883856"
---
# <a name="use-data-collection-data-sources-in-electronic-reporting-formats"></a>Использование источников данных СБОР ДАННЫХ в форматах электронной отчетности

[!include [banner](../includes/banner.md)]

Можно использовать конструктор Operations структуры [Электронная отчетность (ER)](general-electronic-reporting.md), чтобы настроить компонент форматирования решения ER, используемого для создания исходящих документов в других форматах. Иерархическая структура сконфигурированного компонента форматирования состоит из элементов форматов. Эти элементы форматирования используются для заполнения созданных документов необходимой информацией во время выполнения. По умолчанию при выполнении формата ER элементы форматирования выполняются в том же порядке, в котором они представлены в иерархии форматов: один за одним, начиная с верхнего и до нижнего.

Когда ER выполняет элемент форматирования, содержащий привязку, выполняется формула этой привязки, и элемент формата добавляет значение в созданный документ. Например, привязка может передать значение поля модели данных элементу форматирования. Можно настроить источник данных СБОР ДАННЫХ для сбора значений полей модели данных во время выполнения, суммирования значений и заполнения созданного документа полученными значениями. Чтобы использовать такой подход, измените начальную привязку так, чтобы настроенный источник данных СБОР ДАННЫХ использовался для передачи значения поля модели данных в элемент формата. Передавая значения через источник данных СБОР ДАННЫХ, можно собрать необходимые сведения для дальнейшего использования.

При настройке источника данных СБОР ДАННЫХ укажите тип значения, который будет управляться в источнике данных. В настоящее время для сбора значений поддерживаются следующие [типы данных](er-formula-supported-data-types-primitive.md):

- Логический
- Дата
- DateTime
- GUID
- Int64
- Целое число
- Действующий
- Строка
- Время

Метод `Collect(Value)` источника данных СБОРА ДАННЫХ можно использовать для передачи значения в источник данных для коллекции. В этом методе аргумент `Value` является либо константой, либо действительным путем к полю источника данных соответствующего типа данных.

Чтобы получить доступ к списку собранных значений, используйте свойство `Result` источника данных СБОРА ДАННЫХ. Это свойство возвращает [список записей](er-formula-supported-data-types-composite.md#record-list). Записи списка записей содержат поле `Value`, которое можно использовать для доступа к собранным значениям.

По умолчанию источник данных СБОРА ДАННЫХ собирает только уникальные значения.

Чтобы собрать все значения, установите для поля **Собрать все значения** в выбранном источнике данных СБОРА ДАННЫХ значение **Да**. Когда для поля **Собрать все значения** установлено значение **Да**, параметризованное свойство `Sum(Flag)` становится доступным. Это свойство можно использовать для получения общей суммы всех текущих собранных значений. В этом свойстве аргумент `Flag` является [логическим](er-formula-supported-data-types-primitive.md#boolean) значением, используемым для указания, должно ли быть сброшено итоговое значение.

- Когда указано значение **false**, суммирование продолжается с ранее собранной суммы.
- Когда указано значение **true**, запускается новое суммирование.

В настоящее время для суммирования поддерживаются следующие типы данных:

- Int64
- Целое число
- Действующий

Чтобы получить дополнительные сведения об этой функции, выполните следующий пример.

## <a name="example-configure-an-er-format-to-do-counting-and-summing-by-using-a-data-collection-data-source"></a>Пример: настройка формата ER для подсчета и суммирования с использованием источника данных СБОРА ДАННЫХ

В этом примере показано, как пользователь в роли "системный администратор" или "функциональный консультант электронной отчетности" может настроить формат ER, который содержит источник данных СБОРА ДАННЫХ, используемый для расчета итоговых сумм и суммированных значений.

Процедуры в этом примере могут быть выполнены в компании USMF в Microsoft Dynamics 365 Finance.

### <a name="upload-and-use-the-provided-er-solution"></a>Отправка и использование предоставленного решения ER

1. [Импорт примера конфигураций электронной отчетности](er-defer-sequence-element.md#import-the-sample-er-configurations).
2. [Активация поставщика конфигураций](er-defer-sequence-element.md#activate-a-configurations-provider).
3. [Просмотр импортированного сопоставления модели](er-defer-sequence-element.md#review-the-imported-model-mapping).
4. [Просмотр импортированного формата](er-defer-sequence-element.md#review-the-imported-format).
5. [Запустите импортированный формат](er-defer-sequence-element.md#run-the-imported-format).

### <a name="run-the-format-of-the-provided-er-solution"></a>Выполнение формата предоставленного решения ER

1. На странице **Конструктор формата** выберите **Выполнить**.
2. В диалоговом окне **Параметры электронной отчетности** выберите **ОК**.
3. Загрузите и просмотрите файл, предлагаемый веб-браузером.

    ![Загруженный файл, содержащий результаты исходного выполнения формата](./media/er-data-collection-data-sources-01.png)

### <a name="modify-the-format-of-the-er-solution-to-calculate-the-running-tax-total"></a>Изменение формата решения ER для расчета текущих налоговых итогов

Если объем проводок значительно превышает объем в текущем примере, расчетное время суммирования может увеличиться и вызвать снижение производительности. Изменяя настройки формата, можно помочь предотвратить эти проблемы в производительности системы. Так как для их включения в создаваемый отчет необходимо получить доступ к налоговым значениям, эти сведения можно повторно использовать для суммирования значений налога.

1. На странице **Конструктор формата** на вкладке **Сопоставление** выберите **Добавить корень**.
2. В диалоговом окне **Добавление источника данных** выберите **Функции** \> **Коллекция данных**.
3. В диалоговом окне **Свойства источника данных "сбор данных"** выполните следующие действия:

    1. В поле **Имя** введите **CollectedTaxValues**.
    2. В поле **Тип элемента** выберите **Вещественный**.
    3. В поле **Собрать все значения** выберите значение **Да**.
    4. Нажмите **ОК**.

4. Выберите числовой элемент формата **Отчет\\Строки\\Запись\\TaxAmount**.

    > [!NOTE]
    > В настоящее время привязка `@.Value` сконфигурирована для этого элемента. Таким образом, созданный документ, если из поля `model.Data.List.Value` введены значения налога.

5. Выберите **Изменить формулу**.
6. На странице **Конструктор формул** выполните следующие действия:

    1. В поле **Формула** замените `@.Value` на `CollectedTaxValues.Collect(@.Value)`.
    2. Сохраните изменения и закройте страницу.

    > [!NOTE]
    > Новая привязка передаст в созданный документ те же налоговые значения. Однако эти значения будут также собраны в источнике данных **CollectedTaxValues**.

7. Выберите числовой элемент формата **Отчет\\Строки\\Запись\\RunningTotal**.
8. Выберите **Изменить формулу**.
9. На странице **Конструктор формул** выполните следующие действия:

    1. В поле **Формула** введите `CollectedTaxValues.Sum(false)`.
    2. Сохраните изменения и закройте страницу.

    > [!NOTE]
    > Новая привязка передаст в созданный документ общую сумму налоговых значений, которые уже были введены.

    ![Числовые элементы, имеющие обновленные привязки на странице конструктора форматов](./media/er-data-collection-data-sources-02.png)

10. Выберите **Сохранить**, затем выберите **Выполнить**.
11. В диалоговом окне **Параметры электронной отчетности** выберите **ОК**.
12. Загрузите и просмотрите файл, предлагаемый веб-браузером.

    ![Загруженный файл, содержащий результаты измененного выполнения формата](./media/er-data-collection-data-sources-03.png)

### <a name="modify-the-format-to-evaluate-the-list-of-collected-tax-values"></a>Изменение формата для оценки списка собранных налоговых значений

1. На странице **Конструктор формата** на вкладке **Формат** выберите числовой элемент формата **Запись\\Строки\\Запись\\RunningTotal**, а затем выполните следующие действия:

    1. В поле **Числовой тип** измените значение с **вещественного** на **целое**.
    2. В поле **Числовой формат** измените значение с **F2** на **F0**.

3. На вкладке **Сопоставление** выберите **Изменить формулу**.
4. На странице **Конструктор формул** выполните следующие действия:

    1. В поле **Формула** введите `COUNT(CollectedTaxValues.Result)`.
    2. Сохраните изменения и закройте страницу.

    > [!NOTE]
    > Новая привязка будет передаваться в созданный документ, число записей в списке, в котором будут собираться налоговые значения.

5. Выберите **Сохранить**, затем выберите **Выполнить**.
6. В диалоговом окне **Параметры электронной отчетности** выберите **ОК**.
7. Загрузите и просмотрите файл, предлагаемый веб-браузером.

    ![Загруженный файл, содержащий результаты другого измененного выполнения формата](./media/er-data-collection-data-sources-04.png)

## <a name="frequently-asked-questions"></a>Вопросы и ответы

### <a name="if-i-have-to-calculate-running-totals-and-collect-data-what-is-the-difference-between-using-a-data-collection-data-source-and-using-the-built-in-data-collection-functions"></a>Если необходимо рассчитать итоговые значения и собрать данные, чем отличается использование источника данных СБОРА ДАННЫХ и использование встроенных функций СБОРА ДАННЫХ?

И источник данных СБОРА ДАННЫХ, и встроенные функции [СБОРА ДАННЫХ](er-functions-category-data-collection.md) могут использоваться для сбора, суммирования и подсчета данных на основе сведений, передаваемых в созданный исходящий документ. Однако при попытке определить, какой метод следует использовать, следует принять во внимание следующие моменты.

| Иcточник данных | Встроенные функции |
|-------------| ------------------ |
| Собираются только значения. | <p>Собираются именованные значения. Таким образом, итоговые значения для отдельных групп значений могут быть рассчитаны.</p><p>Кроме того, группы могут быть извлечены в виде списка.</p><p>Также можно собрать текстовые значения.</p> |
| Уникальные значения собираются автоматически. | Дополнительные параметры необходимы для извлечения списка уникальных значений из собранных значений. |
| Производительность зависит от объема собранных значений. | На практике производительность не зависит от объема собранных значений. |
| Этот прием применим для всех типов исходящих документов. | Этот метод применим только для текстовых и XML-документов. |

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Настройка формата для инвентаризации и суммирования](./tasks/er-format-counting-summing-1.md)
- [Отложенное выполнение элементов последовательности в форматах электронной отчетности](er-defer-sequence-element.md#Example)

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]

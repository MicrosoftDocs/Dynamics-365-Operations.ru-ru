---
title: Создание конфигураций ER для заполнения шаблонов PDF
description: В этом разделе приводятся сведения о разработке формата электронной отчетности (ER) для заполнения шаблона PDF.
author: NickSelin
manager: AnnBe
ms.date: 04/19/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.search.scope: Core, Operations
ms.custom: 220314
ms.assetid: 2685df16-5ec8-4fd7-9495-c0f653e82567
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: ''
ms.dyn365.ops.version: 10.0.1
ms.openlocfilehash: 96426ce54ec1b37c6751d990503d95960c2913df
ms.sourcegitcommit: fbc106af09bdadb860677f590464fb93223cbf65
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2019
ms.locfileid: "2771314"
---
# <a name="design-er-configurations-to-fill-in-pdf-templates"></a>Создание конфигураций ER для заполнения шаблонов PDF

[!include[banner](../includes/banner.md)]

Процедуры в этом разделе являются примерами, которые показывают, как пользователь в роли **Системный администратор** или **Разработчик электронной отчетности** может настроить формат электронной отчетности (ER), который создает отчеты как PDF-файлы путем использования заполняемых документов PDF в качестве шаблонов отчетов. Эти шаги могут быть выполнены в любой компании Dynamics 365 Finance или в службах Regulatory Configuration Service (RCS).

## <a name="prerequisites"></a>Необходимые условия

Прежде чем начать, необходимо иметь один из следующих типов доступа, в зависимости от службы, которую вы используете для выполнения процедур данного раздела:

- Доступ к Finance для одной из следующих ролей:

    - Разработчик электронной отчетности
    - Консультант по функциональным возможностям электронной отчетности
    - Системный администратор

- Доступ к службам RCS для одной из следующих ролей:

    - Разработчик электронной отчетности
    - Консультант по функциональным возможностям электронной отчетности
    - Системный администратор

Кроме того, необходимо выполнить процедуру [Создание поставщиков конфигурации и пометка их как активных](tasks/er-configuration-provider-mark-it-active-2016-11.md).

Наконец, необходимо загрузить следующие файлы из [CustomerSource](https://go.microsoft.com/fwlink/?linkid=874111):

| Описание содержания                       | Имя файла                                     |
|-------------------------------------------|-----------------------------------------------|
| Шаблон для первой страницы отчета | [IntrastatReportTemplate1.pdf](https://mbs.microsoft.com/Files/public/CS)                  |
| Шаблон для других страниц отчета    | [IntrastatReportTemplate2.pdf](https://mbs.microsoft.com/Files/public/CS/AX/IntrastatReportTemplate2.pdf)                  |
| Пример формата электронной отчетности — PDF                          | [Отчет Интрастат (PDF).версия.1.1.xml](https://mbs.microsoft.com/Files/public/CS/AX/IntrastatreportPDFversion11.xml)        |
| Пример формата электронной отчетности — Excel                          | [Интрастат (импорт из Excel).версия.1.1.xml](https://mbs.microsoft.com/Files/public/CS/AX/IntrastatimportfromExcelversion11.xml) |
| Демонстрационный набор данных                            | [Образец данных Интрастат.xlsx](https://mbs.microsoft.com/Files/public/CS/AX/Intrastatsampledata.xlsx)                    |

## <a name="design-the-format-configuration"></a>Создание конфигурации формата

### <a name="get-access-to-the-list-of-configurations-provided-by-microsoft"></a>Получение доступа к списку конфигураций, предоставленных компанией Microsoft

1. Перейдите в раздел **Управление организацией \> Рабочие области \> Электронная отчетность**.
2. Убедитесь, что поставщик **Litware, Inc.** доступен и помечен как активный.
3. На плитке поставщика **Microsoft** выберите **Репозитории**.

    > [!NOTE]
    > Если репозиторий типа **LCS** уже существует, пропустите остальные шаги этой процедуры.

4. Выберите **Добавить**.
5. В раскрывающемся диалоговом окне в группе полей **Тип репозитория конфигурации** выберите вариант **LCS**.
6. Выберите **Создать репозиторий**.
7. Нажмите **ОК**.

### <a name="get-the-model-configurations-provided-by-microsoft"></a>Получение модельных конфигураций, предоставленных компанией Microsoft

1. В левой части страницы **Репозиторий конфигураций** выберите кнопку **Показать фильтры** (символ воронки).
2. Добавьте фильтр для значения **LCS** в поле **Тип** и используйте оператор **начинается с**.
3. Выберите **Применить**.
4. Выберите **Открыть**.
5. В дереве выберите **Модель Интрастат**.
6. На экспресс-вкладке **Версии** выберите версию **1**.

    > [!NOTE]
    > Если кнопка **Импорт** на экспресс-вкладке **Версии** недоступна, пропустите оставшиеся шаги этой процедуры.

7. Выберите **Импорт**.
8. Выберите **Да**, чтобы подтвердить импорт выбранной версии конфигурации модели **Модель Интрастат**.

### <a name="create-a-new-format-configuration"></a>Создание новой конфигурации формата

1. В рабочей области **Электронная отчетность** выберите плитку **Конфигурации отчетности**.
2. В дереве выберите **Модель Интрастат**.
3. Выберите **Создать конфигурацию**.

    > [!NOTE]
    > Если кнопка **Создать конфигурацию** недоступна, необходимо включить режим конструктора на странице **Параметры электронной отчетности**, которую можно открыть из рабочей области **Электронная отчетность**.

4. В раскрывающемся диалоговом окне в группе полей **Создать** выберите вариант **Формат, основанный на модели данных Интрастат**.
5. В поле **Имя** введите **Отчет Интрастат (PDF)**.
6. В поле **Описание** введите **Отчет Интрастат в формате PDF**.

    > [!NOTE]
    > Активный поставщик конфигурации вводится автоматически. Этот поставщик сможет обновлять эту конфигурацию. Хотя другие поставщики могут использовать эту конфигурация, они не смогут ее обновлять.

7. Необязательно: в поле **Тип формата** можно выбрать конкретный формат электронного документа. Если выбрать **PDF**, во время разработки конструктор операций электронной отчетности предложит только элементы формата, которые применяется только к документам, созданным в формате PDF (**PDF\Файл**, **PDF\Слияние PDF** и т. д.). Если оставить это поле пустым, формат электронного документа будет указываться во время разработки в конструкторе операций электронной отчетности, когда будет добавлен первый элемент форматирования. Например, если добавить **Excel\Файл** в качестве первого элемента форматирования, конструктор операций электронной отчетности предложит только элементы формата, которые применимы только к документам, созданным в формате Excel (**Excel\Ячейка**, **Excel\Диапазон** и т. п.). формат.
8. Выберите **Создать конфигурацию**.

Создается новая конфигурации формата электронной отчетности. Можно использовать черновую версию этой конфигурации для хранения компонента формата электронной отчетности, предназначенного для создания электронных документов в формате PDF.

### <a name="design-the-format-of-an-electronic-document"></a>Разработка формата электронного документа

Затем в созданной конфигурации формата электронной отчетности следует разработать формат электронной отчетности, который создает отчет **Контрольный Интрастат** в формате PDF. На первой странице этого отчета должна быть показана сводка по отчету и сведения о проводках внешней торговли, по которым подается отчет. На других страницах должны отображаться только сведения о проводках внешней торговли, о которых подается отчет. Поскольку создаваемые страницы отчета должны иметь различную структуру, в формате электронной отчетности будут использоваться два разных шаблона в формате PDF.

В любом средстве просмотра PDF откройте загруженные шаблоны PDF. Обратите внимание, что каждый шаблон содержит несколько полей, которые должны быть заполнены. В каждом шаблоне сведения о проводках внешней торговли представляются как 42 строки, каждая из которых содержит девять полей. Номер строки отображается в конце имени каждого поля (например, **Дата 1**...**Дата 42** и **Товар 1**...**Товар 42**).

На следующем рисунке показан шаблон PDF для первой страницы отчета.

![Шаблон 1](media/rcs-ger-filloutpdf-template1.png)

На следующем рисунке показан шаблон PDF для других страниц отчета.

![Шаблон 2](media/rcs-ger-filloutpdf-template2.png)

1. На странице **Конфигурации** выберите **Конструктор**.
2. Выберите **Добавить корень**.
3. В раскрывающемся диалоговом окне в дереве выберите **PDF \> Слияние PDF**.

    При выборе элемента **Слияние PDF** в качестве корневого элемента формата все PDF-документы, созданные во время выполнения, будут объединены в один окончательный PDF-документ. Если требуется только один шаблон PDF для создания всех необходимых документов с помощью созданного формата электронной отчетности, можно выбрать **PDF-файл** в качестве корневого элемента.

4. В поле **Имя** введите **Вывод**.
5. В поле **Языковые предпочтения** выберите **Пользовательские предпочтения**. Отчет будет создан на предпочтительном языке пользователя, который его запустит.
6. В поле **Предпочтения языкового стандарта** выберите **Пользовательские предпочтения**. Значения и даты, представленные на страницах отчета, будут отформатированы на основе предпочтительного языкового стандарта пользователя, запускающего отчет.
7. Нажмите **ОК**.
8. На панели операций откройте вкладку **Импорт** и выберите **Импорт из PDF**.

    Когда заполняемый PDF-документ импортируется в качестве шаблона для этого формата электронной отчетности, все необходимые элементы формата электронной отчетности (элементы **PDF-файл**, **Группа полей** и **Поля**) автоматически создаются в создаваемом формате на основе структуры импортируемого PDF-документа.

9. Выберите **Обзор**. Найдите и выберите файл **IntrastatReportTemplate1.pdf**, загруженный ранее в качестве необходимого компонента.
10. Нажмите **ОК**.

    Выбранный файл загружается, и поле **Шаблон** в диалоговом окне **Импорт из PDF** заполняется.

11. Для параметра **Поля группы** выберите значение **Да**. Если выбранный PDF-документ содержит какие-либо группы полей, они будут использоваться для группировки созданных элементов формата электронной отчетности. Для этой цели будет создан элемент формата **Группа полей**.

    Если этот параметр имеет значение **Нет**, необходимые элементы формата электронной отчетности будут созданы как плоский список элементов, которые вложены в созданный элемент формата **PDF-файл**.

12. Нажмите **ОК**.

    ![Диалоговое окно "Импорт из PDF"](media/rcs-ger-filloutpdf-importtemplate.png)

13. В дереве разверните узел **Вывод**.

    Обратите внимание, что компонент **PDF-файл** был автоматически создан для управления созданием первой страницы отчета, создаваемого во время выполнения.

14. В дереве разверните узел **Вывод \> PDF-файл**.

    Обратите внимание, что структурированный список элементов форматирования был автоматически создан в этом формате электронной отчетности на основе структуры ранее импортированного заполняемого PDF-документа.

15. В дереве разверните узел **Вывод \> PDF-файл**.
16. В поле **Имя** введите **Страница 1**.

    Этот элемент формата будет использоваться для создания первой страницы отчета **Контрольный Интрастат**. Эта страница отображает сводку отчета и подробные сведения о проводках по внешней торговле.

    Если оставить поле **Языковые предпочтения** пустым, настройка **Языковые предпочтения** родительского элемента **Слияние PDF** будет определять язык отчета, созданный с использованием этого элемента формата. Можно выбрать другое значение, чтобы переопределить настройку родительского элемента.

    Если оставить поле **Предпочтения языкового стандарта** пустым, настройка **Предпочтения языкового стандарта** родительского элемента **Слияние PDF** будет определять языковой стандарт, созданный с использованием этого элемента формата. Языковой стандарт определяет формат значений и дат на страницах отчета. Можно выбрать другое значение, чтобы переопределить настройку родительского элемента.

17. В области действий выберите вкладку **Импорт**. Обратите внимание, что кнопка **Обновить из PDF** стала доступна для выбранного элемента формата **PDF-файл**.

    С помощью этой кнопки можно импортировать обновленный шаблон PDF в отредактированный формат. При импорте обновленного шаблона PDF список элементов формата будет изменен соответствующим образом:

    - Для любых новых полей в обновленном шаблоне PDF новые элементы формата создаются в отредактированном формате электронной отчетности.
    - Если обновленный шаблон PDF больше не содержит полей, соответствующих каким-либо существующим элементам формата в измененном формате электронной отчетности, эти элементы формата удаляются из формата электронной отчетности.

18. На вкладке **Формат** выберите **Вложения**.

    Обратите внимание, что импортированный PDF-документ прикрепляется к измененному формату электронной отчетности.

    ![Предварительный просмотр PDF-вложения](media/rcs-ger-filloutpdf-attachedtemplate.png)

19. Продолжайте разрабатывать этот формат, выполнив импорт второго шаблона PDF, добавляя необходимые привязки к источникам данных и т. д.
20. Нажмите **Сохранить**.
21. Закройте страницу.
22. Выберите **Удалить**.
23. Выберите **Да**.

Чтобы узнать, как можно использовать новые элементы формата **Слияние PDF**, **PDF-файл**, **Группа полей** и **Поле** для создания документов в формате PDF, можно выполнить импорт и анализ образца формата электронной отчетности.

### <a name="import-the-format-configuration"></a>Импорт конфигурации формата

Затем импортируйте образец формата электронной отчетности, который был ранее загружен для создания отчета **Контрольный Интрастат** в формате PDF. На первой странице этого отчета должна быть показана сводка по отчету и сведения о проводках внешней торговли, по которым подается отчет. На других страницах должны отображаться только сведения о проводках внешней торговли, о которых подается отчет.

1. На странице **Конфигурации** выберите пункт **Обмен \> Загрузить из XML-файла**.
2. Выберите **Обзор**. Найдите и выберите файл **Отчет Интрастат (PDF).версия.1.1.xml**, загруженный ранее в качестве необходимого компонента.
3. Нажмите **ОК**.

## <a name="analyze-the-format-configuration"></a>Анализ конфигурации формата

### <a name="format-layout"></a>Макет формата

1. На странице **Конфигурации** в дереве выберите **Модель Интрастат \> Отчет Интрастат (PDF)**.
2. Выберите **Конструктор**.
3. Выберите **Показать сведения**.
4. В дереве разверните узел **Вывод: Слияние PDF**.

    Обратите внимание, что данный формат электронной отчетности содержит два элемента **PDF-файл**, каждый из которых использует отдельный шаблон PDF. Один шаблон используется для создания первой страницы отчета в формате PDF, а другой шаблон используется для создания других страниц.

5. Разверните в дереве узел **Вывод: Слияние PDF \> Страница 1: PDF-файл (IntrastatReportTemplate1)**.
6. Разверните в дереве узел **Вывод: Слияние PDF \> Страница N: PDF-файл (IntrastatReportTemplate2)**.

    Обратите внимание, что в связи с различием содержимого двух шаблонов PDF структура вложенных элементов формата для двух элементов **PDF-файл** также отличается.

### <a name="format-mapping"></a>Сопоставление формата

1. На странице **Конструктор формата** выберите вкладку **Сопоставление**.
2. В дереве разверните **Разбиение на страницы \> Страницы**.

    ![Страница конструктора формул, в которой развернуто дерево моделей](media/rcs-ger-filloutpdf-reviewformat.png)

    Заметьте следующие детали:

    - Элемент формата **Вывод \> Страница 1** типа **PDF-файл** не привязан ни к какому источнику данных, а выражение **Включен** этого элемента формата пусто. Таким образом, во время выполнения шаблон PDF **IntrastatReportTemplate1** будет заполнен только один раз при создании отдельного PDF-документа.
    - Элемент формата **Вывод \> Страница N** типа **PDF-файл** привязан к источнику данных **Paging.PageN** типа **Список записей**, а выражение **Включен** этого элемента формата пусто. Таким образом, во время выполнения шаблон PDF **IntrastatReportTemplate2** будет заполнен для каждой записи из привязанного списка записей при создании отдельного PDF-документа.
    - Так как элементы формата **Страница 1: PDF-файл** и **Страница N: PDF-файл** являются дочерними от элемента формата **Вывод: Слияние PDF**, все заполненные документы PDF будут объединены в один окончательный документ PDF.
    - Источники данных **Paging.Page1** и **Paging.PageN** настраиваются как фильтры записей из источника данных **Paging.Pages**. Этот источник данных настроен для разбиения всего набора проводок по внешней торговле на партии. Каждый пакет содержит до 42 записей. Для разделения проводок на пакеты используется следующее выражение электронной отчетности:

        SPLITLIST(Totals.CommodityRecord,42)

    - Источник данных **Paging.Pages** содержит элемент **Paging.Pages.Enumerated**, который возвращает сведения о каждой записи, включенной в пакет. Эти детали включают последовательность записей в текущем пакете (поле **Paging.Pages.Enumerated.Number**). Поле **Paging.Pages.Enumerated.Number** используется в выражении **Имя** элементов формата **Поля PDF** для динамического создания имени поля, которое основано на номере проводки в пакете. Созданное имя поля затем используется для заполнения соответствующего поля PDF в используемом шаблоне PDF.
    - Элемент формата **Вывод \> Страница N \> Сведения 2** типа **Группа PDF** привязан к источнику данных **Paging.PageN.Enumerated** (или **\@.Enumerated**, если используется режим просмотра **Относительный путь**) типа **Список записей**. Таким образом, во время выполнения вложенные элементы этой группы PDF будут заполнены для каждой записи из присоединенного списка записей. Таким образом, отдельные строки PDF создаются виртуально, когда для каждой N-ой из 42 записей из списка **Paging.PageN.Enumerated** следующие поля PDF заполнены: Дата N, Направление N, Товар N и т. д. Таким образом, в этом смысле поведение этого элемента формата **Группа полей** напоминает поведение элементов формата **XML \> Последовательность** и **Текст \> Последовательность**.

3. В дереве разверните **Вывод \> Страница N \> Details2**.
4. В дереве выберите **Вывод \> Страница N \> Details2 \> PageFooter**.

    Обратите внимание, что атрибут **Name** данного элемента формата определен как **PageFooter**. Также обратите внимание, что выражение **Имя** элемента формата пусто.

5. В дереве выберите **Вывод \> Страница N \> Details2 \> Корректировка 1**.

    Обратите внимание, что атрибут **Name** данного элемента формата определен как **Корректировка 1**. Также обратите внимание, что выражение **Имя** элемента формата определено как **Paging.FldName("Корректировка",\@.Number)**.

![Конструктор формата, в котором выбрано сопоставление](media/rcs-ger-filloutpdf-reviewformat2.png)

Обратите внимание, что элемент формата **Поле** используется для заполнения отдельного поля для заполняемого PDF-документа, определенного как шаблон родительского элемента формата **PDF-файл**. Привязка элемента формата **PDF-файла** или вложенных элементов, если она имеет вложенные элементы, указывает значение, введенное в соответствующие поля PDF. Для указания поля PDF, которое заполняется отдельным элементом формата, можно использовать другие свойства элемента формата **Поле**:

- На вкладке **Формат** — атрибут **Name** элемента формата
- На вкладке **Сопоставление** — выражение **Имя** элемента формата

Так как оба свойства являются необязательными для элемента формата **Поле**, применяются следующие правила для указания целевого поля PDF:

- Если атрибут **Name** пуст, а выражение **Имя** возвращает пустую строку во время выполнения, во время выполнения создается исключение, чтобы уведомить пользователя о том, что поле PDF не удается найти в шаблоне PDF, используемом для заполнения PDF-документа.
- Если атрибут **Name** определен, и выражение **Имя** пусто, поле PDF, имеющее то же имя, что и атрибут **Name** элемента формата, заполняется.
- Если атрибут **Name** определен, и выражение **Имя** настроено, поле PDF, имеющее то же имя, что и значение, возвращенное выражением **Имя** элемента формата, заполняется.

> [!NOTE]
> Флажок PDF может заполняться как выбранный следующими способами:
>
> - Когда соответствующий элемент формата **Поле** привязан к полю источника данных типа данных **Логический**, имеющему значение **True**.
> - Когда соответствующий элемент формата **Поле** содержит вложенный элемент формата **Строка**, который связан с полем источника данных, имеющим текстовое значение **1**, **True** или **Да**

## <a name="run-the-format-configuration"></a>Выполнение конфигурации формата

### <a name="import-the-format-configuration"></a>Импорт конфигурации формата

Далее следует загрузить образец формата электронной отчетности **Интрастат (импорт из Excel)**. Этот формат предназначен для разбора выбранной пользователем книги Microsoft Excel, моделирующей проводки внешней торговли.

1. На странице **Конфигурации** выберите пункт **Обмен \> Загрузить из XML-файла**.
2. Выберите **Обзор**. Найдите и выберите файл **Интрастат (импорт из Excel).версия.1.1.xml**, загруженный ранее в качестве необходимого компонента.
3. Нажмите **ОК**.
4. В дереве выберите **Модель Интрастат \> Интрастат (импорт из Excel)**.
5. Выберите **Правка**.
6. Установите для параметра **По умолчанию для сопоставления модели** значение **Да**.

    > [!NOTE]
    > Если ранее для параметра **По умолчанию для сопоставления модели** установлено значение **Да** для конфигурации **Модель Интрастат** или для другой конфигурации, которая является вложенной в конфигурацию **Модель Интрастат**, установите для этого параметра значение **Нет**.

    Если для параметра **По умолчанию для сопоставления модели** установлено значение **Да**, в качестве источника данных по умолчанию для конфигурации формата **Отчет Интрастат (PDF)** будет назначен импортированный формат электронной отчетности **Интрастат (импорт из Excel)**. Затем, когда выполняется конфигурация формата **Отчет Интрастат (PDF)**, содержимое рабочей книги Excel, проанализированное с помощью формата электронной отчетности **Интрастат (импорт из Excel)**, будет моделировать проводки по внешней торговле, которые должны быть включены в отчет. Следующая иллюстрация показывает пример книги Excel.

    ![Книга Excel, имеющая образцы данных](media/rcs-ger-filloutpdf-excelworkbook.png)

### <a name="run-the-format-configuration"></a>Выполнение конфигурации формата

1. На странице **Конфигурации** в дереве выберите **Модель Интрастат \> Отчет Интрастат (PDF)**.
2. Выберите **Выполнить**.
3. Выберите **Обзор**. Найдите и выберите файл **Пример данных Интрастат.xlsx**, загруженный ранее в качестве необходимого компонента.
4. Нажмите **ОК**.
5. В поле **Направление отчета** выберите **Оба**, чтобы заполнить все проводки из импортированной книги Excel в создаваемом отчете PDF.
6. Нажмите **ОК**.
7. Просмотрите созданный PDF-документ.

На следующем рисунке показан пример первой страницы создаваемого отчета.

![Первая страница созданного отчета](media/rcs-ger-filloutpdf-generatedreport.png)

На следующем рисунке показан пример другой страницы создаваемого отчета.

![Другая страница созданного отчета](media/rcs-ger-filloutpdf-generatedreport2.png)

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Электронная отчетность — Разработка конфигурации для создания отчетов в формате OPENXML (ноябрь 2016 г.)](tasks/er-design-reports-openxml-2016-11.md)
- [Разработка конфигураций электронной отчетности для создания отчетов в формате Word](tasks/er-design-configuration-word-2016-11.md)

---
title: Настройка параметров формата ER для юридического лица
description: В этом разделе объясняется, как настроить параметры формата электронной отчетности (ER) для юридического лица.
author: NickSelin
ms.date: 03/25/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ERSolutionTable, EROperationDesigner, ERLookupDesigner, ERComponentLookupStructureEditing
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2019-01-01
ms.dyn365.ops.version: Release 8.1.3
ms.openlocfilehash: f72ce72e9cbd268efc6ab09dbec7009794d69613
ms.sourcegitcommit: d715e44b92b84b1703f5915d15d403ccf17c6606
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2022
ms.locfileid: "8644509"
---
# <a name="set-up-the-parameters-of-an-er-format-per-legal-entity"></a>Настройка параметров формата ER для юридического лица

[!include[banner](../includes/banner.md)]

## <a name="prerequisites"></a>Необходимые условия

Для выполнения этих шагов необходимо сначала выполнить шаги в [Настройка форматов ER для использования параметров, указанных для юридического лица](er-app-specific-parameters-configure-format.md).

Чтобы выполнить примеры в этом разделе, необходимо иметь доступ к Microsoft Dynamics 365 Finance для одной из следующих ролей:

- Разработчик электронной отчетности
- Консультант по функциональным возможностям электронной отчетности
- Системный администратор

## <a name="import-er-configurations"></a>Импорт конфигураций электронной отчетности
Для импорта конфигураций ER выполните следующие действия: 

1. Выполните вход в свою среду.
2. В панели мониторинга по умолчанию выберите **Электронная отчетность**.
3. Выберите **Конфигурации отчетности**.
4. В текущем экземпляре Finance импортируйте конфигурации, которые были экспортированы из Regulatory Configuration Services (RCS) во время выполнения шагов, описанных в разделе [Настройка форматов ER для использования параметров, указанных для юридического лица](er-app-specific-parameters-configure-format.md). Выполните следующие шаги для каждой конфигурации [электронной отчетности (ER)](general-electronic-reporting.md) в следующем порядке: модель данных, сопоставление моделей и форматы.

    1. Выберите **Exchange \> Загрузить из XML-файла**.
    2. Выберите **Обзор**, чтобы выбрать файл для требуемой конфигурации ER в формате XML.
    3. Нажмите **ОК**.

    На следующем рисунке показаны конфигурации, которые должны получиться после завершения работы.

    ![Страница конфигураций электронной отчетности.](./media/GER-AppSpecParms-ImportedConfigurations.PNG)

## <a name="set-up-parameters-for-the-demf-company"></a>Настройка параметров компании DEMF

Структуру ER можно использовать для настройки параметров приложения для формата ER.

1. Выберите юридическое лицо **DEMF**.
2. В дереве конфигураций выберите формат **Формат для изучения поиска данных LE**.
3. В области действий на вкладке **Конфигурации** в группе **Параметры для конкретного приложения** выберите **Настройка**.

    ![Страница параметров для конкретного приложения ER предназначена для настройки параметров.](./media/GER-AppSpecParms-LookupForm.PNG)

    На странице параметры **Параметры для конкретного приложения** можно настроить правила для источника данных **Выбор** в формате **Формат для изучения поиска данных LE**.

    Если базовый формат ER будет содержать несколько источников данных типа **Поиск**, необходимо выбрать нужный источник данных на экспресс-вкладке **Поиск**, прежде чем можно будет начать настройку набора правил для источника данных.

    Для каждого источника данных можно настроить отдельные правила для каждой версии выбранного формата ER.

    Полный набор правил для всех источников данных поиска, доступных в выбранной версии базового формата ER, используется для настройки параметров для конкретного приложения в формате ER.

4. Выберите версию **1.1.1** формата ER.
5. На экспресс- вкладке **Условия** выберите **Добавить**.
6. В поле **Код** новой записи выберите стрелку раскрывающегося списка, чтобы открыть поиск.

    Поиск представляет собой список налоговых кодов для выбора. Этот список возвращается источником данных **Model.Data.Tax**, который был настроен в основном формате ER. Так как этот источник данных содержит поле **Имя**, в поиске отображается имя каждого налогового кода.

    ![Подстановка поля кода на странице параметров для конкретного приложения электронной отчетности.](./media/GER-AppSpecParms-LookupForm-CodeFldPicker.PNG)

7. Выберите налоговый код **VAT19**.
8. В поле **Результат поиска** новой записи выберите стрелку раскрывающегося списка, чтобы открыть поиск. При поиске представлен список значений для перечисления формата TaxationLevel format для выбора.

    Обратите внимание, что если выбран немецкий язык как предпочитаемый язык для пользователя, выполнившего вход, метки значений будут отображаться в поиске на немецком языке при условии, что они были переведены в основном формате ER. Кроме того, если метка источника данных поиска была переведена, эта метка появится на предпочтительном языке пользователя на вкладке **Поиск**.

    ![Поле подстановки переведено на немецкий на странице параметров конкретного приложения ER.](./media/GER-AppSpecParms-LookupForm-LookupFldPicker.PNG)

9. Выбор значения **Обычное налогообложение**.

    При добавлении этой записи определяется следующее правило: когда запрашивается источник данных поиска **Выбор** и налоговый код **VAT19** передается в качестве аргумента, в качестве запрошенного уровня налогообложения будет возвращено **Обычное налогообложение**.

10. Выберите **Добавить**, а затем выполните следующие действия:

    1. В поле **Код** выберите налоговый код **InVAT19**.
    2. В поле **Результат поиска** выберите значение **Обычное налогообложение**.

11. Выберите **Добавить**, а затем выполните следующие действия:

    1. В поле **Код** выберите налоговый код **VAT7**.
    2. В поле **Результат поиска** выберите значение **Сокращенное налогообложение**.

12. Выберите **Добавить**, а затем выполните следующие действия:

    1. В поле **Код** выберите налоговый код **InVAT7**.
    2. В поле **Результат поиска** выберите значение **Сокращенное налогообложение**.

13. Выберите **Добавить**, а затем выполните следующие действия:

    1. В поле **Код** выберите налоговый код **THIRD**.
    2. В поле **Результат поиска** выберите значение **Нет налогообложения**.

14. Выберите **Добавить**, а затем выполните следующие действия:

    1. В поле **Код** выберите налоговый код **InVAT0**.
    2. В поле **Результат поиска** выберите значение **Нет налогообложения**.

15. Выберите **Добавить**, а затем выполните следующие действия:

    1. В поле **Код** выберите параметр **\*Нет налогообложения\***.
    2. В поле **Результат поиска** выберите значение **Другое**.

    При добавлении этой последней записи определяется следующее правило: когда запрашивается налоговый код, передаваемый в качестве аргумента, не удовлетворяет какому-либо предыдущему правилу, в качестве запрошенного уровня налогообложения будет возвращено **Другое**.

    ![Последняя запись, добавленная на странице параметров для конкретного приложения электронной отчетности.](./media/GER-AppSpecParms-LookupForm-RulesSet.PNG)

16. В поле **Состояние** выберите **Завершено**.

    При выполнении версии формата ER со статусом **Завершено** или **Общие** этот набор правил должен находиться в состоянии **Завершено**. В противном случае выполнение базового формата ER будет прервано, когда формат пытается загрузить данные из этого набора правил во время выполнения источника данных поиска **Выбор**.

    При выполнении версии формата ER со статусом **Черновик** базовый формат ER имеет доступ к этому набору правил независимо от его состояния.

17. Нажмите **Сохранить**.
18. Закройте страницу **Параметры для конкретного приложения**.

## <a name="run-the-er-format-in-the-demf-company"></a>Выполните формат ER в компании DEMF
Чтобы выполнить формат ER в компании DEMF, выполните следующие действия: 

1. В дереве конфигураций выберите формат **Формат для изучения поиска данных LE**.
2. В области действий выберите **Выполнить**.
3. В появившемся диалоговом окне выберите **ОК**.
4. Загрузите созданный отчет и сохраните его локально.

    Обратите внимание, что в созданном отчете сводка налогового кода **InVAT7** помещена на уровень **Сокращенное**, а суммарные данные кодов **VAT19** и **InVA19** помещены на уровне **Обычное**. Это поведение определяется конфигурацией в наборе правил, зависящем от юридического лица.

5. Перейдите в раздел **Налог \> Косвенные налоги \> Налог \> Налоговые коды**.
6. Выберите налоговый код **InVAT7**.
7. В области действий на вкладке **Код налога** в группе **Запросы** выберите **Разнесенный налог** для просмотра информации о значении налога и примененной налоговой ставки для налогового кода.

    ![Страница разнесенного налога.](./media/GER-AppSpecParms-Statement.PNG)

8. Закройте страницу **Разнесенные налоги**.

## <a name="set-up-parameters-for-the-usmf-company"></a>Настройка параметров компании USMF
Чтобы настроить параметры для компании USMF, выполните следующие действия: 

1. Выберите юридическое лицо **USMF**.
2. Перейдите в раздел **Управление организацией \> Электронная отчетность \> Конфигурации**.
3. В дереве конфигураций разверните элемент **Модель данных для изучения параметризованных вызовов**, раскройте элемент **Формат для изучения параметризованных вызовов** и выберите формат **Формат для изучения поиска данных LE**.
4. В области действий на вкладке **Конфигурации** в группе **Параметры для конкретного приложения** выберите **Настройка**.
5. Выберите версию **1.1.1** выбранного формата ER.
6. На экспресс- вкладке **Условия** выберите **Добавить**.
7. В поле **Код** новой записи выберите стрелку раскрывающегося списка, чтобы открыть поиск.

    Теперь поиск отображает список налоговых кодов для налога компании **USMF** для выбора.

    ![Налоговые коды для налога компании USMF.](./media/GER-AppSpecParms-LookupForm-CodeFldPicker2.PNG)

8. Выберите налоговый код **EXEMPT**.
9. В поле **Результат поиска** новой записи выберите значение **Нет налогообложения**.
10. Выберите **Добавить**.
11. В поле **Код** новой записи выберите параметр **\*Нет налогообложения\***.
12. В поле **Результат поиска** новой записи выберите значение **Обычное налогообложение**.
13. В поле **Состояние** выберите **Завершено**.
14. Нажмите **Сохранить**.

    ![Страница импорта параметров для конкретного приложения ER.](./media/GER-AppSpecParms-LookupForm-RulesSet2.PNG)

15. Закройте страницу **Параметры для конкретного приложения**.

## <a name="run-the-er-format-in-the-usmf-company"></a>Выполните формат ER в компании USMF
Чтобы выполнить формат ER в компании USMF, выполните следующие действия:

1. В дереве конфигураций выберите формат **Формат для изучения поиска данных LE**.
2. В области действий выберите **Выполнить**.
3. В появившемся диалоговом окне выберите **ОК**.
4. Загрузите созданный отчет и сохраните его локально.

    В созданном отчете обратите внимание, что теперь вы повторно использовали один и тот же формат ER для другого юридического лица, но не внесли никакие изменения в формат ER.

## <a name="reuse-legal-entitydependent-parameters"></a>Использование параметров, зависимых от юридического лица

### <a name="duplicate-existing-parameters"></a>Дублирование существующих параметров

#### <a name="export-parameters"></a>Параметры экспорта
Чтобы экспортировать параметры, выполните следующие шаги:

1. Перейдите в раздел **Управление организацией \> Рабочие области \> Электронная отчетность**.
2. Выберите **Конфигурации отчетности**.
3. В дереве конфигураций выберите формат **Формат для изучения поиска данных LE**.
4. В области действий на вкладке **Конфигурации** в группе **Параметры для конкретного приложения** выберите **Настройка**.
5. Выберите версию **1.1.1** формата ER.
6. На панели операций выберите **Экспорт**.
7. Загрузите созданный файл и сохраните его локально.

    Настроенный набор параметров приложения был экспортирован как файл XML.

#### <a name="import-parameters"></a>Параметры импорта
Чтобы импортировать параметры, выполните следующие шаги:

1. Выберите версию **1.1.2** формата ER.
2. На панели операций выберите **Импорт**.
3. Выберите **Да** для подтверждения того, что вы хотите перезаписать существующие параметры для конкретного приложения для данной версии формата.
4. Нажмите **Обзор**, чтобы найти файл, содержащий экспортированные параметры приложения для версии **1.1.1**.
5. Нажмите **ОК**.

    Версия **1.1.2** формата ER теперь имеет те же параметры, что и приложение, первоначально настроенное для версии **1.1.1**.

##### <a name="applicability-considerations"></a>Соображения применимости

Зависящие от приложения параметры формата ER зависят от юридического лица. Для повторного использования параметров, связанных с приложением, которые были настроены для одного юридического лица, в другом юридическом лице, необходимо экспортировать их. Затем импортируйте их после того, как вы войдете в другую компанию.

Этот подход экспорта-импорта можно также использовать для переноса формата ER, относящегося к параметрам конкретного приложения, которые первоначально были настроены в одном экземпляре Finance в другом экземпляре Finance.

Если настроить параметры для конкретного приложения для одной версии формата ER, а затем импортировать более позднюю версию того же формата в текущий экземпляр Finance, существующие параметры, связанные с приложением, не будут применены к импортируемой версии, пока не будут использована функция **Использовать параметры для конкретного приложения из предыдущих версий форматов электронной отчетности**. Дополнительные сведения см. в разделе [Повторное использование существующих параметров](#reuse-existing-parameters) далее в этой теме.

При выборе файла для импорта структура параметров конкретного приложения в этом файле сравнивается со структурой соответствующих источников данных типа **Поиск** в формате ER, выбранном для импорта. По умолчанию импорт выполняется, только когда структура каждого параметра конкретного приложения совпадает со структурой соответствующего источника данных в формате ER, выбранном для импорта. Если структуры не соответствуют друг другу, выводится предупреждающее сообщение о том, что импорт выполнить невозможно. Если принудительно выполнить импорт, то существующие параметры для конкретного приложения для выбранного формата ER будут очищены, и их необходимо настроить с начала.


С версии Finance 10.0.24 можно изменить поведение по умолчанию и избежать получения предупреждающего сообщения, включив функцию **Сопоставить параметры для конкретного приложения электронной отчетности при импорте** в рабочей области **Управление функциями**. При включенной этой функции, если структура параметров конкретного приложения, которая импортируется, отличается от структуры соответствующих источников данных в целевом формате ER, выбранном для импорта, импорт будет успешен в следующих случаях:

- Структура целевого формата ER была изменена путем добавления новых столбцов условия в любые существующие источники данных типа **Подстановка**. По завершении импорта параметры для конкретного приложения обновляются. Во всех импортированных записях параметров конкретного приложения значения в каждом добавленном столбце условия инициализируются значением по умолчанию для [типа данных](er-formula-supported-data-types-primitive.md) этого столбца.
- Структура целевого формата ER была изменена путем удаления некоторых столбцов условия из существующих источников данных типа **Подстановка**. По завершении импорта параметры для конкретного приложения обновляются. Во всех импортированных записях параметров конкретного приложения удаляются значения в каждом удаленном столбце условий.
- Структура целевого формата ER была изменена путем добавления новых источников данных типа **Подстановка**. По завершении импорта добавленные подстановки добавляются в параметры для конкретного приложения.
- Структура целевого формата ER была изменена путем удаления некоторых существующих источников данных типа **Подстановка**. После завершения импорта все артефакты, связанные с источниками данных типа **Подстановка**, которые были удалены из целевого формата ER, удаляются из импортированных параметров для конкретного приложения.

После завершения импорта в дополнение к описанным изменениям состояние импортированных параметров конкретного приложения изменяется на **Выполняется**. Выводится предупреждающее сообщение о том, что автоматически настроенные параметры конкретного приложения необходимо изменить вручную.

#### <a name="replicate-parameters"></a>Репликация параметров

В Finance версии 10.0.27 можно одновременно скопировать параметры, настроенные в одной компании, в другие компании.

Чтобы скопировать параметры, выполните следующие шаги.

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. Выберите **Конфигурации отчетности**.
3. В дереве конфигураций выберите формат **Формат для изучения поиска данных LE**.
4. В области действий на вкладке **Конфигурации** в группе **Параметры для конкретного приложения** выберите **Настройка**.
5. Выберите версию **1.1.1** формата ER.
6. На панели операций выберите **Реплицировать**.
7. В диалоговом окне **Реплицировать** на вкладке **Компании** выберите компании, в которые требуется скопировать параметры.

    > [!NOTE]
    > Список целевых компаний предлагается только тем пользователям, которым назначена [роль](../sysadmin/role-based-security.md#security-roles) безопасности, настроенная для предоставления доступа ко всем организациям.

8. Нажмите **ОК**.

    > [!NOTE]
    > Диалоговое окно подтверждения информирует пользователя о том, что некоторые целевые компании содержат ранее настроенные параметры для выбранной версии формата электронной отчетности. Выберите **Да**, чтобы переопределить параметры путем копирования их из текущей компании.

    Настроенный набор параметров конкретного приложения теперь будет скопирован в выбранные компании.

### <a name="reuse-existing-parameters"></a>Повторное использование существующих параметров

В Finance версии 10.0.23 можно повторно использовать параметры для конкретного приложения, которые были настроены для одной версии формата электронной отчетности, при запуске более поздней версии того же формата. Чтобы повторно использовать существующие параметры, включите функцию **Использовать параметры для конкретного приложения из предыдущих версий форматов электронной отчетности** в рабочей области **Управление функциями**. Если эта функция включена и вы запускаете одну версию формата ER, которая пытается прочитать параметры конкретного приложения, она попытается найти параметры конкретного приложения, которые были настроены для выполняемой версии этого формата. Если они недоступны, электронная отчетность будет пытаться найти их для ближайшей младшей версии этого формата.

> [!NOTE]
> Можно повторно использовать параметры конкретного приложения только в области текущего юридического лица.
>
> Ошибка отображается во время выполнения, когда запускается более поздняя версия формата ER, который пытается повторно использовать параметры приложения, настроенные для более ранней версии того же формата, и изменилась структура хотя бы одного источника данных типа **Подстановка** более поздней версии формата.

## <a name="relationship-between-application-specific-parameters-and-an-er-format"></a>Отношение между параметрами конкретного приложения и форматом ER

Связь между форматом ER и его параметрами, зависящими от приложения, устанавливается с помощью уникального идентификационного кода формата ER, зависящего от экземпляра, для формата ER. Таким образом, при удалении формата ER из Finance параметры конкретного приложения, настроенные для формата ER, хранятся в текущем экземпляре Finance. Они могут быть доступны при повторном импорте базового формата ER в данный экземпляр Finance.

## <a name="access-application-specific-parameters-by-using-the-er-framework"></a>Доступ к параметрам, относящимся к приложению, при помощи структуры ER

В предыдущем примере для доступа к параметрам в формате ER, связанных с приложением, используется структура ER. Такой подход не позволяет ограничить доступ к параметрам конкретного приложения для заданного формата ER. Если необходимо применять такие ограничения, выполните следующие действия. 

1. Либо используйте существующий элемент меню **ERSolutionAppSpecificParametersDesigner**, либо реализуйте свой собственный элемент меню **ERSolutionAppSpecificParametersDesigner**.

    ![Пункт меню Display ERSolutionAppSpecificParametersDesigner.](./media/GER-AppSpecParms-LookupForm-Access1.PNG)

2. Выполните одно из следующих действий.

    1. Создайте новую кнопку пункта меню и свяжите ее с соответствующей записью их таблицы **ERSolutionTable**, задав для свойства **Источник данных** значение **ERSolutionTable**.

        ![Отображение новых настроек пункта меню.](./media/GER-AppSpecParms-LookupForm-Access2.PNG)

    2. Создайте простую кнопку и переопределите метод **Нажато**, как показано в следующем примере.

        Используя этот подход, можно указать уникальный код решения (определяемый через значение **GUID**), чтобы разрешить доступ к параметрам конкретного приложения только определенного формата ER и последующих копий, которые были получены из него.
        
        ```xpp
        public void clicked()
            {
                super();

                ERSolutionTable solutionTableRecord = ERSolutionTable::findByGUID(str2Guid('ADACCB2F-EFD1-4C90-877D-7E1E5D1AEE92'));

                Args args = new Args();
                args.record(solutionTableRecord);
                args.caller(this);

                new MenuFunction(menuItemDisplayStr(ERSolutionAppSpecificParametersDesigner), MenuItemType::Display)
                    .run(args);
            }
        ```

## <a name="additional-resources"></a>Дополнительные ресурсы

[Конструктор формул в электронной отчетности](general-electronic-reporting-formula-designer.md)

[Настройка форматов ER для использования параметров, указанных для юридического лица](er-app-specific-parameters-configure-format.md)

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]

---
title: Создание нового решения ER для печати меток ZPL
description: В этой теме объясняется, как разработать новое решение электронной отчетности (ER), чтобы напечатать метки языка программирования Zebra (ZPL).
author: NickSelin
ms.date: 02/28/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ERSolutionTable, ERFormatDestinationTable
audience: Application User
ms.reviewer: kfend
ms.custom: 97423
ms.assetid: f3055a27-717a-4c94-a912-f269a1288be6
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2022-02-01
ms.dyn365.ops.version: 10.0.26
ms.openlocfilehash: c1bedf1184b45741102000fa68c8d662c7383301
ms.sourcegitcommit: 2977e92a76211875421e608555311c363cfbdc25
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2022
ms.locfileid: "8612366"
---
# <a name="design-a-new-er-solution-to-print-zpl-labels"></a>Создание нового решения ER для печати меток ZPL

[!include [banner](../includes/banner.md)]


В этой теме объясняется, как пользователь с ролью "системный администратор", "разработчик электронной отчетности" или "функциональный консультант по электронной отчетности" может настроить параметры структуры [электронной отчетности ER](general-electronic-reporting.md), разработать необходимые [конфигурации](general-electronic-reporting.md#Configuration) электронной отчетности для нового решения ER для доступа к данным системы управления складом и создания пользовательских меток расположения складов в формате языка программирования Zebra Programming Language (ZPL) II. Эти шаги можно выполнить в компании **USRT**.

## <a name="business-scenario"></a>Бизнес-сценарий

Вы представляете компанию, которая реализует управление складом в Microsoft Dynamics 365 Finance. Каждое местоположение склада должно быть помечено самоклеющейся наклейкой, которая включает штрих-код. Работники склада будут использовать ручные сканеры штрих-кодов для сканирования штрих-кодов.

Все складские местоположения были помечены в рамках действий перед вводом в эксплуатацию. Однако, необходимо также иметь возможность печатать этикетки местоположения склада при необходимости, если существующие этикетки повреждены или изменяется настройка хранения на складе. Используя недавно выпущенные функции электронной отчетности, можно настроить новое решение электронной отчетности, позволяющее супервайзеру склада печатать метки непосредственно на термопринтере меток.

## <a name="configure-the-er-framework"></a>Настройка платформы электронной отчетности

Выполните шаги из раздела [Настройка платформы электронной отчетности](er-quick-start2-customize-report.md#ConfigureFramework), чтобы настроить минимальный набор параметров электронной отчетности. Необходимо завершить эту настройку до начала использования платформы электронной отчетности для разработки нового решения электронной отчетности.

## <a name="design-a-domain-specific-data-model"></a>Проектирование модели данных для конкретного домена

Создайте новую конфигурацию электронной отчетности, которая содержит компонент [модели данных](er-overview-components.md#data-model-component) для домена управления складом. Эта модель данных позднее будет использоваться в качестве источника данных при разработке формата электронной отчетности для создания меток расположений на складе.

### <a name="import-a-data-model-configuration"></a>Импорт конфигурации модели данных

Выполните следующие действия, чтобы импортировать необходимую модель данных из XML-файла, предоставляемого корпорацией Microsoft. Вместо этого можно создать собственную модель данных, как описано в следующем разделе.

1. Загрузите файл [Warehouse model.version.1.xml](https://download.microsoft.com/download/9/f/1/9f136e9b-bf5f-403a-b089-a2b2ed1da2ba/Warehouse-model.version.1.xml) и сохраните его на локальном компьютере.
2. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
3. В рабочей области **Электронная отчетность** выберите **Конфигурации отчетности**.
4. На странице **Конфигурации** на панели действий выберите **Exchange** \> **Загрузить из XML-файла**.
5. Выберите **Обзор**, затем найдите и выберите файл **Warehouse model.version.1.xml**.
6. Выберите **ОК**, чтобы импортировать конфигурацию.

![Импортированная конфигурация модели данных электронной отчетности на странице конфигураций.](./media/er-design-zpl-labels-imported-model.png)

### <a name="create-a-data-model-configuration"></a>Создание конфигурации модели данных

Вместо импорта файла модели данных, предоставленного корпорацией Майкрософт, можно создать модель данных "с нуля". Пример, который показывает, как выполнить эту задачу, см. в разделе [Создание новой конфигурации модели данных](er-quick-start1-new-solution.md#DesignDataModel).

### <a name="review-the-data-model"></a>Просмотр модели данных

Редактируемую версию сконфигурированной модели данных можно просмотреть на странице **Конструктор моделей данных**.

![Структура модели данных электронной отчетности на странице конструктора моделей данных.](./media/er-design-zpl-labels-model.png)

## <a name="design-a-model-mapping-for-the-configured-data-model"></a>Разработка сопоставления модели для настроенной модели данных

В качестве пользователя в роли разработчика электронной отчетности необходимо создать новую конфигурацию электронной отчетности, которая содержит компонент [сопоставления модели](er-overview-components.md#model-mapping-component) для модели данных склада. Этот компонент реализует настроенную модель данных для Dynamics 365 Finance и предназначен для этого приложения. Необходимо настроить его, чтобы указать объекты приложения, которые будут использоваться для заполнения настроенной модели данных данными приложения в среда выполнения. Чтобы выполнить эту задачу, необходимо понимать, как структура данных в бизнес-домене управления складом реализована в Finance.

### <a name="import-a-model-mapping-configuration"></a>Импорт конфигурации сопоставления модели

Выполните следующие действия, чтобы импортировать необходимое сопоставление модели из XML-файла, предоставляемого корпорацией Microsoft. Вместо этого можно создать собственную модель сопоставления, как описано в следующем разделе.

1. Загрузите файл [Warehouse model mapping.version.1.1.xml](https://download.microsoft.com/download/1/c/c/1cc94d28-3d90-4ffd-a118-77d6c322904f/Warehouse-model-mapping.version.1.1.xml) и сохраните его на локальном компьютере.
2. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
3. В рабочей области **Электронная отчетность** выберите **Конфигурации отчетности**.
4. На странице **Конфигурации** на панели действий выберите **Exchange** \> **Загрузить из XML-файла**.
5. Выберите **Обзор**, затем найдите и выберите файл **Warehouse model mapping.version.1.1.xml**.
6. Выберите **ОК**, чтобы импортировать конфигурацию.

![Импортированная конфигурация сопоставления модели электронной отчетности на странице конфигураций.](./media/er-design-zpl-labels-imported-mapping.png)

### <a name="create-a-model-mapping-configuration"></a>Создание конфигурации сопоставления модели

Вместо импорта файла сопоставления модели, предоставленного корпорацией Майкрософт, можно создать сопоставление модели "с нуля". Пример, который показывает, как выполнить эту задачу, см. в разделе [Создание новой конфигурации сопоставления модели](er-quick-start1-new-solution.md#CreateModelMapping).

### <a name="review-the-model-mapping"></a>Просмотр сопоставления моделей

Редактируемую версию сконфигурированного сопоставления модели можно просмотреть на странице **Конструктор сопоставления моделей**.

![Структура сопоставления модели электронной отчетности на странице конструктора сопоставления моделей.](./media/er-design-zpl-labels-mapping.png)

## <a name="design-a-format"></a>Разработка формата

В качестве пользователя в роли функционального консультанта по электронной отчетности необходимо создать новую конфигурацию ER, которая содержит компонент [формата](er-overview-components.md#format-component). Для настройки этого компонента вы будете использовать код ZPL II для указания макета этикетки местоположения склада.

### <a name="import-a-format-configuration"></a>Импорт конфигурации формата

Выполните следующие действия, чтобы импортировать необходимый формат из XML-файла, предоставляемого корпорацией Microsoft. Вместо этого можно создать собственный формат, как описано в следующем разделе.

1. Загрузка файла [Warehouse location labels.version.1.1.xml](https://download.microsoft.com/download/5/7/5/5758b551-69a5-45bd-a2b2-21c3db73a6fc/Warehouse-location-labels.version.1.1.xml) и сохранение его на локальном компьютере.
2. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
3. В рабочей области **Электронная отчетность** выберите **Конфигурации отчетности**.
4. На странице **Конфигурации** на панели действий выберите **Exchange** \> **Загрузить из XML-файла**.
5. Выберите **Обзор**, затем найдите и выберите файл **Warehouse location labels.version.1.1.xml**.
6. Выберите **ОК**, чтобы импортировать конфигурацию.

![Импортированная конфигурация формата электронной отчетности на странице конфигураций.](./media/er-design-zpl-labels-imported-format.png)

### <a name="create-a-format-configuration"></a>Создание конфигурации формата

Вместо импорта файла формата, предоставленного корпорацией Майкрософт, можно создать формат "с нуля". Пример, который показывает, как выполнить эту задачу, см. в разделе [Создание новой конфигурации формата](er-quick-start1-new-solution.md#FormatCreate).

### <a name="review-the-format"></a>Просмотр формата

Редактируемую версию сконфигурированного формата можно просмотреть на странице **Конструктор форматов**.

![Структура формата электронной отчетности на странице конструктора форматов.](./media/er-design-zpl-labels-format.png)

Источник данных `model.Location.Label` этого формата настроен для создания меток, которые содержат следующие сведения:

- Название склада в виде текста
- Название склада в виде штрих-кода
- Название местонахождения
- Контрольные разряды

На странице **Конструктор формул** для источника данных формула электронной отчетности, используемая для создания меток, включает функцию `CONCATENATE`, объединяющую информацию в нужном макете.

![Формула для источника данных модели на странице конструктора форматов.](./media/er-design-zpl-labels-review-formula.png)

> [!TIP]
> Макет наклейки предназначен для выравнивания заголовка ячейки и контрольных цифр в центре метки. Однако ZPL II не поддерживает выравнивание по центру для штрих-кодов. Таким образом, формула источника данных `model.Location.Warehouse.Alignment` используется для выравнивания штрих-кода в центре метки. Эта формула вычисляет левое смещение штрих-кода на основе количества символов в названии склада.

## <a name="prepare-your-environment-for-previewing-generated-labels"></a>Подготовка среды для предварительного просмотра созданных меток

В следующем примере используется приложение эмулятора принтера для меток ZPL, чтобы отобразить предварительный просмотр созданных меток на экране. Выполните следующие шаги для включения этого параметра.

1. Добавьте назначение электронной отчетности [Принтер](er-destination-type-print.md) для формата электронной отчетности **Метка местоположения склада** и настройте его для отправки созданных этикеток из Finance в [агент маршрутизации документов (DRA)](install-document-routing-agent.md).
2. Установите и настройте агент DRA для направления созданных этикеток из Finance на локальный принтер, доступный с текущей рабочей станции.
3. Добавьте локальный принтер для текущей рабочей станции и настройте его для передачи созданных меток из DRA в приложение эмулятора принтера.
4. Установите приложение эмулятора принтера в качестве расширения веб-браузера Chrome и настройте его для передачи созданных меток с локального принтера в веб-службу, которая будет отображать созданные метки и возвращать их в эмулятор принтера для предварительного просмотра.

<table>
<tbody>
<tr align="center">
<td>
<p>Finance</p>
<p>Отчет электронной отчетности</p>
<p>Назначение принтера</p>
</td>
<td><img src="./media/er-design-zpl-labels-flow1.png" alt="Data flow direction: from Finance to the DRA."></td>
<td>Агент маршрутизации документов</td>
<td><img src="./media/er-design-zpl-labels-flow1.png" alt="Data flow direction: from the DRA to a local printer."></td>
<td>Локальный принтер</td>
<td><img src="./media/er-design-zpl-labels-flow1.png" alt="Data flow direction: from a local printer to a printer emulator."></td>
<td>Эмулятор принтера</td>
<td><img src="./media/er-design-zpl-labels-flow2.png" alt="Data flow direction: from a printer emulator to a rendering web service and then back to the printer emulator."></td>
<td>Веб-служба отрисовки</td>
</td>
</tr>
</tbody>
</table>

### <a name="install-and-configure-a-printer-emulator-application"></a>Установка и настройка приложения эмулятора принтера

Добавьте приложение эмулятора принтера для механизма визуализации ZPL в веб-браузер Chrome. В этом примере используется эмулятор [принтера Zpl](https://chrome.google.com/webstore/detail/zpl-printer/phoidlklenidapnijkabnfdgmadlcmjo), который основан на [веб-службе Labelary ZPL](http://labelary.com/service.html). Приложение эмулятора принтера передает созданные метки в формате ZPL с локального принтера веб-службе, а затем возвращает метки в виде файлов PDF или PNG для предварительного просмотра.

1. В интернет-магазине Chrome найдите и выберите приложение эмулятора принтера, которое необходимо использовать. Затем выберите **Добавить в Chrome**, чтобы добавить его в веб-браузер Chrome.

    ![Добавление приложения эмулятора принтера в веб-браузер Chrome из интернет-магазина Chrome.](./media/er-design-zpl-labels-add-app.png)

2. Выберите **Запустить приложение**, чтобы запустить приложение эмулятора принтера из веб-браузера Chrome.

    ![Запуск приложения эмулятора принтера из веб-браузера Chrome.](./media/er-design-zpl-labels-run-app.png)

3. Настройте выполняющееся приложение:

    1. Выключите приложение.
    2. В настройках принтера задайте для узла значение **127.0.0.1**.
    3. Установите для порта значение **9100**.

        ![Настройка приложения эмулятора принтера.](./media/er-design-zpl-labels-configure-app.png)

    4. Снова включите приложение. Должно быть получено сообщение о том, что принтер был запущен на указанном узле и порте.

        ![Приложение-эмулятор принтера снова включено.](./media/er-design-zpl-labels-turn-on-app.png)

> [!NOTE]
> Так как приложение эмулятора принтера, используемое в этом примере, использует веб-службу для отрисовки меток, убедитесь, что параметры безопасности позволяют взаимодействовать со службой. В противном случае приложение не получит отрисованные метки, и предварительный просмотр этих меток будет недоступен.

### <a name="add-and-configure-a-local-printer"></a>Добавление и настройка локального принтера

[Добавьте новый локальный принтер](https://support.microsoft.com/windows/install-a-printer-in-windows-10-cc0724cf-793e-3542-d1ff-727e4978638b), который текущее устройство может использовать для передачи созданных меток из DRA в приложение эмулятора принтера.

1. В Windows выберите **Пуск** \> **Параметры** \> **Устройства** \> **Принтеры и сканеры**.
2. Выберите **Параметры принтеров и сканеров**.
3. Для **Добавить принтер или сканер** выберите **Добавить устройство**.
4. Для **Необходимый принтер отсутствует в списке** выберите **Добавить вручную**.
5. В поле **Найти принтер по другим параметрам** выберите **Добавить локальный или сетевой принтер с параметрами, заданными вручную**.
6. В поле **Выберите порт принтера** выберите **Создать новый порт**, затем выполните следующие действия:

    1. В поле **Тип порта** выберите **Стандартный порт TCP/IP**.
    2. В поле **Имя или IP-адрес** введите **127.0.0.1**.
    3. В поле **Имя порта** введите **ZPL**.
    4. Дождитесь завершения операции **Поиск порта TCP/IP**.
    5. В поле **Тип устройства** выберите **Особое**, затем выберите **Параметры**.
    6. Убедитесь, что указаны следующие параметры порта:

        - **Имя порта**: ZPL
        - **Имя принтера или IP-адрес:** 127.0.0.1
        - **Протокол:** Raw
        - **Номер порта:** 9100

7. В поле **Установка драйвера принтера** выберите **Общий / только текст**.
8. В поле **Имя принтера** введите **ZebraPrinter**.

![Добавьте локальный принтер для текущего устройства.](./media/er-design-zpl-labels-configure-printer.png)

### <a name="install-and-configure-the-dra"></a>Установка и настройка DRA

Подготовьте агент DRA для передачи созданных этикеток из Finance в сконфигурированный локальный принтер.

1. [Установите DRA](install-document-routing-agent.md#install-the-document-routing-agent).
2. [Настройте DRA](install-document-routing-agent.md#configure-the-document-routing-agent).
3. [Зарегистрируйте локальный принтер](install-document-routing-agent.md#register-network-printers) в агенте DRA.
4. [Активируйте локальный принтер](install-document-routing-agent.md#administer-network-printers) в среде Finance.

![Подготовка агента DRA для печати созданных меток.](./media/er-design-zpl-labels-configure-dra.png)

### <a name="configure-the-er-destination"></a>Настройка места назначения ER

Подготовьте пункт назначения электронной отчетности для передачи созданных этикеток из Finance в агент DRA.

1. Перейдите в раздел **Управление организацией** \> **Электронная отчетность** \> **Место назначения электронной отчетности**.
2. На странице **Назначение электронной отчетности** на панели операций выберите **Создать**.
3. В поле **Ссылка** выберите **Этикетки местоположения склада**.
4. На экспресс-вкладке **Место назначения файла** выберите **Создать**.
5. В поле **Имя** введите **Этикетки**.
6. В поле **Имя компонента файла** выберите **Отчет**.
7. Выберите **Параметры**.
8. В открывшемся диалоговом окне **Параметры места назначения** на вкладке **Принтер** установите для параметра **Включено** значение **Да**.
9. В поле **Имя принтера** выберите **ZebraPrinter**.
10. В поле **Тип маршрутизации документа** выберите **ZPL**.
11. Нажмите **ОК**.

![Настройка места назначения электронной отчетности для формата этикеток местоположения склада на странице назначения электронной отчетности.](./media/er-design-zpl-labels-configure-destination.png)

## <a name="review-warehouse-locations"></a>Проверка местонахождений склада

1. Перейдите в раздел **Управление складом** \> **Настройка** \> **Склад** \> **Местонахождения**.
2. На странице **Местоположения** выберите фильтр для просмотра только тех местоположений, которые имеют значение в поле **Контрольные разряды**.

![Проверка складских местоположений на странице местоположений.](./media/er-design-zpl-labels-review-locations.png)

## <a name="print-warehouse-location-labels"></a>Печать этикеток местоположения склада

1. Перейдите в раздел **Администрирование организации** \> **Электронная отчетность** \> **Конфигурации**.
2. На странице **Конфигурации** в дереве конфигурации разверните **Модель склада** и выберите **Этикетки местоположений склада**.
3. В области действий выберите **Выполнить**.
4. В диалоговом окне **Параметры электронного отчета** на вкладке **Включаемые записи** выберите **Фильтр**.
5. На вкладке **Диапазон** найдите строку, в которой поле **Таблица** имеет значение **Местонахождения**, а в поле **Поле** задано значение **Местонахождение**. В поле **Критерии** введите значение **LPEnabled**.
6. Нажмите **ОК**.
7. Нажмите **ОК**. Метка создается и отображается на странице предварительного просмотра приложения эмулятора принтера.

![Проверка созданной этикетки на странице предварительного просмотра приложения эмулятора принтера Zpl.](./media/er-design-zpl-labels-preview-label.png)

## <a name="modify-the-layout-of-a-label"></a>Изменение формата метки

Можно изменить текущий макет этикеток местоположения склада. В следующем примере показано, как изменить макет так, чтобы создаваемые этикетки включали код профиля местоположения.

1. Перейдите в раздел **Администрирование организации** \> **Электронная отчетность** \> **Конфигурации**.
2. Установите для [параметра пользователя электронной отчетности](electronic-reporting-destinations.md#applicability) **Использовать места назначения для статуса черновика** значение **Да**.
3. На странице **Конфигурации** в дереве конфигурации разверните **Модель склада** и выберите **Этикетки местоположений склада**.
4. Выберите **Конструктор**.
5. На странице **Конструктор форматов** на вкладке **Сопоставление** выберите источник данных `model.Location.Label`.
6. В диалоговом окне **Свойства источника данных** выберите **Правка** \> **Изменить формулу**.
7. На странице **Конструктор формул** в поле **Формула** проверьте формулу электронной отчетности, которая используется для создания меток.

    ```vb
    CONCATENATE(
    "^XA",CrLf,
    "^CF0,30,30^FO0,30^FB800,1,0,C,0^FD",Warehouse,"\&^FS",CrLf,
    "^BY2,2,50^FT",@.Warehouse.Alignment,",126^BCN,,N,N,N,A^FD",Warehouse,"\&^FS",CrLf,
    "^FO0,150^FB800,1,0,C,0^FD",@.Name,"\&^FS",CrLf,
    "^CF0,20,20^FO0,200^FB800,1,0,C,0^FD",@.CheckDigits,"\&^FS",CrLf,
    "^XZ")
    ```

8. Обновление формулы для добавления кода профиля местоположения в созданные метки.

    ```vb
    CONCATENATE(
    "^XA",CrLf,
    "^CF0,30,30^FO0,30^FB800,1,0,C,0^FD",Warehouse,"\&^FS",CrLf,
    "^BY2,2,50^FT",@.Warehouse.Alignment,",126^BCN,,N,N,N,A^FD",Warehouse,"\&^FS",CrLf,
    "^FO0,150^FB800,1,0,C,0^FD",@.Name,"\&^FS",CrLf,
    "^CF0,20,20^FO0,200^FB800,1,0,C,0^FD",@.CheckDigits,"\&^FS",CrLf,
    "^CF0,40,40^FO0,240^FB800,1,0,C,0^FD",@.ProfileID,"\&^FS",CrLf,
    "^XZ")
    ```

9. Нажмите **Сохранить**.
10. Нажмите **ОК**.
11. В области действий выберите **Выполнить**.
12. В диалоговом окне **Параметры электронного отчета** на вкладке **Включаемые записи** выберите **Фильтр**.
13. На вкладке **Диапазон** найдите строку, в которой поле **Таблица** имеет значение **Местонахождения**, а в поле **Поле** задано значение **Местонахождение**. В поле **Критерии** введите **Отсек**.
14. Нажмите **ОК**.
15. Нажмите **ОК**. Метка создается и отображается на странице предварительного просмотра приложения эмулятора принтера.

![Просмотр созданной метки, которая содержит идентификатор профиля местоположения на странице предварительного просмотра приложения эмулятора принтера Zpl.](./media/er-design-zpl-labels-preview-label2.png)

## <a name="encoding"></a>Шифрование

> [!NOTE]
> Необходимо синхронизировать настройку кодировки компонента **Общее\\Файл** редактируемого формата электронной отчетности и соответствующий параметр для созданной метки. Значение поля **[Кодировка](er-suppress-bom-characters.md)** в компоненте **Общее\\Файл** не должно противоречить команде ZPL, которая используется для управления кодировкой метки (например, команде `^CI`). Электронная отчетность не проверяет, что данные параметры синхронизованы.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Назначение принтера](er-destination-type-print.md)

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]

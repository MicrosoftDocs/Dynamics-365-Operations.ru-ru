---
title: Повышение производительности решений электронной отчетности за счет добавления параметризованных источников данных ВЫЧИСЛЯЕМЫЕ ПОЛЯ
description: В этой статье объясняется, как повысить производительность решений электронной отчетности (ER), добавляя параметризированные источники данных типа ВЫЧИСЛЯЕМОЕ ПОЛЕ.
author: kfend
ms.date: 04/23/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.search.region: Global
ms.author: filatovm
ms.search.validFrom: ''
ms.dyn365.ops.version: 10.0.5
ms.custom: ''
ms.assetid: ''
ms.openlocfilehash: 34bb7c6256994f103c4da599157c06bd9d0795ef
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/12/2022
ms.locfileid: "9288269"
---
# <a name="improve-the-performance-of-er-solutions-by-adding-parameterized-calculated-field-data-sources"></a>Повышение производительности решений электронной отчетности за счет добавления параметризованных источников данных ВЫЧИСЛЯЕМЫЕ ПОЛЯ

[!include [banner](../includes/banner.md)]

В этой статье объясняется, как можно получить [трассировку производительности](trace-execution-er-troubleshoot-perf.md) выполняемых форматов [электронной отчетности (ER)](general-electronic-reporting.md), а затем использовать сведения из этих трассировок для повышения производительности путем настройки параметризированного источника данных **Вычисляемое поле**.

В процессе разработки конфигураций электронной отчетности для создания бизнес-документов определяется метод, используемый для извлечения данных из приложения и ввода их в создаваемые выходные данные. При разработке параметризированного источника данных электронной отчетности типа **Вычисляемое поле** можно сократить число вызовов базы данных и значительно сократить время и затраты, связанные со сбором сведений о выполнении формата электронной отчетности.

## <a name="prerequisites"></a>Необходимые условия

- Чтобы выполнить примеры в этой статье, необходимо иметь доступ к одной из следующих [ролей](../sysadmin/tasks/assign-users-security-roles.md):

    - Разработчик электронной отчетности
    - Консультант по функциональным возможностям электронной отчетности
    - Системный администратор

- Компания должна иметь значение **DEMF**.
- Выполните шаги в [Приложении 1](#appendix1) этой статьи, чтобы загрузить компоненты примера решения от Майкрософт для электронной отчетности, который необходим для выполнения примеров из этой статьи.
- Выполните шаги, изложенные в [Приложении 2](#appendix2) данной статьи, для настройки минимального набора параметров электронной отчетности, необходимого для использования структуры электронной отчетности, чтобы повысить производительность примера решения от Майкрософт для электронной отчетности.

## <a name="import-the-sample-er-solution"></a>Импорт примера решения электронной отчетности

Представьте, что вы должны разработать решение электронной отчетности для создания нового отчета, отображающего проводки по поставщику. В настоящее время на странице **Проводки по поставщику** можно найти проводки для выбранного поставщика (перейдите по пути **Расчеты с поставщиками** \> **Поставщики** \> **Все поставщики**, выберите поставщика, затем на панели операций на вкладке **Поставщик** в группе **Проводки** выберите **Проводки**). Однако необходимо иметь вместе все проводки по поставщику в одном электронном документе в формате XML. Это решение будет состоять из нескольких конфигураций ER, которые содержат требуемую модель данных, сопоставление моделей и компоненты формата.

Первым шагом является импорт образца решения электронной отчетности для создания отчета о проводках по поставщику.

1. Выполните вход в экземпляр Microsoft Dynamics 365 Finance, который был подготовлен для вашей компании.
2. В этой статье вам предстоит создать и изменить конфигурации для демонстрационной компании **Litware, Inc**. Убедитесь, что данный поставщик конфигурации был добавлен в ваш экземпляр Finance и отмечен как активный. Дополнительные сведения см. в [Создание поставщиков конфигураций и пометка их как активных](tasks/er-configuration-provider-mark-it-active-2016-11.md).
3. В рабочей области **Электронная отчетность** выберите плитку **Конфигурации отчетности**.
4. На странице **Конфигурации** импортируйте конфигурации электронной отчетности, загруженные в качестве необходимого компонента в Finance, в следующем порядке: модель данных, сопоставление моделей, формат. Для каждой конфигурации выполните следующие действия.

    1. На панели действий выберите пункт **Обмен** \> **Загрузить из XML-файла**.
    2. Выберите **Обзор** и выберите соответствующий файл для конфигурации электронной отчетности в формате XML.
    3. Нажмите **ОК**.

![Импортированные конфигурации на странице конфигураций.](./media/er-calculated-field-ds-performance-imported-configurations.png)

## <a name="review-the-sample-er-solution"></a>Проверка примера решения электронной отчетности

### <a name="review-the-model-mapping"></a>Просмотр сопоставления моделей

1. На странице **Конфигурации** в дереве конфигураций разверните **Модель улучшения производительности** и выберите **Сопоставление улучшения производительности**.
2. В области действий выберите **Конструктор**.
3. На странице **Сопоставление модели и источника данных** в области действий выберите **Конструктор**.

    Это сопоставление модели электронной отчетности предназначено для выполнения следующих действий:

    - Получите список проводок по поставщику, которые хранятся в таблице VendTrans (источник данных **Trans**).
    - Для каждой проводки выберите из таблицы VendTable запись поставщика, для которой была разнесена проводка (источник данных **\#Vend**).

    > [!NOTE]
    > Источник данных **\#Vend** настроен для получения соответствующей записи поставщика с помощью существующего отношения "многие к одному" **\@.'\>Relations'.VendTable\_AccountNum**.

    Сопоставление модели в этой конфигурации реализует базовую модель данных для любого из форматов электронной отчетности, созданных для этой модели и выполняемых в Finance. Таким образом, содержимое источника данных **Trans** предоставляется для форматов электронной отчетности, таких как абстрактные источники данных **модели**.

    ![Источник данных Trans на странице конструктора сопоставления модели.](media/er-calculated-field-ds-performance-mapping-1.png)

4. Закройте страницу **Конструктор сопоставления модели**.
5. Закройте страницу **Сопоставление модели и источника данных**.

### <a name="review-format"></a>Предварительный просмотр формата

1. На странице **Конфигурации** в дереве конфигураций разверните **Модель улучшения производительности** и выберите **Формат улучшения производительности**.
2. В области действий выберите **Конструктор**.
3. На странице **Конструктор формата** на вкладке **Сопоставление** выберите **Свернуть/Развернуть**.
4. Разверните элементы **Модель**, **Данные** и **Проводка**.

    Этот формат электронной отчетности предназначен для создания отчета о проводках по поставщику в формате XML.

    ![Источники данных формата и сконфигурированные привязки элементов форматирования на странице конструктора форматов.](media/er-calculated-field-ds-performance-format.png)

5. Закройте страницу **Конструктор форматов**.

## <a name="run-the-sample-er-solution-to-trace-execution"></a>Запуск примера решения электронной отчетности для трассировки выполнения

Представьте, что вы завершили разработку первой версии решения электронной отчетности. Теперь необходимо проверить решение в вашем экземпляре Finance и проанализировать производительность выполнения.

### <a name="turn-on-the-er-performance-trace"></a>Включение трассировки производительности электронной отчетности

1. Выберите компанию **DEMF**.
2. Следуйте указаниям в разделе [Включение трассировки производительности электронной отчетности](trace-execution-er-troubleshoot-perf.md#turn-on-the-er-performance-trace), чтобы создать трассировку производительности при выполнении формата электронной отчетности.

    ![Диалоговое окно параметров пользователя.](media/er-calculated-field-ds-performance-format-user-parameters.png)

### <a name="run-the-er-format"></a><a id="run-format"></a>Выполнение формата электронной отчетности

1. Перейдите в раздел **Администрирование организации** \> **Электронная отчетность** \> **Конфигурации**.
2. На странице **Конфигурации** в дереве конфигураций выберите пункт **Формат улучшения производительности**.
3. В области действий выберите **Выполнить**.

## <a name="use-the-performance-trace-to-analyze-model-mapping-performance"></a>Используйте трассировку производительности для анализа производительности сопоставления моделей

1. На странице **Конфигурации** в дереве конфигураций выберите пункт **Сопоставление улучшения производительности**.
2. В области действий выберите **Конструктор**.
3. На странице **Сопоставления модели** в области действий выберите **Конструктор**.
4. На странице **Конструктор сопоставления модели** в области действий выберите **Трассировка производительности**.
5. Выберите последнюю созданную трассировку, затем выберите **ОК**.

Новые сведения теперь доступны для некоторых элементов источника данных в текущем сопоставлении модели:

- Фактическое время, потраченное на получение данных с использованием источника данных
- То же время, выраженное в процентах от общего времени, затраченного на выполнение всего сопоставления модели

![Сведения о времени выполнения на странице конструктора сопоставления моделей.](./media/er-calculated-field-ds-performance-mapping-2.png)

Сетка **Статистика производительности** показывает, что источник данных **Trans** обращается к таблице VendTrans один раз. Значение **\[265\]\[Q:265\]** источника данных **Trans** указывает на то, что проводки по поставщику 265 были извлечены из таблицы приложения и возвращены в модель данных.

Сетка **Статистика производительности** также показывает, что сопоставление текущей модели дублирует запросы базы данных во время выполнения источника данных **\#Vend**. Это дублирование происходит по следующим причинам:

- Таблица поставщика вызывается два раза для каждой из 265 прошедших итерацию проводок по поставщику, что дает общее количество вызовов 530:

    - Один вызов выполняется для ввода номера счета поставщика.
    - Один вызов выполняется для ввода имени поставщика.

- Таблица поставщиков вызывается для каждой итерации проводки по поставщику, даже если выбранные проводки были разнесены только для пяти поставщиков. Из 530 вызовов 525 являются дубликатами. На следующем рисунке показано полученное сообщение о повторяющихся вызовах (запросах базы данных).

![Сообщение о дубликатах запросов базы данных на странице конструктора сопоставления модели.](./media/er-calculated-field-ds-performance-mapping-2a.png)

Общее время выполнения сопоставления модели (приблизительно восемь секунд); обратите внимание на то, что более 80 процентов (примерно шесть секунд) было потрачено на получение значений из таблицы приложений VendTable. Этот процент слишком велик для двух атрибутов пяти поставщиков, в сравнении с объемом информации из таблицы приложения VendTrans.

Для уменьшения числа вызовов, выполняемых для получения сведений о поставщике для каждой проводки, и для повышения производительности сопоставления моделей можно использовать кэширование для источника данных **\#Vend**.

> [!NOTE]
> Источник данных **Trans\\\#Vend** будет кэширован в области текущей проводки источника данных **Trans** во время выполнения.

При кэшировании источника данных **\#Vend** уменьшается число дубликатов вызовов с 525 до 260, но дублирование не устраняется полностью. Для полного устранения дублирования можно настроить новый параметризованный источник данных типа **Вычисляемое поле**.

## <a name="improve-the-model-mapping-based-on-information-from-the-execution-trace"></a>Улучшите сопоставление модели на основе информации из трассировки выполнения

### <a name="change-the-logic-of-the-model-mapping"></a>Изменение логики сопоставления модели

Выполните следующие действия, чтобы использовать кэширование и источник данных типа **Вычисляемое поле**, чтобы предотвратить дублирование вызовов к базе данных.

1. На странице **Конфигурации** в дереве конфигураций выберите пункт **Сопоставление улучшения производительности**.
2. В области действий выберите **Конструктор**.
3. На странице **Сопоставления модели** в области действий выберите **Конструктор**.
4. На странице **Конструктор сопоставления моделей** выполните следующие шаги, чтобы добавить источник данных типа **Записи таблицы** для доступа к записям в таблице приложения VendTable:

    1. В области **Типы источников данных** разверните **Dynamics 365 for Operations** и выберите **Записи таблицы**.
    2. Выберите **Добавить корень**.
    3. В диалоговом окне в поле **Имя** введите **Vend**.
    4. В поле **Таблица** введите **VendTable**.
    5. Нажмите **ОК**.

5. Можно параметризировать вызовы к источникам данных типа **Вычисляемое поле** только в том случае, если эти источники данных находятся в контейнере. Таким образом, необходимо выполнить следующие действия, чтобы добавить источник данных типа **Пустой контейнер** для хранения нового параметризованного источника данных типа **Вычисляемое поле**:

    1. В области **Типы источников данных** разверните **Общие** и выберите **Пустой контейнер**.
    2. Выберите **Добавить корень**.
    3. В диалоговом окне в поле **Имя** введите **Box**.
    3. Нажмите **ОК**.

    ![Источник данных Box на странице конструктора сопоставления модели.](./media/er-calculated-field-ds-performance-mapping-3.png)

6. Выполните следующие действия, чтобы добавить параметризованный источник данных типа **Вычисляемое поле**:

    1. В области **Источники данных** выберите **Box**.
    2. В области **Типы источников данных** раскройте **Функции** и выберите элемент **Вычисляемое поле**.
    3. Выберите **Добавить**.
    4. В диалоговом окне в поле **Имя** введите **Vend**.
    5. Выберите **Изменить формулу**.
    6. На странице **Конструктор формул** выберите **Параметры**, чтобы указать параметры, которые должны быть предоставлены при вызове этого источника данных.
    7. В диалоговом окне **Параметры** выберите **Создать**.
    8. В поле **Имя** введите **parmVendAccNumber**.
    9. В поле **Тип** выберите **String**.
    10. Нажмите **ОК**.
    11. В поле **Формула** введите **FIRSTORNULL(FILTER(Vend, Vend.AccountNum=parmVendAccNumber))**.
    12. Выберите **Сохранить**, затем закройте страницу **Конструктор формул**.
    13. Нажмите **ОК**, чтобы добавить новый источник данных.

7. Чтобы пометить добавленный источник данных как кэшируемый во время выполнения, необходимо выполнить следующие действия:

    1. В области **Источники данных** выберите **Box\\Vend**.
    2. Выберите **Кэш**.

    > [!NOTE]
    > Источник данных **Box\\Vend** будет кэширован в области всех проводок по поставщикам источника данных **Trans** во время выполнения.

8. Выполните следующие шаги для обновления вложенного источника данных **Trans\\\#Vend**, чтобы в нем использовался источник данных **Box\\Vend**:

    1. В области **Источники данных** разверните **Trans**.
    2. Выберите источник данных **Trans\\\#Vend**, затем выберите **Правка** \> **Изменить формулу**.
    3. На странице **Конструктор формул** в поле **Формула** введите **Box.Vend(\@.AccountNum)**.
    4. Выберите **Сохранить**, затем закройте страницу **Конструктор формул**.
    5. Выберите **ОК**, чтобы завершить изменения в выбранном источнике данных.

9. Нажмите **Сохранить**.

    ![Источник данных Vend на странице конструктора сопоставления модели.](./media/er-calculated-field-ds-performance-mapping-4.png)

10. Закройте страницу **Конструктор сопоставления модели**.
11. Закройте страницу **Сопоставления модели**.

### <a name="complete-the-modified-version-of-the-er-model-mapping"></a>Выполните измененную версию сопоставления модели ER

1. На странице **Конфигурации** на экспресс-вкладке **Версии** выберите версию **1.2** конфигурации **Сопоставление улучшения производительности**.
2. Выберите **Изменить статус** \> **Завершено**, затем выберите **ОК**.

## <a name="run-the-modified-er-solution-to-trace-execution"></a>Запуск измененного решения электронной отчетности для трассировки выполнения

Повторите шаги из раздела [Выполнение формата электронной отчетности](#run-format) выше в этой статье, чтобы создать новую трассировку производительности.

## <a name="use-the-performance-trace-to-analyze-adjustments-to-the-model-mapping"></a>Используйте трассировку производительности для анализа корректировок сопоставления моделей 

1. На странице **Конфигурации** в дереве конфигураций выберите пункт **Сопоставление улучшения производительности**.
2. В области действий выберите **Конструктор**.
3. На странице **Сопоставления модели** в области действий выберите **Конструктор**.
4. На странице **Конструктор сопоставления модели** в области действий выберите **Трассировка производительности**.
5. Выберите последнюю созданную трассировку, затем выберите **ОК**.

Обратите внимание, что изменения, внесенные в сопоставление модели, исключают повторяющиеся запросы к базе данных. Также уменьшилось число обращений к таблицам базы данных и источникам данных для данного сопоставления модели.

![Сведения о трассировке на странице 1 конструктора сопоставления модели.](./media/er-calculated-field-ds-performance-mapping-5.png)

Общее время выполнения сократилось примерно в 20 раз (с примерно 8 секунд до 400 миллисекунд). Поэтому производительность всего решения электронной отчетности улучшилась.

![Сведения о трассировке на странице 2 конструктора сопоставления модели.](./media/er-calculated-field-ds-performance-mapping-5a.png)

## <a name="appendix-1-download-the-components-of-the-sample-microsoft-er-solution"></a><a name="appendix1"></a>Приложение 1. Загрузка компонентов образца решения электронной отчетности Microsoft

Необходимо загрузить следующие файлы и сохранить их локально.

| Хранилище файлов                                        | Содержимое |
|---------------------------------------------|---------|
| Модель улучшения производительности.версия.1     | [Пример конфигурации модели данных электронной отчетности](https://download.microsoft.com/download/4/6/f/46f0f3fa-782b-414a-8f7b-b6c64a388661/Performance_improvement_model.version.1.xml) |
| Сопоставление улучшения производительности.версия.1.1 | [Пример конфигурации сопоставления модели электронной отчетности](https://download.microsoft.com/download/8/9/1/8913a763-afb8-4bf4-aaf1-95ad793ffc5a/Performance_improvement_mapping.version.1.1.xml) |
| Формат улучшения производительности.версия.1.1  | [Пример конфигурации формата электронной отчетности](https://download.microsoft.com/download/9/0/c/90c75963-bc78-4edc-9096-556bbe281f10/Performance_improvement_format.version.1.1.xml) |

## <a name="appendix-2-configure-the-er-framework"></a><a name="appendix2"></a>Приложение 2. Настройка платформы электронной отчетности

Прежде чем можно будет начать пользоваться платформой электронной отчетности с целью повышения производительности образца решения электронной отчетности Microsoft, необходимо настроить минимальный набор параметров электронной отчетности.

### <a name="configure-er-parameters"></a><a id="ConfigureParameters"></a>Настройка параметров ER

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Связанные ссылки** выберите **Параметры электронной отчетности**.
3. На странице **Параметры электронной отчетности** на вкладке **Общие сведения** задайте для параметра **Включить режим конструктора** значение **Да**.
4. На вкладке **Вложения** установите следующие параметры.

    - В поле **Конфигурации** выберите тип **Файл** для компании **DEMF**.
    - В полях **Архив заданий**, **Временная**, **Базовый** и **Другие** выберите тип **Файл**.

Дополнительные сведения о настройке параметров электронной отчетности см. в разделе [Настройка платформы электронной отчетности](electronic-reporting-er-configure-parameters.md).

### <a name="activate-an-er-configuration-provider"></a><a id="ActivateProvider"></a>Активация поставщика конфигураций электронной отчетности

Каждая добавленная конфигурация электронной отчетности помечается как принадлежащая поставщику конфигурации электронной отчетности. Для этой цели используется поставщик конфигурации электронной отчетности, который активирован в рабочей области **Электронная отчетность**. Поэтому перед началом добавления или изменения конфигураций электронной отчетности необходимо активировать поставщика конфигурации электронной отчетности в рабочей области **Электронная отчетность**.

> [!NOTE]
> Только владелец конфигурации электронной отчетности может редактировать конфигурацию. Поэтому перед редактированием конфигурации электронной отчетности необходимо активировать соответствующего поставщика конфигурации электронной отчетности в рабочей области **Электронная отчетность**.

#### <a name="review-the-list-of-er-configuration-providers"></a><a id="ReviewProvidersList"></a>Просмотр списка поставщиков конфигурации электронной отчетности

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Связанные ссылки** выберите **Поставщики конфигураций**.
3. На странице **Таблица поставщиков конфигураций** каждая запись поставщика имеет уникальное имя и URL-адрес. Проверьте содержимое данной страницы. Если запись для **Litware, Inc.** уже существует, пропустите следующую процедуру, [Добавление нового поставщика конфигурации электронной отчетности](#ActivateProvider).

#### <a name="add-a-new-er-configuration-provider"></a><a id="ActivateProvider"></a>Добавление нового поставщика конфигурации электронной отчетности

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Связанные ссылки** выберите **Поставщики конфигураций**.
3. На странице **Поставщики конфигураций** выберите **Создать**.
4. В поле **Имя** введите **Litware, Inc.**
5. В поле **Интернет-адрес** введите `https://www.litware.com`.
6. Нажмите **Сохранить**.

#### <a name="activate-an-er-configuration-provider"></a><a id="ActivateAddedProvider"></a>Активация поставщика конфигураций электронной отчетности

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Поставщики конфигураций** выберите плитку **Litware, Inc.**, затем выберите **Установить активные**.

Дополнительные сведения о поставщиках конфигурации электронной отчетности см. в разделе [Создание поставщиков конфигураций и пометка их как активных](tasks/er-configuration-provider-mark-it-active-2016-11.md).

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Обзор электронной отчетности](general-electronic-reporting.md)
- [Трассировка выполнения форматов электронной отчетности для устранения неполадок, связанных с производительностью](trace-execution-er-troubleshoot-perf.md)
- [Поддержка параметризованных вызовов источников данных электронной отчетности для типа вычисляемого поля](er-calculated-field-type.md)


[!INCLUDE[footer-include](../../../includes/footer-banner.md)]

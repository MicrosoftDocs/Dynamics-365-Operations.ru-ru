---
title: Создайте формат ER для создания отчета в формате Excel с внедренными изображениями в верхних и нижних колонтитулах страницы
description: В этой теме объясняется, как использовать электронную отчетность (ER) для создания деловых документов, содержащих изображения и фигуры, внедренные в верхние и нижние колонтитулы.
author: NickSelin
ms.date: 06/28/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: EROperationDesigner, ERParameters
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2021-06-01
ms.dyn365.ops.version: 10.0.21
ms.openlocfilehash: 1115be8c33eeaf16c1a533e63b31d87b0fc5f68d6469ff075428f72ac146b2f4
ms.sourcegitcommit: 42fe9790ddf0bdad911544deaa82123a396712fb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/05/2021
ms.locfileid: "6746643"
---
# <a name="design-an-er-format-to-generate-a-report-in-excel-format-with-embedded-images-in-page-headers-or-footers"></a>Создайте формат ER для создания отчета в формате Excel с внедренными изображениями в верхних и нижних колонтитулах страницы

[!include[banner](../includes/banner.md)]

В этой теме объясняется, как пользователь с ролью системного администратора или функционального консультанта по электронной отчетности может выполнять следующие задачи:

- Настройка параметров для платформы [электронной отчетности (ER)](general-electronic-reporting.md).
- Импортируйте [конфигурации](general-electronic-reporting.md#Configuration) ER, [предоставляемые](general-electronic-reporting.md#Provider) корпорацией Майкрософт и используемые для создания [накладных с произвольным текстом](../../../finance/accounts-receivable/create-free-text-invoice-new.md), на основе [шаблона](er-fillable-excel.md#excel-file-component) в формате Microsoft Excel.
- Создание [настраиваемой (производной)](general-electronic-reporting.md#building-a-format-selecting-another-format-as-a-base-customization) версии стандартной конфигурации формата ER, предоставляемой корпорацией Microsoft.
- Измените конфигурацию пользовательского формата ER таким образом, чтобы создать отчет по накладной с произвольным текстом, в нижнем колонтитуле которого имеется изображение логотипа компании.

Процедуры в этой теме могут быть выполнены в компании **USMF**. Написание кода не требуется. Перед началом необходимо загрузить и сохранить следующий файл.

| описание        | Имя файла |
|--------------------|-----------|
| Изображение логотипа компании | [Company logo.png](https://download.microsoft.com/download/8/2/e/82e6bd81-caac-4e9a-bfce-1392ce7c8616/Companylogo.png) |

## <a name="content"></a>Содержимое

- [Настройка юридического лица](#ConfigureLegalEntity)
- [Настройка платформы электронной отчетности](#ConfigureFramework)

    - [Настройка параметров ER](#ConfigureParameters)
    - [Активация поставщика конфигураций электронной отчетности](#ActivateProvider)

        - [Просмотр списка поставщиков конфигурации электронной отчетности](#ReviewProvidersList)
        - [Добавление нового поставщика конфигурации электронной отчетности](#AddProvider)
        - [Активация нового поставщика конфигураций электронной отчетности](#ActivateAddedProvider)

- [Импорт стандартных конфигураций формата электронной отчетности](#ImportERSolution1)

    - [Импорт стандартных конфигураций электронной отчетности](#ImportERFormat)
    - [Проверка импортированных конфигураций электронной отчетности](#ReviewImportedERSolution)

- [Печать накладной с произвольным текстом с использованием стандартного формата ER](#PrintInvoice1)

    - [Настроить управление печатью](#ConfigurePrintManagement1)
    - [Печать накладной с произвольным текстом](#ProcessInvoice1)

- [Настройка стандартного формата электронной отчетности](#CustomizeProvidedFormat)

    - [Создание пользовательского формата](#DeriveProvidedFormat)
    - [Изменение пользовательского формата](#ConfigureDerivedFormat)
    - [Пометка пользовательского формата как готового к запуску](#MarkFormatRunnable)

- [Печать накладной с произвольным текстом с использованием настраиваемого формата ER](#PrintInvoice2)

    - [Настроить управление печатью](#ConfigurePrintManagement2)
    - [Печать накладной с произвольным текстом](#ProcessInvoice2)

- [Дополнительные ресурсы](#References)

## <a name="configure-the-legal-entity"></a><a id="ConfigureLegalEntity"></a>Настройка юридического лица

1. Перейдите в раздел **Управление организацией** \> **Организации** \> **Юридические лица**.
2. На странице **Юридические лица** на экспресс-вкладке **Изображение логотипа компании отчета** выберите **Изменить**.
3. В диалоговом окне **Выбор файла изображения для отправки** выберите **Обзор** и найдите загруженный ранее файл **Company logo.png**.
4. Выберите **Сохранить**, затем закройте страницу **Юридические лица**.

![Изображение логотипа компании, выбранное на странице юридических лиц.](./media/er-embed-images-header-footer-excel-reports-company-logo-image.png)

## <a name="configure-the-er-framework"></a><a id="ConfigureFramework"></a>Настройка платформы электронной отчетности

В качестве пользователя в роли функционального консультанта по электронной отчетности вам необходимо настроить минимальный набор параметров ER, прежде чем можно будет начать использовать платформу электронной отчетности для создания пользовательской версии стандартного формата электронной отчетности.

### <a name="configure-er-parameters"></a><a id="ConfigureParameters"></a>Настройка параметров ER

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Связанные ссылки** выберите **Параметры электронной отчетности**.
3. На странице **Параметры электронной отчетности** на вкладке **Общие сведения** задайте для параметра **Включить режим конструктора** значение **Да**.
4. На вкладке **Вложения** установите следующие параметры.

    - В поле **Конфигурации** выберите тип **Файл** для компании **USMF**.
    - В полях **Архив заданий**, **Временная**, **Базовый** и **Другие** выберите тип **Файл**.

Дополнительные сведения о настройке параметров электронной отчетности см. в разделе [Настройка платформы электронной отчетности](electronic-reporting-er-configure-parameters.md).

### <a name="activate-an-er-configuration-provider"></a><a id="ActivateProvider"></a>Активация поставщика конфигураций электронной отчетности

Каждая добавленная конфигурация электронной отчетности помечается как принадлежащая поставщику конфигурации электронной отчетности. Для этой цели используется поставщик конфигурации электронной отчетности, который активирован в рабочей области **Электронная отчетность**. Поэтому перед началом добавления или изменения конфигураций электронной отчетности необходимо активировать поставщика конфигурации электронной отчетности в рабочей области **Электронная отчетность**.

> [!NOTE]
> Только владелец конфигурации может редактировать конфигурацию ER. Перед редактированием конфигурации электронной отчетности необходимо активировать соответствующего поставщика конфигурации электронной отчетности в рабочей области **Электронная отчетность**.

#### <a name="review-the-list-of-er-configuration-providers"></a><a id="ReviewProvidersList"></a>Просмотр списка поставщиков конфигурации электронной отчетности

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Связанные ссылки** выберите **Поставщики конфигураций**.
3. На странице **Таблица поставщиков конфигураций** каждая запись поставщика имеет уникальное имя и URL-адрес. Проверьте содержимое данной страницы. Если запись для **Litware, Inc.** (`https://www.litware.com`) уже существует, пропустите следующую процедуру, [Добавление нового поставщика конфигурации электронной отчетности](#AddProvider).

#### <a name="add-a-new-er-configuration-provider"></a><a id="AddProvider"></a>Добавление нового поставщика конфигурации электронной отчетности

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Связанные ссылки** выберите **Поставщики конфигураций**.
3. На странице **Поставщики конфигураций** выберите **Создать**.
4. В поле **Имя** введите **Litware, Inc.**
5. В поле **Интернет-адрес** введите `https://www.litware.com`.
6. Нажмите **Сохранить**.

#### <a name="activate-the-new-er-configuration-provider"></a><a id="ActivateAddedProvider"></a>Активация нового поставщика конфигураций электронной отчетности

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Поставщики конфигураций** выберите плитку **Litware, Inc.**, затем выберите **Установить активные**.

Дополнительные сведения о поставщиках конфигурации электронной отчетности см. в разделе [Создание поставщиков конфигураций и пометка их как активных](tasks/er-configuration-provider-mark-it-active-2016-11.md).

## <a name="import-the-standard-er-format-configurations"></a><a id="ImportERSolution1"></a>Импорт стандартных конфигураций формата электронной отчетности

### <a name="import-the-standard-er-configurations"></a><a id="ImportERFormat"></a>Импорт стандартных конфигураций электронной отчетности

Чтобы добавить стандартные конфигурации электронной отчетности в текущий экземпляр Dynamics 365 Finance, необходимо импортировать их из [репозитория](general-electronic-reporting.md#Repository) электронной отчетности, который был настроен для этого экземпляра.

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Поставщики конфигураций** выберите плитку **Майкрософт**, затем выберите **Репозитории**, чтобы просмотреть список репозиториев для поставщика **Майкрософт**.
3. На странице **Репозитории конфигураций** выберите репозиторий типа **Глобальный**, затем выберите **Открыть**. Если будет предложено выполнить проверку подлинности для подключения к службе [Regulatory Configuration Service](../../../finance/localizations/rcs-overview.md), следуйте инструкциям по проверке подлинности.
4. На странице **Репозиторий конфигураций** в дереве конфигураций на левой панели выберите конфигурацию формата **Накладная с произвольным текстом (Excel)**.
5. На экспресс-вкладке **Версии** выберите последнюю версию (например, **240.112**) выбранной конфигурации формата электронной отчетности.
6. Выберите **Импорт** для загрузки выбранной версии из глобального репозитория в текущий экземпляр Finance.

![Импорт стандартных конфигураций ER на странице "Репозиторий конфигураций".](./media/er-embed-images-header-footer-excel-reports-import-solution.png)

> [!TIP]
> При возникновении проблем с доступом к [глобальному репозиторию](er-download-configurations-global-repo.md) можно вместо этого [загрузить конфигурации](download-electronic-reporting-configuration-lcs.md) из служб Microsoft Dynamics Lifecycle Services (LCS).

### <a name="review-the-imported-er-configurations"></a><a id="ReviewImportedERSolution"></a>Проверка импортированных конфигураций электронной отчетности

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Конфигурации** выберите плитку **Конфигурации отчетности**.
3. На странице **Конфигурации** в дереве конфигураций на левой панели разверните **Модель накладной**.
4. В дополнение к выбранному формату электронной отчетности **Накладная с произвольным текстом (Excel)** были импортированы другие необходимые конфигурации электронной отчетности. Убедитесь, что в дереве конфигураций доступны следующие конфигурации электронной отчетности:

    - **Модель накладных** — эта конфигурация содержит компонент [модели данных](general-electronic-reporting.md#data-model-and-model-mapping-components) электронной отчетности, который представляет структуру данных бизнес-домена накладных.
    - **Сопоставление модели накладных** — эта конфигурация содержит компонент [сопоставления моделей](general-electronic-reporting.md#data-model-and-model-mapping-components) электронной отчетности, описывающий заполнение модели данных данными приложения во время выполнения.
    - **Накладная с произвольным текстом (Excel)** — эта конфигурация содержит [формат](general-electronic-reporting.md#FormatComponentOutbound) и компоненты ER сопоставления форматов. В компоненте формата указывается макет отчета, основанный на шаблоне в формате Excel. Компонент сопоставления формата содержит источник данных модели и определяет, как источник данных используется для заполнения макет отчета во время выполнения.

![Импортированные конфигурации ER на странице конфигурации.](./media/er-embed-images-header-footer-excel-reports-imported-solution.png)

## <a name="print-a-free-text-invoice-by-using-the-standard-er-format"></a><a id="PrintInvoice1"></a>Печать накладной с произвольным текстом с использованием стандартного формата ER

### <a name="set-up-print-management"></a><a id="ConfigurePrintManagement1"></a>Настроить управление печатью

1. Перейдите в раздел **Расчеты с клиентами** \> **Накладные** \> **Все накладные с произвольным текстом**.
2. На странице **Накладная с произвольным текстом** выберите накладную **FTI-00000002**, а затем на панели действий на вкладке **Накладная** в группе **Управление печатью** выберите **Управление печатью**.
3. На странице **Настройка управления печатью**, в дереве слева, разверните **Модуль — Расчеты с клиентами \> Документы \> Накладная с произвольным текстом**, а затем выберите элемент **Оригинал \<Default\>**.
4. В поле **Формат отчета** выберите **Накладная с произвольным текстом (Excel)**.
5. Нажмите клавишу **ESC**, чтобы закрыть страницу **Настройка управления печатью** и вернуться на страницу **Накладная с произвольным текстом**.

![Параметры управления печатью для накладной с произвольным текстом в стандартном формате ER на странице настройки управления печатью.](./media/er-embed-images-header-footer-excel-reports-print-management.png)

### <a name="print-a-free-text-invoice"></a><a id="ProcessInvoice1"></a>Печать накладной с произвольным текстом

1. На странице **Накладная с произвольным текстом** убедитесь, что накладная **FTI-00000002** все еще выбрана, а затем на панели действий на вкладке **Накладная** в группе **Документ**, выберите **Печать** \> **Выбрано**.
2. Загрузите созданную накладную в формате Excel и откройте ее для предварительного просмотра.
3. Обратите внимание, что в соответствии с структурой шаблона Excel для предоставленного формата ER нижний колонтитул созданной накладной содержит сведения о текущем номере страницы и общее число страниц в отчете.

![Созданная накладная с произвольным текстом.](./media/er-embed-images-header-footer-excel-reports-print-invoice1.gif)

## <a name="customize-the-standard-er-format"></a><a id="CustomizeProvidedFormat"></a>Настройка стандартного формата электронной отчетности

В этом разделе можно использовать конфигурации ER, предоставляемые корпорацией Майкрософт, для создания накладной с произвольным текстом в формате Excel. Однако необходимо добавить настройку для помещения изображения логотипа компании в нижний колонтитул созданных накладных.

В этом случае, как представитель Litware, Inc., необходимо создать (наследовать) новую конфигурацию формата электронной отчетности, основанную на конфигурации **Накладная с произвольным текстом (Excel)**, предоставляемую корпорацией Майкрософт.

### <a name="create-a-custom-format"></a><a id="DeriveProvidedFormat"></a>Создание пользовательского формата

1. Перейдите в раздел **Администрирование организации** \> **Электронная отчетность** \> **Конфигурации**.
2. На странице **Конфигурации** в дереве конфигураций на левой панели разверните **Модель накладной**, затем выберите **Накладная с произвольным текстом (Excel)**. Litware, Inc. будет использовать импортированную версию (например, **240.112**) в качестве основы для пользовательской версии.
3. Выберите **Создать конфигурацию**, чтобы открыть раскрывающееся диалоговое окно. Можно использовать диалоговое окно, чтобы создать новую конфигурацию для пользовательского формата платежей.
4. В группе полей **Создать** выберите параметр **Производное от имени: Накладная с произвольным текстом (Excel), Microsoft**.
5. В поле **Имя** введите **Настраиваемая накладная с произвольным текстом (Excel)**.
6. Выберите **Создать конфигурацию**.

![Создание конфигурации для настраиваемого формата платежа в диалоговом окне "Создание конфигурации".](./media/er-embed-images-header-footer-excel-reports-add-derived-format.png)

Создана версия 240.112.1 конфигурации формата ER **настраиваемой накладной с произвольным текстом (Excel)**. Эта версия имеет [статус](general-electronic-reporting.md#component-versioning) **Черновик** и может редактироваться. Текущее содержимое пользовательского формата электронной отчетности соответствует содержимому формата, предоставленного корпорацией Майкрософт.

![Создана новая версия конфигурации формата ER на странице конфигурации.](./media/er-embed-images-header-footer-excel-reports-derived-format-configuration1.png)

### <a name="edit-the-custom-format"></a><a id="ConfigureDerivedFormat"></a>Изменение пользовательского формата

Настройте пользовательский формат так, чтобы изображение логотипа компании поместилось в нижний колонтитул на каждой странице отчета.

1. Перейдите в раздел **Администрирование организации** \> **Электронная отчетность** \> **Конфигурации**.
2. На странице **Конфигурации** в дереве конфигураций на левой панели разверните **Модель платежа**, затем выберите **Настраиваемая накладная с произвольным текстом (Excel)**.
3. На экспресс-вкладке **Версии** выберите версию **240.112.1** выбранной конфигурации.
4. Выберите **Конструктор**.
5. На странице **Конструктор форматов** выберите **Показать сведения** для просмотра дополнительных сведений об элементах формата.
6. Разверните и изучите следующие элементы:

    - Элемент **Накладная с произвольным текстом** типа **Excel**. Этот элемент используется для создания накладной в формате книги Excel.
    - Элемент **Накладная с произвольным текстом \\ Накладная** типа **Лист**. Этот элемент используется для создания листа созданной книги Excel.
    - Элемент **Накладная с произвольным текстом \\ Накладная \\ Нижний колонтитул** типа **Нижний колонтитул**. Этот элемент используется для заполнения нижнего колонтитула накладной.

7. Выберите элемент **Накладная с произвольным текстом \\ Накладная \\ Нижний колонтитул**.

    ![Элемент нижнего колонтитула в конструкторе операций электронной отчетности.](./media/er-embed-images-header-footer-excel-reports-derived-format0.png)

    > [!NOTE]
    > Нижний колонтитул страницы созданной накладной содержит сведения о текущем номере страницы и общее число страниц в отчете. Как можно видеть, элемент **Накладная с произвольным текстом \\ Накладная \\ Нижний колонтитул** не содержит дочерних элементов. Таким образом, используемый шаблон Excel настроен для отображения подробных сведений о разбиении на страницы в центре нижнего колонтитула каждого отчета.

8. Выберите **Добавить**, затем выберите тип **Excel \\ Рисунок** для добавляемого элемента формата:

    1. В поле **Выравнивание** выберите **По правому краю**.
    2. В поле **Масштабировать по высоте** выберите **Относительно**.
    3. В поле **Масштаб в процентах** введите **70**.
    4. Нажмите **ОК**.

        > [!NOTE]
        > Элемент **Excel \\ Рисунок** используется для добавления изображения логотипа компании и выравнивания его по правому краю нижнего колонтитула.

    ![Свойства элемента "Рисунок" в диалоговом окне Свойства компонента.](./media/er-embed-images-header-footer-excel-reports-derived-format1.png)

9. В дереве структуры формата слева выберите только что добавленный элемент **Рисунок**, а затем на вкладке **Сопоставление** разверните источник данных **модели**.
10. Разверните **model.Payment** \> **model.InvoiceBase \> model.InvoiceBase.CompanyInfo**, а затем выберите поле источника данных **model.InvoiceBase.CompanyInfo.Logo**. Поле источника данных типа [Контейнер](er-formula-supported-data-types-composite.md#container) предоставляет изображение логотипа компании в виде мультимедийного содержимого.
11. Выберите **Связать**. Элемент формата **Рисунок** привязан к полю источника данных **model.InvoiceBase.CompanyInfo.Logo**. Таким образом, во время выполнения изображение логотипа компании будет помещено в нижний колонтитул созданных накладных.

    ![Элемент формата "Рисунок" привязан к полю источника данных model.InvoiceBase.CompanyInfo.Logo в конструкторе операций ER.](./media/er-embed-images-header-footer-excel-reports-derived-format2.png)

12. Выберите **Сохранить**, затем закройте страницу **Конструктор**.

### <a name="mark-the-custom-format-as-runnable"></a><a id="MarkFormatRunnable"></a>Пометка пользовательского формата как готового к запуску

Поскольку была создана первая версия пользовательского формата и она имеет статус **Черновик**, можно запустить формат для целей тестирования. Для выполнения отчета обработайте платеж поставщику с помощью метода платежа, который ссылается на пользовательский формат электронной отчетности. По умолчанию при вызове формата электронной отчетности из приложения [учитываются](general-electronic-reporting.md#component-versioning) только те версии, которые имеют статус **Завершено** и **Общие**. Это позволяет предотвратить использование в форматах электронной отчетности незаконченных макетов. Однако для выполнения тестов можно заставить приложение использовать версию формата электронной отчетности, имеющую статус **Черновик**. Таким образом, можно откорректировать текущую версию формата, если требуется внести изменения. Дополнительные сведения см. в разделе [Применимость](electronic-reporting-destinations.md#applicability).

Чтобы использовать черновую версию формата электронной отчетности, необходимо явно пометить формат электронной отчетности.

1. Перейдите в раздел **Администрирование организации** \> **Электронная отчетность** \> **Конфигурации**.
2. На странице **Конфигурации** в области действий на вкладке **Конфигурации** в группе **Дополнительные параметры** выберите **Параметры пользователя**.
3. В диалоговом окне **Параметры пользователя** установите для параметра **Параметры выполнения** значение **Да**, затем выберите **ОК**.
4. Выберите **Правка**, чтобы сделать текущую страницу редактируемой, затем в дереве конфигураций на левой панели выберите **Настраиваемая накладная с произвольным текстом (Excel)**.
5. Для параметра **Выполнить черновик** выберите значение **Да**.

![Пометка пользовательского формата как готового к запуску на странице конфигураций.](./media/er-embed-images-header-footer-excel-reports-derived-format-configuration2.png)

## <a name="print-a-free-text-invoice-by-using-the-custom-er-format"></a><a id="PrintInvoice2"></a>Печать накладной с произвольным текстом с использованием настраиваемого формата ER

### <a name="set-up-print-management"></a><a id="ConfigurePrintManagement2"></a>Настроить управление печатью

1. Перейдите в раздел **Расчеты с клиентами** \> **Накладные** \> **Все накладные с произвольным текстом**.
2. На странице **Накладная с произвольным текстом** выберите накладную **FTI-00000002**, а затем на панели действий на вкладке **Накладная** в группе **Управление печатью** выберите **Управление печатью**.
3. На странице **Настройка управления печатью**, в дереве слева, разверните **Модуль — Расчеты с клиентами** \> **Документы** \> **Накладная с произвольным текстом**, а затем выберите элемент **Оригинал** **\<Default\>**.
4. В поле **Формат отчета** выберите **Настраиваемая накладная с произвольным текстом (Excel)**.
5. Нажмите **ESC**, чтобы закрыть страницу **Настройка управления печатью** и вернуться на страницу **Накладная с произвольным текстом**.

### <a name="print-a-free-text-invoice"></a><a id="ProcessInvoice2"></a>Печать накладной с произвольным текстом

1. На странице **Накладная с произвольным текстом** убедитесь, что накладная **FTI-00000002** все еще выбрана, а затем на панели действий на вкладке **Накладная** в группе **Документ**, выберите **Печать** \> **Выбрано**.
2. Загрузите созданную накладную в формате Excel и откройте ее для предварительного просмотра.
3. Обратите внимание, что в соответствии со структурой пользовательского формата ER нижний колонтитул страницы созданной накладной содержит изображение логотипа компании в дополнение к сведениям о разбиении на страницы отчета.

![Созданная накладная с произвольным текстом с изображением логотипа компании в нижнем колонтитуле страницы.](./media/er-embed-images-header-footer-excel-reports-print-invoice2.gif)

## <a name="additional-resources"></a><a id="References"></a>Дополнительные ресурсы

- [Разработка конфигурации для создания документов в формате Excel](er-fillable-excel.md)
- [Внедрение изображений и фигур в документы, создаваемые с помощью электронной отчетности](electronic-reporting-embed-images-shapes.md)

---
title: Настройка источников данных поиска для использования параметров для приложения электронной отчетности
description: В этом разделе объясняется, как настроить форматы электронной отчетности (ER) для использования параметров для приложения электронной отчетности.
author: NickSelin
manager: AnnBe
ms.date: 04/02/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ERSolutionTable, EROperationDesigner, ERLookupDesigner, ERComponentLookupStructureEditing
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2019-01-01
ms.dyn365.ops.version: Release 8.1.3
ms.openlocfilehash: 542580c859759c25da84589ec82495eb72bbcbe5
ms.sourcegitcommit: 74f5b04b482b2ae023c728e0df0eb78305493c6a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2021
ms.locfileid: "5853529"
---
# <a name="configure-lookup-data-sources-to-use-er-application-specific-parameters"></a><span data-ttu-id="5198b-103">Настройка источников данных поиска для использования параметров для приложения электронной отчетности</span><span class="sxs-lookup"><span data-stu-id="5198b-103">Configure Lookup data sources to use ER application-specific parameters</span></span> 

[!include[banner](../includes/banner.md)]

<span data-ttu-id="5198b-104">Параметры, зависящие от приложения [электронной отчетности (ER)](general-electronic-reporting.md), позволяют вам настраивать фильтрацию данных в формате электронной отчетности, чтобы они основывались на наборе абстрактных правил.</span><span class="sxs-lookup"><span data-stu-id="5198b-104">The [Electronic reporting (ER)](general-electronic-reporting.md) application-specific parameters feature lets you configure data filtering in an ER format so that it's based on a set of abstract rules.</span></span> <span data-ttu-id="5198b-105">Этот набор правил может быть настроен для использования источника данных типа **Поиск**, доступного в формате электронной отчетности.</span><span class="sxs-lookup"><span data-stu-id="5198b-105">This set of rules can be configured to use the data source of the **Lookup** type that is available in an ER format.</span></span> <span data-ttu-id="5198b-106">Можно затем указать реальные правила помимо разработчиков компонентов электронной отчетности, используя пользовательский интерфейс, который автоматически создается на основе настроек источника данных **Поиск** соответствующего формата электронной отчетности и текущих данных юридического лица.</span><span class="sxs-lookup"><span data-stu-id="5198b-106">You can then specify real rules beyond the ER components designers by using the user interface (UI) that is automatically generated based on the settings of the **Lookup** data source of the corresponding ER format and the current legal entity data.</span></span> <span data-ttu-id="5198b-107">В конечном счете, указанные правила будут доступны из источника данных **Поиск** в формате электронной отчетности при выполнении этого формата электронной отчетности.</span><span class="sxs-lookup"><span data-stu-id="5198b-107">Eventually, the specified rules will be accessed by the ER format's **Lookup** data source when this ER format is executed.</span></span>

> [!NOTE]
> <span data-ttu-id="5198b-108">Используйте настроенные источники данных для редактируемого формата электронной отчетности, чтобы указать, какие данные приложения используются для настройки реальных правил.</span><span class="sxs-lookup"><span data-stu-id="5198b-108">Use the configured data sources of the editable ER format to specify what application data is used to configure real rules.</span></span>

<span data-ttu-id="5198b-109">Используйте [Конструктор операций электронной отчетности](general-electronic-reporting.md#building-a-format-that-uses-a-data-model-as-a-base) для перевода источника данных типа **поиска** в формат электронной отчетности.</span><span class="sxs-lookup"><span data-stu-id="5198b-109">Use the [ER Operations designer](general-electronic-reporting.md#building-a-format-that-uses-a-data-model-as-a-base) to bring a data source of the **Lookup** type in to your ER format.</span></span> <span data-ttu-id="5198b-110">Источник данных должен быть настроен для описания внешнего вида абстрактных правил, включая следующие:</span><span class="sxs-lookup"><span data-stu-id="5198b-110">The data source must be configured to describe how your abstract rules look, including the following:</span></span>

   - <span data-ttu-id="5198b-111">Набор параметров определенного типа данных, значение которого указывается для указания одного правила.</span><span class="sxs-lookup"><span data-stu-id="5198b-111">The parameter set of certain data type whose value is provided to specify a single rule.</span></span>
   - <span data-ttu-id="5198b-112">Тип значения определенного типа данных, возвращаемых одним правилом, когда это правило считается наиболее подходящим среди других правил.</span><span class="sxs-lookup"><span data-stu-id="5198b-112">The value type of certain data type that is returned by a single rule when this rule is considered the most appropriate among others.</span></span>

<span data-ttu-id="5198b-113">Можно настроить следующие типы источников данных **поиска** в зависимости от типа значения, возвращаемого любым настроенным правилом:</span><span class="sxs-lookup"><span data-stu-id="5198b-113">You can configure the following types of **Lookup** data sources depending on the type of value that is returned by any configured rule:</span></span>

   - <span data-ttu-id="5198b-114">Используйте тип **Модель данных\Поиск**, если необходимо вернуть значение перечисления модели.</span><span class="sxs-lookup"><span data-stu-id="5198b-114">Use the **Data model\Lookup** type when a model enumeration value must be returned.</span></span>
   - <span data-ttu-id="5198b-115">Используйте тип **Операции Dynamics 365\Поиск** при необходимости возврата значения перечисления приложения или значения [расширенного типа данных](../extensibility/extensible-edts.md) приложения.</span><span class="sxs-lookup"><span data-stu-id="5198b-115">Use the **Dynamics 365 Operations\Lookup** type when an application enumeration value or an application [extended data type](../extensibility/extensible-edts.md) value must be returned.</span></span>
   - <span data-ttu-id="5198b-116">Используйте тип **Перечисление форматов\Поиск**, если необходимо вернуть значение перечисления форматов.</span><span class="sxs-lookup"><span data-stu-id="5198b-116">Use the **Format enumeration\Lookup** type when a format enumeration value must be returned.</span></span>

<span data-ttu-id="5198b-117">На следующем рисунке показано, как можно настроить перечисление форматов в образце формата электронной отчетности.</span><span class="sxs-lookup"><span data-stu-id="5198b-117">The following illustration shows how a format enumeration can be configured in the sample ER format.</span></span>

   ![Отображение перечисления формата в качестве базы для настроенного источника данных поиска](./media/er-lookup-data-sources-img1.gif)

<span data-ttu-id="5198b-119">На следующем рисунке показаны компоненты формата, которые были настроены для составления отчета о других типах налогов в отдельном разделе созданного отчета.</span><span class="sxs-lookup"><span data-stu-id="5198b-119">The following illustration shows the format components that were configured to report different type of taxes in a different section of a generated report.</span></span>

   ![Отображение разделов формата для отдельных типов налогов в отчете](./media/er-lookup-data-sources-img2.png)

<span data-ttu-id="5198b-121">На следующем рисунке показано, как конструктор операций электронной отчетности позволяет добавить источник данных **Перечисление форматов\Поиск**.</span><span class="sxs-lookup"><span data-stu-id="5198b-121">The following illustration shows how the ER Operations designer allows the addition of a data source of the **Format enumeration\Lookup** type.</span></span>  <span data-ttu-id="5198b-122">Добавленный источник данных настраивается, возвращая значение перечисления форматов `List of taxation levels`.</span><span class="sxs-lookup"><span data-stu-id="5198b-122">The added data source is configured as returning a value of the `List of taxation levels` format enumeration.</span></span>

   ![Добавление источника данных электронной отчетности из типа "Перечисление форматов\Поиск"](./media/er-lookup-data-sources-img3.gif)

<span data-ttu-id="5198b-124">На следующем рисунке показано, как настроить источник данных для использования поля **кода** списка записей **Model.Data.Tax** источника данных **Модель** в качестве параметра, который должен быть указан для каждого настраиваемого правила.</span><span class="sxs-lookup"><span data-stu-id="5198b-124">The following illustration shows how the added data source is configured to use the **Code** field of the **Model.Data.Tax** record list of the **Model** data source as a parameter that must be specified for every configured rule.</span></span>

![Настройка параметров добавленного источника данных типа "Перечисление форматов\Поиск"](./media/er-lookup-data-sources-img4.gif)

<span data-ttu-id="5198b-126">Добавленный источник данных `Model.Data.Tax` настраивается для указания налогового кода для каждого настроенного правила путем доступа к записям таблицы приложения **TaxTable**.</span><span class="sxs-lookup"><span data-stu-id="5198b-126">The added `Model.Data.Tax` data source is configured to specify a tax code for every configured rule by accessing records of the **TaxTable** application table.</span></span>

   ![Проверка источника данных поиска для одной компании для "Перечисление форматов\Поиск"](./media/er-lookup-data-sources-img5.gif)

<span data-ttu-id="5198b-128">Можно настроить правила поиска для выбранного формата ER, используя пользовательский интерфейс, который автоматически выравнивается по структуре настроенного источника данных.</span><span class="sxs-lookup"><span data-stu-id="5198b-128">You can set up the lookup rules for the selected ER format by using the UI that is automatically aligned with the structure of the configured data source.</span></span> <span data-ttu-id="5198b-129">В настоящее время этот интерфейс пользователя требует, чтобы для каждого правила было указано возвращаемое значение в качестве значения перечисления формата `List of taxation levels`, а также налоговый код в качестве параметра.</span><span class="sxs-lookup"><span data-stu-id="5198b-129">Currently, this UI requires that for each rule, you specify the returned value as the `List of taxation levels` format enumeration value as well as the tax code as a parameter.</span></span>

   ![Настройка правил для настроенного источника данных](./media/er-lookup-data-sources-img6.gif)

<span data-ttu-id="5198b-131">На следующем рисунке показано, как можно настроить источник данных `Model.Data.Summary.LevelByLookup` для типа **Вычисляемое поле** для вызова настроенного источника данных **Поиск**, предоставляющих необходимые параметры.</span><span class="sxs-lookup"><span data-stu-id="5198b-131">The following illustration shows how the `Model.Data.Summary.LevelByLookup` data source of the **Calculated field** type can be configured to call the configured **Lookup** data source providing the required parameters.</span></span> <span data-ttu-id="5198b-132">Чтобы обработать этот вызов в среда выполнения, в списке настроенных правил в заданной последовательности будет обнаружено первое правило, удовлетворяющее заданным условиям.</span><span class="sxs-lookup"><span data-stu-id="5198b-132">To process this call at runtime, ER goes through the list of configured rules in the defined sequence to locate the first rule that satisfies the provided conditions.</span></span> <span data-ttu-id="5198b-133">В этом примере это правило, содержащее налоговый код, который соответствует указанному коду.</span><span class="sxs-lookup"><span data-stu-id="5198b-133">In this example, it's the rule that contains the tax code that matches the provided one.</span></span> <span data-ttu-id="5198b-134">В результате будет найдено наиболее подходящее правило, а для этого источника данных будет возвращено значение перечисления, настроенное для найденного правила.</span><span class="sxs-lookup"><span data-stu-id="5198b-134">As the result, the most appropriate rule is found and the enumeration value that is configured for the found rule is returned by this data source.</span></span>

> [!NOTE]
> <span data-ttu-id="5198b-135">Если применимое правило не найдено, создается исключение.</span><span class="sxs-lookup"><span data-stu-id="5198b-135">An exception is thrown when no applicable rule is found.</span></span> <span data-ttu-id="5198b-136">Чтобы не допустить подобных исключений, настройте дополнительные правила в конце списка правил, чтобы обрабатывать случаи, когда не задано ненастроенное значение или значение не указано.</span><span class="sxs-lookup"><span data-stu-id="5198b-136">To prevent these exceptions, configure additional rules at the end of the rules list to handle cases when a non-configured value or no value is provided.</span></span> <span data-ttu-id="5198b-137">Используйте параметры **\*Не пустой\*** и **\*Пустой\***, соответственно.</span><span class="sxs-lookup"><span data-stu-id="5198b-137">Use the **\*Not blank**\* and **\*Blank**\* options accordingly.</span></span>  
>
> ![Добавление источника данных для вызова настроенного источника данных "Поиск"](./media/er-lookup-data-sources-img7.png)

<span data-ttu-id="5198b-139">При установке для параметра **Межфирменный** значения **Да** для редактируемого источника данных поиска, вы добавляете новый обязательный параметр **Компания** к набору параметров этого источника данных.</span><span class="sxs-lookup"><span data-stu-id="5198b-139">When you set the **Cross-company** option to **Yes** for the editable lookup data source, you add a new required **Company** parameter to the set of parameters of this data source.</span></span> <span data-ttu-id="5198b-140">Значение параметра **компания** должно быть указано во время выполнения, когда был вызван источник данных поиска.</span><span class="sxs-lookup"><span data-stu-id="5198b-140">The value of the **Company** parameter must be specified at runtime when the lookup data source is called.</span></span> <span data-ttu-id="5198b-141">Когда код компании указывается во время выполнения, правила, настроенные для этой компании, используются для поиска наиболее подходящего правила, и возвращается соответствующее значение.</span><span class="sxs-lookup"><span data-stu-id="5198b-141">When the company code is specified at runtime, the rules configured for this company are used to find the most appropriate rule, and the corresponding value is returned.</span></span> <span data-ttu-id="5198b-142">На следующем рисунке показано, как это можно сделать и как изменяется набор параметров изменяемого источника данных.</span><span class="sxs-lookup"><span data-stu-id="5198b-142">The following illustration shows how you can do this and how the set of parameters of the editable data source is changed.</span></span>

   ![Проверка источника данных поиска между компаниями для типа "Перечисление форматов\Поиск"](./media/er-lookup-data-sources-img8.gif)

> [!NOTE]
> <span data-ttu-id="5198b-144">Выберите каждую компанию отдельно, чтобы настроить набор правил для этого источника данных поиска для редактируемого формата электронной отчетности.</span><span class="sxs-lookup"><span data-stu-id="5198b-144">Select every company seperately to configure the set of rules for this lookup data source of the editable ER format.</span></span> <span data-ttu-id="5198b-145">Исключение создается в среде выполнения, когда поиск между компаниями вызывается с кодом компании, для которой настройка поиска не была завершена.</span><span class="sxs-lookup"><span data-stu-id="5198b-145">An exception is thrown at runtime when the cross-company lookup is called with the code of the company for which the lookup setting was not completed.</span></span>
>
> <span data-ttu-id="5198b-146">Убедитесь, что вы предоставляете разрешения для пользователя, который запускает формат электронной отчетности с межфирменным источником данных **Поиск** для получения доступа к данным каждой компании, входящей в область действия этого источника данных.</span><span class="sxs-lookup"><span data-stu-id="5198b-146">Make sure that you grant permissions for a user who runs the ER format with the cross-company **Lookup** data source to access the data of every company that is in scope of this data source.</span></span> <span data-ttu-id="5198b-147">В противном случае исключение создается в среда выполнения.</span><span class="sxs-lookup"><span data-stu-id="5198b-147">Otherwise, an exception is thrown at runtime.</span></span>

<span data-ttu-id="5198b-148">Начиная с версии 10.0.19, доступны расширенные возможности источников данных **поиска**.</span><span class="sxs-lookup"><span data-stu-id="5198b-148">Starting in version 10.0.19, the extended capabilities of the **Lookup** data sources are available.</span></span> <span data-ttu-id="5198b-149">Когда вы устанавливаете для параметра **Расширенный** значение **Да** для редактируемого источника данных поиска, настроенный источник данных поиска преобразуется в структурированный источник данных, предоставляющий дополнительные возможности анализа настроенного набора правил.</span><span class="sxs-lookup"><span data-stu-id="5198b-149">When you set the **Extended** option to **Yes** for the editable lookup data source, the configured lookup data source is transformed to the structured data source that offers the additional capabilities to analyze the configured set of rules.</span></span> <span data-ttu-id="5198b-150">Следующая иллюстрация показывает это преобразование.</span><span class="sxs-lookup"><span data-stu-id="5198b-150">The following illustration shows this transformation.</span></span>

   ![Проверка структурированного источника данных поиска для "Перечисление форматов\Поиск"](./media/er-lookup-data-sources-img9.gif)

- <span data-ttu-id="5198b-152">Подэлемент **поиска** используется в качестве функции для поиска наиболее подходящего правила из набора настраиваемых правил на основе указанного набора параметров.</span><span class="sxs-lookup"><span data-stu-id="5198b-152">The **Lookup** sub-item is designed as a function to find the most appropriate rule from the set of configurable rules based on the provided set of parameters.</span></span>
- <span data-ttu-id="5198b-153">Подэлемент **IsLookupResultSet** используется в качестве функции для принятия предоставленного значения базового источника данных перечисления и возвращения *логического* значения **Истина**, если набор правил содержит по крайней мере одно правило, для которого указанное значение перечисления было настроено как возвращаемое значение.</span><span class="sxs-lookup"><span data-stu-id="5198b-153">The **IsLookupResultSet** sub-item is designed as a function to accept the provided value of the base enumeration data source and return the *Boolean* value of **True** when the set of rules contain at least one rule for which the provided enumeration value was configured as a returned value.</span></span> <span data-ttu-id="5198b-154">Эта функция возвращает *логическое* значение **Ложь**, если нет настроенных правил для возврата предоставленного значения перечисления.</span><span class="sxs-lookup"><span data-stu-id="5198b-154">This function returns the *Boolean* value of **False** when there are no rules configured to return the provided enumeration value.</span></span>
- <span data-ttu-id="5198b-155">Подэлемент **Настройка** предназначен в качестве функции, которая возвращает набор настроенных правил в виде записей списка записей.</span><span class="sxs-lookup"><span data-stu-id="5198b-155">The **Setting** sub-item is designed as a function that returns the set of configured rules as records of a record list.</span></span> <span data-ttu-id="5198b-156">Возвращаемые значения и набор параметров настроенных правил представлены в каждой возвращаемой записи в виде полей соответствующих типов данных:</span><span class="sxs-lookup"><span data-stu-id="5198b-156">The returned values and the set of parameters of the configured rules are presented in every returned record as fields of the relevant data types:</span></span>

    - <span data-ttu-id="5198b-157">Возвращаемое значение представляется в поле **Результат поиска**.</span><span class="sxs-lookup"><span data-stu-id="5198b-157">The returned value is presented as the **Lookup result** field.</span></span>
    - <span data-ttu-id="5198b-158">Настроенные параметры представляются в виде полей с именами параметров (поле **код** в этом примере).</span><span class="sxs-lookup"><span data-stu-id="5198b-158">The configured parameters are presented as fields having names of parameters (**Code** field in this example).</span></span>

<span data-ttu-id="5198b-159">Дополнительные сведения о настройке источника данных **поиска** см. в [Настройка формата электронной отчетности для использования параметров, указанных для юридического лица](er-app-specific-parameters-configure-format.md).</span><span class="sxs-lookup"><span data-stu-id="5198b-159">For more information about to how configure the **Lookup** data source, see [Configure ER formats to use parameters that are specified per legal entity](er-app-specific-parameters-configure-format.md).</span></span> <span data-ttu-id="5198b-160">Сведения о настройке правил поиска см. в разделе [Настройка параметров формата электронной отчетности для юридического лица](er-app-specific-parameters-set-up.md).</span><span class="sxs-lookup"><span data-stu-id="5198b-160">To learn how to set the Lookup rules, see [Set up the parameters of an ER format per legal entity](er-app-specific-parameters-set-up.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="5198b-161">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="5198b-161">Additional resources</span></span>

[<span data-ttu-id="5198b-162">Настройка форматов электронной отчетности для использования параметров, указанных для юридического лица</span><span class="sxs-lookup"><span data-stu-id="5198b-162">Configure ER formats to use parameters that are specified per legal entity</span></span>](er-app-specific-parameters-configure-format.md)

[<span data-ttu-id="5198b-163">Настройка параметров формата электронной отчетности для юридического лица</span><span class="sxs-lookup"><span data-stu-id="5198b-163">Set up the parameters of an ER format per legal entity</span></span>](er-app-specific-parameters-set-up.md)

---
title: Поддержка параметризованных вызовов моделей данных электронной отчетности
description: В этой статье объясняется, как реализовать параметризованные вызовы моделей данных электронной отчетности (ER).
author: kfend
ms.date: 03/14/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.search.region: Global
ms.author: filatovm
ms.search.validFrom: 2020-10-01
ms.dyn365.ops.version: 10.0.15
ms.custom: ''
ms.assetid: ''
ms.search.form: ERModelMappingDesigner, EROperationDesigner, ERExpressionDesignerFormula, ERDataModelDesigner
ms.openlocfilehash: 5be189c19d963991ec012de189bbf7b721b88fef
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/12/2022
ms.locfileid: "9275999"
---
# <a name="support-parameterized-calls-of-er-data-models"></a>Поддержка параметризованных вызовов моделей данных электронной отчетности

[!include [banner](../includes/banner.md)]

Для создания бизнес-документов необходимо настроить решение [электронной отчетности (ER)](general-electronic-reporting.md), которое содержит следующие компоненты электронной отчетности:

- **[Формат](er-overview-components.md#format-component)** — этот компонент определяет структуру бизнес-документа.
- **Сопоставление формата** — этот компонент управляет тем, как заполняется во время выполнения бизнес-документ.
- **[Сопоставление модели](er-overview-components.md#model-mapping-component)** — этот компонент определяет, какие данные извлекается из приложения в сопоставление формата.
- **[Модель данных](er-overview-components.md#data-model-component)** — этот компонент передает информацию между отдельными компонентами.

При запуске формата электронной отчетности запускается каждый элемент форматирования, начиная с корневого элемента формата. Когда элемент формата, который запускается, содержит привязку к [источнику данных](general-electronic-reporting.md#configuring-data-model-mappings-for-outgoing-documents), этот источник данных выполняется для доставки ожидаемых данных и использует из для заполнения элемента формата. При вызове источника данных типа *Модель* вызывается соответствующее сопоставление модели, чтобы извлечь данные из приложения на основе настроек сопоставления модели.

Ранее эти вызовы сопоставления модели не могли быть параметризованы, чтобы сделать их зависимыми от логики выполняемого формата. Поддерживался только следующий поток данных.

<table>
<tbody>
<tr align="center">
<td>
<b>Формат</b><br>
Элемент&nbsp;формата<br>
&nbsp;
</td>
<td>
<i>Привязка</i><br>
&gt;&nbsp;запрос&nbsp;&gt;<br>
&lt;&nbsp;значение&nbsp;&lt;
</td>
<td><b>Сопоставление&nbsp;формата</b><br>
Источник данных<br>
&nbsp;
</td>
<td>
<i>Модель&nbsp;данных</i><br>
&gt;&nbsp;запрос&nbsp;&gt;<br>
&lt;&nbsp;значение&nbsp;&lt;
</td>
<td>
<b>Сопоставление&nbsp;модели</b><br>
Источник&nbsp;данных<br>
&nbsp;
</td>
<td>
<i>Привязка</i><br>
&gt;&nbsp;запрос&nbsp;&gt;<br>
&lt;&nbsp;значение&nbsp;&lt;
</td>
<td>
<b>Таблица</b><br>
Запись<br>
Поле
</td>
</tr>
</tbody>
</table>

Однако в версии 10.0.15 или более поздней можно настроить поля модели данных, которые могут быть вызваны только в том случае, если предоставлены значения настроенных параметров. Когда такое поле настраивается и вызывается из компонента формата, необходимые параметры должны быть указаны в привязке формата в качестве аргументов вызова. В этих случаях значения аргументов могут быть указаны на основе значений, зависящих от формата. Таким образом, можно использовать **динамическую параметризацию в среде выполнения** для вызовов модели данных для поддержки следующего потока данных.

<table>
<tbody>
<tr align="center">
<td>
<b>Формат</b><br>
Элемент&nbsp;формата&nbsp;1<br>
<br>
Элемент&nbsp;формата&nbsp;2<br>
&nbsp;<br>
&nbsp;
</td>
<td>
<i>Привязка</i><br>
&gt;&nbsp;запрос&nbsp;1&nbsp;&gt;<br>
&lt;&nbsp;значение&nbsp;1&nbsp;&lt;<br>
&gt;&nbsp;запрос&nbsp;2&nbsp;&gt;<br>
&lt;&nbsp;значение&nbsp;3&nbsp;&lt;<br>
&nbsp;
</td>
<td>
<b>Сопоставление&nbsp;формата</b><br>
Источник&nbsp;данных&nbsp;1<br>
&nbsp;<br>
<b>value2=Func(value1)</b><br>
&nbsp;<br>
&nbsp;
</td>
<td>
<i>Модель&nbsp;данных</i><br>
&gt;&nbsp;field1&nbsp;&gt;<br>
&lt;&nbsp;значение&nbsp;1&nbsp;&lt;<br>
<b>&gt;&nbsp;field2(value2)&nbsp;&gt;</b><br>
&lt;&nbsp;значение&nbsp;3&nbsp;&lt;<br>
&nbsp;
</td>
<td>
<b>Сопоставление&nbsp;модели</b><br>
Источник&nbsp;данных&nbsp;1<br>
<br>
Источник&nbsp;данных&nbsp;2<br>
&nbsp;<br>
&nbsp;
</td>
<td>
<i>Привязка</i><br>
&gt;&nbsp;запрос&nbsp;1&nbsp;&gt;<br>
&lt;&nbsp;значение&nbsp;1&nbsp;&lt;<br>
&gt;&nbsp;запрос&nbsp;2&nbsp;&gt;<br>
&lt;&nbsp;значение&nbsp;3&nbsp;&lt;<br>
&nbsp;
</td>
<td>
<b>Таблица&nbsp;1</b><br>
Запись&nbsp;1<br>
Поле&nbsp;1<br>
<b>Таблица&nbsp;2</b><br>
Запись&nbsp;2<br>
Поле&nbsp;2
</td>
</tr>
</tbody>
</table>

Новая функциональная возможность позволяет параметризовать вызов любого поля модели данных типа [*Запись*](er-formula-supported-data-types-composite.md#record) или [*Список записей*](er-formula-supported-data-types-composite.md#record-list). Для параметров поля модели данных поддерживаются следующие типы данных:

- [Логический](er-formula-supported-data-types-primitive.md#boolean)
- [Тара](er-formula-supported-data-types-composite.md#container)
- [Дата](er-formula-supported-data-types-primitive.md#date)
- [DateTime](er-formula-supported-data-types-primitive.md#datetime)
- [GUID](er-formula-supported-data-types-primitive.md#guid)
- [Int64](er-formula-supported-data-types-primitive.md#int64)
- [Целое число](er-formula-supported-data-types-primitive.md#integer)
- [Действующий](er-formula-supported-data-types-primitive.md#real)
- [Строка](er-formula-supported-data-types-primitive.md#string)

Можно указать каждый параметр поля модели данных, для которого аргумент может быть представлен в виде одного значения определенного типа данных и [*списка*](er-formula-supported-data-types-composite.md#record-list) таких значений.

> [!NOTE]
> Значение по умолчанию для параметра поля модели данных не поддерживается. Если добавить параметр в поле в модели данных и версия этой модели данных уже была выпущена и опубликована, необходимо [перебазировать](general-electronic-reporting.md#upgrading-a-format-selecting-a-new-version-of-base-format-rebase) все соответствующие сопоставления модели и форматы на новую версию этой модели, поскольку изменение этой модели данных не имеет обратной совместимости.

Можно настроить параметризованные поля модели данных, чтобы сделать вызовы сопоставления моделей зависящими от формата. Этот подход может помочь уменьшить число сопоставлений модели, которые должны быть настроены для многих форматов одной модели данных. Этот подход можно также использовать для улучшения производительности выполнения форматов и сокращения времени, необходимого для создания бизнес-документов. Чтобы получить дополнительные сведения об этой функции, выполните пример в этой статье.

## <a name="example-use-parameterized-calls-of-er-data-models"></a>Пример: использование параметризованных вызовов моделей данных электронной отчетности

Следующие шаги описывают, как пользователь в роли системного администратора или разработчика электронной отчетности может разработать решение электронной отчетности, содержащее модель данных, сопоставление модели и компонент формата электронной отчетности, которые настроены для вызова сопоставления модели из формата путем указания аргумента для вызова, значение которого было рассчитано во время выполнения, используя формулу выполняемого формата. 

Эти шаги можно выполнить в компании **DEMF**. Изменения кода не требуются. 

В этом примере вам предстоит создать необходимые [конфигурации](general-electronic-reporting.md#Configuration) ER для демонстрационной компании **Litware, Inc.** Убедитесь, что поставщик конфигурации для демонстрационной компании **Litware, Inc.** (`http://www.litware.com`) указан для платформы электронной отчетности, который помечен как **Активный**. Если этого поставщика конфигурации нет в списке или он не помечен как **Активный**, следуйте указаниям в теме [Создание поставщика конфигурации и пометка его как активного](tasks/er-configuration-provider-mark-it-active-2016-11.md).

### <a name="business-scenario"></a>Бизнес-сценарий

Имеется решение электронной отчетности, которое содержит формат, который можно использовать для создания электронного документа для целей аудита. Этот формат содержит налоговые проводки, которые относятся к заказам на продажу и заказам на покупку и имеют необходимые сведения, например, дату проводки и сумму налога. В новом финансовом году структура этого документа изменилась. Теперь необходимо предоставить расширенный документ, содержащий дополнительные сведения (имена) всех сторон (клиенты и поставщики), чьи проводки представлены в созданных отчетах. Поэтому необходимо изменить решение электронной отчетности таким образом, чтобы оно создавало документы, которые соответствуют этому новому требованию.

### <a name="configure-the-er-framework"></a>Настройка платформы электронной отчетности

Выполните шаги из раздела [Настройка платформы электронной отчетности](er-quick-start2-customize-report.md#ConfigureFramework), чтобы настроить минимальный набор параметров электронной отчетности. Необходимо завершить эту настройку до начала использования платформы электронной отчетности для разработки нового решения электронной отчетности.

### <a name="design-a-domain-specific-data-model"></a>Проектирование модели данных для конкретного домена

Необходимо создать новую конфигурацию электронной отчетности, которая содержит требуемый компонент модели данных. Эта модель данных позднее будет использоваться в качестве источника данных при разработке формата электронной отчетности для создания отчета аудита.

Выполните следующие действия, чтобы импортировать необходимую модель данных из XML-файла, предоставляемого корпорацией Microsoft.

1. Загрузите файл [Sample audit model.version.1.xml](https://download.microsoft.com/download/7/1/9/719b0132-fed7-4c73-8afa-90cac29c2fee/Sample-audit-model.version.1.xml) и сохраните его на локальном компьютере.
2. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
3. В рабочей области **Электронная отчетность** выберите **Конфигурации отчетности**.
4. На странице **Конфигурации** на панели действий выберите **Exchange** \> **Загрузить из XML-файла**.
5. Выберите **Обзор**, затем найдите и выберите файл **Sample audit model.version.1.xml**.
6. Выберите **ОК**, чтобы импортировать конфигурацию.

    ![Импортированная конфигурация модели данных электронной отчетности на странице конфигураций.](./media/er-data-model-parameterized-calls-imported-model.png)

На следующем рисунке показана редактируемая версия настроенной модели данных на странице **Конструктор моделей данных**.

![Структура модели данных электронной отчетности на странице конструктора моделей данных.](./media/er-data-model-parameterized-calls-model1.png)

В настоящее время модель предназначена для предоставления только тех налоговых проводок, которые имеют необходимые сведения.

### <a name="design-a-model-mapping-for-the-configured-data-model"></a>Разработка сопоставления модели для настроенной модели данных

В качестве пользователя в роли разработчика электронной отчетности необходимо создать новую конфигурацию электронной отчетности, которая содержит компонент сопоставления модели для примера модели данных аудита. Этот компонент реализует настроенную модель данных для Microsoft Dynamics 365 Finance и предназначен для этого приложения. Необходимо настроить компонент "сопоставление моделей", чтобы указать объекты приложения, которые должны использоваться для заполнения настроенной модели данных данными приложения в среда выполнения. Чтобы выполнить эту задачу, необходимо понимать, как структура данных в бизнес-домене налогов реализована в Finance.

Выполните следующие действия, чтобы импортировать необходимое сопоставление модели из XML-файла, предоставляемого корпорацией Microsoft.

1. Загрузите файл [Sample audit model mapping.version.1.1.xml](https://download.microsoft.com/download/c/0/3/c03a4673-b1b1-4ef8-96d0-bf96518be6e0/Sample-audit-model-mapping.version.1.1.xml) и сохраните его на локальном компьютере.
2. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
3. В рабочей области **Электронная отчетность** выберите **Конфигурации отчетности**.
4. На странице **Конфигурации** на панели действий выберите **Exchange** \> **Загрузить из XML-файла**.
5. Выберите **Обзор**, затем найдите и выберите файл **Sample audit model mapping.version.1.1.xml**.
6. Выберите **ОК**, чтобы импортировать конфигурацию.

    ![Импортированная конфигурация сопоставления модели электронной отчетности на странице конфигураций.](./media/er-data-model-parameterized-calls-imported-mapping.png)

На следующем рисунке показана доступная для редактирования версия настроенного сопоставления модели на странице **Конструктор сопоставления моделей**.

![Структура сопоставления модели электронной отчетности на странице конструктора сопоставления моделей.](./media/er-data-model-parameterized-calls-mapping1.png)

В настоящее время сопоставление модели предназначено для предоставления налоговых проводок, которые имеют необходимые сведения. Оно извлекает эту информацию из таблицы приложения `TaxTrans`, используя настроенные источники данных электронной отчетности `TaxTrans` и `TaxTransFiltered`.

### <a name="design-a-new-format"></a>Разработка нового формата

В качестве пользователя в роли функционального консультанта по электронной отчетности необходимо создать новую конфигурацию ER, которая содержит компонент формата. Необходимо настроить компонент формата для заполнения созданных отчетов налоговыми проводками, имеющими все необходимые сведения.

Выполните следующие действия, чтобы импортировать необходимый формат из XML-файла, предоставляемого корпорацией Microsoft.

1. Загрузите файл [Sample audit format.version.1.1.xml](https://download.microsoft.com/download/e/b/7/eb7e126e-2bb3-4bbb-a735-ffd4c48920b1/Sample-audit-format.version.1.1.xml) и сохраните его на локальном компьютере.
2. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
3. В рабочей области **Электронная отчетность** выберите **Конфигурации отчетности**.
4. На странице **Конфигурации** на панели действий выберите **Exchange** \> **Загрузить из XML-файла**.
5. Выберите **Обзор**, затем найдите и выберите файл **Sample audit format.version.1.1.xml**.
6. Выберите **ОК**, чтобы импортировать конфигурацию.

    ![Импортированная конфигурация формата электронной отчетности на странице конфигураций.](./media/er-data-model-parameterized-calls-imported-format.png)

На следующем рисунке показана доступная для редактирования версия настроенного формата на странице **Конструктор формата**.

![Структура формата электронной отчетности на странице конструктора форматов.](./media/er-data-model-parameterized-calls-format1.png)

Формат электронной отчетности настраивается на формирование отчета в виде текстового файла в формате значений с разделителями-запятыми (CSV).

### <a name="run-the-imported-format"></a>Запуск импортированного формата

1. На странице **Конфигурации** выберите конфигурацию **Образец формата аудита**, а затем на панели операций выберите **Выполнить**.
2. В диалоговом окне **Параметры электронного отчета** на вкладке **Включаемые записи** выберите **Фильтр**.
3. Укажите условия для выбора налоговых проводок ваучеров **PIV-110000004** и **INV-10000001**.
4. Нажмите **ОК**.
5. Нажмите **ОК**.
6. Просмотрите созданный документ, содержащий налоговые проводки по выбранным ваучерам.

    ![Предварительный просмотр созданного документа с налоговыми проводками.](./media/er-data-model-parameterized-calls-output1.png)

### <a name="adjust-the-imported-er-solution"></a>Настройка импортированного решения электронной отчетности

В соответствии с новым требованием документ, который необходимо отправить, должен содержать имена клиентов и поставщиков, чьи проводки включены. Поэтому необходимо изменить импортированное решение электронной отчетности таким образом, чтобы оно создавало документ, который соответствует этому новому требованию.

Определите, как необходимо реализовать необходимые изменения импортированных компонентов электронной отчетности.

Очевидным подходом является реализация следующих модификаций:

- В модели данных добавьте новое поле модели данных `Transaction.Party.Name` типа *Строка*.
- В сопоставлении модели настройте привязку для нового поля модели данных, используя доступные табличные отношения для получения доступа к соответствующей записи таблицы приложения `DirPartyTable` и выберите из нее значение поля `Name`.

Хотя данный подход будет работать, это может привести к проблемам с производительностью в базе данных SQL, так как `TaxTrans` — это таблица транзакций, и поэтому она может содержать большой объем записей. В этом случае число вызовов `DirPartyTable` должно равняться количеству записей в таблице `TaxTrans`, что может привести к проблемам с производительностью.

Можно также реализовать следующие модификации:

- В модели данных добавьте новый корень `Party` и новое поле `Party.Name`.
- В сопоставлении модели добавьте новый источник данных, который будет соединять все записи таблиц, которые используются в отношениях таблиц для доступа к соответствующей записи таблицы приложения `DirPartyTable`, начиная с таблицы `TaxTrans`.

Хотя данный подход будет работать, это может привести к некоторым проблемам потребления памяти. Даже если новый источник данных [JOIN](er-join-data-sources.md) запускается в качестве одного запроса SQL к базе данных приложения, чтобы исключить проблемы производительности базы данных, результат должен быть выбран в память сервера приложений. Так как количество записей и число полей в этих записях будут довольно большими, этот подход может привести к значительному потреблению памяти. Может быть даже создано исключение нехватки памяти во время выполнения.

Можно реализовать изменения, когда выполняемый формат собирает в памяти уникальные коды идентификации клиентов и поставщиков для всех налоговых проводок, которые будут представлены в созданном отчете. Поскольку следует хранить только уникальные коды, окончательный набор кодов не будет иметь достаточного размера, чтобы повлиять на потребление памяти. После этого набор кодов будет передан в сопоставление модели в качестве аргумента другого вызова источника данных типа *Модель*. На основе этого вызова сопоставление модели запускает новый источник данных электронной отчетности, который создает один запрос SQL к базе данных приложения для выборки из таблицы `DirPartyTable` записей только для тех сторон, чьи коды представлены в предоставленном наборе кодов.

### <a name="adjust-the-imported-data-model"></a>Настройка импортированной модели данных

1. Перейдите в раздел **Администрирование организации** \> **Электронная отчетность** \> **Конфигурации**.
2. На странице **Конфигурации** в дереве конфигураций на левой панели выберите **Пример модели аудита**.
3. На экспресс-вкладке **Версии** выберите версию **2** со статусом **Черновик**.
4. Выберите экспресс-вкладку **Компоненты конфигурации**.
5. Выберите **Конструктор**, чтобы открыть модель данных для редактирования.
6. На странице **Модель данных** убедитесь, что выбрано поле `Root`, затем выберите **Создать**.
7. В раскрывающемся диалоговом окне выполните следующие действия:

    1. В группе полей **Новый узел как** выберите параметр **Дочерний элемент активного узла**.
    2. В поле **Имя** введите **Сторона**.
    3. В поле **Тип элемента** выберите **Список записей**.
    4. Нажмите **Добавить**, чтобы завершить добавление нового поля.

8. Убедитесь, что выбрано поле `Root.Party`, затем на вкладке **Узел** выберите **Параметры**.
9. В диалоговом окне **Параметры** выполните следующие действия:

    1. На вкладке **Параметры** выберите **Создать**.
    2. В поле **Имя** введите **PartyRefRecId**.
    3. В поле **Тип** выберите **Int64**.
    4. Выберите флажок **Список**.
    5. Нажмите кнопку **ОК**, чтобы завершить ввод параметров.

    > [!NOTE]
    > Поле модели данных `Root.Party` было только что настроено как поле, вызываемое, когда в параметре **PartyRefRecId** указано значение. Это значение должно присутствовать в списке записей, которые содержат поле `Value` типа данных *Int64*.

    ![Диалоговое окно параметров.](./media/er-data-model-parameterized-calls-model2a.png)

10. Убедитесь, что поле `Root.Party` все еще выбрано, затем выберите **Создать**.
11. В раскрывающемся диалоговом окне выполните следующие действия:

    1. В группе полей **Новый узел как** выберите параметр **Дочерний элемент активного узла**.
    2. В поле **Имя** введите **Имя**.
    3. В поле **Тип элемента** выберите **Строка**.
    4. Нажмите **Добавить**, чтобы завершить добавление нового поля.

12. Выберите **Сохранить**, затем закройте страницу **Модель данных**.

    ![Структура настроенной модели данных электронной отчетности на странице конструктора моделей данных.](./media/er-data-model-parameterized-calls-model2b.png)

13. На экспресс-вкладке **Версии** для версии **2** выберите **Изменить статус** \> **Завершено**. Затем выберите **OK**.

    > [!NOTE]
    > Изменения модели данных хранятся во второй версии компонента модели данных **Пример модели аудита**, который находится во второй версии конфигурации электронной отчетности **Пример модели аудита**.

![Обновленная конфигурация модели данных электронной отчетности на странице конфигураций.](./media/er-data-model-parameterized-calls-updated-model.png)

### <a name="adjust-the-imported-model-mapping"></a>Настройка импортированного сопоставления модели

1. На странице **Конфигурации** в дереве конфигураций на левой панели разверните **Пример модели аудита**.
2. Выберите **Пример сопоставления модели аудита**, а затем на экспресс-вкладке **Версии** выберите вторую версию сопоставления, основанную на первой версии модели данных (версия **1.2**), которая имеет статус **Черновик**.
3. Выберите **Повторно разместить**.
4. В поле **Целевая версия** оставьте версию **2** базовой модели **Пример модели аудита**.
5. Нажмите кнопку **ОК**, чтобы изменить базу модели и согласовать сопоставление модели с последними изменениями модели данных.

    Обратите внимание, что номер версии доступного для редактирования сопоставления модели изменился с **1.2** на **2.2**, указывая на то, что в данный момент в качестве базы используется вторая версия модели.

6. Выберите **Конструктор**.
7. На странице **Сопоставление модели и источника данных** выберите **Конструктор** для текущего сопоставления модели.
8. Выполните следующие действия, чтобы добавить новый источник данных для доступа к таблице приложения `DirPartyTable`:

    1. В области **Тип источника данных** выберите **Dynamics 365 for Operations \> Записи таблицы**.
    2. В области **источники данных** выберите **Добавить корень**.
    3. В поле **Имя** введите **PartyTable**.
    4. В поле **Таблица** введите **DirPartyTable**.
    5. Нажмите **ОК**, чтобы завершить добавление нового источника данных.

9. Выполните следующие действия, чтобы добавить новый источник данных для запроса записей `DirPartyTable` на основе предоставленного списка кодов идентификации записей:

    1. В области **Тип источника данных** выберите **Общие \> Пустой контейнер**.
    2. В области **источники данных** выберите **Добавить корень**.
    3. В поле **Имя** введите **Данные**.
    4. Нажмите **ОК**, чтобы завершить добавление нового источника данных.
    5. В области **Источники данных** выберите источник данных **Данные**.
    6. В области **Тип источника данных** выберите **Функции \> Вычисляемое поле**.
    7. В области **Источники данных** выберите **Добавить**.
    8. В поле **Имя** введите **DirParty**.
    9. Выберите **Изменить формулу**.
    10. На странице **Конструктор формул** выберите **Параметры**.
    11. В диалоговом окне **Параметры** выполните следующие действия:

        1. На вкладке **Параметры** выберите **Создать**.
        2. В поле **Имя** введите **DirPartyId**.
        3. В поле **Тип** выберите **Int64**.
        4. Выберите флажок **Список**.
        5. Нажмите **ОК**.

        > [!NOTE]
        > Вы только что настроили это вычисляемое таким образом, что оно будет принимать во время выполнения аргумент одного параметра, настроенного как список записей, который имеет единственное поле `Value` типа *Int64*.

    12. В поле **Формула** введите следующее выражение:

        `FILTER(PartyTable, VALUEINLARGE(PartyTable.RecId, DirPartyId, DirPartyId.Value))`

        > [!NOTE]
        > Вы только что настроили вычисляемое поле `DirParty` для выборки только тех записей `DirPartyTable`, в которые коды идентификации записей включены в список `DirPartyId`, указанный в качестве аргумента при вызове поля `DirParty`.

        ![Формула для выборки имен субъектов из таблицы приложения на странице конструктора формул.](./media/er-data-model-parameterized-calls-formula1.png)

    13. Выберите **Сохранить**, затем закройте страницу **Конструктор формул**.
    14. Выберите **Сохранить**, затем нажмите кнопку **ОК**, чтобы завершить добавление нового источника данных.

10. Выполните следующие действия, чтобы связать новый источник данных с новым полем модели данных, чтобы модель данных использовалась для предоставления имен субъектов:

    1. На панели **Модель данных** выберите поле модели данных `Root.Party`.
    2. В области **Модель данных** выберите **Изменить**.
    3. На странице **Конструктор формул** в поле **Формула** введите выражение `Data.DirParty(PartyRefRecId)`.
    4. Выберите **Сохранить**, затем закройте страницу **Конструктор формул**.

        > [!NOTE]
        > Вы только что настроили привязку для вызова настроенного источника данных `Data.DirParty` и предоставления списка кодов идентификации записей, которые будут задаваться в формате при вызове поля модели данных `Root.Party`.

    5. На панели **Модель данных** выберите поле модели данных `Root.Party.Name`.
    6. В области **Модель данных** выберите **Изменить**.
    7. На странице **Конструктор формул** в области **Источник данных** разверните **Данные \> DirParty** и выберите **Имя**.
    8. Выберите **Добавить источник данных**.
    9. Выберите **Сохранить**, затем закройте страницу **Конструктор формул**.

    ![Структура настроенного сопоставления модели электронной отчетности на странице конструктора сопоставления моделей.](./media/er-data-model-parameterized-calls-mapping2.png)

11. Выберите **Сохранить** и закройте страницу **Конструктор сопоставления модели**.
12. Закройте страницу **Сопоставление модели и источника данных**.
13. На экспресс-вкладке **Версии** для версии **2.2** выберите **Изменить статус \> Завершено**. Затем выберите **OK**.

### <a name="adjust-the-imported-format"></a>Настройка импортированного формата

1. На странице **Конфигурации** выберите **Пример формата аудита**.
2. На экспресс-вкладке **Версии** выберите версию **1.2** со статусом **Черновик**.
3. Выберите **Повторно разместить**.
4. В поле **Целевая версия** оставьте версию **2** базовой модели **Пример модели аудита**.
5. Нажмите кнопку **ОК**, чтобы изменить базу и согласовать формат с последними изменениями модели данных.
6. Выберите **Конструктор**.
7. На странице **Конструктор форматов** в дереве структуры формата в левой области выберите **Развернуть/свернуть**.
8. Выполните следующие действия, чтобы добавить новый элемент формата для сбора кодов идентификации записей сторон, чьи проводки представлены в созданных отчетах.

    1. В дереве структуры формата выберите элемент последовательности **Report.Row.Trans**.
    2. Выберите **Добавить**.
    3. В диалоговом окне **Добавить** выберите **Источник данных \> Элемент**.
    4. В диалоговом окне **Свойства компонента** в поле **Имя** введите **ИД**.
    5. В поле **Тип данных** выберите **Int64**.
    6. Нажмите **ОК**.

    > [!NOTE]
    > Элемент **Источник данных \> Элемент** может использоваться для выполнения внутренних вычислений и преобразования данных только в области выполняемого формата. Таким образом, при добавлении этого элемента формата содержимое созданного документа не изменяется.

9. Выполните следующие действия, чтобы добавить новые элементы формата для ввода имен сторон в создаваемых отчетах:

    1. Выберите элемент последовательность **Report.Row**.
    2. Выберите **Добавить**.
    3. В диалоговом окне **Добавить** выберите **Текст \> Последовательность**.
    4. В диалоговом окне **Свойства компонента** в поле **Имя** введите **Сторона**.
    5. Нажмите **ОК**.
    6. Выберите элемент последовательность **Report.Row.Party**.
    7. Выберите **Добавить**.
    8. В диалоговом окне **Добавить** выберите **Текст \> Строка**.
    9. В диалоговом окне **Свойства компонента** в поле **Имя** введите **Имя**.
    10. Нажмите **ОК**.

10. Выполните следующие действия, чтобы добавить новый источник данных для сбора кодов идентификации записей сторон, чьи проводки представлены в созданных отчетах:

    1. На вкладке **Сопоставление** выберите **Добавить корень**.
    2. В диалоговом окне **Добавление источника данных** выберите **Функции \> Коллекция данных**.
    3. В диалоговом окне **Свойства источника данных "Сбор данных"** в поле **Имя** введите **PartyIds**.
    4. В поле **Тип элемента** выберите **Int64**.
    5. Нажмите **ОК**.

11. Выполните следующие действия, чтобы добавить новую привязку для сбора кодов идентификации записей сторон, чьи проводки представлены в созданных отчетах:

    1. В дереве структуры формата выберите элемент элемента данных **Report.Row.Trans.Id**.
    2. Выберите **Изменить формулу**.
    3. На странице **Конструктор формул** введите выражение `PartyIds.Collect(model.Transaction.Party.RecId)`.
    4. Выберите **Сохранить**, затем закройте страницу **Конструктор формул**.

12. Выполните следующие действия, чтобы добавить новые привязки для ввода имен сторон в создаваемых отчетах:

    1. В дереве структуры формата выберите элемент последовательности **Report.Party**.
    2. Выберите **Изменить формулу**.
    3. На странице **Конструктор формул** введите выражение `model.Party(PartyIds.Result)`.
    4. Выберите **Сохранить**, затем закройте страницу **Конструктор формул**.
    5. В дереве структуры формата выберите элемент последовательности **Report.Party.Name**.
    6. На вкладке **Сопоставление** выберите поле модели данных `model.Party.Name`.
    7. Выберите **Связать**.

    ![Структура настроенного формата электронной отчетности на странице конструктора форматов.](./media/er-data-model-parameterized-calls-format2.png)

13. Выберите **Сохранить**, затем закройте страницу **Конструктор форматов**.
14. Закройте страницу **Сопоставление модели и источника данных**.
15. На экспресс-вкладке **Версии** для версии **2.2** выберите **Изменить статус** \> **Завершено**. Затем выберите **OK**.

### <a name="run-the-adjusted-format"></a>Запуск настроенного формата

1. На странице **Конфигурации** выберите **Образец формата аудита**, а затем на панели операций выберите **Выполнить**.
2. В диалоговом окне **Параметры электронного отчета** на вкладке **Включаемые записи** выберите **Фильтр**.
3. Укажите условия для выбора налоговых проводок ваучеров **PIV-110000004** и **INV-10000001**.
4. Нажмите **ОК**.
5. Нажмите **ОК**.
6. Просмотрите созданный документ, содержащий налоговые проводки по выбранным ваучерам и имена соответствующих клиентов и поставщиков.

    ![Предварительный просмотр созданного документа с налоговыми проводками и именами сторон.](./media/er-data-model-parameterized-calls-output2.png)

7. Перейдите к пункту **Расчеты с поставщиками** \> **Поставщики** \> **Все поставщики** и просмотрите сведения о выбранном ваучере **PIV-110000004**, включая наименование поставщика.

    ![Просмотр сведений о ваучере покупки на страницах «Все поставщики» и «Журнал накладных».](./media/er-data-model-parameterized-calls-review1.gif)

8. Перейдите к пункту **Расчеты с клиентами** \> **Клиенты** \> **Все клиенты** и просмотрите сведения о выбранном ваучере **INV-10000001**, включая наименование клиента.

    ![Просмотр подробных сведений о ваучере по продажам на страницах «Все клиенты» и «Разнесенный налог».](./media/er-data-model-parameterized-calls-review2.gif)

Для получения дополнительных сведений об этом выполнении решения электронной отчетности воспользуйтесь встроенным средством синтаксического анализа [трассировки производительности](trace-execution-er-troubleshoot-perf.md).

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Поддержка параметризованных вызовов источников данных электронной отчетности для типа вычисляемого поля](er-calculated-field-type.md)
- [Трассировка выполнения форматов электронной отчетности для устранения неполадок, связанных с производительностью](trace-execution-er-troubleshoot-perf.md)
- [Использование источников данных СБОР ДАННЫХ в форматах электронной отчетности](er-data-collection-data-sources.md)
- [Функция электронной отчетности ValueInLarge](er-functions-logical-valueinlarge.md)

[!INCLUDE[footer-include](../../../includes/footer-banner.md)]

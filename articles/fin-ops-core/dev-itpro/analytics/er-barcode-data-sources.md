---
title: Создание изображений штрихкодов с помощью источников данных штрихкодов
description: В этой теме объясняется, как использовать источники данных штрихкодов для формирования изображений штрихкода.
author: NickSelin
manager: AnnBe
ms.date: 10/21/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-platform
ms.technology: ''
ms.search.form: ERWorkspace, ERSolutionTable, ERModelMappingDesigner, EROperationDesigner
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: 220314
ms.assetid: ''
ms.search.region: Global
ms.author: nselin
ms.search.validFrom: 2020-05-01
ms.dyn365.ops.version: Version 10.0.13
ms.openlocfilehash: 3fb754267de1120bc3c086d49cb7c63028183bda
ms.sourcegitcommit: 659375c4cc7f5524cbf91cf6160f6a410960ac16
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/05/2020
ms.locfileid: "4681432"
---
# <a name="use-barcode-data-sources-to-generate-bar-code-images"></a>Создание изображений штрихкодов с помощью источников данных штрихкодов

[!include[banner](../includes/banner.md)]

Для создания требуемых вам электронных и печатаемых исходящих документов можно использовать платформу [электронной отчетности (ER)](general-electronic-reporting.md) для разработки [компонентов формата ER](general-electronic-reporting.md#FormatComponentOutbound). Чтобы создать исходящий документ в формате Microsoft Office, необходимо задать формат отчета, используя документ Microsoft Excel или документ Microsoft Word в качестве шаблона отчета. С помощью [конструктора операций ER](general-electronic-reporting.md#building-a-format-that-uses-a-data-model-as-a-base) можно привязать документ Excel или Word в качестве шаблона для формата ER. Следующие именованные элементы в связанном шаблоне связаны с элементами сконфигурированного компонента формата:

- Элементы управления содержимым в Word
- Именованные листы, диапазоны, ячейки, фигуры и изображения в Excel

Эти именованные элементы используются в качестве заполнителей для данных, вводимых в созданный документ при выполнении формата ER. Элементы формата ER связаны с источниками данных. Эти источники данных определяют данные, которые будут введены в генерируемые документы во время выполнения. Дополнительные сведения см. в разделе [Внедрение изображений и фигур в документы, создаваемые с помощью электронной отчетности](electronic-reporting-embed-images-shapes.md).

ER теперь поддерживает тип источника данных **Штрихкод**. Таким образом, теперь можно создать изображение, представляющее штрихкод для указанного текста. При настройке формата ER можно указать источники данных типа **Штрихкод** для создания изображений штрихкодов. Затем эти изображения можно добавлять в созданные деловые документы, такие как заказы, счета, отборочные накладные и чеки. Их можно также добавить к различным видам этикеток, таким как этикетки продукта или полки и этикетки упаковки и отгрузки.

Следующие местозаполнители могут использоваться в шаблонах отчетов для ввода изображений штрихкодов:

- Элемент управления содержимым [Рисунок](https://docs.microsoft.com/office/client-developer/word/content-controls-in-word) для Word
- Объект [Рисунок](https://support.office.com/article/insert-pictures-3c51edf4-22e1-460a-b372-9329a8724344) в Excel

Используя источник данных типа **Штрихкод**, можно формировать штрихкоды в следующих форматах:

- Одномерные штрихкоды:

    - Codabar
    - Code 39
    - Code 93
    - Code 128
    - EAN-8
    - EAN-13
    - ITF-14
    - Intelligent Mail
    - MSI
    - Plessey
    - PDF417
    - UPC-A
    - UPC-E

- Двумерные штрихкоды:

    - Aztec
    - Data Matrix
    - QR-код

При настройке источника данных **Штрихкод** можно определить отдельные параметры отрисовки, которые используются для создания изображения:

- **Ширина** — определяет ширину штрихкода в пикселах. Значение **0** (ноль) указывает, что используется ширина по умолчанию. Значение может различаться для различных форматов.
- **Высота** — определяет высоту штрихкода в пикселах. Значение **0** (ноль) указывает, что используется высота по умолчанию. Значение может различаться для различных форматов.
- **Поле** — укажите размер поля штрихкода в пикселах. Поле — это область на каждой стороне штрихкода, которая должна быть сохранена чистой (тихая зона). Значение **0** (ноль) указывает, что используется поле по умолчанию. Значение может различаться для различных форматов.
- **Выходное содержимое** — установите значение **Да**, чтобы создать изображение штрихкода, содержащее закодированные данные в виде текста. Значение по умолчанию равно **Нет**.
- **Кодирование** — укажите тип символов, которые кодируются в созданном изображении штрихкода. По умолчанию используется кодировка **UTF-8**.

> [!IMPORTANT]
> При добавлении нового источника данных **Штрихкод** необходимо поместить его в другой элемент (контейнер) как вложенный элемент.
>
> При привязке источника данных **Штрихкод** к элементу ячейки в формате, а элемент ячейки представляет либо элемент управления содержимым Word, либо рисунок Excel, источник данных представлен в этой привязке в виде функции, имеющей единственный параметр типа **Строка**. Этот параметр необходимо использовать, чтобы указать текст, который должен быть преобразован в изображение штрихкода и считан при сканировании созданного штрихкода.

Чтобы получить дополнительные сведения об этой функции, выполните примеры в этой теме.

## <a name="example-generate-a-payment-check-that-contains-a-bar-code-that-encodes-the-payable-amount"></a>Пример. Создание чека платежа, который содержит штрихкод, кодирующий сумму оплаты

В этом примере показано, как пользователь с ролью **Системный администратор** или **Консультант по функциональным возможностям электронной отчетности** может настроить формат ER, содержащий шаблон, используемый для создания исходящего документа в формате Excel, содержащего штрихкод. Ниже приводится обзор используемых шагов.

1. [Выполнение необходимых условий](#ExamplePrerequisites).
2. [Активация поставщика конфигураций](#ExampleProvider).
3. [Импорт предоставленного решения ER](#ExampleImportSolution).
4. [Создание чека платежа](#ExampleGenerateCheque).
5. [Проверка созданного чека платежа](#ExampleReviewGeneratedCheque).
6. [Изменение формата предоставленного решения ER](#ExampleModifyFormat).

    1. [Применение нового шаблона чека](#ExampleModifyFormatApplyTemplate).
    2. [Добавление нового источника данных штрихкода](#ExampleModifyFormatAddDataSource).
    3. [Привязка нового элемента формата](#ExampleModifyFormatBindFormatElement).
    4. [Создание измененной версии, доступной для тестового запуска](#ExampleModifyFormatMakeVersionAvailable).

        1. [Выполнение измененной версии формата](#CompleteToRun).
        2. [Разрешение использования черновой версии](#MarkToRun).

7. [Создание чека платежа](#ExampleGenerateCheque2).
8. [Преобразование созданного чека в PDF-файл](#ExampleConvertToPDF).

В этом примере будет использоваться предоставляемое решение ER, настроенное для создания чеков платежей. Это решение создает чеки платежей, где сумма к оплате записывается и как число, и как текст. Это решение электронной отчетности будет изменено таким образом, чтобы чек включал также созданный штрихкод, в котором сумма платежа кодируется и может быть считана с помощью сканера штрихкодов.

Эти шаги можно выполнить в компании **USMF** в Microsoft Dynamics 365 Finance.

### <a name="complete-the-prerequisites"></a><a name="ExamplePrerequisites"></a>Выполнение необходимых условий

Чтобы выполнить пример в этом разделе, необходимо иметь доступ к компании USMF в Finance для одной из следующих ролей:

- Консультант по функциональным возможностям электронной отчетности
- Системный администратор

Если вы еще не завершили пример в теме [Внедрение изображений и фигур в документы, создаваемые с помощью электронной отчетности](electronic-reporting-embed-images-shapes.md), загрузите следующие конфигурации примера решения ER.

| Описание содержания         | Имя файла                   |
|-----------------------------|-----------------------------|
| Конфигурации модели данных электронной отчетности | Model for cheques.xml       |
| Конфигурация формата электронной отчетности     | Cheques printing format.xml |

Кроме того, загрузите следующий файл Excel, содержащий измененный шаблон для указанного решения электронной отчетности.

| Описание содержания | Имя файла                 |
|---------------------|---------------------------|
| Шаблон отчета     | Check template Excel.xlsx |

### <a name="activate-a-configuration-provider"></a><a name="ExampleProvider"></a>Активация поставщика конфигураций

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Поставщики конфигурации** убедитесь, что [поставщик конфигурации](general-electronic-reporting.md#Provider) для демонстрационной компании **Litware, Inc.** есть в списке и помечен как активный. Если его в списке нет или он не помечен как активный, следуйте указаниям в теме [Создание поставщика конфигурации и пометка его как активного](tasks/er-configuration-provider-mark-it-active-2016-11.md).

![Настройка демонстрационной компании для активации на странице конфигураций локализации](./media/er-barcode-data-source-active-provider.png)

### <a name="import-the-provided-er-solution"></a><a name="ExampleImportSolution"></a>Импорт предоставленного решения ER

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Конфигурации** выберите плитку **Конфигурации отчетности**.
3. На странице **Конфигурации**, если конфигурация **Модель для чеков** недоступна в дереве конфигурации, выполните следующие шаги для импорта конфигурации модели данных ER:

    1. На панели действий выберите пункт **Обмен** \> **Загрузить из XML-файла**.
    2. В диалоговом окне выберите **Обзор**, найдите и выберите файл **Model for cheques.xml**, затем выберите **ОК**.

4. Если конфигурация **Формат печати чеков** недоступна в дереве конфигурации, выполните следующие шаги для импорта конфигурации формата ER:

    1. На панели действий выберите пункт **Обмен** \> **Загрузить из XML-файла**.
    2. В диалоговом окне выберите **Обзор**, найдите и выберите файл **Cheques printing format.xml**, затем выберите **ОК**.

5. В дереве конфигурации разверните **Модель для чеков**.
6. Просмотрите список импортированных конфигураций ER в дереве конфигурации.

### <a name="generate-a-payment-check"></a><a name="ExampleGenerateCheque"></a>Создание чека платежа

1. Перейдите в раздел **Управление банком и кассовыми операциями** \> **Банковские счета** \> **Банковские счета**.
2. На странице **Банковские счета** выберите счет **USMF OPER**.
3. На странице сведений о банковском счете в области действий на вкладке **Настройка** в группе **Макет** выберите **Чек**.
4. На странице **Макет чека** выберите **Правка**.
5. На экспресс-вкладке **Общие** установите для параметра **Универсальный электронный формат экспорта** значение **Да**.
6. В поле **Конфигурация формата экспорта** выберите формат ER **Формат печати чеков**, который был импортирован ранее.
7. В области действий выберите **Тест печати**.
8. В диалоговом окне установите для параметра **Формат оборотных чеков** значение **Да**, затем выберите **ОК**.

    ![Макет чека — диалоговое окно проверки печати](./media/er-barcode-data-source-check-layout.png)

### <a name="review-the-generated-payment-check"></a><a name="ExampleReviewGeneratedCheque"></a>Проверка созданного чека платежа

- Откройте созданный чек в Excel.
2. Просмотрите сформированный чек.

    ![Созданный чек платежа в Excel](./media/er-barcode-data-source-cheque1.png)

### <a name="modify-the-format-of-the-provided-er-solution"></a><a name="ExampleModifyFormat"></a>Изменение формата предоставленного решения ER

#### <a name="apply-a-new-check-template"></a><a name="ExampleModifyFormatApplyTemplate"></a>Применение нового шаблона чека

Можно использовать приложение рабочего стола Excel, чтобы открыть файл **Cheque template Excel.xlsx**, который был импортирован ранее. Обратите внимание, что этот шаблон отличается от шаблона, использованного для создания чека платежа в предоставленном решении ER. Кроме того, он включает элемент **AmountBarcode** для изображения штрихкода.

![Элемент AmountBarcode в шаблоне Excel](./media/er-barcode-data-source-cheque2.png)

Теперь необходимо изменить решение ER, а затем [повторно применить](modify-electronic-reporting-format-reapply-excel-template.md) измененный шаблон.

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Конфигурации** выберите **Конфигурации отчетности**.
3. На странице **Конфигурации** в дереве конфигурации разверните **Модель для чеков** и выберите **Формат печати чеков**.
4. В области действий выберите **Конструктор**.
5. В конструкторе операций электронной отчетности выберите вкладку **Сопоставление** в правой части страницы, затем на панели в дереве формата слева выберите **Развернуть/свернуть**.
6. Обратите внимание, что все элементы формата ячейки привязаны к соответствующим источникам данных.

    ![Привязка элементов формата ячейки к источникам данных в конструкторе операций ER](./media/er-barcode-data-source-cells-bound.png)

7. Выберите вкладку **Формат** в правой части страницы.
8. На панели операций выберите многоточие (**...**), затем выберите **Импорт**.
9. В группе **Импорт** выберите **Обновить из Excel**, затем выберите **Обновить шаблон**.
10. В диалоговом окне перейдите к файлу **Cheque template Excel.xlsx**, сохраненному на компьютере, выберите его и выберите **ОК**, чтобы подтвердить применение выбранного шаблона.
11. Выберите вкладку **Сопоставление** в правой части страницы, затем на панели в дереве формата слева выберите **Развернуть/свернуть**.
12. Обратите внимание, что элемент ячейки **AmountBarcode** был добавлен к формату. Этот элемент связан с элементом **AmountBarcode**, который был добавлен в измененный шаблон Excel в качестве заполнителя для изображения штрихкода.

    ![Элемент ячейки AmountBarcode добавлен в формат в конструкторе операций ER](./media/er-barcode-data-source-cell-added.png)

#### <a name="add-a-new-barcode-data-source"></a><a name="ExampleModifyFormatAddDataSource"></a>Добавление нового источника данных штрихкода

Далее необходимо добавить новый источник данных типа **Штрихкод**.

1. В конструкторе операций электронной отчетности на вкладке **Сопоставление** в правой части страницы выберите источник данных для **печати**.
2. Выберите **Добавить**, затем в группе **Функции** выберите тип источника данных **Штрихкод**.

    ![Выбор типа источника данных штрихкода](./media/er-barcode-data-source-add.png)

3. В диалоговом окне в поле **Имя** введите **штрихкод**.
4. В поле **Формат штрихкода** выберите **Код 128**.
5. В поле **Ширина** введите **500**.
6. Нажмите **ОК**.

    ![Диалоговое окно свойств источника данных](./media/er-barcode-data-source-add2.png)

#### <a name="bind-a-new-format-element"></a><a name="ExampleModifyFormatBindFormatElement"></a>Привязка нового элемента формата

Далее необходимо связать новый элемент форматирования с добавленным источником данных.

1. В конструкторе операций электронной отчетности на вкладке **Сопоставление** в правой части страницы выберите источник данных **печать\\штрихкод**.
2. На панели дерева формата слева выберите элемент ячейки **AmountBarcode**, затем выберите **Связать**.
3. В области действий выберите **Показать сведения**.
4. Обратите внимание, что поскольку источник данных **Штрихкод** представлен в привязке в виде функции, содержащей один параметр, имя связанного элемента форматирования было автоматически взято в качестве аргумента этого параметра.

    ![Сведения об источнике данных штрихкода в конструкторе операций электронной отчетности](./media/er-barcode-data-source-bind1.png)

5. Для корректировки привязки выберите команду **Изменить формулу**.

    Вам не нужно, чтобы возвращалось имя элемента ячейки. Поэтому необходимо настроить выражение, возвращающее текст, который содержит сумму платежа для текущего чека. Так как родительский диапазон **ChequeLines** привязан к источнику данных **model.cheques**, сумма оплаты текущего чека доступна в поле **model.cheques.attributes.amount** типа данных **Вещественный**.

6. В поле **Формула** введите **print.barcode(NUMBERFORMAT(@.attributes.amount, "F2"))**.
7. Выберите **Сохранить**, затем закройте [конструктор формул ER](general-electronic-reporting-formula-designer.md).
8. Обратите внимание, что привязка была изменена.

    ![Скорректированная привязка в конструкторе операций ER](./media/er-barcode-data-source-bind2.png)

9. Выберите **Сохранить**, затем закройте конструктор операций ER.

#### <a name="make-the-modified-version-available-for-test-runs"></a><a name="ExampleModifyFormatMakeVersionAvailable"></a>Создание измененной версии, доступной для тестового запуска

По умолчанию при выполнении формата ER используются только те версии, которые имеют статус **Завершено** и **Общие**.

После завершения изменений можно выполнить работу с текущей черновой версией и сделать изменения доступными для использования. Инструкции см. в разделе [Выполнение измененной версии формата](#CompleteToRun) ниже.

Если необходимо продолжить работу с текущей черновой версией, но ее необходимо использовать для создания чеков, необходимо явно указать, что необходимо использовать черновую версию формата для выполнения. Инструкции см. в разделе [Разрешение использования черновой версии](#MarkToRun).

##### <a name="complete-the-modified-format-version"></a><a name="CompleteToRun"></a>Выполнение измененной версии формата

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Конфигурации** выберите **Конфигурации отчетности**.
3. На странице **Конфигурации** в дереве конфигурации разверните **Модель для чеков** и выберите **Формат печати чеков**.
4. На экспресс-вкладке **Версии** выберите запись со статусом **Черновик**.
5. Выберите **Изменить статус**, затем выберите **Завершено**.
6. В диалоговом окне выберите **ОК**.

Статус текущей версии изменяется с **Черновик** на **Завершено**, и новая версия со статусом **Черновик** создается. Эту новую черную версию можно использовать для применения дополнительных изменений.

##### <a name="make-the-draft-version-available-for-use"></a><a name="MarkToRun"></a>Разрешение использования черновой версии

1. Перейдите в раздел **Управление организацией** \> **Рабочие области** \> **Электронная отчетность**.
2. На странице **Конфигурации локализации** в разделе **Конфигурации** выберите **Конфигурации отчетности**.
3. На странице **Конфигурации** в области действий на вкладке **Конфигурации** в группе **Дополнительные параметры** выберите **Параметры пользователя**.
4. В диалоговом окне установите для параметров **Параметр выполнения** значение **Да**, затем выберите **ОК**.
5. В дереве конфигурации разверните **Модель для чеков** и выберите **Формат печати чеков**.
6. Для параметра **Выполнить черновик** выберите значение **Да**.
7. Нажмите **Сохранить**.

Черновая версия выбранного формата помечается как доступная для использования при выполнении выбранного формата.

### <a name="generate-a-payment-check"></a><a name="ExampleGenerateCheque2"></a>Создание чека платежа

1. Перейдите в раздел **Управление банком и кассовыми операциями** \> **Банковские счета** \> **Банковские счета**.
2. На странице **Банковские счета** выберите счет **USMF OPER**.
3. На странице сведений о банковском счете в области действий на вкладке **Настройка** в группе **Макет** выберите **Чек**.
4. На странице **Макет чека** на панели операций выберите **Тест печати**.
5. В диалоговом окне установите для параметра **Формат оборотных чеков** значение **Да**.
6. Нажмите **ОК**.
7. Просмотрите сформированный чек. Обратите внимание, что был создан штрихкод для кодирования суммы платежа в чеке.

    ![Созданный чек платежа со штрихкодом в Excel](./media/er-barcode-data-source-cheque3.png)

> [!IMPORTANT]
> Исключение генерируется, если аргумент источника данных **Штрихкод** не соответствует требованиям, предъявляемым к формату штрихкода. Например, при вызове источника данных **Штрихкод** для создания штрихкода [EAN-8](https://wikipedia.org/wiki/EAN-8) для указанного текста, создается исключение, если длина текста превышает семь символов.

### <a name="convert-the-generated-check-to-a-pdf"></a><a name="ExampleConvertToPDF"></a>Преобразование созданного чека в PDF-файл

Как описано в разделе [Создание форм для печати FTI](er-generate-printable-fti-forms.md#finland), можно использовать специальный шрифт для создания штрихкодов в созданном документе. В этом случае дополнительные преобразования создаваемого документа могут зависеть от доступности этого шрифта в среде преобразования. Например, при попытке преобразовать документ в формат PDF или просмотреть его в среде, в которой отсутствует шрифт, штрихкоды не будут отображаться правильно.

Однако при использовании источника данных **Штрихкод** для создания штрихкодов отображение этих штрихкодов не зависит от шрифта. Таким образом, можно легко преобразовать документы, содержащие штрихкоды, в формат PDF. На следующем рисунке показан предварительный просмотр созданного чека платежа, который был [преобразован](electronic-reporting-destinations.md#OutputConversionToPDF) в PDF-файл на основе настройки настроенного [места назначения](electronic-reporting-destinations.md) электронной отчетности.

![Предварительный просмотр чека платежа в формате PDF](./media/er-barcode-data-source-cheque4.png)

## <a name="limitations"></a>Ограничения

> [!NOTE]
> Некоторые типы создаваемых штрихкодов имеют фиксированные пропорции. Такое поведение имеет смысл, если включена функция **Включить использование библиотеки EPPlus в платформе электронной отчетности**, чтобы работать с документами Excel в электронной отчетности. В этом случае изображение вводится в местозаполнитель, который имеет заблокированную пропорцию. Таким образом, когда размеры местозаполнителя в шаблоне соответствуют соотношениям изображения, которое введено, можно изменить размер реального изображения в созданном документе, чтобы сохранить необходимые пропорции. Чтобы не допустить изменения размера изображения, используйте местозаполнитель с ожидаемыми пропорциями.

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Обзор электронной отчетности](general-electronic-reporting.md)
- [Места назначения электронной отчетности](electronic-reporting-destinations.md)
- [Язык формул электронной отчетности](er-formula-language.md)
- [Функция NUMBERFORMAT](er-functions-text-numberformat.md)

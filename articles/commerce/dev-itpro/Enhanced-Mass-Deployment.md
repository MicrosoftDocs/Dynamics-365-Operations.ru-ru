---
title: Массовое развертывание запечатанных компонентов самообслуживания Commerce
description: В этой статье объясняется, как использовать эту структуру для установщиков компонентов самообслуживания для автоматической установки и развертывания служб.
author: jashanno
ms.date: 05/11/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: sericks
ms.search.region: Global
ms.author: jashanno
ms.search.validFrom: 2021-04-30
ms.openlocfilehash: a679d78db3ad5bd9cccbd4ab6a7026bd07890f55
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2022
ms.locfileid: "8898587"
---
# <a name="mass-deployment-of-sealed-commerce-self-service-components"></a>Массовое развертывание запечатанных компонентов самообслуживания Commerce

[!include [banner](../includes/banner.md)]

Эта статья относится к запечатанной структуре, установщикам компонентов, которые выпускаются каждый месяц, начиная с выпуска 10.0.18 и которые доступны в библиотеке общих ресурсов в Microsoft Dynamics Lifecycle Services (LCS). Обратите внимание, что первые несколько выпусков этих установщиков обозначены как **(Предварительная версия)**. Однако единственная цель этого обозначения — дифференцировать новые установщики, пока Microsoft определяет, существуют ли какие-либо дополнительные функциональные требования для их использования. Это не означает, что установщики не являются действительными для производства. Основываясь на выпуске этих новых установщиков, Microsoft планирует прекратить поддержку старых (устаревших) установщиков примерно в октябре 2023 года. 

В этой статье объясняется, как использовать новые установщики для автоматической установки и обслуживания обновлений с помощью аргументов командной строки. Эти аргументы позволяют выполнить массовое развертывание несколькими различными способами.

> [!NOTE]
> Новые запечатанные установщики самообслуживания не будут доступны в центральных офисах, их можно загрузить только через LCS.

## <a name="delimiters-for-mass-deployment"></a>Разделители для массового развертывания

В следующей таблице показаны разделители, которые могут использоваться при выполнении командной строки.


| Разделитель                 | Описание |
|---------------------------|-------------|
| --AadTokenIssuerPrefix | Префикс издателя токена Microsoft Azure Active Directory (Azure AD). |
| --AsyncClientAadClientId | Идентификатор клиента Azure AD, который должен использоваться асинхронным клиентом при обмене данными с центральным офисом. |
| --AsyncClientAppInsightsInstrumentationKey | Ключ инструментирования AppInsights Async Client |
| --AsyncClientCertFullPath | Полностью отформатированный путь URN, использующий отпечаток в качестве метрики поиска расположения сертификата асинхронной идентификации клиента, который следует использовать для проверки подлинности в Azure AD для связи с центральным офисом. Например, `store://My/LocalMachine?FindByThumbprint=<MyThumbprint>` является правильным форматом URN. Значение **\<MyThumbprint\>** будет заменено отпечатком сертификата, который должен использоваться. Этот параметр не следует использовать вместе с параметром **-AsyncClientCertThumbprint** |
| --AsyncClientCertThumbprint | Отпечаток сертификата идентификатора Async Client, который должен использоваться для аутентификации с Azure AD для связи с центральным офисом. Этот отпечаток будет использоваться для поиска местонахождения и имени **LocalMachine/My store**, чтобы найти правильный сертификат для использования. Этот параметр не следует использовать вместе с параметром **-AsyncClientCertFullPath**. |
| --ClientAppInsightsInstrumentationKey | Ключ инструментирования клиента AppInsights. |
| --CloudPosAppInsightsInstrumentationKey | Ключ инструментирования Cloud POS AppInsights. |
| --Config | Файл конфигурации, который должен использоваться во время установки. Примером имени файла является **Contoso.CommerceScaleUnit.xml**. |
| --CposAadClientId | Идентификатор клиента Azure AD, который должен использоваться при активации устройства в Cloud POS. Этот параметр не является обязательным для локальных развертываний. |
| --Device | Идентификатор устройства, как показано на странице **Устройства** в центральном офисе. |
| --EnvironmentId | Идентификатор среды. |
| --HardwareStationAppInsightsInstrumentationKey | Ключ инструментирования Hardware Station AppInsights. |
| --Install | Параметр, который указывает, должен ли быть установлен компонент, предоставляемый данным установщиком. Этот параметр необязателен. |
| --InstallOffline | Для современных POS этот параметр указывает, что необходимо также установить и настроить автономную базу данных. Используйте также параметр **-SQLServerName** . В противном случае установщик попытается найти экземпляр по умолчанию, отвечающий необходимым требованиям. |
| --Port | Порт, который должен быть связан и использоваться виртуальным каталогом сервера Retail Server. Если порт не задан, будет использоваться значение порта 443 по умолчанию. |
| --Register | Идентификатор устройства, как показано на странице **Регистры** в центральном офисе. |
| --RetailServerAadClientId | Идентификатор клиента Azure AD, который должен использоваться сервером Retail Server при обмене данными с центральным офисом. |
| --RetailServerAadResourceId | Идентификатор ресурса приложения Retail Server Azure AD, который должен использоваться при активации устройства. Этот параметр не является обязательным для локальных развертываний. |
| --RetailServerCertFullPath | Полностью отформатированный путь URN, использующий отпечаток в качестве метрики сертификата идентификации сервера Retail Server, который следует использовать для проверки подлинности в Azure AD для связи с центральным офисом. Например, `store://My/LocalMachine?FindByThumbprint=<MyThumbprint>` является правильным форматом URN, где значение **\<MyThumbprint\>** будет заменено отпечатком сертификата, который следует использовать. Этот параметр не следует использовать вместе с параметром **-RetailServerCertThumbprint** |
| --RetailServerCertThumbprint | Отпечаток сертификата идентификатора Retail Server, который должен использоваться для аутентификации с Azure AD для связи с центральным офисом. Этот отпечаток будет использоваться для поиска местонахождения и имени хранилища **LocalMachine/My store**, чтобы найти правильный сертификат для использования. Этот параметр не следует использовать вместе с параметром **-RetailServerCertFullPath**. |
| --RetailServerURL | URL-адрес сервера Retail Server, который должен использоваться установщиком (Этот URL-адрес называется также Commerce Scale Unit \[CSU\] URL.). В современном случае для POS-терминала это значение будет использоваться при активации устройства. |
| --SkipAadCredentialsCheck| Переключатель, который указывает, следует ли пропускать проверки требуемого компонента для учетных данных Azure AD. Значение по умолчанию равно **false**. |
| --SkipCertCheck | Переключатель, который указывает, следует ли пропускать проверки требуемого компонента для сертификата. Значение по умолчанию равно **false**. |
| --SkipIisCheck | Переключатель, который указывает, следует ли пропускать проверки требуемого компонента для Internet Information Services (IIS). Значение по умолчанию равно **false**. |
| --SkipNetFrameworkCheck | Переключатель, который указывает, следует ли пропускать проверки требуемого компонента для .NET Framework. Значение по умолчанию равно **false**. |
| --SkipScaleUnitHealthcheck | Переключатель, который указывает, следует ли пропустить проверку работоспособности установленных компонентов. Значение по умолчанию равно **false**. |
| --SkipSChannelCheck | Переключатель, который указывает, следует ли пропускать проверки требуемого компонента для .безопасного канала. Значение по умолчанию равно **false**. |
| --SkipSqlFullTextCheck | Переключатель, который указывает на необходимость пропуска проверки требуемого компонента для SQL Server, требующего полнотекстового поиска Значение по умолчанию равно **false**. |
| --SkipSqlServerCheck | Переключатель, который указывает, следует ли пропускать проверки требуемого компонента для SQL Server. Значение по умолчанию равно **false**. |
| --SqlServerName | Имя SQL Server. Если имя не указано, установщик попытается найти экземпляр по умолчанию. |
| --SslcertFullPath | Полный отформатированный путь URN, использующий отпечаток в качестве показателя поиска местоположения сертификата, который должен использоваться для шифрования HTTP-трафика в единицу масштабирования. Например, `store:\/\/My\/LocalMachine\?FindByThumbprint\=\<MyThumbprint\>` является правильным форматом URN, где значение **\<MyThumbprint\>** будет заменено отпечатком сертификата, который следует использовать. Этот параметр не следует использовать вместе с параметром **-SslCertThumbprint**. |
| --SslCertThumbprint | Отпечаток сертификата, который должен использоваться для шифрования трафика HTTP в единицу масштабирования. Этот отпечаток будет использоваться для поиска местонахождения и имени **LocalMachine/My store**, чтобы найти правильный сертификат для использования. Этот параметр не следует использовать вместе с параметром **-SslCertFullPath**. |
| --StoreSystemAosUrl | URL-адреса центрального офиса |
| --StoreSystemChannelDatabaseId | Идентификатор базы данных канала (имя). |
| --TenantId | Идентификатор клиента Azure AD. |
| --TransactionServiceAzureAuthority | Центр Transaction Service Azure AD. |
| --TransactionServiceAzureResource | Ресурс Transaction Service Azure AD. |
| --TrustSqlServerCertificate | Переключатель, который указывает, следует ли доверять сертификату сервера во время установки подключения к SQL Server. Чтобы избежать угроз безопасности, производственные развертывания никогда не должны поставлять значение **true** здесь Значение по умолчанию равно **false**. |
| --Verbosity | Уровень ведения журнала, запрашиваемого во время установки. Обычно это значение не должно использоваться. |
| --WindowsPhoneAppInsightsInstrumentationKey | Ключ инструментирования Hardware Station AppInsights. |

## <a name="general-overview"></a>Общий обзор

Новая структура для установщиков самообслуживания имеет различные функции и усовершенствования. Новая структура в настоящее время создает установщики только для современных POS, аппаратных станций и CSU (самостоятельных). Важно понимать принципы использования основных командных строк для запечатанных установщиков, которые должны выглядеть аналогично использованию в следующем примере. 
 
```Console
<Component Installer Name>.exe install --<Parameter Name> "<Parameter Information>"
```

Для установки установщику требуется параметр **установить** (или **удалить**, чтобы удалить установку) и любые параметры, связанные с этой установкой. **Имя параметра** должно включать любые необходимые параметры, такие как регистр, URL-адрес CSU или сертификат. **Сведения о параметрах** должны включать любые дополнительные сведения о параметрах.

Созданная запечатанная структура позволяет выполнить следующие изменения:
- **Запечатанные** — новая структура установщика полностью отделяет распространяемые Microsoft установщики базовых компонентов от настроек на основе расширяемости. Настройки будут установлены позже, но затем не будут привязаны к обновлениям (так что обновления будут разрешены только для базового компонента Microsoft, только для настроек или для обоих).
- **GUI-less** — больше нету пользовательского интерфейса (UI). Вместо этого для каждого установщика компонентов создается исполняемый файл, управляемый командной строкой. Это изменение является одним из нескольких ключевых изменений или функций, которые используются для того, чтобы сфокусировать новую структуру установщика на использовании при массовом развертывании.
- **Более глубокое ведение журнала** — расширенные журналы установщика позволяют лучше проверять завершение или сбой установки, выполненные шаги и любые сгенерированные предупреждения или ошибки.
- **Очистка** — в новой среде установщики компонентов прилагают больше усилий для поддержания чистоты каталогов установки, очищая все содержимое папки компонентов перед установкой более новых компонентов. Эта очистка гарантирует отсутствие оставшихся файлов, которые могут вызвать проблемы и помешать успешной установке.

Три компонента не были перенесены в новую платформу: симулятор виртуального периферийного устройства, Async Server Connector Service (используется для поддержки Dynamics AX 2012 R3) и замена службы в реальном времени (используется для поддержки Dynamics AX 2012 R3).

> [!NOTE]
> Установщики хранятся локально и в сохраненном виде.  Это важно, со временем, для управления и удаления сохраненных установщиков, чтобы не тратить дисковое пространство. Рекомендуется сохранить текущий установщик для базовых компонентов и все установщики расширений для последних версий для целей восстановления из экстремальных случаев.

## <a name="migration"></a>Миграция

Миграция со старых установщиков компонентов платформы самообслуживания на новые установщики компонентов платформы требует удаления старых компонентов.

- **Современный POS** — новая структура установщика привела к тому, что приложение получило новый идентификатор подписи приложения. Поэтому перед установкой нового компонента Modern POS требуется полное удаление старых компонентов Из-за необходимости полной деинсталляции снова потребуется активация устройства. (Эта повторная активация устройства требуется один раз, при условии, что удаление не произойдет снова.)
- **Аппаратная станция** — в качестве веб-сайта IIS новая структура установщика требует переделки базовой структуры папок. Поэтому перед установкой нового компонента аппаратной станции структуры требуется полное удаление старых компонентов
- **Commerce Scale Unit (CSU, self-hosted)** — как и серия веб-сайтов IIS, новая структура установщика требует переделки базовой структуры папок.  Поэтому перед установкой нового компонента CSU структуры требуется полное удаление старых компонентов

## <a name="modern-pos"></a>Modern POS

### <a name="before-you-begin"></a>Перед началом

Важно удалить старый компонент самообслуживания (Modern POS) самостоятельно. Дополнительные сведения см. в этапах миграции ранее в этой статье.

### <a name="examples-of-silent-deployment"></a>Примеры автоматического развертывания

В этом разделе приводятся примеры команд, используемых для установки современных POS.

#### <a name="silently-install-modern-pos"></a>Автоматическая установка Modern POS

Следующая команда автоматически устанавливает (обновляет) Modern POS. Он имеет стандартную структуру команд, которая используется для автоматического обслуживания установленных компонентов. В структуре используются основные значения **&lt;InstallerName&gt;.exe**.

Следующая базовая команда демонстрирует доступные параметры, если требуется установка. Настоятельно рекомендуется использовать эту команду при первом тестировании или использовании установщика.

```Console
CommerceModernPOS.exe --help install
```

> [!NOTE]
> Файл конфигурации не требуется для Modern POS. У установщика теперь есть параметры (показаны ранее в этой статье) для различных значений, которые используются во время активации устройства.

Следующая команда указывает все параметры, которые следует использовать при активации устройства после установки приложения Modern POS. В этом примере используется регистр **Houston-3**, который является часто используемым значением в демонстрационных данных Dynamics 365 Commerce.

```Console
CommerceModernPOS.exe install --Register "Houston-3" --Device "Houston-3" --RetailServerURL "https://MyDynamics365CommerceURL.dynamics.com/Commerce"
```

Следующая команда указывает параметры, которые следует использовать для установки и настройки автономной базы данных. SQL Server указывается вместе с файлом конфигурации, который должен использоваться.

```Console
CommerceModernPOS.exe install --InstallOffline --SQLServerName "SQLExpress" --Config "ModernPOS.Houston-3.xml"
```

Эти концепции можно сочетать и сопоставлять для достижения желаемых результатов установки.

## <a name="hardware-station"></a>Станция оборудования

### <a name="before-you-begin"></a>Перед началом

Важно удалить старый компонент аппаратной станции самообслуживания. Дополнительные сведения см. в этапах миграции ранее в этой статье. Больше не существует инструмента сведений о счете продавца. Вместо этого информация об учетной записи продавца устанавливается при сопряжении POS-терминала с аппаратной станцией. При первом тестировании этого установщика настоятельно рекомендуется выполнить следующую команду:

```Console
CommerceHardwareStation.exe --help install
```

### <a name="examples-of-silent-deployment"></a>Примеры автоматического развертывания

В этом разделе приводятся примеры команд, используемых для установки аппаратных станций.

#### <a name="silently-install-hardware-station"></a>Автоматически установите аппаратную станцию

Следующая команда автоматически устанавливает (обновляет) аппаратную станцию Он имеет стандартную структуру команд, которая используется для обслуживания установленных компонентов. В структуре используются основные значения **&lt;InstallerName&gt;.exe**.

Следующая базовая команда запускает установщик исполняемого файла.

```Console
HardwareStation.exe install --Port 443 --StoreSystemAOSURL "https://MyDynamics365CommerceURL.dynamics.com/" --StoreSystemChannelDatabaseID "Houston" --SSLCertThumbprint "MySSLCertificateThumbprintOftenHasNumbers"
```

> [!NOTE]
> Файл конфигурации не требуется для аппаратной станции. Установщик теперь имеет параметры (показаны ранее в этой статье) для различных требуемых значений.

Следующая команда задает все параметры, необходимые для пропуска проверок предварительных требований во время стандартной установки. 

> [!NOTE]
> Пропускать проверки не рекомендуется без предварительного тщательного тестирования или в ситуациях разработки.

```Console
HardwareStation.exe install --SkipFirewallUpdate --SkipOPOSCheck --SkipVersionCheck --SkipURLCheck --Config "HardwareStation.Houston.xml"
```

Как обычно, эти концепции часто смешивают и сопоставляют для достижения желаемых результатов установки.

## <a name="commerce-scale-unit-self-hosted"></a>Commerce Scale Unit (резидентное размещение)

При первом тестировании этого установщика настоятельно рекомендуется выполнить следующую команду:

```Console
CommerceStoreScaleUnitSetup.exe --help install
```

### <a name="before-you-begin"></a>Перед началом

Важно удалить старый компонент самообслуживания (автономно). Дополнительные сведения см. в этапах миграции ранее в этой статье.

### <a name="examples-of-silent-deployment"></a>Примеры автоматического развертывания

В этом разделе приводятся примеры команд, используемых для установки современных CSU (автономно).

#### <a name="silently-install-csu-self-hosted"></a>Автоматическая установка CSU (автономно)

Следующая команда автоматически устанавливает (обновляет) Modern CSU. Он имеет стандартную структуру команд, которая используется для автоматического обслуживания установленных компонентов. В структуре используются основные значения **&lt;InstallerName&gt;.exe**.

В сравнении с другими установщиками самообслуживания, Commerce Scale Unit (CSU) более сложна и требует достаточно большого объема дополнительной информации. Следующая команда представляет собой минимальную команду (параметры), необходимую для выполнения установщика исполняемого файла, когда файл конфигурации отсутствует

```Console
CommerceScaleUnit.exe install --port 446 --SSLCertThumbprint "MySSLCertificateThumbprintOftenHasNumbers" --RetailServerCertFullPath "store://My/LocalMachine?FindByThumbprint=MyCertificateThumbprintUsedByRetailServer" --AsyncClientAADClientID "MyAAD-Client-IDFor-AsyncClient" --RetailServerAADClientID "MyAAD-Client-IDFor-RetailServer" --CPOSAADClientID "MyAAD-Client-IDFor-CloudPOS" --RetailServerAADResourceID "https://retailstorescaleunit.retailserver.com" --TrustSqlServerCertificate --Config "Contoso.StoreSystemSetup.xml"
```

> [!NOTE]
> Файл конфигурации все еще необходим для CSU (автономно).

Следующая команда является более тщательной командой, запускающей установщик исполняемого файла с некоторыми альтернативными параметрами.

```Console
CommerceScaleUnit.exe install --Port 446 --SSLCertFullPath "store://My/LocalMachine?FindByThumbprint=MySSLCertificateThumbprintOftenHasNumbers" --AsyncClientCertFullPath "store://My/LocalMachine?FindByThumbprint=MySSLCertificateThumbprintOftenHasNumbers" --RetailServerCertFullPath "store://My/LocalMachine?FindByThumbprint=MyCertificateThumbprintUsedByRetailServer" --AsyncClientAADClientID "MyAAD-Client-IDFor-AsyncClient" --RetailServerAADClientID "MyAAD-Client-IDFor-RetailServer" --CPOSAADClientID "MyAAD-Client-IDFor-CloudPOS" --RetailServerAADResourceID "https://retailstorescaleunit.retailserver.com" --TrustSqlServerCertificate --Verbosity 0 --Config "Contoso.StoreSystemSetup.xml"
```

Следующая команда задает все параметры, необходимые для пропуска проверок предварительных требований во время стандартной установки. 

> [!NOTE]
> Пропускать проверки не рекомендуется без предварительного тщательного тестирования или в ситуациях разработки.


```Console
CommerceScaleUnit.exe installer --skipscaleunithealthcheck --skipcertcheck --skipaadcredentialscheck --skipschannelcheck --skipiischeck --skipnetcorebundlecheck --skipsqlservercheck --skipnetframeworkcheck --skipversioncheck --skipurlcheck --Config "Contoso.StoreSystemSetup.xml" --SSLCertFullPath "store://My/LocalMachine?FindByThumbprint=MySSLCertificateThumbprintOftenHasNumbers" --AsyncClientCertFullPath "store://My/LocalMachine?FindByThumbprint=MySSLCertificateThumbprintOftenHasNumbers" --RetailServerCertFullPath "store://My/LocalMachine?FindByThumbprint=MyCertificateThumbprintUsedByRetailServer" --AsyncClientAADClientID "MyAAD-Client-IDFor-AsyncClient" --RetailServerAADClientID "MyAAD-Client-IDFor-RetailServer" --CPOSAADClientID "MyAAD-Client-IDFor-CloudPOS" --RetailServerAADResourceID "https://retailstorescaleunit.retailserver.com" --TrustSqlServerCertificate
```

Эти концепции можно сочетать и сопоставлять для достижения желаемых результатов установки.

<!--## Mass deployment examples using InTune

This section will be added in a future update.

## Mass deployment examples using System Center Configuration Manager (SCCM)

This section will be added in a future update.-->

[!INCLUDE[footer-include](../../includes/footer-banner.md)]

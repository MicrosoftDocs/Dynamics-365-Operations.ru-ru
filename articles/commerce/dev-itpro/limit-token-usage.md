---
title: Ограничение использования маркера платежа
description: В этой статье описывается функция, которая ограничивает использование маркеров оплаты в Microsoft Dynamics 365 Commerce.
author: BrianShook
ms.date: 10/20/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: brshoo
ms.search.validFrom: 2022-09-20
ms.openlocfilehash: 8092ab0724f33f21759aa84d25e0bdcb5b2ad5dd
ms.sourcegitcommit: 6bd8822f7aa781d596b70956bead834117cf302c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/20/2022
ms.locfileid: "9709661"
---
# <a name="limit-payment-token-usage"></a>Ограничение использования маркера платежа

[!include [banner](../includes/banner.md)]
[!include [banner](../includes/preview-banner.md)]

В этой статье описывается функция, которая ограничивает использование маркеров оплаты в Microsoft Dynamics 365 Commerce. Использование маркеров ограничено областью заказа на продажу или, если предоставлено согласие клиента, сохраняется в виде зарегистрированной карты.

## <a name="key-terms"></a>Ключевые термины

| Срок | Описание |
|---|---|
| Маркер | BLOB-объект XML, на который задана ссылка в системе Dynamics 365, в котором хранятся ссылки на платежи для целей проводок. |
| Зарегистрированная карта | Сохраненный маркер ссылки карточки, согласованный для будущего использования в системе Dynamics 365 или шлюзе платежа, который относится к счету клиента. |

Ограничения на использование маркера платежа применяются к любой среде, использующей службу платежных шлюзов, в которой используются повторяющиеся маркеры. Готовый соединитель платежей [Dynamics 365 Payment Connector для Adyen](adyen-connector.md) использует повторяющиеся маркеры платежей для выполнения последующих действий заказа, таких как корректировки авторизации и повторные авторизации.

Чтобы помочь управлять тем, как в системе используются повторяющиеся маркеры платежей, функция **Ограничить использование маркера платежа контекстом заказа** ограничивает использование повторяющегося маркера до области заказа на продажу в системе. Когда она активирована, функция изменяет пользовательский интерфейс Commerce headquarters путем обновления страниц ввода платежей и ограничивает возможность выбора прошлых ссылок платежей клиента для использования в новых экземплярах проводок.

Эта функция помогает в соответствии с правилами использования для некоторых поставщиков платежей, таких как Visa. В своих [основных правилах Visa и в правилах продуктов и обслуживания Visa](https://usa.visa.com/content/dam/VCOM/download/about-visa/visa-rules-public.pdf) компания Visa указывает, что использование маркеров оплаты должно быть ограничено областью проводки, если только владелец карты не соглашается на иное.

Функция **Ограничить использование маркера платежа контекстом заказа** применяется только в том случае, если используется служба платежных шлюзов, которая использует ссылки на повторяющиеся маркеры оплаты.

## <a name="enable-the-feature"></a>Включение функции

Чтобы включить функцию **Ограничить использование маркера платежа контекстом заказа** в Commerce headquarters для вашей среды перейдите в раздел **Рабочие области \> Управление функциями**, найдите и выберите **Ограничить использование маркера платежа контекстом заказа** в списке, затем выберите **Включить**.

## <a name="limit-payment-token-usage"></a>Ограничение использования маркера платежа

Если эта функция включена, страницы Commerce headquarters, используемые для захвата метода платежа, обновляют способ ссылки на способы оплаты клиента, которые находятся в файле для клиента. Это обновление в основном повлияет на две области работы:

- Порядок ввода зарегистрированной карты клиента от имени клиента
- Как сохраняются сведения об оплате для клиента для записей платежа по будущим заказам на продажу

Когда клиент взаимодействует с каналами Commerce, сведения об оплате хранятся с контекстом заказа на продажу. Контекст заказа на продажу ограничивает токен платежа таким образом, чтобы он не использовался в качестве ссылки платежа на запись клиента на страницах платежей для новых или измененных платежей по заказам на продажу в Commerce Headquarters.

### <a name="payment-form-changes"></a>Изменения формы платежей

Когда центр обработки вызовов или Commerce headquarters принимает платеж для клиента по заказу на продажу, на странице платежа будут представлены сведения о выбранном методе платежа. Когда функция **Ограничить использование маркера платежа контекстом заказа** включена, если пользователь выбирает знак "плюс" (**+**) на странице платежа, отображаются только сохраненные записи "зарегистрированная карта". Изменения требуют, чтобы центр обработки вызовов или пользователь Commerce headquarters вводил полные сведения об оплате, введенные клиентом при заполнении страницы **Ввод сведений о клиентских платежах** для новой проводки заказа на продажу.

Список значений в поле **Номер** включает только ссылки на карты, связанные с клиентом, у которого имеется зарегистрированная карта. Он отфильтровывает все просроченные ссылки на платеж, которые не входят в область заказа на продажу.

Знак "плюс" (**+**) в поле **Номер** остается доступным и может использоваться для ввода сведений о платеже, предоставленных клиентом для проводки, связанной с обрабатываемым заказом на продажу.

### <a name="how-cards-on-file-work"></a>Как работают зарегистрированные карты

Когда активирована функция **Ограничить использование маркера платежа контекстом заказа**, зарегистрированная карта является повторяющейся токеном платежа, который сохраняется для записи клиента и не ограничен областью заказа на продажу. Зарегистрированная карта включает краткий справочник для пользователей Commerce headquarters при заполнении страницы платежа для нового платежа по заказу на продажу. Эта ссылка на маркер применима только к среде Dynamics 365. Для интерактивных каналов, использующих службу платежных шлюзов, которая позволяет пользователям сохранить метод оплаты для будущего использования в модуле платежа iFrame, платежный шлюз безопасно сохраняет эти ссылки в виде отдельной ссылки на зарегистрированную карту Dynamics 365.

Например, если соединитель платежа Dynamics 365 Commerce Payment Connector для Adyen используется в интерактивном канале, клиенты, которые вводят свои данные кредитной карты в модуле платежа iFrame, видят только ссылки на сохраненные карты службы шлюза для их следующей интернет-покупки, когда они аутентифицированы. Они не видят зарегистрированную карты, сохраненную в среде Dynamics 365, в качестве параметра в модуле оплаты iFrame. Аналогичным образом, когда покупатели размещают заказ через центр обработки вызовов, ссылки на их сохраненные в интернете карты не представлены в качестве параметров для пользователя центра обработки вызовов. Пользователь центра обработки вызовов видит только ссылки на предыдущую зарегистрированную карточку из системы Dynamics 365 (на что согласился клиент), чтобы сохранить для будущих заказов.

Пользователи Commerce headquarters могут сохранить зарегистрированную карту для клиента, перейдя в раздел **Розница и коммерция \> Клиенты** и выбрав запись счета клиента. В разделе **Клиент \> Настройка** пользователи, имеющие разрешения на обработку платежных страниц, могут использовать страницу запись **Кредитные карты** для ввода платежной карты, которая будет зарегистрирована для будущих проводок. Эта операция позволяет экономить время при обработке будущих платежей заказов на продажу для клиента. Пользователи центра обработки вызовов и Commerce headquarters должны вводить информацию о зарегистрированной карте только в том случае, если клиент соглашается использовать ссылку на карту для будущих проводок.

Флажок **Сохранить для будущего использования** в нижней части платежных страниц Commerce headquarters позволяет пользователям сохранить зарегистрированную карту для использования в будущем. Этот флажок следует использовать только в том случае, если клиент соглашается использовать зарегистрированную карту для будущих проводок. Можно отобразить или ограничить флажок **Сохранить для дальнейшего использования**, используя параметр **Разрешить хранение карты клиента** на вкладке **Платеж** на странице **Параметры центра обработки вызовов** в Commerce Headquarters. Если этот параметр имеет значение **Да**, пользователи Commerce headquarters, имеющие разрешения на обработку платежных страниц, могут сохранить зарегистрированную карту, используя флажок **Сохранить для дальнейшего использования**. Если для этого параметра установлено значение **Нет**, флажок недоступен пользователям Commerce headquarters, имеющим разрешения на обработку страниц платежей. Параметр **Разрешить хранение карты клиента** можно использовать, если компании требуется ограничить использование повторяющихся маркеров в Commerce headquarters, но однако не нужно разрешать сохранение зарегистрированной карты без процедуры, чтобы гарантировать предоставление согласия клиента.

### <a name="commerce-headquarters-pages-where-the-recurring-token-restrictions-are-enforced"></a>Страницы Commerce headquarters, для которых действуют ограничения на повторяющиеся маркеры

Область ограничения токенов влияет на следующие области в Commerce headquarters, когда функция активирована:

- Сведения о платежах клиента в разделах **Заказ на продажу \> Платежи \> Введите платеж клиента**
- Непрерывные заказы
- Платежи по взносам
- Платежи по кредитным картам при расчетах с клиентами

### <a name="manage-payment-tokens-archiving-or-removal"></a>Управление маркерами оплаты (архивирование и удаление)

Маркеры оплаты, созданные до включения флага функции **Ограничить использование маркера платежа контекстом заказа** (или в то время, когда функция была отключена), останутся "неограниченными" в системе, и к ним можно будет обращаться в списках выбора на странице платежей Commerce Headquarters. Эти маркеры можно регулярно удалять в Commerce headquarters двумя способами:

- Используйте страницу **Архивирование данных проводок по кредитной карте** для настройки задания, которое регулярно удаляет или архивирует маркеры оплаты. Если для параметра **Удалить данные без архивирования** задать значение **Да**, будут удалены маркеры, соответствующие настройте **Минимальный срок проводки в днях**. Для получения дополнительной информации см. раздел [Архивирование данных проводок по кредитной карте](archive-cc-data.md).
- Используйте новую страницу **Удалить маркеры кредитных карт** (**Расчеты с клиентами \> Запросы и отчеты \> Очистка \> Удалить маркеры кредитных карт**), позволяющую выполнить или настроить пакетное задание, удаляющее маркеры оплаты. Настройте следующие параметры:

    - Значение **Минимальный возраст маркера в днях** должно быть не менее 90 дней.
    - Параметры **Выполнять в фоновом режиме** могут использоваться для определения параметров **Повторение** или **Оповещения**.
    - Группа пакетов может быть назначена для выполнения задачи для определенной группы.
    - Если для параметра **Частный** задано значение **Да**,задание может запустить только пользователь, создавшей его.
    - Значение **Да** для параметра **Критическое задание** гарантирует, что система активно отслеживает статус задания.

Удаленные токены невозможно восстановить. Установите в поле **Минимальный возраст маркера в днях** диапазон, удовлетворяющий наиболее продолжительному времени существования транзакций для вашей среды (от авторизации до регистрации или возврата денег).

## <a name="additional-resources"></a>Дополнительные ресурсы

[Вопросы и ответы по платежам](payments-retail.md)

[Модуль оформления заказа](../add-checkout-module.md)

[Модуль платежа](../payment-module.md)

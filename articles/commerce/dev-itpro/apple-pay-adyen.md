---
title: Настройка Apple Pay с Adyen в Dynamics 365 Commerce
description: В этой статье описывается, как настроить Apple Pay с Adyen в Microsoft Dynamics 365 Commerce.
author: BrianShook
ms.date: 11/15/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: josaw
ms.search.region: Global
ms.author: brshoo
ms.search.validFrom: 2022-06-20
ms.openlocfilehash: 0949b9d7a4b181605d43956932b4fc095940bd64
ms.sourcegitcommit: cf6b764824bd1cf2c0dde6d37ddd0a7abab87ff0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/16/2022
ms.locfileid: "9780367"
---
# <a name="set-up-apple-pay-with-adyen-in-dynamics-365-commerce"></a>Настройка Apple Pay с Adyen в Dynamics 365 Commerce

[!include [banner](../includes/banner.md)]
[!include [banner](../includes/preview-banner.md)]

В этой статье описывается, как настроить Apple Pay с Adyen в Microsoft Dynamics 365 Commerce.

## <a name="key-terms"></a>Ключевые термины

| Срок | Описание |
|---|---|
| Apple Pay | Также известный как "кнопка" Apple Pay, Apple Pay является предложением по бумажнику, которое поддерживается через соединитель Adyen. Он обеспечивает взаимодействие с клиентами и интеграцию, которая поддерживается соединителем Microsoft Dynamics 365 Apple Pay. |
| Кошелек | Тип платежа, который не включает традиционные характеристики платежа, такие как диапазон идентификационного номера банка (BIN) и дата истечения срока годности, которые используются для различения типов кредитных и дебетовых карт. |

Dynamics 365 Commerce предлагает готовую интеграцию для Apple Pay, когда используется служба шлюза платежей Adyen. Apple Pay — это метод платежа для цифрового бумажника, использующий счет Apple Pay продавца в координации со службой платежей Adyen. Когда он настроен, кнопка Apple Pay является выбираемым способом оплаты, который является частью страницы оформления заказа интернет-магазина. Кнопка Apple Pay представляется в качестве варианта платежа только для поддерживаемых устройств Apple Pay. Когда пользователи выбирают **Apple Pay** в поддерживаемом веб-браузере или устройстве, они направляются для завершения платежа непосредственно на службу Apple Pay. Затем они возвращаются в интернет-витрину для завершения заказа.

Ссылка на соединитель Dynamics 365 Payment Connector для Apple Pay используется в дополнение к соединителю Dynamics 365 Payment Connector для Adyen, чтобы включить Apple Pay и платежи кредитными картами на сайте. Apple Pay также можно настроить для использования в магазинах, у которых имеются терминалы Adyen, использующие соединитель Dynamics 365 Payment Connector для Adyen с Commerce POS. В этом случае соединитель Dynamics 365 Payment Connector для Adyen обрабатывает нажатие на платежном устройстве Apple через терминал.

## <a name="prerequisites"></a>Необходимые условия

Для использования Apple Pay с Adyen в Commerce требуется учетная запись продавца Apple. Сведения о том, как настроить Apple Pay в вашей текстовой области клиента, см. в разделе [Интеграция Apple Pay Drop-in](https://docs.adyen.com/payment-methods/apple-pay/web-drop-in#set-up-apple-pay). Сведения о том, что делать, когда вы готовы к вводу в эксплуатацию в производственную среду, см. в разделе [Ввод в эксплуатацию](https://docs.adyen.com/payment-methods/apple-pay/web-drop-in#going-live).

Метод платежа Apple Pay также должен быть интегрирован с вашей учетной записью Adyen. Adyen может помочь настроить метод оплаты, а также обеспечить назначение доменов, для которых используется сертификат, для использования с сертификатом.

Чтобы включить флаг функции расширенного кошелька в Commerce headquarters, перейдите в раздел **Рабочие области \> Управление функциями**, и выполните поиск функции **Расширенная поддержка кошелька и усовершенствования платежей**. Выберите эту функцию, затем выберите **Включить**. После включения функции выполните график распределения **1110**, чтобы изменения были доступны во всех каналах.

## <a name="map-the-apple-pay-payment-method"></a>Сопоставление способа платежа Apple Pay

Apple Pay — это метод платежа цифровым бумажником. Сведения о настройке сопоставления платежей для Apple Pay см. в разделе [Поддержка платежей из бумажника](../wallets.md).

Чтобы сопоставить метод платежа Apple Pay в Commerce Headquarters, выполните следующие шаги.

1. Перейдите в раздел **Розница и коммерция \> Настройка канала \> Методы оплаты \> Типы карт**.
1. Выберите **Создать**, чтобы добавить строку для Apple Pay, и установите следующие значения:

    - **ИД:** ApplePay
    - **Имя электронного платежа:** Apple Pay
    - **Тип:** Кошелек
    - **Издатель:** Apple

1. Выберите **Сопоставление обработчика**, чтобы открыть диалоговое окно **Методы сопоставления платежей обработчика**. В столбце **Несопоставленные методы оплаты обработчика** перечислены поддерживаемые способы оплаты для каждого доступного соединителя (Adyen, PayPal и Apple).
1. Сопоставьте поддерживаемые методы платежей, которые вам нужны для обоих соединителей **Dynamics 365 Payment Connector для Adyen** (для использования в POS-терминале) и **Dynamics 365 Payment Connector для Apple Pay** (для интерактивного канала).
1. Для каждой строки сопоставления в столбце **Несопоставленные методы оплаты обработчика** выберите строку для поддержки, затем выберите **Добавить**, чтобы переместить выбранные значения в столбец **Сопоставленные методы оплаты обработчика**.
1. Выберите **ОК**, затем, на странице **Типы карт** выберите **Сохранить**.

## <a name="set-up-the-apple-pay-certificate-for-your-site"></a>Настройка сертификата Apple Pay для сайта

Для каждого сайта необходимо добавить файл сопоставления доменов (называемый также сертификатом Apple Pay), как описано в [документации по Adyen Apple Pay](https://docs.adyen.com/payment-methods/apple-pay/web-drop-in#going-live). Можно использовать конструктор сайта Commerce для отправки файла сопоставления доменов в библиотеку мультимедиа для сайта.

Чтобы настроить сертификат Apple Pay в конфигураторе сайта, выполните следующие действия.

1. Загрузите сертификат (файл сопоставления доменов) из [Adyen](https://docs.adyen.com/payment-methods/apple-pay/web-drop-in#going-live).
1. Добавьте расширение .txt в файл сопоставления доменов.
1. В конструкторе сайтов [отправьте](../upload-serve-static-files.md) файл сопоставления доменов в библиотеку мультимедиа сайта.
1. Перейдите в раздел **URL-адреса**.
1. Выберите **Создать \> Создать URL-адрес**.
1. В диалоговом поле **Создать URL-адрес** выберите **Актив библиотеки мультимедиа**.
1. В поле **Путь URL-адреса** введите путь URL-адреса (если он еще не введен). После базового URL-адреса домена введите следующую обязательную строку Apple: `<domain>/.well-known/apple-developer-merchantid-domain-association.txt`.
1. Выберите **Далее**. В библиотеке мультимедиа отображаются все отправленные ресурсы мультимедиа типа **документ** (.txt).
1. Выберите файл сопоставления доменов, который должен быть предоставлен для запросов на URL-адрес, который вы определили ранее.
1. Выберите **Создать**.

На этом этапе URL-адрес, который вы создали, находится в состоянии черновика. Опубликуйте URL-адрес для завершения процесса. Файл, на который указывает URL-адрес, не будет возвращен до тех пор, пока вы не опубликуете URL-адрес.

## <a name="configure-a-commerce-online-store-for-apple-pay"></a>Настройка интернет-магазина Commerce для Apple Pay

Чтобы настроить интернет-магазин Commerce для Apple Pay, выполните следующие действия.

1. В Commerce headquarters перейдите в раздел **Retail и Commerce \> Каналы \> Интернет-магазины**.
1. Выберите значение **Код канала розничной торговли** канала интернет-магазина вашего сайта.
1. На экспресс-вкладке **Счета оплаты** добавьте соединитель **Dynamics 365 Payment Connector для Adyen**, если он еще не настроен, следуя указаниям в разделе [Настройка Dynamics 365 Payment Connector для Adyen](adyen-connector-setup.md).
1. После настройки соединителя Adyen выберите **Добавить**, чтобы добавить соединитель **Dynamics 365 Payment Connector для Apple Pay**.
1. Введите значения для свойств продавца соединителя.

    | Свойство               | Описание | Обязательное поле | Автоматически устанавливать | Образец значения |
    | ---------------------- | ----------- | -------- | ----------------- | ------------ |
    | Имя сборки          | Имя сборки для соединителя Dynamics 365 Payment Connector для Apple Pay. | Да | Да | Имя двоичного файла |
    | ИД учетной записи службы     | Уникальный код настройки свойств продавца. Этот идентификатор записывается в проводках платежа и определяет свойства продавца, которые должны использоваться нисходящими процессами (например, выставлением накладных). | Да | Да | Guid |
    | ИД счета торговца    | Введите уникальный идентификатор продавца Adyen. Это значение предоставляется при регистрации с Adyen, как описано в разделе [Регистрация в Adyen](adyen-connector-setup.md#sign-up-with-adyen). | Да | Нет | MerchantIdentifier |
    | Ключ облачного API          | Введите ключ облачного API Adyen. Вы можете получить этот ключ, следуя указаниям в разделе [Как получить ключ API](https://docs.adyen.com/developers/user-management/how-to-get-the-api-key). | Да | Нет | abcdefg |
    | Среда шлюза    | Введите среду шлюза Adyen, с которой необходимо выполнить сопоставление. Возможные значения — **Тест** и **Активный**. Для этого поля следует задать значение **Активный** только для производственных устройств и проводок. | Да | Да | Активный |
    | Поддерживаемые валюты   | Введите валюты, которые должен обработать соединитель. В сценариях наличия карты Adyen может поддерживать дополнительные валюты с помощью [динамического преобразования валют](https://www.adyen.com/pos-payments/dynamic-currency-conversion) после отправки запроса проводки в платежный терминал. Для получения списка поддерживаемых валют обратитесь в службу поддержки Adyen. | Да | Да | USD;EUR |
    | Поддерживаемые типы платежных средств | Введите типы средств оплаты, которые должен обработать соединитель. | Да | Да | ApplePay |

1. После ввода информации о продавце выполните задание по графику распределения конфигурации канала **1070**.

## <a name="configure-commerce-pos-for-apple-pay"></a>Настройка POS-терминала Commerce для Apple Pay

В конфигурации POS-терминала используется настройка поля **Служба EFT** в профиле оборудования для соединителя Dynamics 365 Payment Connector для Adyen. В Commerce headquarters настройте сервис EFT для соединителя Dynamics 365 Payment Connector для Adyen, как описано в разделе [Настройка раздела профиля оборудования POS-терминала Dynamics 365](adyen-connector-setup.md#set-up-a-dynamics-365-pos-hardware-profile).

Убедитесь, что вы добавили **ApplePay** в список типов платежных средств в поле **Поддерживаемые типы платежных средств**. Используйте точку с запятой (;) для разделения типов платежных средств в списке.

При сопоставлении процессоров для соединителя Adyen будут зафиксированы типы карт бумажников, используемые Apple Pay на POS-терминале.

### <a name="configure-content-security-policies-in-site-builder"></a>Настройка политик безопасности содержимого в конструкторе сайтов

Перед настройкой фрагментов или страниц для использования с Apple Pay необходимо убедиться, что политики безопасности содержимого (CSP) настроены в конструкторе сайтов Commerce для вашего сайта.

Чтобы настроить политики безопасности содержимого в конструкторе сайтов, выполните следующие действия.

1. Перейдите к разделу **Параметры сайта \> Расширения**.
1. На вкладке **Политика безопасности содержимого** выберите **Добавить**, чтобы добавить строку, содержащую `https://applepay.cdn-apple.com/jsapi/v1/apple-pay-sdk.js` в разделы **child-src**, **connect-src**, **frame-src**, **img-src**, **script-src** и **style-src**.
1. Закончив, выберите **Сохранить и опубликовать** для фиксации изменений.

### <a name="set-up-apple-pay-as-a-checkout-payment-option"></a>Настройка Apple Pay в качестве варианта оплаты при оформлении заказа

Чтобы настроить Apple Pay в качестве варианта оплаты при оформлении заказа на странице оформления заказа (не экспресс-страницы) вашего сайта, выполните следующие действия.

1. В конструкторе сайтов перейдите в раздел **Фрагменты** и выберите фрагмент оформления заказа сайта.
1. Выберите **Правка**.
1. В гнезде **Контейнер раздела оформления заказа** выберите многоточие (**...**), затем выберите **Добавить модуль**.
1. В диалоговом окне **Выбор модуля** выберите модуль **Apple Pay**, затем выберите **ОК**.
1. Нажмите **Сохранить**.
1. Выберите **Завершить редактирование** для возврата фрагмента, затем нажмите кнопку **Опубликовать**, чтобы опубликовать ее.

Настройки для модуля **Apple Pay** встроены в модуль и соединяются с настроенным соединителем Dynamics 365 Payment Connector для Apple Pay, который настроен для интернет-канала в Commerce headquarters

### <a name="apple-pay-payment-behavior"></a>Поведение платежа Apple Pay

Кнопка оплаты **Apple Pay** отображается только на поддерживаемых устройствах Apple Pay (iPhone, iPads и браузеры Safari, поддерживающие Apple Pay). Если пользователь не использует одно из этих устройств, кнопка оплаты **Apple Pay** не отображается.

Когда пользователь выбирает кнопку оплаты **Apple Pay**, отображается диалоговое окно **Apple Pay**. В нем пользователь может выполнить проверку подлинности с помощью своего устройства Apple Pay или браузера. В диалоговом окне **Apple Pay** отображается сводка по сумме заказа и методу оплаты, которые пользователь настроил для своего бумажника Apple. Пользователь может просмотреть эти сведения, затем выбрать **Оплатить** для завершения платежа. После завершения платежа пользователь направляется на страницу сайта **Заказ завершен**, на которой показана подробная сводка заказа для завершенной проводки.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Вопросы и ответы по платежам](payments-retail.md)

[Модуль оформления заказа](../add-checkout-module.md)

[Модуль платежа](../payment-module.md)

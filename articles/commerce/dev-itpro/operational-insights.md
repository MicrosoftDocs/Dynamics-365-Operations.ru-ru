---
title: Настройка оперативной аналитики
description: В этой статье описывается, как настроить и использовать функцию оперативной аналитики в Microsoft Dynamics 365 Commerce.
author: ashishMSFT
ms.date: 12/07/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: asharchw
ms.search.validFrom: 2016-02-28
ms.openlocfilehash: ca0d31e403275d6131fa6d53f0a7b46a7ddb651d
ms.sourcegitcommit: 0c927fcb3afd34d870391f05b5393a4673d916e5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/08/2022
ms.locfileid: "9832132"
---
# <a name="set-up-operational-insights"></a>Настройка оперативной аналитики

[!include [banner](../includes/banner.md)]

В этой статье описывается, как настроить и использовать функцию оперативной аналитики в Microsoft Dynamics 365 Commerce.

Оперативная аналитика — это функция Dynamics 365 Commerce, которая предназначена для предоставления клиентам улучшенного представления о работоспособности и бизнес-функциях, отправляя телеметрические сведения непосредственно на счет Application Insights, принадлежащий клиенту.

При включении оперативной аналитики для вашей среды в Commerce headquarters можно собрать проверенный список событий как из Commerce Scale Unit (CSU), так и из POS-устройства. Эти события помогут лучше понять, как работают системы, и позволяют отслеживать ключевые технические и деловые показатели.

Даже если вы не хотите все время собирать эту телеметрию, вы можете воспользоваться преимуществом, быстро включив или отключив сбор для конкретных сред. Таким образом, телеметрия может помочь в устранении неполадок или отладке на этапе разработки или в производстве.

## <a name="access-logs-in-application-insights"></a>Журналы доступа в Application Insights

Чтобы получить доступ к журналам событий диагностики для компонентов Commerce CSU и POS через Application Insights, выполните процедуры, описанные в этом разделе.

### <a name="minimum-version-requirements-for-csu"></a>Минимальные требования к версии для CSU

CSU имеет следующие минимальные требования к версии:

- 10.0.23 (Retail Server версии 9.33.22062.15 и более поздних)
- 10.0.24 (Retail Server версии 9.34.22062.14 и более поздних)
- 10.0.25 (Retail Server версии 9.35.22062.13 и более поздних)
- 10.0.26 и позднее (все версии)

### <a name="enable-diagnostic-events-in-application-insights"></a>Включение диагностических событий в Application Insights

> [!IMPORTANT]
> Если ранее была использована предварительная версия оперативной аналитики, необходимо использовать следующую процедуру, чтобы включить оперативную аналитику. Таким образом обеспечивается возможность продолжения надежного и безопасного доступа к событиям.

Для включения событий диагностики компонента Commerce необходимо иметь учетную запись Application Insights. Вы можете использовать существующую учетную запись или [создать новую учетную запись](/azure/azure-monitor/app/create-workspace-resource#create-workspace-based-resource). Для обеспечения конфиденциальности данных рекомендуется использовать отдельные учетные записи Application Insights для рабочих сред, сред песочницы и сред разработки. После создания счета необходимо включить функцию **Оперативная аналитика** в Headquarters.

Чтобы включить события диагностики в Application Insights, выполните следующие действия.

1. В headquarters откройте рабочую область **Управление функциями** и включите функцию **Оперативная аналитика**.
1. Перейдите в раздел **Администрирование системы \> Настройка \> Оперативная аналитика**.
1. На вкладке **Настройка** задайте для параметра **События канала Commerce** значение **Да**.
1. На вкладке **Среды** введите значения **Код среды LCS** и **Режим среды** для каждой среды, в которой планируется использовать Application Insights. Идентификатор среды каждой среды можно найти на странице **Сведения о среде** для этой среды в Microsoft Dynamics Lifecycle Services. Этот шаг требуется для предотвращения непреднамеренного отсылки диагностических событий в неправильную среду при выполнении операций копирования базы данных.
1. На вкладке **Реестр Application Insights** укажите значение **Ключ инструментирования** Application Insights и соответствующее значение **Режим среды** для сред, в которых планируется использовать каждую из этих учетных записей Application Insights.
1. После выполнения предыдущей настройки необходимо выполнить задание **Задание CDX 1110**. Можно подождать, пока это задание будет запущено по его собственному графику, или можно выполнить его вручную.
1. В Lifecycle Services перейдите в раздел **Сведения о среде \> Commerce \> Управление**, выберите экземпляр CSU, затем выберите **Перезапустить**. Повторите этот шаг для каждого CSU.
1. Повторите предыдущие шаги для каждой среды, в которой планируется использовать Application Insights.

> [!NOTE]
> - События телеметрии в оперативной аналитике могут изменяться. Рекомендуется использовать события оперативной аналитики, чтобы выполнить предварительный анализ и устранение неполадок самостоятельно, но не определять панели мониторинга или оповещения. При использовании событий для целей за пределами самостоятельного устранения неполадок рекомендуется проверять и обновлять запросы после каждой версии CSU/POS.
> - По состоянию на версию Commerce 10.0.29 процедуры, описанные в этом разделе, также позволяют включить потоковую передачу событий оперативной аналитики POS в вашу учетную запись Application Insights. Дополнительные сведения см. в разделе [Оперативная аналитика для POS — события и запросы](https://download.microsoft.com/download/9/2/b/92be35b0-0e24-4a4d-940d-6f4db29791c0/Operational-Insights-Commerce-POS-events-queries.pdf).

#### <a name="use-the-dllhostexeconfig-file-to-control-pos-operational-insights-events"></a>Использование файла DLLHost.exe.config для управления событиями оперативной аналитики POS

Чтобы использовать файл DLLHost.exe.config для управления событиями оперативной аналитики POS, выполните следующие действия.

1. В текстовом редакторе откройте файл **DLLHost.exe.config** по пути **C:\\Program Files (x86)\\Microsoft Dynamics 365\\70\\Retail Modern POS\\ClientBroker**.
1. В разделе **diagnosticsSection** удалите XML-элемент Sink с именем класса **Microsoft.Dynamics.Retail.Diagnostics.OperationalInsights.OperationalInsightsLogger**.
1. Сохраните файл.

### <a name="disable-diagnostic-events-in-application-insights"></a>Отключение диагностических событий в Application Insights

> [!IMPORTANT]
> Если необходимо отключить события диагностики и больше не отправлять их в Application Insights, необходимо выполнить следующую процедуру. Вы не можете просто отключить эту функцию в управлении функциями.

Чтобы отключить события диагностики в Application Insights, выполните следующие действия.

1. В Headquarters перейдите в раздел **Администрирование системы \> Оперативная аналитика**.
1. На вкладке **Настройка** задайте для параметра **События канала Commerce** значение **Нет**.
1. После выполнения предыдущей настройки необходимо выполнить задание **Задание CDX 1110**. Можно подождать, пока это задание будет запущено по его собственному графику, или можно выполнить задание вручную.
1. В Lifecycle Services перейдите в раздел **Сведения о среде \> Commerce \> Управление**, выберите экземпляр CSU, затем выберите **Перезапустить**. Повторите этот шаг для каждого CSU.
1. Повторите предыдущие шаги для каждой среды, в которой планируется отключить Application Insights.

Чтобы отключить события диагностики для одной среды, удалите ключ инструментирования на вкладке **Реестр Application Insights** страницы **Оперативная аналитика**. Затем выполните шаги 3 и 4 предыдущей процедуры.

> [!NOTE]
> В версии Commerce 10.0.29 и новее шаги, описанные в этом разделе, отключают потоковую передачу событий оперативной аналитики POS в вашу учетную запись Application Insights. 

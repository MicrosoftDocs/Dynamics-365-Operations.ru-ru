---
title: Настройка Google Pay с Adyen
description: В этой статье описывается, как настроить Google Pay с Adyen в Microsoft Dynamics 365 Commerce.
author: BrianShook
ms.date: 07/05/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: brshoo
ms.search.validFrom: 2017-06-20
ms.openlocfilehash: cdf950fc7b3720543d93e108d4e3c3c2ab254e09
ms.sourcegitcommit: bdee5e642d417a13abdb778c14ec5f2dbbf8dee7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/09/2022
ms.locfileid: "9838400"
---
# <a name="configure-google-pay-with-adyen"></a>Настройка Google Pay с Adyen

[!include [banner](../includes/banner.md)]

В этой статье описывается, как настроить Google Pay с Adyen в Microsoft Dynamics 365 Commerce.

Dynamics 365 Commerce предлагает готовую интеграцию для Google Pay, когда используется служба шлюза платежей Adyen. Google Pay — это метод платежа для цифрового бумажника, использующий счет Google Pay продавца в координации со службой платежей Adyen. Когда он настроен, кнопка Google Pay доступна в качестве выбранного способа оплаты при оформлении заказа через Интернет. Когда пользователи выбирают **Google Pay** в поддерживаемом веб-браузере или устройстве, они направляются на завершение платежа непосредственно со службой Google Pay. Затем они возвращаются в интернет-витрину для завершения заказа.

При использовании Google Pay для модуля экспресс-оформления в модуле Commerce сведения о счете платежа пользователя автоматически заполняются в форме оформления, что помогает пользователю быстрее выполнить процедуру оформления. В Commerce имеется модуль экспресс-оплаты, который включает поведение экспресс-оформления. Модуль экспресс-оплаты можно использовать во фрагменте, который включен на странице оформления заказа или корзины. Ссылка на соединитель Dynamics 365 Payment Connector для Google Pay используется в дополнение к соединителю Dynamics 365 Payment Connector для Adyen, чтобы включить параметры экспресс-оплаты и обычного оформления заказов, когда настроен PayPal. Google Pay можно также настроить с терминалами платежей Adyen и POS-терминалом Commerce для использования в магазине.

## <a name="key-terms"></a>Ключевые термины

| Срок | Описание |
|---|---|
| Google Pay | Также известный как "кнопка" Google Pay, Google Pay является предложением по бумажнику, которое поддерживается через соединитель Adyen. Он обеспечивает взаимодействие с клиентами и интеграцию, которая поддерживается соединителем Dynamics Google Pay Connector. |
| Кошелек | Тип платежа, который не включает традиционные характеристики платежа, такие как диапазон идентификационного номера банка (BIN) и дата истечения срока годности, которые используются для различения типов кредитных и дебетовых карт. |
| Модуль экспресс-платежа | Модуль Dynamics 365 Commerce, который поддерживает более быстрое поведение при оформлении с поддерживаемыми методами оплаты. |

## <a name="prerequisites"></a>Необходимые условия

Для использования Google Pay с Adyen в Commerce требуется учетная запись Google Merchant. Сведения о порядке настройки учетной записи Google Merchant см. в разделе [Документация по Adyen на Google Pay](https://docs.adyen.com/payment-methods/google-pay/) и в [контрольном списке интеграции](https://developers.google.com/pay/api/web/guides/test-and-deploy/integration-checklist) Google.

Метод платежа Google Pay также должен быть интегрирован с вашей учетной записью Adyen. Инструкции по ссылке интеграции см. в разделе [Adyen Google Pay](https://www.adyen.com/payment-methods/google-pay).

Кроме того, необходимо включить улучшенную функцию бумажника в Dynamics 365 Commerce Headquarters. Перейдите в раздел **Рабочие области \> Управление функциями**, выполните поиск функции **Расширенная поддержка кошелька и усовершенствования платежей**, выберите функцию, затем выберите **Включить**. После включения функции выполните график распределения **1110**, чтобы изменения были доступны во всех каналах.

## <a name="map-the-google-pay-payment-method"></a>Сопоставление способа платежа Google Pay

Google Pay — это метод платежа цифровым бумажником. Сведения о настройке сопоставления платежей для Google Pay см. в разделе [Поддержка платежей из бумажника](../wallets.md).

Чтобы сопоставить метод оплаты Google Pay с типами карточного платежного средства для POS-терминала и интернет-каналов, выполните следующие действия.

1. В Commerce headquarters перейдите в раздел **Розничная торговля и коммерция \> Настройка канала \> Методы оплаты \> Типы карт**.
1. Выберите **Создать**, чтобы добавить строку для Google Pay.
1. В поле **ИД** введите **GooglePay**.
1. В поле **Имя электронного платежа** введите **Google Pay**.
1. В поле **Тип** введите **Кошелек**.
1. В поле **Эмитент** введите **Google**.
1. В области действий выберите **Сопоставление обработчика**, чтобы открыть диалоговое окно **Методы сопоставления платежей обработчика**.
1. В разделе **Несопоставленные методы оплаты обработчика** отображается список несопоставленных методов оплаты обработчика, каждая из которых сопоставляется с соответствующим соединителем. Чтобы сопоставить несопоставленные методы оплаты обработчика Google Pay с типами карточных платежных средств, выполните следующие действия для каждого типа карточного платежного средства:

    1. В разделе **Типы списаний по карте** выберите тип карточного платежного средства.
    1. В столбце **Несопоставленные методы оплаты обработчика** выберите оба соединителя **Dynamics 365 Payment Connector для Adyen** (для использования в POS-терминале) и **Dynamics 365 Payment Connector для Google Pay** (для использования в интерактивных каналах).
    1. Выберите **Добавить**. Выбранные параметры добавляются в столбец **Сопоставленные методы оплаты обработчика**.

1. После завершения сопоставления методов платежей выберите **Сохранить**.
1. На странице **Типы карточек** выберите **Сохранить**.

## <a name="configure-a-commerce-online-store-for-google-pay"></a>Настройка интернет-магазина Commerce для Google Pay

Чтобы настроить интернет-магазин Commerce для использования Google Pay, выполните следующие действия.

1. В Commerce headquarters перейдите в раздел **Retail и Commerce \> Каналы \> Интернет-магазины**.
1. Выберите канал интернет-магазина вашего сайта, выбрав значение **Код канала розничной торговли** этого канала.
1. На экспресс-вкладке **Счета оплаты** в разделе **Соединитель** подтвердите, что в списке присутствует соединитель **Dynamics 365 Payment Connector для Adyen**. Если в списке его нет, следуйте указаниям в разделе [Настройка соединителя Dynamics 365 Payment Connector для Adyen](adyen-connector-setup.md), чтобы добавить его.

    > [!NOTE]
    > В большинстве случаев соединитель **Dynamics 365 Payment Connector для Adyen** должен быть указан как первый соединитель для канала (первый соединитель также называется первичным соединителем). За ним должны следовать другие соединители, которые будут использоваться, например **Dynamics 365 Payment Connector для PayPal** и **Dynamics 365 Payment Connector для GooglePay**.

1. После добавления соединителя **Dynamics 365 Payment Connector для Adyen** выберите **Добавить**, чтобы добавить соединитель **Dynamics 365 Payment Connector для GooglePay**. Затем задайте следующие свойства для соединителя.

    | Поле                  | Описание | Обязательное поле | Автоматически устанавливать | Образец значения |
    | ---------------------- | ----------- | -------- | ----------------- | ------------ |
    | Имя сборки          | Имя сборки для соединителя Dynamics 365 Payment Connector для GooglePay. | Да | Да | *Имя двоичного файла* |
    | ИД учетной записи службы     | Уникальный код для настройки свойств продавца. Этот идентификатор записывается в проводках платежа и определяет свойства продавца, которые должны использоваться нисходящими процессами (например, выставлением накладных). | Да | Да | *GUID* |
    | Идентификатор продавца Google     | Введите код продавца Google, назначенный вашей учетной записи Google Merchant. Это свойство необходимо для производственных сред, но оно необязательно для тестовых сред. Дополнительные сведения см. на сайте <https://pay.google.com/>. | Да | Нет | *Числовой идентификатор* |
    | ИД счета торговца    | Введите уникальный идентификатор продавца Adyen. Это значение предоставляется при регистрации с Adyen, как описано в разделе [Регистрация в Adyen](adyen-connector-setup.md#sign-up-with-adyen). | Да | Нет | *Идентификатор продавца* |
    | Ключ облачного API          | Введите ключ облачного API Adyen. Чтобы получить этот ключ, следуйте указаниям в разделе [Как получить ключ API](https://docs.adyen.com/developers/user-management/how-to-get-the-api-key). | Да | Нет | "abcdefg" |
    | Среда шлюза    | Среда шлюза Adyen, с которой необходимо выполнить сопоставление. Возможные значения — **Тест** и **Активный**. Для этого поля следует задать значение **Активный** только для производственных устройств и проводок. | Да | Да | "Активный" |
    | Поддерживаемые валюты   | Валюты, которые должен обработать соединитель. В сценариях наличия карты Adyen может поддерживать дополнительные валюты с помощью [динамического преобразования валют](https://www.adyen.com/pos-payments/dynamic-currency-conversion) после отправки запроса проводки в платежный терминал. Для получения списка поддерживаемых валют обратитесь в службу поддержки Adyen. | Да | Да | "USD;EUR" |
    | Поддерживаемые типы платежных средств | Типы средств оплаты, которые должен обработать соединитель. | Да | Да | "GooglePay" |

1. После завершения настройки свойств соединителя выполните задание графика распределения **1070 (конфигурация канала)**.


### <a name="use-the-payment-express-module-with-google-pay"></a>Использование экспресс-модуля платежей с Google Pay

Модуль экспресс-оплаты Commerce работает с поддерживающими способами оплаты, чтобы дать клиентам сайта возможность быстрее оформить заказ, используя информацию об учетной записи платежной службы в процессе оформления заказа. Модуль экспресс-оплаты ссылается на настроенную кнопку соединителя и возвращает выбранные пользователем сведения о заказе (адрес, контактная информация и способ платежа) для предварительного заполнения формы оформления.

Когда модуль экспресс-оплаты используется с Google Pay, если клиент выбирает кнопку Google Pay в разделе **Экспресс-оплата**, открывается окно iFrame Google Pay. Пользователи затем могут войти в свою учетную запись Google, чтобы использовать адрес доставки своей учетной записи, платежный адрес, адрес электронной почты и выбранный способ оплаты Google Pay для оплаты транзакции.

Когда пользователи завершают действие в окне Google Pay, они направляются на страницу оформления заказа на сайте Commerce, на которой форма оформления предварительно заполнена сведениями из учетной записи Google Pay. После возвращения пользователей на страницу оформления из окна Google Pay они увидят следующие сведения:

- В потоке экспресс-оплаты первый вариант доставки, доступный для возвращенного адреса доставки, будет предварительно выбран для клиента.
- При использовании Google Pay контактный адрес электронной почты не возвращается. Гостевые пользователи, оформляющие заказ, должны ввести адрес электронной почты в разделе контактов страницы оформления заказа. У пользователей, вошедших в систему, будут автоматически заполняться контактные данные из учетной записи клиента Dynamics (основной адрес электронной почты, который они использовали для проверки подлинности).

У клиентов есть возможность просмотреть заказы и изменить детали оформления заказа, прежде чем они выберут **Разместить заказ**, чтобы завершить заказ.

### <a name="configure-google-pay-in-site-builder"></a>Настройка Google Pay в конструкторе сайтов 

Перед настройкой фрагментов или страниц с Google Pay необходимо убедиться, что политики безопасности содержимого для сайта установлены в конструкторе сайтов Commerce.

Чтобы убедиться в том, что политики безопасности содержимого заданы в конструкторе сайтов, выполните следующие действия.

1. На вашем сайте перейдите к разделу **Параметры сайта \> Расширения**.
1. На вкладке **Политика безопасности содержимого** добавьте строку для `*.google.com` в директивы **child-src**, **connect-src**, **frame-ancestors**, **frame-src**, **img-src**, **script-src** и **style-src**.
1. Закончив, выберите **Сохранить и опубликовать**.

### <a name="configure-the-payment-express-fragment-with-google-pay-in-site-builder"></a>Настройка фрагмента экспресс-оплаты с Google Pay в конструкторе сайтов

Чтобы настроить фрагмент экспресс-платежа с Google Pay для интернет-магазина, выполните следующие действия.

1. В конструкторе сайтов перейдите в раздел **Фрагменты**.
1. Выберите **Создать**.
1. В диалоговом окне **Создание фрагмента** выберите модуль **Контейнер**, введите имя фрагмента (например, **Экспресс-оформление**), затем выберите **ОК**. 
1. Выберите ячейку **Контейнер по умолчанию** для нового фрагмента.
1. В области свойств справа задайте свойства для модуля контейнера:

    - **Заголовок** — введите заголовок, который будет выводиться для раздела экспресс-оформления сайта (например, **Экспресс-оформление**).
    - **Макет контейнера** — выберите **Поток**.
    - **Ширина** — выберите **Заполнение контейнера**.
    - **Показанные дочерние элементы** — выберите **Три**, чтобы указать количество дочерних элементов, которое будет помещаться в строке раздела экспресс-оформления страницы оформления заказа (например, текстовое поле, экспресс-оплата для PayPal и экспресс-оплата для Google Pay).
    - **Имя класса CSS** — введите **msc-express-payment-container** (обязательно).

    > [!IMPORTANT]
    > - Для **Имя класса CSS** должно быть установлено значение **msc-express-payment-container** для управления поведением контейнера во время оформления. Это поведение включает в себя скрытие, свертывание и другие действия, которые применяются к разделу экспресс-оформления во время потока оформления. Класс **msc-express-payment-container** функционирует с операциями по умолчанию, которые выпускаются модулем оформления библиотеки модулей.
    > - К **имени класса CSS** могут быть добавлены дополнительные стили. При настройке поведения модуля тщательно проверьте элементы управления стилем, если используется тоже кодированное поведение библиотеки модулей в модуле оформления для поведения экспресс-оформления.

1. В ячейке **Контейнер по умолчанию** выберите многоточие (**...**), затем выберите **Добавить модуль**.
1. В диалоговом окне **Выбрать модуль** выберите модуль **Экспресс-оплата**, затем выберите **ОК**.
1. В области свойств модуля **Экспресс-оплата** задайте или настройте значение **Высота iFrame** в пикселах (например, **60**).
1. В поле **Поддерживаемые типы платежных средств** введите **GooglePay**. Значение должно совпадать со строкой **Поддерживаемые типы платежных средств** в соединителе, настроенном для канала (как описано в разделе [Настройка интернет-магазина Commerce для Google Pay](#configure-a-commerce-online-store-for-google-pay) ранее в этой статье).

    > [!NOTE]
    > Можно повторить шаги с 6 по 9, чтобы добавить модули **Экспресс-оплата** для других способов оплаты. Выровняйте значение **Поддерживаемые типы платежных средств** с дополнительными настроенными типами оплаты (например, **Paypal**).

1. Необязательно: можно добавить модуль блока текста в модуль контейнера по умолчанию, чтобы включить инструкции или сведения о раскрытии. После добавления модуля в области свойств введите нужный текст в поле **Форматированный текст**. Можно разместить текст выше или ниже модулей экспресс-оплаты, выбрав многоточие (**...**) в ячейке **Блок текста**, затем выбрав **Вверх** или **Вниз**.
1. Выберите **Сохранить**, чтобы сохранить изменения, затем выберите **Завершить изменение**.
1. Выберите **Опубликовать**, чтобы опубликовать фрагмент.

### <a name="add-the-payment-express-fragment-to-the-checkout-page"></a>Добавление фрагмента экспресс-платежей на страницу оформления заказа

Чтобы добавить фрагмент экспресс-платежей на страницу оформления заказа, выполните следующие шаги.

1. В конструкторе сайтов перейдите в раздел **Страницы**, затем выберите страницу оформление заказа сайта.
1. Выберите **Правка**.
1. В ячейке **Основной** выберите многоточие (**...**), затем выберите **Добавить модуль**.
1. В диалоговом окне **Выбрать модуль** выберите модуль **Контейнер**, затем выберите **ОК**.
1. В области свойств справа задайте свойства для модуля контейнера:

    - **Макет контейнера** – нажмите **С накоплением**.
    - **Ширина** — выберите **Заполнение контейнера**.
    - **Показанные дочерние элементы** — выберите **Три**, чтобы указать количество дочерних элементов, которое будет помещаться в строке раздела экспресс-оформления страницы оформления заказа (например, текстовое поле, экспресс-оплата для PayPal и экспресс-оплата для Google Pay).

1. В ячейке модуля **Контейнер** выберите многоточие (**...**), затем выберите **Добавить фрагмент**.
1. В диалоговом окне **Выбор фрагмента** выберите созданный ранее фрагмент экспресс-платежей и нажмите **ОК**.
1. Выберите **Сохранить**, чтобы сохранить изменения, затем выберите **Завершить изменение**.
1. Выберите **Опубликовать**, чтобы опубликовать страницу.

> [!NOTE]
> Если страница оформления уже включает контейнер, в котором находится фрагмент оформления, и требуется, чтобы модуль оформления отображался над обычным контейнером оформления, можно разместить его выше или ниже существующего оформления, выбрав многоточие (**...**) в ячейке **Главная**, затем выбрав **Вверх** или **Вниз**.

### <a name="add-the-payment-express-fragment-to-the-cart-page"></a>Добавление фрагмента экспресс-платежей на страницу заказа

Чтобы добавить фрагмент экспресс-платежей на страницу корзины, выполните следующие шаги.

1. В конструкторе сайтов перейдите в раздел **Страницы**, затем выберите страницу корзины сайта.
2. Выберите **Правка**.
3. В представлении структуры разверните гнездо **Главное** в представлении в виде дерева и найдите контейнер, содержащий модуль **Корзина**.
4. В модуле **Корзина** выберите гнездо **Экспресс-оплата**, выберите многоточие (**…**), затем выберите **Добавить модуль**.
5. В диалоговом окне **Выбрать модуль** выберите модуль **Экспресс-оплата**, затем выберите **ОК**.
6. Выберите гнездо модуля **Экспресс-оплата**. Затем в области свойств справа в разделе **Поддерживаемые типы платежных средств** введите **GooglePay**. Значение должно совпадать со строкой **Поддерживаемые типы платежных средств** в соединителе, который был настроен для канала (как описано в разделе [Настройка интернет-магазина Commerce для Google Pay](#configure-a-commerce-online-store-for-google-pay) ранее в этой статье).
1. Выберите **Сохранить**, чтобы сохранить изменения, затем выберите **Завершить изменение**.
1. Выберите **Опубликовать**, чтобы опубликовать страницу.

Пользователи могут включить до трех поддерживаемых модулей **Экспресс-оплата** (иными словами, три доступных поддерживаемых варианта оплаты) в слоте корзины **Экспресс-оплата**.

### <a name="set-up-google-pay-as-an-option-in-the-checkout-payment-section"></a>Настройка Google Pay в качестве параметра раздела оплаты при оформлении

Можно настроить Google Pay в качестве параметра раздела платежа для оформления только для функций платежа, не связанных с экспресс-оплатой. Форма оформления заказа будет заполнена пользователем, и страница платежа Google Pay будет готова только к оформлению для оплаты по Google Pay. Сведения об учетной записи Google не будут использоваться для перезаписи заполненных сведений оформления.

> [!NOTE]
> В следующей процедуре предполагается, что ваш сайт использует фрагмент оформления, настроенный с информацией о получении, адресом доставки, параметрами доставки, контактной информацией, дополнительными условиями, а также раздел для элементов оформления. Модуль оформления библиотеки модулей по умолчанию выпускается с контейнером раздела оформления, который имеет модули блока текста, баллов по программе лояльности, подарочного сертификата и платежа. Дополнительные сведения см. в разделе [Модуль платежа](../payment-module.md).

Чтобы настроить Google Pay в качестве регулярного параметра платежа в разделе **Метод оплаты** на странице оформления заказа, выполните следующие действия.

1. В конструкторе сайтов перейдите в раздел **Фрагменты**, затем выберите фрагмент оформления заказа сайта.
1. Выберите **Правка**.
1. В ячейке **Информация об оформлении заказа** выберите многоточие (**...**), затем выберите **Добавить модуль**.
1. В диалоговом окне **Выбрать модуль** выберите модуль **Оплата**, затем выберите **ОК**.
1. В области свойств модуля **Оплата** справа задайте свойства для модуля контейнера:

    - **Заголовок** — введите заголовок, который будет выводиться для раздела экспресс-оформления сайта (например, **Google Pay**).
    - **Высота iFrame** — измените значение на предпочтительную высоту дизайна в пикселах (например, **75**). 
    - **Поддерживаемые типы платежных средств** — введите **GooglePay** в соответствии с конфигурацией для соединителя Google Pay в Commerce Headquarters.
    - **Основной платеж** — оставьте флажок снятым. (Это свойство обычно включается для модуля оформления Adyen.)
    - **Переопределение стиля платежей** — это свойство не поддерживается для конфигурации Google Pay.
    - **Использовать ИД соединителя** — это свойство должно быть выбрано, если на странице используется несколько соединителей платежей.

1. Разместите этот модуль выше или ниже других модулей оплаты, выбрав многоточие (**...**) в ячейке **Оплата**, затем выбрав **Вверх** или **Вниз**.
1. Выберите **Сохранить**, чтобы сохранить изменения, затем выберите **Завершить изменение**.
1. Выберите **Опубликовать**.

### <a name="modes-of-delivery"></a>Способы поставки

С модулем экспресс-оплаты, который использует Google Pay, будет предварительно выбран первый вариант доставки, возвращаемый для выбранного адреса доставки из учетной записи Google Pay. У пользователей имеется возможность настроить адрес доставки на другие варианты, если это необходимо.

Порядок, в котором способы доставки отображаются в модуле экспресс-оплаты, настраивается на странице **Способы доставки** для канала в Commerce Headquarters. В Commerce headquarters перейдите в раздел **Retail и Commerce \> Каналы \> Интернет-магазины** и выберите значение **Код канала розничной торговли** для вашего магазина. В области действий на вкладке **Настройка** выберите **Режимы доставки**. Режимы доставки, перечисленные в списке, отображаются в том же порядке в модуле экспресс-оплаты. Выберите **Управление способами доставки** на панели действий, чтобы добавить или удалить способы доставки для канала розничной торговли или продукта. Подробные сведения о настройке режимов доставки см. в разделе [Настройка способов доставки](/dynamicsax-2012/appuser-itpro/set-up-modes-of-delivery).

Модуль оформления заказа также использует модуль параметров доставки при отображении способов доставки во время оформления заказа. Дополнительные сведения см. в разделе [Модуль параметров доставки](../delivery-options-module.md).

Способы доставки отображаются при добавлении в список **Режимы доставки** в интернет-магазине.

## <a name="configure-commerce-pos-for-google-pay"></a>Настройка POS-терминала Commerce для Google Pay

В конфигурации POS-терминала используется настройка поля **Служба EFT** в профиле оборудования для соединителя Dynamics 365 Payment Connector для Adyen. Сведения о настройке сервиса электронного перевода средств (EFT) для соединителя Dynamics 365 Payment Connector для Adyen в Commerce headquarters см. в разделе [Настройка профиля оборудования POS-терминала Dynamics 365](adyen-connector-setup.md#set-up-a-dynamics-365-pos-hardware-profile).

При сопоставлении процессоров для соединителя Adyen фиксируются типы карт бумажников, используемые Google Pay на POS-терминале.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Вопросы и ответы по платежам](payments-retail.md)

[Модуль оформления заказа](../add-checkout-module.md)

[Модуль платежа](../payment-module.md)

---
title: Определенные пользователем профили сертификатов для розничных магазинов
description: В этом разделе представлен обзор использования сертификатов в розничных магазинах.
author: josaw
manager: annbe
ms.date: 10/09/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.region: Global
ms.search.industry: Retail
ms.author: epopov
ms.search.validFrom: 2020-10-09
ms.dyn365.ops.version: 10.0.15
ms.openlocfilehash: 03fe3d7fb64b2e9d0a06dc56654933f0c672782a
ms.sourcegitcommit: eaf330dbee1db96c20d5ac479f007747bea079eb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/15/2021
ms.locfileid: "5225753"
---
# <a name="user-defined-certificate-profiles-for-retail-stores"></a><span data-ttu-id="286d2-103">Определенные пользователем профили сертификатов для розничных магазинов</span><span class="sxs-lookup"><span data-stu-id="286d2-103">User-defined certificate profiles for retail stores</span></span>

[!include [banner](../includes/banner.md)]


## <a name="overview"></a><span data-ttu-id="286d2-104">Обзор</span><span class="sxs-lookup"><span data-stu-id="286d2-104">Overview</span></span>

<span data-ttu-id="286d2-105">В этом разделе представлен обзор профилей сертификатов, доступных в Microsoft Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="286d2-105">This topic provides an overview of the certificate profiles that are available in Microsoft Dynamics 365 Commerce.</span></span> <span data-ttu-id="286d2-106">Эта функция расширяет функцию [Управление секретами для розничных каналов](../dev-itpro/manage-secrets.md) путем добавления поддержки локальных сертификатов.</span><span class="sxs-lookup"><span data-stu-id="286d2-106">This functionality extends the [Manage secrets for retail channels](../dev-itpro/manage-secrets.md) feature by adding support for local certificates.</span></span>

<span data-ttu-id="286d2-107">Когда POS-терминал работает в автономном режиме, он не может получить доступ к сертификатам, хранящимся в этом хранилище ключей.</span><span class="sxs-lookup"><span data-stu-id="286d2-107">While the point of sale (POS) is running in offline mode, it can't access the certificates that are stored in the key vault.</span></span> <span data-ttu-id="286d2-108">Вместо этого следует использовать локальный сертификат.</span><span class="sxs-lookup"><span data-stu-id="286d2-108">The local certificate should be used instead.</span></span> <span data-ttu-id="286d2-109">Поддерживаются следующие возможности:</span><span class="sxs-lookup"><span data-stu-id="286d2-109">The following capabilities are supported:</span></span>

- <span data-ttu-id="286d2-110">Использование локальных сертификатов в сценариях резервного хранилища ключей</span><span class="sxs-lookup"><span data-stu-id="286d2-110">Using local certificates in key vault fallback scenarios</span></span>
- <span data-ttu-id="286d2-111">Использование локальных сертификатов без хранилища ключей (например, в локальной установке)</span><span class="sxs-lookup"><span data-stu-id="286d2-111">Using local certificates without a key vault (for example in an on-premises installation)</span></span>
- <span data-ttu-id="286d2-112">Постепенное обновление сертификатов, где некоторые магазины и терминалы используют новую версию сертификата, но другие магазины и терминалы продолжают использовать предыдущую версию</span><span class="sxs-lookup"><span data-stu-id="286d2-112">Gradual update of certificates, where some stores and terminals use a new version of the certificate, but other stores and terminals continue to use the previous version</span></span>

<span data-ttu-id="286d2-113">Функция профилей сертификатов позволяет указать сертификат по умолчанию и задать порядок поиска сертификатов в одном и том же профиле сертификатов.</span><span class="sxs-lookup"><span data-stu-id="286d2-113">The certificate profiles functionality lets you specify a default certificate and set the order that certificates in the same certificate profile are searched in.</span></span> <span data-ttu-id="286d2-114">Эта функция также обеспечивает аналогичный подход к настройке для локальных сертификатов и сертификатов из хранилища ключей.</span><span class="sxs-lookup"><span data-stu-id="286d2-114">This functionality also provides a similar setup approach for local certificates and Key Vault certificates.</span></span> <span data-ttu-id="286d2-115">Для сертификатов можно добавлять параметры, специфические для компании, но уникальный межфирменный идентификатор для каждого сертификата можно использовать в каналах Commerce.</span><span class="sxs-lookup"><span data-stu-id="286d2-115">You can add company-specific settings for certificates, but the unique cross-company identifier for each certificate can be used in the Commerce channels.</span></span>

### <a name="scenarios"></a><span data-ttu-id="286d2-116">Сценарии</span><span class="sxs-lookup"><span data-stu-id="286d2-116">Scenarios</span></span>

<span data-ttu-id="286d2-117">Функциональность профилей сертификатов поддерживает следующие сценарии в каналах Commerce:</span><span class="sxs-lookup"><span data-stu-id="286d2-117">The certificate profiles functionality supports the following scenarios in the Commerce channels:</span></span>

- <span data-ttu-id="286d2-118">Использование локального сертификата в сценариях резервного хранилища ключей.</span><span class="sxs-lookup"><span data-stu-id="286d2-118">Use a local certificate in key vault fallback scenarios.</span></span> <span data-ttu-id="286d2-119">Ниже приведены несколько примеров таких резервных сценариев:</span><span class="sxs-lookup"><span data-stu-id="286d2-119">Here are some examples of these fallback scenarios:</span></span>

    - <span data-ttu-id="286d2-120">Хранилище ключей недоступно.</span><span class="sxs-lookup"><span data-stu-id="286d2-120">The key vault storage isn't accessible.</span></span>
    - <span data-ttu-id="286d2-121">Сертификат не найден в хранилище ключей.</span><span class="sxs-lookup"><span data-stu-id="286d2-121">A certificate isn't found in the key vault storage.</span></span>
    - <span data-ttu-id="286d2-122">POS-терминал работает в автономном режиме.</span><span class="sxs-lookup"><span data-stu-id="286d2-122">The POS is running in offline mode.</span></span>

- <span data-ttu-id="286d2-123">Использование локальных сертификатов, но без хранения их в хранилище ключей (например, в локальной установке).</span><span class="sxs-lookup"><span data-stu-id="286d2-123">Use local certificates, but without storing them in the key vault (for example, in an on-premises installation).</span></span>
- <span data-ttu-id="286d2-124">Выполнение постепенного обновления сертификатов, когда новая версия сертификата используется только в магазинах или на терминалах, в которых уже доступна новая версия.</span><span class="sxs-lookup"><span data-stu-id="286d2-124">Do a gradual update of certificates, where a new version of the certificate is used only in stores or on terminals where the new version is already available.</span></span>
- <span data-ttu-id="286d2-125">Использование одного и того же сертификата в нескольких компаниях.</span><span class="sxs-lookup"><span data-stu-id="286d2-125">Use the same certificate in several companies.</span></span>

## <a name="set-up-certificate-profiles"></a><span data-ttu-id="286d2-126">Настройка профилей сертификатов</span><span class="sxs-lookup"><span data-stu-id="286d2-126">Set up certificate profiles</span></span>

<span data-ttu-id="286d2-127">В следующей процедуре описан порядок настройки профилей сертификатов.</span><span class="sxs-lookup"><span data-stu-id="286d2-127">The following procedure explains how to set up certificate profiles.</span></span> <span data-ttu-id="286d2-128">Прежде чем использовать профили сертификатов в каналах Commerce, выполните следующие шаги, чтобы настроить параметры.</span><span class="sxs-lookup"><span data-stu-id="286d2-128">Before you use certificate profiles in the Commerce channels, follow these steps to configure the settings.</span></span>

1. <span data-ttu-id="286d2-129">В рабочей области **Управление функциями** включите функцию **Определяемые пользователем профили сертификатов для розничных магазинов**.</span><span class="sxs-lookup"><span data-stu-id="286d2-129">In the **Feature management** workspace, turn on the **User-defined certificate profiles for retail stores** feature.</span></span>
2. <span data-ttu-id="286d2-130">Перейдите в раздел **Администрирование системы \> Настройка \> Профили сертификатов**.</span><span class="sxs-lookup"><span data-stu-id="286d2-130">Go to **System administration \> Setup \> Certificate profiles**.</span></span>
3. <span data-ttu-id="286d2-131">Создайте запись и задайте для нее поля **Профиль сертификата**, **Имя** и **Описание**.</span><span class="sxs-lookup"><span data-stu-id="286d2-131">Create a record, and set the **Certificate profile**, **Name**, and **Description** fields for it.</span></span>

    > [!NOTE]
    > <span data-ttu-id="286d2-132">Профиль сертификата является уникальным идентификатором сертификата во всех компаниях и компонентах Commerce.</span><span class="sxs-lookup"><span data-stu-id="286d2-132">The certificate profile is a unique identifier of a certificate across all companies and Commerce components.</span></span>

3. <span data-ttu-id="286d2-133">На вкладке **Юридические лица** добавьте строку и выберите юридическое лицо (компанию), для которого должен использоваться текущий профиль сертификатов.</span><span class="sxs-lookup"><span data-stu-id="286d2-133">On the **Legal entities** tab, add a line, and select the legal entity (company) that the current certificate profile should be used for.</span></span> <span data-ttu-id="286d2-134">Если профиль сертификатов должен использоваться для нескольких юридических лиц, повторите этот шаг, чтобы добавить строку для каждого дополнительного юридического лица.</span><span class="sxs-lookup"><span data-stu-id="286d2-134">If the certificate profile should be used for multiple legal entities, repeat this step to add a line for each additional legal entity.</span></span>
4. <span data-ttu-id="286d2-135">Выберите **Параметры**, чтобы открыть страницу **Параметры профиля сертификатов**, на которой можно ввести параметры профиля сертификатов для конкретного компании.</span><span class="sxs-lookup"><span data-stu-id="286d2-135">Select **Settings** to open the **Certificate profile settings** page, where you can enter company-specific settings for the certificate profile.</span></span>

### <a name="certificate-profile-settings"></a><span data-ttu-id="286d2-136">Параметры профиля сертификата</span><span class="sxs-lookup"><span data-stu-id="286d2-136">Certificate profile settings</span></span>

<span data-ttu-id="286d2-137">При выборе пункта **Параметры** для строк профиля сертификатов отображается страница **Параметры профиля сертификатов**.</span><span class="sxs-lookup"><span data-stu-id="286d2-137">When you select **Settings** for certificate profile lines, the **Certificate profile settings** page appears.</span></span> <span data-ttu-id="286d2-138">Эта страница позволяет указать, какие сертификаты могут использоваться при вызове текущего профиля сертификатов в каналах Commerce.</span><span class="sxs-lookup"><span data-stu-id="286d2-138">This page lets you specify which certificates can be used when the current certificate profile is called in the Commerce channels.</span></span> <span data-ttu-id="286d2-139">Можно также указать порядок, в котором должен выполняться поиск сертификатов.</span><span class="sxs-lookup"><span data-stu-id="286d2-139">You can also specify the order that certificates should be searched in.</span></span>

> [!NOTE]
> <span data-ttu-id="286d2-140">Поле **Приоритет** устанавливается автоматически.</span><span class="sxs-lookup"><span data-stu-id="286d2-140">The **Priority** field is automatically set.</span></span> <span data-ttu-id="286d2-141">Значение **1** соответствует наивысшему приоритету.</span><span class="sxs-lookup"><span data-stu-id="286d2-141">A value of **1** represents the highest priority.</span></span> <span data-ttu-id="286d2-142">При добавлении новой строки на странице **Параметры профиля сертификата** для ее приоритета устанавливается число, которое на единицу больше приоритета предыдущей строки.</span><span class="sxs-lookup"><span data-stu-id="286d2-142">When a new line is added on the **Certificate profile settings** page, its priority is set to a number that is one more than the priority of the previous line.</span></span> <span data-ttu-id="286d2-143">Чтобы изменить приоритет определенной строки, выберите строку, затем выберите либо **Переместить вверх**, чтобы увеличить приоритет, либо **Переместить вниз**, чтобы уменьшить приоритет.</span><span class="sxs-lookup"><span data-stu-id="286d2-143">To change the priority of a specific line, select the line, and then select either **Move up** to increase the priority or **Move down** to decrease the priority.</span></span>

<span data-ttu-id="286d2-144">При добавлении новой строки на страницу **Параметры профиля сертификатов** задайте следующие поля:</span><span class="sxs-lookup"><span data-stu-id="286d2-144">When you add a new line to the **Certificate profile settings** page, set the following fields:</span></span>

- <span data-ttu-id="286d2-145">**Тип местоположения** — выберите местоположение, в котором хранится сертификат.</span><span class="sxs-lookup"><span data-stu-id="286d2-145">**Location type** – Select the location where the certificate is stored.</span></span> <span data-ttu-id="286d2-146">У этого поля есть два возможных значения: **Локальный сертификат** и **Хранилище ключей**.</span><span class="sxs-lookup"><span data-stu-id="286d2-146">This field has two possible values: **Local certificate** and **Key Vault**.</span></span>
- <span data-ttu-id="286d2-147">**Сертификат хранилища ключей** — это поле является обязательным, если в поле **Тип местоположения** указано значение **Хранилище ключей**.</span><span class="sxs-lookup"><span data-stu-id="286d2-147">**Key Vault certificate** – This field is required if you set the **Location type** field to **Key Vault**.</span></span> <span data-ttu-id="286d2-148">Используйте его для указания секрета сертификата хранилища ключей.</span><span class="sxs-lookup"><span data-stu-id="286d2-148">Use it to specify a Key Vault certificate secret.</span></span>

    > [!NOTE]
    > <span data-ttu-id="286d2-149">Прежде чем использовать сертификат хранилища ключей в профилях сертификатов, необходимо отправить сертификат в хранилище ключей и следовать инструкциям в разделе [Настройка клиента Azure Key Vault](https://docs.microsoft.com/dynamics365/finance/localizations/setting-up-azure-key-vault-client).</span><span class="sxs-lookup"><span data-stu-id="286d2-149">Before you use a Key Vault certificate in certificate profiles, be sure to upload a certificate to the key vault storage, and follow the instructions in [Set up the Azure Key Vault client](https://docs.microsoft.com/dynamics365/finance/localizations/setting-up-azure-key-vault-client).</span></span>

- <span data-ttu-id="286d2-150">**Имя хранилища** — это поле является необязательным и доступно только в том случае, если в поле **Тип местоположения** задано значение **Локальный сертификат**.</span><span class="sxs-lookup"><span data-stu-id="286d2-150">**Store name** – This field is optional and is available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="286d2-151">Используйте его для указания имени хранилища по умолчанию, которое должно использоваться для поиска локальных сертификатов.</span><span class="sxs-lookup"><span data-stu-id="286d2-151">Use it to specify a default store name that should be used to search local certificates.</span></span>
- <span data-ttu-id="286d2-152">**Местоположение хранилища** — это поле является необязательным и доступно только в том случае, если в поле **Тип местоположения** задано значение **Локальный сертификат**.</span><span class="sxs-lookup"><span data-stu-id="286d2-152">**Store location** – This field is optional and is available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="286d2-153">Используйте его для указания местоположения хранилища по умолчанию, которое должно использоваться для поиска локальных сертификатов.</span><span class="sxs-lookup"><span data-stu-id="286d2-153">Use it to specify a default store location that should be used to search local certificates.</span></span>

    > [!NOTE]
    > <span data-ttu-id="286d2-154">Для упрощения процесса поиска локальных сертификатов в Commerce Runtime добавлены имя хранилища и местоположение хранилища по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="286d2-154">The default store name and store location are added to simplify the process of searching local certificates in the Commerce runtime.</span></span> <span data-ttu-id="286d2-155">X509StoreProvider содержит список папок, в которых хранятся сертификаты.</span><span class="sxs-lookup"><span data-stu-id="286d2-155">X509StoreProvider has a list of folders where certificates are stored.</span></span> <span data-ttu-id="286d2-156">Если не указано имя хранилища по умолчанию и местоположение хранилища по умолчанию, X509StoreProvider пытается найти сертификат в других папках в своем списке.</span><span class="sxs-lookup"><span data-stu-id="286d2-156">If the default store name and the default store location aren't specified, X509StoreProvider tries to find a certificate in the other folders on its list.</span></span>

- <span data-ttu-id="286d2-157">**Отпечаток** — это поле является обязательным и доступно только в том случае, если в поле **Тип местоположения** задано значение **Локальный сертификат**.</span><span class="sxs-lookup"><span data-stu-id="286d2-157">**Thumbprint** – This field is required and available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="286d2-158">Используйте его для указания отпечатка сертификата.</span><span class="sxs-lookup"><span data-stu-id="286d2-158">Use it to specify the certificate thumbprint.</span></span>
- <span data-ttu-id="286d2-159">**Комментарии** — это поле является необязательным и позволяет пользователям вводить примечания.</span><span class="sxs-lookup"><span data-stu-id="286d2-159">**Comments** – This field is optional and lets users enter notes.</span></span>

### <a name="workflow-searching-certificates-in-the-commerce-runtime"></a><span data-ttu-id="286d2-160">Рабочий процесс: поиск сертификатов в Commerce Runtime</span><span class="sxs-lookup"><span data-stu-id="286d2-160">Workflow: Searching certificates in the Commerce runtime</span></span>

<span data-ttu-id="286d2-161">Ниже приводится основной рабочий процесс, используемый для поиска сертификата при вызове профиля сертификата в среде Commerce Runtime.</span><span class="sxs-lookup"><span data-stu-id="286d2-161">Here is the basic workflow that is used to search for a certificate when a certificate profile is called in the Commerce runtime.</span></span>

1. <span data-ttu-id="286d2-162">Система определяет, имеет ли профиль сертификата специфические для компании параметры для текущего юридического лица.</span><span class="sxs-lookup"><span data-stu-id="286d2-162">The system identifies whether the certificate profile has company-specific settings for the current legal entity.</span></span>
1. <span data-ttu-id="286d2-163">Система пытается найти сертификат, используя значения на странице **Параметры профиля сертификатов** для строки, в поле **Приоритет** которого указано значение **1**.</span><span class="sxs-lookup"><span data-stu-id="286d2-163">The system tries to find the certificate by using the values on the **Certificate profile settings** page for the line where the **Priority** field is set to **1**.</span></span>

    - <span data-ttu-id="286d2-164">Если для поля **Тип местоположения** задано значение **Key Vault**, значение в поле **Секрет сертификата хранилища ключей** используется для поиска сертификата на странице **Параметры хранилища ключей**.</span><span class="sxs-lookup"><span data-stu-id="286d2-164">If the **Location type** field is set to **Key Vault**, the value of the **Key Vault certificate secret** field is used to search for the certificate on the **Key vault parameters** page.</span></span> <span data-ttu-id="286d2-165">Затем выполняется поиск сертификата в хранилище ключей.</span><span class="sxs-lookup"><span data-stu-id="286d2-165">The certificate is then searched for in the key vault storage.</span></span>
    - <span data-ttu-id="286d2-166">Если в поле **Тип местоположения** задано значение **Локальный сертификат**, X509StoreProvider сначала выполняет поиск сертификата, используя имя хранилища и местоположение хранилища по умолчанию, если эти параметры указаны.</span><span class="sxs-lookup"><span data-stu-id="286d2-166">If the **Location type** field is set to **Local certificate**, X509StoreProvider first searches for the certificate by using the default store name and store location, if these parameters are specified.</span></span> <span data-ttu-id="286d2-167">Затем он выполняет поиск во всех других папках в своем списке папок.</span><span class="sxs-lookup"><span data-stu-id="286d2-167">It then searches in all other folders on its list of folders.</span></span>

1. <span data-ttu-id="286d2-168">Если сертификат не найден, процесс повторяется для строки, в поле **Приоритет** которого установлено значение **2**, и т. д.</span><span class="sxs-lookup"><span data-stu-id="286d2-168">If the certificate isn't found, the process is repeated for the line where the **Priority** field is set to **2**, and so on.</span></span>

> [!NOTE]
> <span data-ttu-id="286d2-169">Если профиль сертификата не имеет параметров для текущего юридического лица или если поиск сертификата завершился неудачно для всех строк на странице **Параметры профиля сертификатов**, сертификат не найден.</span><span class="sxs-lookup"><span data-stu-id="286d2-169">If the certificate profile has no settings for the current legal entity, or if the certificate search is unsuccessful for all lines on the **Certificate profile settings** page, the certificate isn't found.</span></span>

#### <a name="caching-the-results-of-certificate-searches"></a><span data-ttu-id="286d2-170">Кэширование результатов поиска сертификатов</span><span class="sxs-lookup"><span data-stu-id="286d2-170">Caching the results of certificate searches</span></span>

<span data-ttu-id="286d2-171">Результаты поиска сертификатов кэшируются.</span><span class="sxs-lookup"><span data-stu-id="286d2-171">The results of certificate searches are cached.</span></span> <span data-ttu-id="286d2-172">По умолчанию для кэша используется срок действия один час.</span><span class="sxs-lookup"><span data-stu-id="286d2-172">The default expiration time for a cache is one hour.</span></span> <span data-ttu-id="286d2-173">Однако это время можно настроить и задать максимальное значение в 24 часа.</span><span class="sxs-lookup"><span data-stu-id="286d2-173">However, this time can be customized and can be set to a maximum value of 24 hours.</span></span>

### <a name="gradual-update"></a><span data-ttu-id="286d2-174">Постепенное обновление</span><span class="sxs-lookup"><span data-stu-id="286d2-174">Gradual update</span></span>

<span data-ttu-id="286d2-175">Если новая версия сертификата введена, но ее невозможно одновременно обновить во всех магазинах, функция профилей сертификатов позволяет постепенно обновлять сертификат.</span><span class="sxs-lookup"><span data-stu-id="286d2-175">If a new version of the certificate is introduced, but it can't be updated in all stores at the same time, the certificate profiles functionality enables the certificate to be updated gradually.</span></span>

1. <span data-ttu-id="286d2-176">Найдите профиль сертификатов и строку, которую необходимо обновить, затем выберите **Параметры**.</span><span class="sxs-lookup"><span data-stu-id="286d2-176">Find a certificate profile and the line that should be updated, and then select **Settings**.</span></span>
1. <span data-ttu-id="286d2-177">Добавьте строку и укажите параметры, которые относятся к последней версии сертификата.</span><span class="sxs-lookup"><span data-stu-id="286d2-177">Add a line, and specify settings that are related to the latest version of the certificate.</span></span>
1. <span data-ttu-id="286d2-178">Увеличьте значение **Приоритет** для новой строки.</span><span class="sxs-lookup"><span data-stu-id="286d2-178">Increase the **Priority** value of the new line.</span></span> <span data-ttu-id="286d2-179">Используйте кнопку **Переместить вверх**, чтобы переместить строку так, чтобы она была над строкой предыдущей версии того же сертификата.</span><span class="sxs-lookup"><span data-stu-id="286d2-179">Use the **Move up** button to move the line so that it's above the line for the previous version of the same certificate.</span></span>

> [!NOTE]
> <span data-ttu-id="286d2-180">В среде Commerce Runtime новая версия сертификата будет называться первой.</span><span class="sxs-lookup"><span data-stu-id="286d2-180">In the Commerce runtime, the new version of the certificate will be called first.</span></span> <span data-ttu-id="286d2-181">Если сертификат еще не был обновлен в конкретном магазине или на конкретном терминале, будет вызвана предыдущая версия.</span><span class="sxs-lookup"><span data-stu-id="286d2-181">If the certificate hasn't yet been updated in a specific store or on a specific terminal, the previous version will be called.</span></span>


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
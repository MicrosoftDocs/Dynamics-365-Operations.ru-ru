---
title: Обзор финансовой интеграции для каналов Commerce
description: В этом разделе представлен обзор возможностей финансовой интеграции, доступных в Dynamics 365 Commerce.
author: josaw
ms.date: 02/01/2019
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.region: Global
ms.search.industry: Retail
ms.author: epopov
ms.search.validFrom: 2019-1-16
ms.dyn365.ops.version: 10
ms.openlocfilehash: 155056eb3a2acd0d66e0ace8d5558929678cb8e3
ms.sourcegitcommit: 3cdc42346bb653c13ab33a7142dbb7969f1f6dda
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2021
ms.locfileid: "5798789"
---
# <a name="overview-of-fiscal-integration-for-commerce-channels"></a><span data-ttu-id="5764e-103">Обзор финансовой интеграции для каналов Commerce</span><span class="sxs-lookup"><span data-stu-id="5764e-103">Overview of fiscal integration for Commerce channels</span></span>

[!include [banner](../includes/banner.md)]

## <a name="introduction"></a><span data-ttu-id="5764e-104">Введение</span><span class="sxs-lookup"><span data-stu-id="5764e-104">Introduction</span></span>

<span data-ttu-id="5764e-105">В этом разделе представлен обзор возможностей финансовой интеграции, доступных в Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="5764e-105">This topic is an overview of the fiscal integration capabilities that are available in Dynamics 365 Commerce.</span></span> <span data-ttu-id="5764e-106">Финансовая интеграция включает интеграцию с различными финансовыми устройствами и службами, которые обеспечивают финансовую регистрации продаж в соответствии с местным финансовым законодательством, предназначенным для предотвращения налогового мошенничества в сфере розничной торговли.</span><span class="sxs-lookup"><span data-stu-id="5764e-106">Fiscal integration includes integration with various fiscal devices and services that enable fiscal registration of sales in accordance with local fiscal laws that are aimed at preventing tax fraud in the retail industry.</span></span> <span data-ttu-id="5764e-107">Вот некоторые типичные сценарии, которые могут охватываться с помощью финансовой интеграции:</span><span class="sxs-lookup"><span data-stu-id="5764e-107">Here are some typical scenarios that can be covered by using fiscal integration:</span></span>

- <span data-ttu-id="5764e-108">Регистрация продажи на финансовом устройстве, подключенном к POS-терминалу, такому как фискальный принтер, и печать фискального чека для клиента.</span><span class="sxs-lookup"><span data-stu-id="5764e-108">Register a sale on a fiscal device that is connected to point of sale (POS), such as a fiscal printer, and print a fiscal receipt for the customer.</span></span>
- <span data-ttu-id="5764e-109">Безопасная подача информации, которая относится к продажам и возвратам, выполняемым в Retail POS, во внешнюю веб-службу, которая принадлежит налоговым органам.</span><span class="sxs-lookup"><span data-stu-id="5764e-109">Securely submit information that is related to sales and returns that are completed in Retail POS to an external web-service that is operated by the tax authority.</span></span>
- <span data-ttu-id="5764e-110">Помощь в обеспечении невозможности изменения данных проводок продаж с помощью цифровых подписей.</span><span class="sxs-lookup"><span data-stu-id="5764e-110">Help guarantee inalterability of sales transaction data through digital signatures.</span></span>

<span data-ttu-id="5764e-111">Функция финансовой интеграции — это платформа, которая предоставляет общее решение для дальнейшей разработки и настройки интеграции между Retail POS и финансовыми устройствами и службами.</span><span class="sxs-lookup"><span data-stu-id="5764e-111">The fiscal integration functionality is a framework that provides a common solution for further development and customization of the integration between Retail POS and fiscal devices and services.</span></span> <span data-ttu-id="5764e-112">Функциональные возможности также включают примеры финансовой интеграции, поддерживающие основные сценарии для конкретных стран или регионов, и работающие с конкретными финансовыми устройствами или службами.</span><span class="sxs-lookup"><span data-stu-id="5764e-112">The functionality also includes fiscal integration samples that support basic scenarios for specific countries or regions, and that work with specific fiscal devices or services.</span></span> <span data-ttu-id="5764e-113">Образец финансовой интеграции состоит из нескольких расширений компонентов Commerce и включается в комплект средств разработки программного обеспечения (SDK).</span><span class="sxs-lookup"><span data-stu-id="5764e-113">A fiscal integration sample consists of several extensions of Commerce components and is included in the software development kit (SDK).</span></span> <span data-ttu-id="5764e-114">Дополнительные сведения о примерах финансовой интеграции см. в разделе [Примеры финансовой интеграции в пакете Retail SDK](#fiscal-integration-samples-in-the-retail-sdk).</span><span class="sxs-lookup"><span data-stu-id="5764e-114">For more information about the fiscal integration samples, see [Fiscal integration samples in the Retail SDK](#fiscal-integration-samples-in-the-retail-sdk).</span></span> <span data-ttu-id="5764e-115">Сведения о том, как установить и использовать пакет Retail SDK см. в разделе [Архитектура комплекта средств разработки программного обеспечения (SDK) для Retail](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span><span class="sxs-lookup"><span data-stu-id="5764e-115">For information about how to install and use the Retail SDK, see [Retail software development kit (SDK) architecture](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span></span>

<span data-ttu-id="5764e-116">Для поддержки других сценариев, которые не поддерживаются примером финансовой интеграции, для интеграции Retail POS с другими финансовыми устройствами или службами или для покрытия потребностей в других странах или регионах необходимо расширить существующий пример финансовой интеграции или создать новый пример на основе существующего образца в качестве примера.</span><span class="sxs-lookup"><span data-stu-id="5764e-116">To support other scenarios that aren't supported by a fiscal integration sample, to integrate Retail POS with other fiscal devices or services, or to cover requirements of other countries or regions, you must either extend an existing fiscal integration sample or create a new sample by using an existing sample as an example.</span></span>

## <a name="fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices"></a><span data-ttu-id="5764e-117">Примеры процесса финансовой регистрации и финансовой интеграции для финансовых устройств</span><span class="sxs-lookup"><span data-stu-id="5764e-117">Fiscal registration process and fiscal integration samples for fiscal devices</span></span>

<span data-ttu-id="5764e-118">Процесс финансовой регистрации в Retail POS может состоять из одного или нескольких шагов.</span><span class="sxs-lookup"><span data-stu-id="5764e-118">A fiscal registration process in Retail POS can consist of one or more steps.</span></span> <span data-ttu-id="5764e-119">Каждый шаг включает финансовую регистрацию конкретных проводок или событий в одном финансовом устройстве или службе.</span><span class="sxs-lookup"><span data-stu-id="5764e-119">Each step involves fiscal registration of specific transactions or events in one fiscal device or service.</span></span> <span data-ttu-id="5764e-120">Следующие компоненты решения участвуют в финансовой регистрации в финансовом устройстве, подключенном к станции Hardware Station:</span><span class="sxs-lookup"><span data-stu-id="5764e-120">The following solution components participate in the fiscal registration in a fiscal device that is connected to a Hardware station:</span></span>

- <span data-ttu-id="5764e-121">**Расширение Commerce Runtime (CRT)** — этот компонент сериализует данные о проводке или событии в формат, который также используется для взаимодействия с финансовым устройством, анализирует ответы от финансового устройства и сохраняет ответы в базе данных канала.</span><span class="sxs-lookup"><span data-stu-id="5764e-121">**Commerce runtime (CRT) extension** – This component serializes transaction/event data in the format that is also used for interaction with the fiscal device, parses responses from the fiscal device, and stores the responses in the channel database.</span></span> <span data-ttu-id="5764e-122">Расширения также определяет конкретные проводки и события, которые должны быть зарегистрированы.</span><span class="sxs-lookup"><span data-stu-id="5764e-122">The extension also defines the specific transactions and events that must be registered.</span></span> <span data-ttu-id="5764e-123">Данный компонент часто называется также *поставщиком фискальных документов*.</span><span class="sxs-lookup"><span data-stu-id="5764e-123">This component is often referred to as a *fiscal document provider*.</span></span>
- <span data-ttu-id="5764e-124">**Расширение Hardware Station** — этот компонент инициализирует связь с финансовым устройством, отправляя запросы и прямые команды на финансовое устройство на основе данных проводки/события, которые извлекаются из финансового документа, и получает ответы от финансового устройства.</span><span class="sxs-lookup"><span data-stu-id="5764e-124">**Hardware station extension** – This component initializes the communication with the fiscal device, sends requests and direct commands to the fiscal device based on the transaction/event data that is extracted from the fiscal document, and receives responses from the fiscal device.</span></span> <span data-ttu-id="5764e-125">Данный компонент часто называется *финансовым соединителем*.</span><span class="sxs-lookup"><span data-stu-id="5764e-125">This component is often referred to as a *fiscal connector*.</span></span>

<span data-ttu-id="5764e-126">Пример финансовой интеграции для финансового устройства содержит расширения CRT и Hardware Station для поставщика фискальных документов и финансового соединителя, соответственно.</span><span class="sxs-lookup"><span data-stu-id="5764e-126">A fiscal integration sample for a fiscal device contains the CRT and Hardware station extensions for a fiscal document provider and a fiscal connector, respectively.</span></span> <span data-ttu-id="5764e-127">Он также содержит следующие конфигурации компонентов:</span><span class="sxs-lookup"><span data-stu-id="5764e-127">It also contains the following component configurations:</span></span>

- <span data-ttu-id="5764e-128">**Конфигурация поставщика фискальных документов** — эта конфигурация определяет метод вывода и формат финансовых документов.</span><span class="sxs-lookup"><span data-stu-id="5764e-128">**Fiscal document provider configuration** – This configuration defines an output method and a format for fiscal documents.</span></span> <span data-ttu-id="5764e-129">Он также содержит сопоставление данных для налогов и способов оплаты, чтобы сделать данные с Retail POS совместимыми со значениями, которые заранее определены во встроенном ПО финансового устройства.</span><span class="sxs-lookup"><span data-stu-id="5764e-129">It also contains a data mapping for taxes and payment methods, to make data from Retail POS compatible with the values that are predefined in the fiscal device firmware.</span></span>
- <span data-ttu-id="5764e-130">**Конфигурация финансового соединителя** — эта конфигурация определяет физическую связь с конкретным финансовым устройством.</span><span class="sxs-lookup"><span data-stu-id="5764e-130">**Fiscal connector configuration** – This configuration defines the physical communication with the specific fiscal device.</span></span>

<span data-ttu-id="5764e-131">Процесс финансовой регистрации для конкретной ККМ POS определяется соответствующим параметром в профиле функциональности POS.</span><span class="sxs-lookup"><span data-stu-id="5764e-131">A fiscal registration process for a specific POS register is defined by a corresponding setting in the POS functionality profile.</span></span> <span data-ttu-id="5764e-132">Дополнительные сведения о настройке процесса финансовой регистрации, отправки конфигураций поставщиков фискальных документов и финансовых соединителей и изменению их параметров см. в разделе [Настройка процесса финансовой регистрации](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span><span class="sxs-lookup"><span data-stu-id="5764e-132">For more details about how to configure a fiscal registration process, upload fiscal document provider and fiscal connector configurations, and change their parameters, see [Set up a fiscal registration process](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span></span>

<span data-ttu-id="5764e-133">В следующем примере показан типовой порядок выполнения финансовой регистрации для финансового устройства.</span><span class="sxs-lookup"><span data-stu-id="5764e-133">The following example shows a typical fiscal registration execution flow for a fiscal device.</span></span> <span data-ttu-id="5764e-134">Поток начинается с события в POS-терминале (например, завершение проводки продажи) и реализует следующую последовательность действий:</span><span class="sxs-lookup"><span data-stu-id="5764e-134">The flow starts with an event in the POS (for example, finalization of a sales transaction) and implements the following sequence of steps:</span></span>

1. <span data-ttu-id="5764e-135">POS-терминал запрашивает финансовый документ из CRT.</span><span class="sxs-lookup"><span data-stu-id="5764e-135">The POS requests a fiscal document from CRT.</span></span>
2. <span data-ttu-id="5764e-136">CRT определяет, требуется ли финансовая регистрация текущего события.</span><span class="sxs-lookup"><span data-stu-id="5764e-136">CRT determines whether the current event requires fiscal registration.</span></span>
3. <span data-ttu-id="5764e-137">В зависимости от параметров процесса финансовой регистрации CRT определяет финансовый соединитель и соответствующий поставщик фискальных документов для использования для финансовой регистрации.</span><span class="sxs-lookup"><span data-stu-id="5764e-137">Based on the fiscal registration process settings, CRT identifies a fiscal connector and corresponding fiscal document provider to use for the fiscal registration.</span></span>
4. <span data-ttu-id="5764e-138">CRT запускается поставщик фискальных документов, который создает фискальный документ (например, документ XML), представляющий проводку или событие.</span><span class="sxs-lookup"><span data-stu-id="5764e-138">CRT runs the fiscal document provider that generates a fiscal document (for example, an XML document) that represents the transaction or event.</span></span>
5. <span data-ttu-id="5764e-139">POS-терминал отправляет фискальный документ, который подготовил CRT, в Hardware Station.</span><span class="sxs-lookup"><span data-stu-id="5764e-139">The POS sends the fiscal document that CRT prepares to a Hardware station.</span></span>
6. <span data-ttu-id="5764e-140">Hardware Station запускает финансовый соединитель, который обрабатывает фискальный документ и передает его финансовому устройству или службе.</span><span class="sxs-lookup"><span data-stu-id="5764e-140">The Hardware station runs the fiscal connector that processes the fiscal document and communicates it to the fiscal device or service.</span></span>
7. <span data-ttu-id="5764e-141">POS-терминал анализирует ответ от финансового устройства или службы, чтобы определить, успешно ли выполнена финансовая регистрация.</span><span class="sxs-lookup"><span data-stu-id="5764e-141">The POS analyzes the response from the fiscal device or service to determine whether the fiscal registration was successful.</span></span>
8. <span data-ttu-id="5764e-142">CRT сохраняет ответ в базе данных канала.</span><span class="sxs-lookup"><span data-stu-id="5764e-142">CRT saves the response to the channel database.</span></span>

<span data-ttu-id="5764e-143">![Схема решения](media/emea-fiscal-integration-solution.png "Схема решения")</span><span class="sxs-lookup"><span data-stu-id="5764e-143">![Solution schema](media/emea-fiscal-integration-solution.png "Solution schema")</span></span>

## <a name="error-handling"></a><span data-ttu-id="5764e-144">Обработка ошибок</span><span class="sxs-lookup"><span data-stu-id="5764e-144">Error handling</span></span>

<span data-ttu-id="5764e-145">Платформа финансовой интеграции предоставляет следующие параметры для обработки ошибок во время финансовой регистрации:</span><span class="sxs-lookup"><span data-stu-id="5764e-145">The fiscal integration framework provides the following options to handle failures during fiscal registration:</span></span>

- <span data-ttu-id="5764e-146">**Повторить** — операторы могут использовать этот параметр, если сбой можно быстро устранить, и финансовую регистрации можно перезапустить.</span><span class="sxs-lookup"><span data-stu-id="5764e-146">**Retry** – Operators can use this option when the failure can be resolved quickly, and the fiscal registration can be rerun.</span></span> <span data-ttu-id="5764e-147">Например, этот параметр используется, если финансовое устройство не подключено, в финансовом принтере нет бумаги или существует замятие бумаги в финансовом принтере.</span><span class="sxs-lookup"><span data-stu-id="5764e-147">For example, this option can be used when the fiscal device isn't connected, the fiscal printer is out of paper, or there is a paper jam in the fiscal printer.</span></span>
- <span data-ttu-id="5764e-148">**Отмена** — этот параметр позволяет оператору отсрочить финансовую регистрацию текущей проводки или события в случае неудачи.</span><span class="sxs-lookup"><span data-stu-id="5764e-148">**Cancel** – This option lets operators postpone the fiscal registration of the current transaction or event if it fails.</span></span> <span data-ttu-id="5764e-149">После того как регистрация отложена, оператор можно продолжить работу с POS и выполнить любую операцию, для которой не требуется финансовая регистрация.</span><span class="sxs-lookup"><span data-stu-id="5764e-149">After the registration is postponed, the operator can continue to work on the POS and can complete any operation that the fiscal registration isn't required for.</span></span> <span data-ttu-id="5764e-150">При возникновении любого события, которое требует финансовой регистрации в POS (например, открывается новая проводка), автоматически отображается диалоговое окно обработки ошибок, чтобы уведомить оператора о том, что предыдущая проводка не была правильно зарегистрирована, и предоставить параметры обработки ошибок.</span><span class="sxs-lookup"><span data-stu-id="5764e-150">When any event that requires the fiscal registration occurs in the POS (for example, a new transaction is opened), the error handling dialog box automatically appears to notify the operator that the previous transaction wasn't correctly registered and to provide the error handling options.</span></span>
- <span data-ttu-id="5764e-151">**Пропустить** — операторы могут использовать этот параметр, когда финансовая регистрация может быть пропущена при определенных условиях и обычные операции могут быть продолжены на POS-терминале.</span><span class="sxs-lookup"><span data-stu-id="5764e-151">**Skip** – Operators can use this option when the fiscal registration can be omitted under specific conditions and regular operations can be continued on the POS.</span></span> <span data-ttu-id="5764e-152">Например, этот параметр может использоваться, когда проводка по продажам, для которой финансовая регистрация закончилась сбоем, может быть зарегистрирована в специальном бумажном журнале.</span><span class="sxs-lookup"><span data-stu-id="5764e-152">For example, this option can be used when a sales transaction that the fiscal registration failed for can be registered in a special paper journal.</span></span>
- <span data-ttu-id="5764e-153">**Пометить как зарегистрированный** — операторы могут использовать этот параметр, когда проводка фактически была зарегистрирована в финансовом устройстве (например, фискальный чек был распечатан), но произошел сбой при сохранении финансового ответа в базе данных канала.</span><span class="sxs-lookup"><span data-stu-id="5764e-153">**Mark as registered** – Operators can use this option when the transaction was actually registered in the fiscal device (for example, a fiscal receipt was printed), but a failure occurred when the fiscal response was being saved to the channel database.</span></span>

> [!NOTE]
> <span data-ttu-id="5764e-154">Параметры **Пропустить** и **Пометить как зарегистрированный** необходимо активировать в процессе финансовой регистрации перед их использованием.</span><span class="sxs-lookup"><span data-stu-id="5764e-154">The **Skip** and **Mark as registered** options must be activated in the fiscal registration process before they are used.</span></span> <span data-ttu-id="5764e-155">Кроме того, операторам должны быть присвоены соответствующие разрешения.</span><span class="sxs-lookup"><span data-stu-id="5764e-155">In addition, corresponding permissions must be granted to operators.</span></span>

<span data-ttu-id="5764e-156">Параметры **Пропустить** и **Пометить как зарегистрированный** включают информационные коды для регистрации некоторых конкретных сведений о сбое, например причину ошибки или обоснование пропуска финансовой регистрации или пометки проводки как зарегистрированной.</span><span class="sxs-lookup"><span data-stu-id="5764e-156">The **Skip** and **Mark as registered** options enable info codes to capture some specific information about the failure, such as the reason for the failure or a justification for skipping the fiscal registration or marking the transaction as registered.</span></span> <span data-ttu-id="5764e-157">Дополнительные сведения о том, как настроить параметры обработки ошибок, см. в разделе [Задание параметров обработки ошибок](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="5764e-157">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="optional-fiscal-registration"></a><span data-ttu-id="5764e-158">Необязательная финансовая регистрация</span><span class="sxs-lookup"><span data-stu-id="5764e-158">Optional fiscal registration</span></span>

<span data-ttu-id="5764e-159">Финансовая регистрация может быть обязательной для некоторых операций, но необязательной для других.</span><span class="sxs-lookup"><span data-stu-id="5764e-159">Fiscal registration might be mandatory for some operations but optional for others.</span></span> <span data-ttu-id="5764e-160">Например, финансовая регистрация регулярных продаж и возвратов может быть обязательной, но финансовая регистрация операций, которые относятся к депозитам клиентов, может быть необязательной.</span><span class="sxs-lookup"><span data-stu-id="5764e-160">For example, the fiscal registration of regular sales and returns might be mandatory, but the fiscal registration of operations that are related to customer deposits might be optional.</span></span> <span data-ttu-id="5764e-161">В этом случае если финансовая регистрация продажи не завершена, следует блокировать дальнейшую продажу, но отсутствие финансовой регистрации депозита клиента не должно блокировать дальнейшие продажи.</span><span class="sxs-lookup"><span data-stu-id="5764e-161">In this case, failure to complete the fiscal registration of a sale should block further sales, but failure to complete the fiscal registration of a customer deposit should not block further sales.</span></span> <span data-ttu-id="5764e-162">Чтобы различать обязательные и необязательные операции, рекомендуется обрабатывать их через разных поставщиков документов, а также настроить отдельные шаги в процессе финансовой регистрации для этих поставщиков.</span><span class="sxs-lookup"><span data-stu-id="5764e-162">To distinguish mandatory and optional operations, we recommend that you handle them through different document providers, and that you set up separate steps in the fiscal registration process for those providers.</span></span> <span data-ttu-id="5764e-163">Параметр **Продолжать при ошибках** должен быть включен для любого шага, связанного с необязательной финансовой регистрацией.</span><span class="sxs-lookup"><span data-stu-id="5764e-163">The **Continue on error** parameter should be enabled for any step that is related to optional fiscal registration.</span></span> <span data-ttu-id="5764e-164">Дополнительные сведения о том, как настроить параметры обработки ошибок, см. в разделе [Задание параметров обработки ошибок](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="5764e-164">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="manually-running-fiscal-registration"></a><span data-ttu-id="5764e-165">Выполнение финансовой регистрации вручную</span><span class="sxs-lookup"><span data-stu-id="5764e-165">Manually running fiscal registration</span></span>

<span data-ttu-id="5764e-166">Если финансовая регистрация проводки или события была отсрочена после сбоя (например, если оператор выбрал **Отменить** в диалоговом окне обработки ошибок), можно вручную повторно выполнить финансовую регистрацию путем вызова соответствующей операции.</span><span class="sxs-lookup"><span data-stu-id="5764e-166">If the fiscal registration of a transaction or event has been postponed after a failure (for example, if the operator selected **Cancel** in the error handling dialog box), you can manually rerun the fiscal registration by invoking a corresponding operation.</span></span> <span data-ttu-id="5764e-167">Дополнительные сведения см. в разделе [Включение выполнения вручную отложенной финансовой регистрации](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span><span class="sxs-lookup"><span data-stu-id="5764e-167">For more details, see [Enable manual execution of postponed fiscal registration](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span></span>

### <a name="fiscal-registration-health-check"></a><span data-ttu-id="5764e-168">Проверка состояния финансовой регистрации</span><span class="sxs-lookup"><span data-stu-id="5764e-168">Fiscal registration health check</span></span>

<span data-ttu-id="5764e-169">Процедуру проверки состояния для финансовых регистраций проверяет доступность финансового устройства или службы при возникновении определенных событий.</span><span class="sxs-lookup"><span data-stu-id="5764e-169">The health check procedure for fiscal registrations verifies the availability of the fiscal device or service when specific events occur.</span></span> <span data-ttu-id="5764e-170">Если финансовая регистрация в настоящее время не может быть выполнена, оператор уведомляется заранее.</span><span class="sxs-lookup"><span data-stu-id="5764e-170">If the fiscal registration can't currently be completed, the operator is notified in advance.</span></span>

<span data-ttu-id="5764e-171">POS выполняет проверку состояния при возникновении следующих событий:</span><span class="sxs-lookup"><span data-stu-id="5764e-171">The POS runs the health check when the following events occur:</span></span>

- <span data-ttu-id="5764e-172">Открыта новая проводка.</span><span class="sxs-lookup"><span data-stu-id="5764e-172">A new transaction is opened.</span></span>
- <span data-ttu-id="5764e-173">Повторно вызвана приостановленная проводка.</span><span class="sxs-lookup"><span data-stu-id="5764e-173">A suspended transaction is recalled.</span></span>
- <span data-ttu-id="5764e-174">Проводка продажи или возврата завершена.</span><span class="sxs-lookup"><span data-stu-id="5764e-174">A sales or return transaction is finalized.</span></span>

<span data-ttu-id="5764e-175">В случае сбоя проверки состояния POS открывает диалоговое окно проверки состояния.</span><span class="sxs-lookup"><span data-stu-id="5764e-175">If the health check fails, the POS shows the health check dialog box.</span></span> <span data-ttu-id="5764e-176">Это диалоговое окно содержит следующие кнопки:</span><span class="sxs-lookup"><span data-stu-id="5764e-176">This dialog box provides the following buttons:</span></span>

- <span data-ttu-id="5764e-177">**ОК** — данная кнопка позволяет оператору пропустить ошибку проверки состояния и продолжить выполнение операции.</span><span class="sxs-lookup"><span data-stu-id="5764e-177">**OK** – This button lets the operator ignore a health check error and continue to process the operation.</span></span> <span data-ttu-id="5764e-178">Операторы могут выбрать эту кнопку только тогда, когда для них включено разрешение **Разрешить пропускать ошибки проверки состояния**.</span><span class="sxs-lookup"><span data-stu-id="5764e-178">Operators can select this button only if the **Allow skip health check error** permission is enabled for them.</span></span>
- <span data-ttu-id="5764e-179">**Отмена** — если оператор выбирает эту кнопку, POS отменяет последнее действие (например, элемент не добавляется в новую проводку).</span><span class="sxs-lookup"><span data-stu-id="5764e-179">**Cancel** – If the operator selects this button, the POS cancels the last action (for example, an item isn't added to a new transaction).</span></span>

> [!NOTE]
> <span data-ttu-id="5764e-180">Проверка работоспособности выполняется только в том случае, если текущая операция требует финансовой регистрации, и если параметр **Продолжать при ошибках** отключен для текущего этапа процесса финансовой регистрации.</span><span class="sxs-lookup"><span data-stu-id="5764e-180">The health check is run only if the current operation requires fiscal registration, and if  the **Continue on error** parameter is disabled for the current step of the fiscal registration process.</span></span> <span data-ttu-id="5764e-181">Дополнительные сведения см. в разделе [Задание параметров обработки ошибок](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="5764e-181">For more details, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

## <a name="storing-fiscal-response-in-fiscal-transaction"></a><span data-ttu-id="5764e-182">Сохранение финансового ответа в финансовой проводке</span><span class="sxs-lookup"><span data-stu-id="5764e-182">Storing fiscal response in fiscal transaction</span></span>

<span data-ttu-id="5764e-183">При успешной финансовой регистрации проводки или события финансовая проводка создается в базе данных канала и связывается с исходной проводки или событием.</span><span class="sxs-lookup"><span data-stu-id="5764e-183">When fiscal registration of a transaction or event is successful, a fiscal transaction is created in the channel database and linked to the original transaction or event.</span></span> <span data-ttu-id="5764e-184">Аналогичным образом, если выбран параметр **Пропустить** или **Пометить как зарегистрированный** для сбойной финансовой регистрации, эта информация сохраняется в финансовой проводке.</span><span class="sxs-lookup"><span data-stu-id="5764e-184">Similarly, if the **Skip** or **Mark as registered** option is selected for a failed fiscal registration, this information is stored in a fiscal transaction.</span></span> <span data-ttu-id="5764e-185">Финансовая проводка содержит финансовый ответ финансового устройства или службы.</span><span class="sxs-lookup"><span data-stu-id="5764e-185">A fiscal transaction holds the fiscal response of the fiscal device or service.</span></span> <span data-ttu-id="5764e-186">Если процесс финансовой регистрации состоит из нескольких шагов, финансовая проводка создается для каждого шага процесса, который привел к успешной и неудачной регистрации.</span><span class="sxs-lookup"><span data-stu-id="5764e-186">If the fiscal registration process consists of several steps, a fiscal transaction is created for each step of the process that resulted in a successful or failed registration.</span></span>

<span data-ttu-id="5764e-187">Финансовые проводки переносятся в Headquarters с помощью *P-задания*, вместе с проводками.</span><span class="sxs-lookup"><span data-stu-id="5764e-187">Fiscal transactions are transferred to Headquarters by the *P-job*, together with transactions.</span></span> <span data-ttu-id="5764e-188">На экспресс-вкладке **Финансовые проводки** страницы **Проводки магазина** можно просмотреть финансовые проводки, которые связаны с проводкой розничной торговли.</span><span class="sxs-lookup"><span data-stu-id="5764e-188">On the **Fiscal transactions** FastTab of the **Store transactions** page, you can view the fiscal transactions that are linked to transactions.</span></span>

<span data-ttu-id="5764e-189">В финансовой проводке хранятся следующие сведения:</span><span class="sxs-lookup"><span data-stu-id="5764e-189">A fiscal transaction stores the following details:</span></span>

- <span data-ttu-id="5764e-190">Сведения о процессе финансовой регистрации (процесс, группа соединителей, соединитель и т. д.).</span><span class="sxs-lookup"><span data-stu-id="5764e-190">Fiscal registration process details (process, connector group, connector, and so on).</span></span> <span data-ttu-id="5764e-191">В них также хранятся серийный номер финансового устройства в поле **Номер регистратора**, если эти сведения включаются в финансовый ответ.</span><span class="sxs-lookup"><span data-stu-id="5764e-191">It also stores the serial number of the fiscal device in the **Register number** field, if this information is included in the fiscal response.</span></span>
- <span data-ttu-id="5764e-192">Статус финансовой регистрации: **Завершено** для успешной регистрации, **Пропущено**, если оператор выбрал параметр **Пропустить** для сбойной регистрации, или **Помечено как зарегистрированный**, если оператор выбрал параметр **Пометить как зарегистрированный**.</span><span class="sxs-lookup"><span data-stu-id="5764e-192">The status of the fiscal registration: **Completed** for successful registration, **Skipped** if the operator selected the **Skip** option for a failed registration, or **Marked as registered** if the operator selected the **Mark as registered** option.</span></span>
- <span data-ttu-id="5764e-193">Проводки информационных кодов, связанных с выбранной финансовой проводкой.</span><span class="sxs-lookup"><span data-stu-id="5764e-193">Info code transactions that are related to a selected fiscal transaction.</span></span> <span data-ttu-id="5764e-194">Для просмотра проводок информационных кодов на экспресс-вкладке **Финансовые проводки** выберите финансовую проводку, которая имеет статус **Пропущено** или **Помечено как зарегистрированный**, затем выберите **Проводки с инфокодом**.</span><span class="sxs-lookup"><span data-stu-id="5764e-194">To view the info code transactions, on the **Fiscal transactions** FastTab, select a fiscal transaction that has a status of **Skipped** or **Marked as registered**, and then select **Info code transactions**.</span></span>

## <a name="fiscal-texts-for-discounts"></a><span data-ttu-id="5764e-195">Финансовые тексты для скидок</span><span class="sxs-lookup"><span data-stu-id="5764e-195">Fiscal texts for discounts</span></span>

<span data-ttu-id="5764e-196">В некоторых странах или регионах имеются особые требования к дополнительным текстам, который должен быть напечатан на финансовых чеках, когда применяются различные виды скидок.</span><span class="sxs-lookup"><span data-stu-id="5764e-196">Some countries or regions have special requirements about additional texts that must be printed on fiscal receipts when different kinds of discounts are applied.</span></span> <span data-ttu-id="5764e-197">Функции финансовой интеграции позволяют настроить специальный текст для скидки, который будет печататься после строки скидки на фискальном чеке.</span><span class="sxs-lookup"><span data-stu-id="5764e-197">The fiscal integration functionality lets you set up a special text for a discount that is printed after a discount line on a fiscal receipt.</span></span> <span data-ttu-id="5764e-198">Для ручных скидок можно настроить финансовый текст для информационного кода, который указан в качестве информационного кода **Скидка для продукта** в профиле функциональности POS.</span><span class="sxs-lookup"><span data-stu-id="5764e-198">For manual discounts, you can configure a fiscal text for the info code that is specified as the **Product discount** info code in the POS functionality profile.</span></span> <span data-ttu-id="5764e-199">Дополнительную информацию о том, как настроить финансовые тексты для скидок, см. в разделе [Настройка финансовых текстов для скидок](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span><span class="sxs-lookup"><span data-stu-id="5764e-199">For more details about how to set up fiscal texts for discounts, see [Set up fiscal texts for discounts](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span></span>

## <a name="printing-fiscal-x-and-fiscal-z-reports"></a><span data-ttu-id="5764e-200">Печать финансовых X- и Z-отчетов</span><span class="sxs-lookup"><span data-stu-id="5764e-200">Printing fiscal X and fiscal Z reports</span></span>

<span data-ttu-id="5764e-201">Функциональные возможности финансовой интеграции поддерживают создание отчетов на конец дня, которые относятся к конкретному интегрированному финансовому устройству или службе:</span><span class="sxs-lookup"><span data-stu-id="5764e-201">Fiscal integration functionality supports generation of end-of-day statements that are specific to the integrated fiscal device or service:</span></span>

- <span data-ttu-id="5764e-202">Новые кнопки, которые выполняют соответствующие операции, должны быть добавлены в макет экрана POS.</span><span class="sxs-lookup"><span data-stu-id="5764e-202">New buttons that run corresponding operations should be added to the POS screen layout.</span></span> <span data-ttu-id="5764e-203">Дополнительные сведения см. в разделе [Настройка финансовых X-/Z-отчетов с POS](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span><span class="sxs-lookup"><span data-stu-id="5764e-203">For more details, see [Set up fiscal X/Z reports from the POS](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span></span>
- <span data-ttu-id="5764e-204">В примере финансовой интеграции этих операции должны соответствовать соответствующим операциям финансового устройства.</span><span class="sxs-lookup"><span data-stu-id="5764e-204">In the fiscal integration sample, these operations should be matched to the corresponding operations of the fiscal device.</span></span>

## <a name="fiscal-integration-samples-in-the-retail-sdk"></a><span data-ttu-id="5764e-205">Примеры финансовой интеграции в пакете Retail SDK</span><span class="sxs-lookup"><span data-stu-id="5764e-205">Fiscal integration samples in the Retail SDK</span></span>

<span data-ttu-id="5764e-206">Следующие примеры финансовой интеграции в настоящее время доступны в Retail SDK:</span><span class="sxs-lookup"><span data-stu-id="5764e-206">The following fiscal integration samples are currently available in the Retail SDK:</span></span>

- [<span data-ttu-id="5764e-207">Пример интеграции фискальных принтеров для Италии</span><span class="sxs-lookup"><span data-stu-id="5764e-207">Fiscal printer integration sample for Italy</span></span>](emea-ita-fpi-sample.md)
- [<span data-ttu-id="5764e-208">Пример интеграции фискальных принтеров для Польши</span><span class="sxs-lookup"><span data-stu-id="5764e-208">Fiscal printer integration sample for Poland</span></span>](emea-pol-fpi-sample.md)
- [<span data-ttu-id="5764e-209">Пример интеграции службы финансовой регистрации для Австрии</span><span class="sxs-lookup"><span data-stu-id="5764e-209">Fiscal registration service integration sample for Austria</span></span>](emea-aut-fi-sample.md)
- [<span data-ttu-id="5764e-210">Пример интеграции службы финансовой регистрации для Чешской Республики</span><span class="sxs-lookup"><span data-stu-id="5764e-210">Fiscal registration service integration sample for Czech Republic</span></span>](emea-cze-fi-sample.md)
- [<span data-ttu-id="5764e-211">Пример интеграции с блоком управления для Швеции</span><span class="sxs-lookup"><span data-stu-id="5764e-211">Control unit integration sample for Sweden</span></span>](./emea-swe-fi-sample.md)
- [<span data-ttu-id="5764e-212">Пример интеграции службы финансовой регистрации для Германии</span><span class="sxs-lookup"><span data-stu-id="5764e-212">Fiscal registration service integration sample for Germany</span></span>](./emea-deu-fi-sample.md)

<span data-ttu-id="5764e-213">Следующие функциональные возможности финансовой интеграции также доступны в пакете Retail SDK, но в данный момент не используют преимущества платформы финансовой интеграции.</span><span class="sxs-lookup"><span data-stu-id="5764e-213">The following fiscal integration functionality is also available in the Retail SDK but doesn't currently take advantage of the fiscal integration framework.</span></span> <span data-ttu-id="5764e-214">Перенос этих финансовых возможностей в платформу финансовой интеграции планируется в последующих обновлениях.</span><span class="sxs-lookup"><span data-stu-id="5764e-214">Migration of this functionality to the fiscal integration framework is planned for later updates.</span></span>


- [<span data-ttu-id="5764e-215">Цифровая подпись для Франции</span><span class="sxs-lookup"><span data-stu-id="5764e-215">Digital signature for France</span></span>](emea-fra-cash-registers.md)
- [<span data-ttu-id="5764e-216">Цифровая подпись для Норвегии</span><span class="sxs-lookup"><span data-stu-id="5764e-216">Digital signature for Norway</span></span>](emea-nor-cash-registers.md)

<span data-ttu-id="5764e-217">Следующие устаревшие функции финансовой интеграции, доступные в Retail SDK, не используют структуру финансовой интеграции и будут удалены в последующих обновлениях:</span><span class="sxs-lookup"><span data-stu-id="5764e-217">The following legacy fiscal integration functionality that is available in Retail SDK does not use the fiscal integration framework and will be deprecated in later updates:</span></span>

- [<span data-ttu-id="5764e-218">Пример интеграции с блоком управления для Швеции (устар.)</span><span class="sxs-lookup"><span data-stu-id="5764e-218">Control unit integration sample for Sweden (legacy)</span></span>](./retail-sdk-control-unit-sample.md)


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
---
title: Функциональность контрольно-кассовой машины для Норвегии
description: В этой статье представлен обзор функций ККМ, доступных для Норвегии в Microsoft Dynamics 365 Commerce, а также приводятся указания по настройке функций.
author: EvgenyPopovMBS
ms.date: 12/20/2021
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: josaw
ms.search.validFrom: 2017-10-31
ms.openlocfilehash: 42eda805646dbb30b40528254a3137102e3075e4
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/12/2022
ms.locfileid: "9292745"
---
# <a name="cash-register-functionality-for-norway"></a>Функциональность контрольно-кассовой машины для Норвегии

[!include[banner](../includes/banner.md)]

В этой статье представлен обзор функций ККМ, доступных для Норвегии в Dynamics 365 Commerce. Кроме того, в ней приводятся указания по настройке функций. Функции состоят из следующих частей:

- Общие возможности POS, доступные для клиентов во всех странах или регионах. Примеры включают в себя параметр, позволяющий предотвратить печать копии чека более одного раза.
- Специфичные для Норвегии функции, такие как цифровые подписи для проводок по продажам.

## <a name="overview-of-cash-register-functionality-for-norway"></a>Обзор функций ККМ для Норвегии

### <a name="common-pos-features"></a>Общие возможности POS

Сведения о функциях POS, доступных клиентам во всех странах или регионах, см. в разделе [Справочные ресурсы для Dynamics 365 Retail](../index.md).

Следующие функции локализации POS, которые ранее были реализованы и сделаны доступными для клиентов во всех странах или регионах, могут теперь быть использованы специально для Норвегии:

- **Печать текстовых полей в чеке с крупным размером шрифта.** Можно использовать параметр **Размер шрифта** в конструкторе формата чеков, чтобы указать, что для поля в формате чеков должен использоваться крупный размер шрифта. (Крупный размер шрифта примерно вдвое больше обычного размера шрифта.) Например, этот параметр можно использовать для печати индикатора "Копия" на копии чека большими буквами.
- **Регистрация печати копий чеков в журнале событий аудита POS.** Можно использовать параметр **Аудит** в профиле функциональности POS, чтобы разрешить печать копий чеков и регистрацию других событий аудита POS. События аудита регистрируются в базе данных канала и в Headquarters. События аудита можно просмотреть на странице **События аудита**.
- **Запрет печати копии чека более одного раза.** При включенном параметре **Аудит** в профиле функциональности POS разрешение POS- терминала **Разрешить печать копий чеков** определяет, можно ли печатать копии чеков. Имеется также параметр, позволяющий предотвратить печать копии чека более одного раза.

Кроме того, следующая функция POS была реализована для Норвегии, но доступного для клиентов во всех странах или регионах:

- **Регистрация дополнительных событий в журнале событий аудита POS.** Если параметр **Аудит** в профиле функциональности POS активирован, в журнале событий аудита POS регистрируются следующие события:

    - Проверки цены
    - Переопределения налога
    - Исправления в количествах по строкам
    - Удаление проводок из базы данных канала

### <a name="norway-specific-pos-features"></a>Функции POS, специфичные для Норвегии

Следующие специфичные для Норвегии возможности POS-терминала активны, когда для параметра **Код ISO** в профиле функциональности POS установлено значение **Нет**.

#### <a name="digital-signing-of-sales-transactions"></a>Цифровая подпись проводок по продажам

Каждая проводка по продаже имеет цифровую подпись. Подпись создается и записывается в журнал проводок POS-терминала одновременно с окончательным завершением проводки. Подпись также доступна в журнале, который экспортируется для целей аудита.

Подписываются только проводки для продаж через кассу. Вот несколько примеров проводок, исключаемых из процесса подписания:

- Предоплата (депозит на счет клиента)
- Предоплаты для заказов на продажу (депозит по заказу клиента)
- Выпуск подарочного сертификата
- Проводки, не связанные с продажей (ввода остатка в кассе, изъятие денежных средств и т. д.)

Подписанные данные представляют собой текстовую строку, состоящую из следующих полей данных. Поля данных разделяются точками с запятой.

1. Предыдущая подпись для того же POS (Для первой проводки используется нулевое значение \[**0**\].)
2. Дата проводки
3. Время проводки
4. Последовательный номер проводки с подписью
5. Сумма проводки, включая налог
6. Сумма проводки без налога

Процесс цифровой подписи использует ключ RSA 1024-бита, который имеет хэш-функцию SHA-1 (RSA-SHA1-1024). Сертификат, устанавливаемый в Commerce Scale Unit, используется для подписания. Уникальный идентификатор сертификата (отпечаток) записывается вместе с подписью.

Подпись хранится в базе данных магазина и в базе данных Headquarters (HQ) вместе с данными проводки. Подпись проводки вместе с данными проводки, которые использовались для ее создания, можно просмотреть на экспресс-вкладке **Финансовые проводки** страницы **Проводки магазина**.

#### <a name="receipts"></a>Поступления

Чеки для Норвегии могут включать дополнительную информацию, которая была реализована с помощью пользовательских полей:

- **Название чека** — можно добавить поле к макету формата чеков, чтобы указать тип чека. Например, чек по продаже будет включать текст "Чек по продаже".
- **Последовательный номер подписанной проводки** — в чеке может появиться порядковый номер подписанной проводки, чтобы связать печатный чек с цифровой подписью в базе данных.
- **Итого по чеку** — настраиваемые поля для итоговых сумм по чеку исключаются суммы, не относящиеся к продажам, из итоговых сумм проводок. Суммы, не относящиеся к продажам, включают суммы для следующих операций:

    - Предоплата (депозит на счет клиента)
    - Предоплаты для заказов на продажу (депозит по заказу клиента)
    - Выпуск подарочного сертификата
    - Добавление средств на подарочный сертификат

#### <a name="x-and-z-reports"></a>Отчеты X и Z

Информация, включенная в отчеты X и Z, основана на норвежских требованиях. Например, суммы **Итого продаж за наличные** включает только суммы для проводок по кассовым продажам и не включает выпуск подарочных сертификатов и предоплаты. Общие продажи за наличные также перечисляются по номенклатурным группам и методам оплаты. Кроме того, накопительные суммы **Итого продажи** и **Итого возвраты** ведутся и распечатываются.

#### <a name="saf-t-cash-register-audit-file"></a>Файл аудита контрольно-кассовой машины SAF-T

Можно экспортировать журнал проводок по POS-терминалу в предопределенном формате контрольно-кассовой машины "Стандартный файл аудита — налог (SAF-T)". Файл аудита содержит сведения об организации, соответствующие основные данные (такие как группы номенклатур, номенклатуры и налоговые коды), данные проводок по продажам через кассу вместе с подписями для этих проводок, данные событий, не связанных с продажами, и данные отчета на конец даты.

Файл аудита может быть экспортирован в следующих сценариях:

- На магазин
- Все магазины
- На терминал
- Все терминалы

Можно также отправить отчет из одного юридического лица от имени другого юридического лица. В этом случае необходимо выполнить экспорт из операционного юридического лица и указать юридическое лицо отчетности в качестве отправителя отчета.

Формат контрольно-кассовых машин SAF-T реализуется в Headquarters с помощью [электронной отчетности](../../fin-ops-core/dev-itpro/analytics/general-electronic-reporting.md). 

## <a name="setting-up-commerce-for-norway"></a>Настройка Commerce для Норвегии

В этом разделе описываются параметры, которые относятся к Норвегии и рекомендованы для нее. Дополнительные сведения см. в [справочных ресурсах для Dynamics 365 Retail](../index.md).

Для использования функций, специфичных для Норвегии, необходимо выполнить следующие задачи:

- Задайте в поле **Страна/регион** значение **NOR** (Норвегия) в основном адресе юридического лица.
- Задайте в поле **Код ISO** значение **NO** (Норвегия) в профиле функциональности POS каждого магазина, расположенного в Норвегии.

Также необходимо указать следующие параметры для Норвегии.

### <a name="set-up-the-legal-entity"></a>Настройка юридического лица

Убедитесь, что имя юридического лица указано. Это имя будет напечатано в отчетах X и Z.

Кроме того, на экспресс-вкладке **Сведения о банковском счете** в поле **Код банка** укажите номер организации.

### <a name="set-up-value-added-tax-vat-per-norwegian-requirements"></a>Настройка налога на добавленную стоимость (НДС) в соответствии с норвежскими требованиями


Необходимо создать коды налога, налоговые группы и налоговые группы номенклатур. Необходимо также настроить сведения о налогах для продуктов и услуг. Дополнительные сведения о настройке кодов и использовании налогов см. в разделе [Обзор налогов](../../finance/general-ledger/indirect-taxes-overview.md).

Также необходимо указать налоговые группы и включить параметр **Цены включают налог** для магазинов, которые находятся в Норвегии.

### <a name="set-up-functionality-profiles"></a>Настройка профилей функциональности

Необходимо включить аудит и настроить нумерацию чеков.

### <a name="update-pos-permissions-groups-and-individual-permission-settings-for-store-workers"></a>Обновление групп разрешений POS и параметров индивидуальных разрешений для работников магазина

Установите для разрешения **Разрешить печать копий чеков** соответствующее значение:

- **Всегда разрешать** — оператор может напечатать копию чека несколько раз.
- **Разрешить только один раз** — оператор может напечатать копию чека только один раз.
- **Разрешить только один раз, и только если доступна HQ DB** — оператор может напечатать копию чека только один раз и только в том случае, если база данных HQ доступна через Commerce Data Exchange: служба реального времени, чтобы система могла проверить, что копия чека ранее не была распечатана в каком-либо магазине.
- **Никогда** — оператор не может напечатать копию чека.

### <a name="configure-custom-fields-so-that-they-can-be-used-in-receipt-formats-for-sales-receipts"></a>Настройка настраиваемых полей таким образом, чтобы их можно было использовать в форматах чеков для чеков на продажу

На странице **Текст языка** добавьте следующие записи для меток настраиваемых полей для макетов чеков. Обратите внимание на то, что значения **Код языка**, **Код текста** и **Текст**, показанные в таблице, являются просто примерами. Их можно изменить в зависимости от требований.

| Код языка | Текст                   | Код текста |
|-------------|------------------------|---------|
| en-US       | Заголовок чека          | 900011  |
| en-US       | Является подарочным сертификатом           | 900012  |
| en-US       | Всего (продажи)          | 900013  |
| en-US       | Общий налог (продажи)      | 900014  |
| en-US       | Итого с налогом (продажи) | 900015  |
| en-US       | Сумма налога (продажи)     | 900016  |
| en-US       | Код проводки по кассе    | 900017  |

На странице **Настраиваемые поля** добавьте следующие записи для настраиваемых полей для макетов чеков. Обратите внимание, что значения **Код текста подписи** должны соответствовать значениям **Код текста**, указанным на странице **Текст языка**.

| Имя                            | Тип    | ИД текста заголовка |
|---------------------------------|---------|-----------------|
| ReceiptTitle                    | Чек | 900011          |
| IsGiftCard                      | Чек | 900012          |
| SalesTotalExt                   | Чек | 900013          |
| TaxTotalExt                     | Чек | 900014          |
| TotalWithTaxExt                 | Чек | 900015          |
| AmountPerTaxExt                 | Чек | 900016          |
| CashTransactionSequentialNumber | Чек | 900017          |

> [!NOTE]
> Важно указать правильные имена настраиваемых полей, как перечислено в таблице выше. Неправильное имя настраиваемого поля приведет к пропущенным данным в чеках.

### <a name="configure-receipt-formats"></a>Настройка форматов чеков

Для всех требуемых форматов чеков измените значение в поле **Поведение печати** на **Всегда печатать** для формата чека.

В конструкторе формата чеков добавьте следующие настраиваемые поля в соответствующие разделы чека. Обратите внимание, что имена полей соответствуют текстам языка, определенным в предыдущем разделе.

1. Заголовок:

    - **Заголовок чека** — это поле определяет тип чека.
    - **Код кассовой проводки** — в этом поле печатается порядковый номер кассовой проводки с подписью.

2. Строки:

    - **Является подарочным сертификатом** — в этом поле строка чека отмечается как связанная с операцией выпуска подарочного сертификата или пополнения подарочного сертификата.

3. Нижний колонтитул:

    - **Всего (продажи)** — в этом поле распечатывается общая сумма кассовых продаж по чеку. Сумма не включает налог. Операции с предоплатой и подарочными картами исключаются.
    - **Итого налог (продажи)** — в этом поле распечатывается общая сумма налога для кассовых продаж по чеку. Операции с предоплатой и подарочными картами исключаются.
    - **Итого с налогом (продажи)** — в этом поле распечатывается общая сумма кассовых продаж по чеку. Сумма включает налог. Операции с предоплатой и подарочными картами исключаются.
    - **Сумма налога (продажи)** — в этом поле распечатывается сумма налога для кассовых продаж по чеку по налоговым кодам. Операции с предоплатой и подарочными картами исключаются.

Дополнительные сведения о работе с форматами чеков см. в разделе [Настройка и конструирование форматов чеков](../receipt-templates-printing.md).

### <a name="configure-the-saf-t-cash-register-export-format"></a>Настройка формата экспорта контрольно-кассовых машин SAF-T

Конфигурация контрольно-кассовых машин SAF-T доступна для загрузки с Microsoft Dynamics Lifecycle Services (LCS). Дополнительные сведения см. в разделе [Импорт конфигураций электронной отчетности](../../fin-ops-core/dev-itpro/analytics/electronic-reporting-import-ger-configurations.md). Необходимо загрузить следующие конфигурации:

- **Данные канала розничной торговли.версия.1** — конфигурация модели данных.
- **Данные канала розничной торговли DMM.версия.1** — конфигурация сопоставления модели данных.
- **Контрольно-кассовые машины NO SAF T.версия.1.20** — конфигурация формата.

После импорта конфигураций на странице **Параметры Commerce** на вкладке **Электронные документы** в поле **Формат экспорта контрольно-кассовой машины SAF-T** выберите имя импортированной конфигурации формата.

Необходимо также сопоставить необходимые основные данные с заранее определенными стандартными кодами SAF-T. Дополнительные сведения см. в документации по контрольно-кассовым машинам SAF-T, предоставляемой норвежской налоговой администрацией. Чтобы создать сопоставление, необходимо установить новое поле **Код контрольно-кассовой машины SAF-T** на следующих страницах:

- Номенклатурные группы
- Методы оплаты
- Налоговые коды

### <a name="configure-channel-components"></a>Настройка компонентов канала

Для включения функций, учитывающих специфику Норвегии, необходимо настроить компоненты канала. Дополнительные сведения см. в [руководствах по развертыванию](emea-nor-fi-deployment.md).

[!INCLUDE[footer-include](../../includes/footer-banner.md)]

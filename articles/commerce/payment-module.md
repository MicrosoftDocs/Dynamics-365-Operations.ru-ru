---
title: Модуль платежа
description: В этой статье описываются модуль платежа, а также описывается, как настраивать его в Microsoft Dynamics 365 Commerce.
author: anupamar-ms
ms.date: 04/12/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application user
ms.reviewer: v-chgri
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: anupamar
ms.search.validFrom: 2019-10-31
ms.dyn365.ops.version: Release 10.0.14
ms.openlocfilehash: a89ca5dd4f46611e75faccd3213028750fa48d35
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2022
ms.locfileid: "8850283"
---
# <a name="payment-module"></a>Модуль платежа

[!include [banner](includes/banner.md)]

В этой статье описываются модуль платежа, а также описывается, как настраивать его в Microsoft Dynamics 365 Commerce.

Модуль платежа позволяет клиентам оплачивать заказы, используя кредитные или дебетовые карты. Интеграция оплаты для этого модуля осуществляется с помощью соединителя платежей Dynamics 365 для Adyen. Дополнительные сведения о настройке соединителя платежей см. в разделе [Соединитель платежей Dynamics 365 для Adyen](dev-itpro/adyen-connector.md).  

В выпуске Commerce 10.0.14 модуль платежей интегрирован с соединителем платежей Dynamics 365 для PayPal, чтобы клиенты были оплачивать заказы с помощью PayPal. Дополнительные сведения о настройке соединителя платежей Dynamics 365 Payment Connector для PayPal см. в разделе [Соединитель платежей Dynamics 365 для PayPal](paypal.md). 

## <a name="dynamics-365-payment-connector-for-adyen"></a>Соединитель платежей Dynamics 365 для Adyen 

В модуле платежа размещается информация о платеже, которая обрабатывается через Adyen в встраиваемый кадре HTML (iFrame). Модуль платежа взаимодействует с Commerce Scale Unit для получения информации об Adyen платеже. В рамках взаимодействий в Commerce Scale Unit модуль платежа позволяет обслуживать данные адреса для выставления счетов либо в iframe через Adyen, либо в отдельном модуле. В теме Fabrikam адрес для выставления счетов включен в отдельном модуле. Такой подход позволяет увеличить гибкость форматирования, так как строки адреса могут быть отображены таким образом, чтобы они соответствовали строкам адреса доставки.

Модуль платежа позволяет также пользователям, вошедшим в систему, сохранять их сведения о платежах. Сведения о платеже и адрес для выставления счета сохраняются и управляются через соединитель платежа Adyen.

Модуль платежа охватывает все расходы по заказу, которые еще не покрыты баллами программы лояльности или подарочным сертификатом. Если итог по заказу охватывается полностью в соответствии с баллами программы лояльности или подарочным сертификатом, то модуль платежа будет скрытым, и клиент сможет разместить заказ без него.

Соединитель платежей Adyen также поддерживает строгая проверка подлинности клиентов (SCA). В составе пересмотренной Директивы о платежных услугах Европейского союза (ЕС) (PSD2) требуется, чтобы в интернет покупатели проходили проверку подлинности за пределами интерактивного процесса покупки, если они используют электронный способ оплаты. Во время потока оформления заказа клиенты перенаправляются на сайт банковских услуг, а затем после проверки подлинности они перенаправляются обратно в поток оформления заказа Commerce. Во время этого перенаправления сведения, введенные клиентом в потоке оформления заказа (например, адрес доставки, параметры поставки, сведения о подарочном сертификате и сведения о программе лояльности) будут сохранены. Прежде чем можно будет включить функцию соединителя платежей Adyen, необходимо настроить соединитель платежей для SCA в Commerce Headquarters. Дополнительные сведения см. в [Строгая проверка подлинности клиентов с помощью Adyen](adyen_redirect.md). Эта функция была включена в выпуске Commerce 10.0.12.

> [!NOTE]
> Для соединителя платежей Adyen модуль IFRAME в модуле платежа может быть визуализирован только в том случае, если добавить URL-адрес Adyen в список разрешенных веб-сайтов. Чтобы выполнить этот шаг, добавьте **\*.adyen.com** в директивы **child-src**, **connect-src**, **img-src**, **script-src** и **style-src** в политике безопасности содержимого вашего сайта. Дополнительные сведения см. в разделе [Управление политикой безопасности содержимого](manage-csp.md). 

На следующем рисунке показан пример модулей подарочных сертификатов, лояльности и платежей Adyen на странице оформления заказа.

![Пример модулей подарочных сертификатов, баллов по программе лояльности и платежей Adyen на странице оформления заказа.](./media/ecommerce-payments.PNG)

## <a name="dynamics-365-payment-connector-for-paypal"></a>Dynamics 365 Payment Connector для PayPal

В выпуске Commerce 10.0.14 модуль платежей также интегрируется с соединителем платежей Dynamics 365 для PayPal. Дополнительные сведения о настройке этого соединителя платежей см. в разделе [Соединитель платежей Dynamics 365 для PayPal](paypal.md).
 
На странице оформления заказа можно настроить соединители как для Adyen, так и для PayPal. В модуле платежей были добавлены дополнительные свойства, помогающие определить, с каким соединителем он должен работать. Дополнительные сведения см. в свойствах модуля **Поддерживаемые типы платежных средств** и **Основной способ платежа** в. следующей таблице.
  
Когда модуль платежей настроен для использования соединителя платежей PayPal, на странице оформления заказа появляется кнопка PayPal. При вызове клиентом модулем платежа отображает IFRAME, содержащий информацию о PayPal. Клиент может войти в систему и предоставить сведения PayPal в этом интернет-кадре iframe для выполнения проводки. Когда клиент выбирает оплату с помощью PayPal, остаток сальдо по заказу будет выставлен через PayPal.

Соединителю платежей PayPal не требуется модуль адреса выставления счетов, поскольку вся информация, связанная с выставлением счетов, обрабатывается в рамках интернет-кадра iFrame PayPal. Однако требуются модули адреса отгрузки и параметров доставки.

На следующем рисунке показан пример двух модулей платежей на странице оформления заказа, одна настроена с помощью соединителя платежей Adyen, а другая с помощью соединителя платежей PayPal.
![Пример модулей платежей Adyen и PayPal на странице оформления заказа.](./media/ecommerce-paypal.png)

На следующем рисунке показан пример интернет-кадра iframe для PayPal, вызванный с помощью кнопки PayPal. 
![Пример интернет-кадра iFrame Paypal на странице оформления заказа.](./media/ecommerce-paypal-iframe.png)

## <a name="payment-module-properties"></a>Свойства модуля платежа

| Имя свойства | Значения | описание |
|---------------|--------|-------------|
| Заголовок | Текст заголовка | Необязательный заголовок для модуля платежа. |
| Высота iframe | Пиксели | Высота iframe в пикселах. При необходимости высоту можно скорректировать. |
| Показать адрес выставления счетов | **True** или **False** | Если это свойство имеет значение **Истина**, адрес для выставления счетов будет обслуживаться Adyen в iframe модуля платежа. Если установлено значение **False**, адрес для выставления счетов не будет обслуживаться системой Adyen, и пользователь Commerce будет должен настроить модуль для отображения адреса для выставления счетов на странице оформления заказа. Для соединителя платежей PayPal это поле не оказывает влияния, поскольку адрес выставления счетов полностью обрабатывается в PayPal. |
| Переопределение стиля платежей | Код каскадных таблиц стилей (CSS) | Так как модуль платежа размещен в iframe, имеется ограничение возможностей стилизации. С помощью этого свойства можно добиться определенного стиля. Чтобы переопределить стили сайта, необходимо вставить код CSS в качестве значения этого свойства. Переопределения и стили конструктора сайтов CSS не применяются к этому модулю. |
|Поддерживаемые типы платежных средств| Строка| Если настроено несколько соединителей платежей, следует предоставить поддерживаемую строку типа платежного средства, определенную в конфигурации соединителя платежей Commerce Headquarters (см. следующее изображение). Если поле пусто, по умолчанию используется соединитель платежей Adyen. Добавлено в Commerce выпуска 10.0.14.|
|Основной платеж|  **True** или **False** | Если установлено значение **True**, все сообщения об ошибках будут создаваться из основного соединителя платежей на странице оформления заказа. Если настроены оба соединителя платежей Adyen и PayPal, установите Adyen в значение **True**, которое было добавлено в выпуске Commerce 10.0.14.|
|Использовать ИД соединителя| **True** или **False** | Это свойство используется, если для сайта настроено несколько соединителей платежей. Если значение **True**, соединителям потребуется использовать идентификатор соединителя для корреляции платежей.|
|Использовать заданный в браузере кода языка для iFrame|  **True** или **False** | (Только для Adyen) Если значение **True**, Adyen iFrame будет отображать язык на основе контекста браузера пользователя сайта вместо использования кода языка канала Commerce, настроенного для этого сайта. Добавлено в Commerce выпуска 10.0.27.|

На следующем рисунке показан пример значения **Поддерживаемые типы платежных средств**, равного "PayPal", в конфигурации соединителя платежей в Commerce Headquarters.
![Пример поддерживаемых типов платежных средств в Commerce Headquarters.](./media/ecommerce-paymenttendertypes.png)

## <a name="billing-address"></a>Адрес выставления счета

Модуль адреса выставления счетов может использоваться на странице оформления заказа, если строки адреса выставления счетов соединителя платежа Adyen недостаточно хорошо соответствуют внешнему виду оставшейся части сайта. 

Для использования модуля адреса выставления счетов на странице оформления заказа, когда модуль оплаты интегрирован с соединителем платежей Adyen, установите для свойства **Показать адрес выставления счетов** значение **False**, чтобы можно было использовать выделенный модуль адреса выставления счетов вместо адреса выставления счетов Adyen по умолчанию. В этом случае автор сайта должен включить модуль адреса выставления счетов на страницу оформления заказа. Соединитель платежей Adyen также позволяет использовать адрес доставки в качестве адреса для выставления счетов, чтобы свести к минимуму число шагов для пользователя сайта.

Аналогично модулям платежей, в модуль адреса выставления счетов в выпуске Commerce 10.0.14 было добавлено свойство **Поддерживаемые типы платежных средств**. Значение этого свойства должно совпадать со значением, указанным в модуле платежей, чтобы убедиться в том, что они работают вместе. Для соединителя платежей Adyen как модуль платежей, так и модуль адреса выставления счетов должны оставлять это значение пустым (состояние по умолчанию). Для соединителя PayPal выделенный модуль адреса выставления счетов не требуется. Для других типов соединителей платежей строка должна быть указана как настроенная в Commerce Headquarters.

## <a name="add-a-payment-module-to-a-checkout-page-and-set-the-required-properties"></a>Добавление модуля платежа на страницу оформления заказа и задание необходимых свойств

Модуль платежа может быть добавлен только в модуль оформления заказа. Дополнительные сведения о настройке модуля платежа для страницы оформления заказа см. в разделе [Модуль оформления заказа](add-checkout-module.md).

## <a name="configure-the-adyen-and-paypal-payment-connectors-when-both-are-used"></a>Настройка соединителей платежей Adyen и PayPal, если они оба используются

Если для вашего сайта будут использоваться оба соединителя платежей Adyen и PayPal, выполните следующие шаги в констуркторе сайтов Commerce, чтобы добавить модули оплаты для каждого соединителя в модуль оформления, затем настройте свойства для каждого модуля.

1. В области свойств модуля платежей PayPal выполните следующие действия:

    1. В поле для свойства **Поддерживаемые типы платежных средств** введите **PayPal**.
    1. Снимите флажок для свойства **Является основным платежом**.
    1. Установите флажок для свойства **Использовать код соединителя**.

1. В области свойств модуля платежей Adyen выполните следующие действия:

    1. Оставьте поле для свойства **Поддерживаемые типы платежных средств** пустым.
    1. Установите флажок для свойства **Является основным платежом**.
    1. Установите флажок для свойства **Использовать код соединителя**.

> [!NOTE]
> При настройке соединителей Adyen и PayPal для совместного использования конфигурация **Dynamics 365 Payment Connector для Adyen** должна быть установлена в первой позиции в конфигурации соединителей **Счета оплаты** интернет-канала в Commerce Headquarters. Чтобы проверить или изменить порядок соединителей, перейдите в раздел **Интернет-магазины** и выберите канал для сайта. Затем на вкладке **Настройка** на экспресс-вкладке **Счета оплаты** в разделе **Соединитель** убедитесь, что конфигурация **Dynamics 365 Payment Connector для Adyen** находится в первой позиции (то есть в верхней строке), и что конфигурация **Dynamics 365 Payment Connector для PayPal** находится на второй строке. Добавьте или удалите соединители по мере необходимости для их упорядочивания.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Модуль корзины](add-cart-module.md)

[Модуль значка корзины](cart-icon-module.md)

[Модуль оформления заказа](add-checkout-module.md)

[Модуль адреса доставки](ship-address-module.md)

[Модуль параметров доставки](delivery-options-module.md)

[Модуль сведений о самовывозе](pickup-info-module.md)

[Модуль сведений о заказе](order-confirmation-module.md)

[Модуль подарочных сертификатов](add-giftcard.md)

[Соединитель платежей Dynamics 365 для Adyen](dev-itpro/adyen-connector.md)

[Соединитель платежей Dynamics 365 для PayPal](paypal.md)

[Строгая проверка подлинности клиентов с помощью Adyen](adyen_redirect.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]

---
title: Добавление поддержки сети доставки контента (CDN)
description: В этом разделе описывается, как добавить сеть доставки содержимого (CDN) в среду Microsoft Dynamics 365 Commerce.
author: brianshook
manager: annbe
ms.date: 07/31/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-commerce
ms.technology: ''
audience: Application user
ms.reviewer: v-chgri
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: brshoo
ms.search.validFrom: 2019-10-31
ms.dyn365.ops.version: Release 10.0.5
ms.openlocfilehash: d653b072eca134c765a5db5659b228648fc13c4a
ms.sourcegitcommit: 3fe4d9a33447aa8a62d704fbbf18aeb9cb667baa
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2021
ms.locfileid: "5582727"
---
# <a name="add-support-for-a-content-delivery-network-cdn"></a>Добавление поддержки сети доставки содержимого (CDN)

[!include [banner](includes/banner.md)]

В этом разделе описывается, как добавить сеть доставки содержимого (CDN) в среду Microsoft Dynamics 365 Commerce.

При настройке среды электронной коммерции в Dynamics 365 Commerce можно настроить ее для работы со службой CDN. 

Пользовательский домен может быть включен во время процесса подготовки к работе для среды электронной коммерции. Вместо этого можно использовать запрос на обслуживание, чтобы настроить его после завершения процесса подготовки. Процесс подготовки для среды электронной коммерции создает имя узла, связанное с данной средой. Имя этого узла имеет следующий формат, где \<*e-commerce-tenant-name*\> — это имя среды:

&lt;e-commerce-tenant-name&gt;.commerce.dynamics.com

Имя узла или конечная точка, создаваемая в ходе процесса подготовки, поддерживает сертификат SSL только для \*commerce.dynamics.com. Оно не поддерживает SSL для пользовательских доменов. Поэтому необходимо завершить протокол SSL для пользовательских доменов в вашей сети CDN и передать трафик из CDN в имя хоста или конечную точку, созданную Commerce. 

Кроме того, *статические элементы* (файлы JavaScript или каскадных таблиц стилей \[CSS\]) из Commerce обслуживаются из конечной точки, созданной Commerce (\*.commerce.dynamics.com). Статические структуры могут кэшироваться только в том случае, если имя узла или конечной точки, которую создает Commerce, помещается позади сети CDN.

## <a name="set-up-ssl"></a>Настройка SSL

Чтобы гарантировать настройку SSL и правильность кэширования статических структур, необходимо настроить CDN так, чтобы он был связан с именем узла, созданным Commerce для вашей среды. Кроме того, необходимо кэшировать следующий шаблон только для статических структур: 

/\_msdyn365/\_scnr/\*

После подготовки вашей среды Commerce с предоставленным пользовательским доменом или после предоставления пользовательского домена для среды с помощью запроса на обслуживание направьте пользовательский домен на имя узла или конечную точку, которая была создана в Commerce.

Как уже упоминалось, созданное имя узла или конечная точка поддерживает сертификат SSL только для \*.commerce.dynamics.com. Оно не поддерживает SSL для пользовательских доменов.

## <a name="cdn-services"></a>Службы CDN

Со средой Commerce можно использовать любую службу CDN. Вот два примера:

- **Microsoft Azure Front Door Service** — решение Azure CDN. Дополнительные сведения о службе Azure Front Door Service см. в [документации по Azure Front Door Service](https://docs.microsoft.com/azure/frontdoor/).
- **Ускоритель динамических сайтов Akamai** — для получения дополнительных сведений см. раздел [Ускоритель динамических сайтов](https://www.akamai.com/us/en/products/performance/dynamic-site-accelerator.jsp).

## <a name="cdn-setup"></a>Настройка CDN

Процесс установки CDN состоит из следующих основных шагов:

1. Добавьте узел переднего плана.
1. Настройте серверный пул.
1. Настройте правила для маршрутизации и кэширования.

### <a name="add-a-front-end-host"></a>Добавление узла переднего плана

Можно использовать любую службу CDN, но для примера в этом разделе используется служба Azure Front Door Service. 

Сведения о настройке службы Azure Front Door Service см. в разделе [Краткое руководство: Создание службы Front Door для глобального веб-приложения с высокой доступностью](https://docs.microsoft.com/azure/frontdoor/quickstart-create-front-door).

### <a name="configure-a-backend-pool-in-azure-front-door-service"></a>Настройка серверного пула в службе Azure Front Door Service

Чтобы настроить серверный пул в службе Azure Front Door Service, выполните следующие действия.

1. Добавьте **&lt;ecom-tenant-name&gt;.commerce.dynamics.com** в серверный пул в качестве пользовательского узла с пустым заголовком серверного узла.
1. В разделе **Балансировка нагрузки** оставьте значения по умолчанию.

На следующем рисунке показано диалоговое окно **Добавление серверного пула** в службе Azure Front Door Service с введенным серверным именем узла.

![Диалоговое окно добавления серверного пула](./media/CDN_BackendPool.png)

На следующем рисунке показано диалоговое окно **Добавление серверного пула** в службе Azure Front Door Service со значениями балансировки нагрузки по умолчанию.

![Диалоговое окно добавления серверного пула (продолжение)](./media/CDN_BackendPool_2.png)

### <a name="set-up-rules-in-azure-front-door-service"></a>Настройка правил в службе Azure Front Door Service

Чтобы настроить правило маршрутизации в службе Azure Front Door Service, выполните следующие действия.

1. Добавьте правило маршрутизации.
1. В поле **Имя** введите **по умолчанию**.
1. В поле **Принятый протокол** выберите **HTTP и HTTPS**.
1. В поле **Интерфейсные узлы** введите **dynamics-ecom-tenant-name.azurefd.net**.
1. В области **Шаблоны для сопоставления** в верхнем поле введите **/\***.
1. В разделе **Сведения о маршруте** установите параметр **Тип маршрута** в значение **Прямой**.
1. В поле **Серверный пул** выберите **ecom-backend**.
1. В группе полей **Протокол переадресации** выберите параметр **Сопоставить запрос**. 
1. Установите для параметра **Перезапись URL** значение **Отключено**.
1. Установите для параметра **Кэширование** значение **Отключено**.

Чтобы настроить правило кэширования в службе Azure Front Door Service, выполните следующие действия.

1. Добавьте правило кэширования.
1. В поле **Имя** введите **статические**.
1. В поле **Принятый протокол** выберите **HTTP и HTTPS**.
1. В поле **Интерфейсные узлы** введите **dynamics-ecom-tenant-name.azurefd.net**.
1. В области **Шаблоны для сопоставления** в верхнем поле введите **/\_msdyn365/\_scnr/\***.
1. В разделе **Сведения о маршруте** установите параметр **Тип маршрута** в значение **Прямой**.
1. В поле **Серверный пул** выберите **ecom-backend**.
1. В группе полей **Протокол переадресации** выберите параметр **Сопоставить запрос**.
1. Установите для параметра **Перезапись URL** значение **Отключено**.
1. Установите для параметра **Кэширование** значение **Отключено**.
1. В поле поведение **Режим кэширования строк запросов** выберите **Кэшировать каждый уникальный URL-адрес**.
1. В группе полей **Динамическое сжатие** выберите **Включено**.

На следующем рисунке показано диалоговое окно **Добавление правила** в службе Azure Front Door Service.

![Диалоговое окно добавления правила](./media/CDN_CachingRule.png)

> [!WARNING]
> Если используемый домен уже активен и используется, создайте запрос в службу поддержки на плитке **Поддержка** в [Lifecycle Services Microsoft Dynamics](https://lcs.dynamics.com/), чтобы получить помощь для последующих шагов. Дополнительные сведения см. в разделе [Получение поддержки для приложений Finance and Operations или Lifecycle Services (LCS)](../fin-ops-core/dev-itpro/lifecycle-services/lcs-support.md).

Если домен является новым и не существовал раньше как активный домен, можно добавить личный домен в конфигурацию Azure Front Door Service. Это позволяет веб-трафику направляться на ваш сайт через экземпляр Azure Front Door. Чтобы добавить пользовательский домен (например, `www.fabrikam.com`), необходимо настроить каноническое имя (CNAME) для домена.

На следующем рисунке показано диалоговое окно **Конфигурация CNAME** в службе Azure Front Door Service.

![Диалоговое окно конфигурации CNAME](./media/CNAME_Configuration.png)

Можно использовать службу Azure Front Door Service для управления сертификатом, или можно использовать собственный сертификат для пользовательского домена.

На следующем рисунке показано диалоговое окно **HTTPS для личного домена** в службе Azure Front Door Service.

![Диалоговое окно "HTTPS для личного домена"](./media/Custom_Domain_HTTPS.png)

Подробные инструкции по добавлению личного домена в Azure Front Door см. в разделе [Добавление личного домена в Front Door](https://docs.microsoft.com/azure/frontdoor/front-door-custom-domain).

Сеть CDN теперь должна быть правильно настроена, чтобы ее можно было использовать с вашим сайтом Commerce.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Параметры реализации сети доставки содержимого](cdn-options.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]

---
title: Создание шаблонов сообщений электронной почты для событий проводок
description: В этом разделе описывается создание, отправка и настройка шаблонов сообщений электронной почты для событий проводок в Microsoft Dynamics 365 Commerce.
author: bicyclingfool
ms.date: 10/26/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: v-chgri
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: stuharg
ms.search.validFrom: 2020-01-20
ms.dyn365.ops.version: Release 10.0.8
ms.openlocfilehash: 69ba8821cde6788d6e0accb37288f92acdfc776c
ms.sourcegitcommit: 6bf9e18989e6d77497a9dda1c362f324b3c2fbf2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/27/2021
ms.locfileid: "7713805"
---
# <a name="create-email-templates-for-transactional-events"></a>Создание шаблонов сообщений электронной почты для событий проводок

[!include [banner](includes/banner.md)]
[!include [banner](includes/preview-banner.md)]

В этом разделе описывается создание, отправка и настройка шаблонов сообщений электронной почты для событий проводок в Microsoft Dynamics 365 Commerce.

Dynamics 365 Commerce содержит готовое решение для отправки электронных сообщений, предупреждающих клиентов о событиях проводок. Например, сообщения электронной почты могут отправляться при размещении заказа, готовности для отправки или отгрузки. В этом разделе описываются шаги создания, отправки и настройки шаблонов сообщений электронной почты, используемых для отправки сообщений электронной почты по проводкам.

## <a name="notification-types"></a>Типы уведомлений

Уведомления можно настроить так, чтобы информировать клиентов через электронную почту, когда выполняются отдельные события в рамках заказа и цикла взаимодействия с клиентом. Для настройки уведомлений необходимо сопоставить шаблон электронной почты с типом уведомления, создав профиль уведомлений по электронной почте Commerce. Сведения о настройке профилей уведомлений по электронной почте см. в разделе [Настройка профиля уведомлений по электронной почте](email-notification-profiles.md).

Dynamics 365 Commerce поддерживает следующие типы уведомлений.

### <a name="order-created"></a>Заказ создан

Тип уведомления *заказ создан* запускается при создании нового заказа на продажу в центральном офисе Commerce.

> [!NOTE]
> Тип уведомления "Заказ создан" не запускается для кассовых проводок, происходящих на POS-терминале. В этом случае вместо этого создается чек, переданный по электронной почте и/или распечатанный. Дополнительные сведения см. в разделе [Отправка чеков по электронной почте из Modern POS (MPOS)](email-receipts.md).

### <a name="order-confirmed"></a>Заказ подтвержден

Тип уведомления *заказ подтвержден* активируется, когда для заказа на продажу в центральном офисе Commerce создается документ подтверждения заказа.

### <a name="picking-completed"></a>Комплектование завершено

Тип уведомления *комплектация завершена* активируется, когда лист комплектации для заказа помечается как "завершенная" в центральном офисе Commerce.

> [!NOTE]
> Тип уведомления "комплектация завершена" не запускается, когда номенклатура отмечена как скомплектованная на POS-терминале.

### <a name="packing-completed"></a>Упаковка завершена

Тип уведомления *упаковка завершена* активируется, когда документ отборочной накладной создается для заказа в центральном офисе Commerce на POS-терминале.

Тип уведомления "упаковка завершена" поддерживает следующие дополнительные заполнители электронной почты, чтобы упростить процедуру "заказ готов к комплектации" и подстановку заказов в электронных письмах из транзакционных писем.

| Имя заполнителя    | Целевые назначения |
| ------------------- | ------- |
| `pickupstorename`     | Название магазина, в котором заказ доступен для отправки. |
| `pickupstoreaddress`  | Адрес магазина, в котором заказ доступен для отправки. |
| `pickupstorehourfrom` | Время начала работы магазина комплектации. |
| `pickupstorehourto`   | Время завершения работы магазина комплектации. |
| `pickupchannelid`     | Код канала магазина для магазина комплектации. |
| `packingslipid`      | Код отборочной накладной для заказа, который будет скомплектован. |
| `confirmationid`      | Код подтверждения заказа для заказа, который будет скомплектован. (Этот код иногда называют идентификатором ссылки на канал.) |

Дополнительные сведения о функциях отметки прибытия и подстановки заказов см. в разделе [Настройка географического обнаружения и перенаправления](geo-detection-redirection.md) и [Включение поиска заказов для оформления заказов клиентами-гостями](order-lookup-guest.md).

### <a name="order-ready-for-pickup"></a>Заказ готов к получению

Тип уведомления *заказ готов к отправке* запускается, когда заказ помечен как упакованный, и режим доставки настроен на **Самовывоз клиентом** в одной или нескольких строках заказа.

> [!NOTE]
> Тип уведомления "заказ готов к отправке" не рекомендуется использовать в качестве типа уведомления о завершении упаковки. Этот тип уведомления настраивается по способу доставки.

### <a name="order-shipped"></a>Заказ доставлен

Тип уведомления *заказ отгружен* запускается, когда выставляется накладная для заказа, для которого указан режим доставки не из магазина.

> [!NOTE]
> Тип уведомления "заказ отгружен" не рекомендуется использовать в качестве типа уведомления заказа с выставленной накладной. Этот тип уведомления настраивается по способу доставки.

### <a name="order-invoiced"></a>Заказ, по которому выставлены накладные

Тип уведомления *заказ с выставленной накладной* запускается при выставлении накладной по заказу в POS-терминале или в центральном офисе Commerce.

### <a name="issue-gift-card"></a>Выдать подарочный сертификат

Тип уведомления *Выдать подарочный сертификат* создается, когда выставляется накладная по заказу на продажу, содержащему продукт для данного типа подарочного сертификата.

> [!NOTE]
> Сообщение электронной почты с уведомлением об отправке подарочного сертификата для получателя подарочного сертификата. Получатель подарочного сертификата указывается в центральном офисе Commerce в отдельной строке заказа на продажу на вкладке **Упаковка** в разделе **Сведения по строке**. Это можно указать либо вручную, либо программным образом.

Тип уведомления о выдаче подарочного сертификата поддерживает следующие дополнительные заполнители.

| Имя заполнителя      | Целевые назначения |
| --------------------- | ------- |
| `giftcardnumber`        | Номер подарочного сертификата для продуктов типа подарочного сертификата. |
| `giftcardbalance`       | Баланс подарочного сертификата для продуктов типа подарочного сертификата. |
| `giftcardmessage`       | Сообщение подарочного сертификата для продуктов типа подарочного сертификата. |
| `giftcardpin`         | Персональный идентификационный номер (PIN) подарочного сертификата для продуктов типа подарочного сертификата. (Этот заполнитель относится к внешним подарочным сертификатам.) |
| `giftcardexpiration`    | Дата окончания срока действия подарочного сертификата для продуктов типа подарочного сертификата. (Этот заполнитель относится к внешним подарочным сертификатам.) |
| `giftcardrecipientname` | Имя получателя подарочного сертификата для продуктов типа подарочного сертификата. |
| `giftcardbuyername`     | Имя покупателя подарочного сертификата для продуктов типа подарочного сертификата. |

Дополнительные сведения о подарочных сертификатах см. в [Цифровые подарочные сертификаты электронной коммерции](digital-gift-cards.md) и [Поддержка внешних подарочных карт](dev-itpro/gift-card.md).

### <a name="order-cancellation"></a>Аннулирование заказа

Тип уведомления *отмена заказа* запускается при отмене заказа в центральном офисе Commerce.

### <a name="customer-created"></a>Клиент создан

Тип уведомления *клиент создан* запускается при создании нового объекта клиента в центральном офисе Commerce.

### <a name="b2b-prospect-approved"></a>Перспективный клиент B2B утвержден

Тип уведомления *Перспективный клиент B2B утвержден* создается , когда в центральном офисе Commerce утвержден запрос на подключение перспективного клиента. Дополнительные сведения о том, как утвердить или отклонить потенциальных клиентов B2B, см. в разделе [Настройка пользователя-администратора для нового делового партнера](b2b/manage-b2b-users.md#set-up-the-administrator-user-for-a-new-business-partner). 

Тип уведомления "Перспективный клиент B2B утвержден" поддерживает следующие дополнительные заполнители.

| Имя заполнителя | Целевые назначения                                                      |
| ---------------- | ------------------------------------------------------------ |
| `firstname`       | Имя перспективного клиента B2B, которое вводится в приложение. |
| `lastname`         | Фамилия перспективного клиента B2B, которое вводится в приложение. |
| `company`          | Имя компании кандидата, которое вводится в приложение. |
| `email`            | Адрес электронной почты перспективного клиента, которое вводится в приложение.   |
| `zipcode`          | Почтовый код основного адреса перспективного клиента. |
| `comments`         | Комментарий, который перспективный клиент ввел в заявку. |
| `storename`        | Имя канала, где был создан перспективный клиент. |
| `storeurl`         | По умолчанию не заполнено. Для использования этого заполнителя необходимо создать настраиваемое расширение. |

### <a name="b2b-prospect-approved"></a>Перспективный клиент B2B утвержден

Тип уведомления *Перспективный клиент B2B отклонен* создается , когда в центральном офисе Commerce отклонен запрос на подключение перспективного клиента. Дополнительные сведения о том, как утвердить или отклонить потенциальных клиентов B2B, см. в разделе [Настройка пользователя-администратора для нового делового партнера](b2b/manage-b2b-users.md#set-up-the-administrator-user-for-a-new-business-partner). 

Тип уведомления "Перспективный клиент B2B отклонен" поддерживает следующие дополнительные заполнители.

| Имя заполнителя | Целевые назначения                                                      |
| ---------------- | ------------------------------------------------------------ |
| `firstname`        | Имя перспективного клиента B2B, которое вводится в приложение. |
| `lastname`         | Фамилия перспективного клиента B2B, которое вводится в приложение. |
| `company`          | Имя компании кандидата, которое вводится в приложение. |

## <a name="create-an-email-template"></a>Создание шаблона сообщения эл. почты

Прежде чем можно будет сопоставить конкретное событие проводки с шаблоном сообщений электронной почты, необходимо создать шаблон.

Чтобы создать шаблон электронной почты, выполните следующие действия.

1. В Commerce headquarters Перейдите в раздел **Retail и Commerce \> Настройка центрального офиса \> Шаблоны сообщений электронной почты организации** или **Администрирование организации \> Настройка \> Шаблоны сообщений электронной почты организации**.
1. Выберите **Создать**.
1. В разделе **Общие** задайте следующие поля:

    - **Код электронной почты** — код электронной почты является уникальным идентификатором шаблона. Это значение, которое отображается при выборе шаблона для сопоставления событию.
    - **Описание сообщения электронной почты** — это необязательное поле можно использовать для создания описания шаблона. Введенное значение появляется только в Commerce Headquarters.
    - **Имя отправителя** — введенное имя отображается в поле "от" для большинства клиентов электронной почты.
    - **Адрес электронной почты отправителя** — Введите адрес электронной почты, который должен использоваться для писем, отправленных с помощью данного шаблона.
    - **Код языка по умолчанию** — в этом поле указывается локализованная версия сообщения электронной почты, которое будет отправлено по умолчанию, если канал, который вызывает этот шаблон, не указывает язык.

1. В **Содержимое сообщения электронной почты**, выберите **Создать**.
1. В поле **Язык** введите язык для шаблона сообщения электронной почты. Можно добавить дополнительные языки и локализованные шаблоны позднее.
1. В поле **Тема** введите сообщение электронной почты, которое должно появиться в поле темы сообщения электронной почты.
1. Выберите **Правка**, чтобы загрузить шаблон сообщения электронной почты.

## <a name="create-an-email-message-body-by-using-html"></a>Создание текста сообщения электронной почты с помощью HTML

Текст сообщения электронной почты составлен в формате HTML. Можно использовать любой макет, стилизацию и фирменную символику, если разрешено использование HTML и встроенных каскадных таблиц стилей (CSS). Кроме того, можно использовать изображения, если они размещены на общедоступной конечной точке веб-узла. Чтобы добавить изображение, введите URL-адрес изображения в атрибут **src** маркера HTML **&lt;img&gt;**.

> [!NOTE]
> Клиенты электронной почты накладывают ограничения макета и стилей, которые могут потребовать корректировок кода HTML и CSS, которые используются в содержании сообщения. Рекомендуется ознакомиться с рекомендациями по созданию HTML-кода, который будет поддерживаться самыми популярными клиентами электронной почты.

## <a name="add-placeholders-to-the-email-message-body"></a>Добавление заполнителей в текст сообщения электронной почты

Сообщение электронной почты может содержать заполнители, которые заменяются значениями, связанными с клиентом и проводкой, при создании сообщения электронной почты. Заполнители всегда заключены в знаки процента (%) и вставляются непосредственно в документ HTML.

Рассмотрим пример:

```html
<p>
    Hello %customername%,<br />
    Order number %salesid%, can be picked up from the <b>%pickupstorename%</b> store.
</p>
```

### <a name="order-placeholders-sales-order-level"></a>Заполнители для заказа (уровень заказа на продажу)

Следующие заполнители извлекают и отображают данные, которые определены на уровне заказа на продажу (в противоположность уровню строки продаж).

| Имя заполнителя     | Целевые назначения                                                      |
| -------------------- | ------------------------------------------------------------ |
| `customername`         | Имя клиента, который разместил заказ.               |
| `customeraddress`      | Адрес, к которому относится клиент.                                 |
| `customeremailaddress` | Адрес электронной почты, введенный клиентом при оформления заказа.     |
| `salesid`              | Код продажи по заказу.                                   |
| `orderconfirmationid`  | Код между каналами, созданный при создании заказа.   |
| `channelid`            | Код розничного или интерактивного канала, через который был размещен заказ. |
| `deliveryname`         | Имя, указанное для адреса доставки.         |
| `deliveryaddress`      | Адрес поставки для отгруженных заказов.                     |
| `deliverydate`         | Дата поставки.                                           |
| `shipdate`             | Дата отгрузки.                                               |
| `modeofdelivery`       | Режим доставки для заказа.                              |
| `ordernetamount`       | Общая сумма для заказа минус общая сумма налога.         |
| `discount`            | Общая скидка для заказа.                            |
| `charges`              | Общая сумма накладных расходов для заказа.                             |
| `tax`                  | Общая сумма налога для заказа.                                 |
| `total`                | Общая сумма для заказа.                              |
| `storename`            | Название магазина, в котором был размещен заказ.            |
| `storeaddress`         | Адрес магазина, в котором был размещен заказ.              |
| `storeopenfrom`        | Время начала работы магазина, в котором был размещен заказ.         |
| `storeopento`          | Время окончания работы магазина, в котором был размещен заказ.         |
| `pickupstorename`      | Название магазина, в котором будет скомплектован заказ.\*   |
| `pickupstoreaddress`   | Адрес магазина, в котором будет скомплектован заказ.\* |
| `pickupopenstorefrom`  | Время начала работы магазина, в котором будет скомплектован заказ.\* |
| `pickupopenstoreto`    | Время окончания работы магазина, в котором будет скомплектован заказ.\* |
| `pickupchannelid`     | Код канала магазина, который указан для режима самовывоза.\* |
| `packingslipid`        | Код отборочной накладной, которая была создана при упаковке строк в заказе.\* |

\* Эти заполнители возвращают данные только тогда, когда они используются для типа уведомления **Заказ готов к отправке**. 

### <a name="order-line-placeholders-sales-line-level"></a>Заполнители сроки заказа (уровень строки продаж)

Следующие заполнители извлекают и отображают данные для отдельных продуктов (строк) в заказе на продажу.

| Имя заполнителя               | Целевые назначения |
|--------------------------------|-------------------|
| `productid`                      | <p>Код продукта. Этот код относится к вариантами.</p><p><strong>Примечание.</strong> Этот заполнитель устарел и заменен на `lineproductrecid`.</p> |
| `lineproductrecid`               | Код продукта. Этот код относится к вариантами. Он однозначно определяет номенклатуру на уровне варианта. |
| `lineitemid`                     | Идентификатор продукта на уровне продукта. (Этот код не относится к вариантами.) |
| `lineproductvariantid`           | Код варианта продукта. |
| `lineproductname`                | Название продукта. |
| `lineproductdescription`         | Описание продукта. |
| `linequantity`                   | Число единиц, заказанных для строки, плюс единица измерения (например, **ea** или **пара**). |
| `lineunit`                       | Единица измерения для данной строки. |
| `linequantity_withoutunit`       | Число единиц, заказанных для строки, без единицы измерения. |
| `linequantitypicked`             | Когда используется событие **PickOrder**, количество единиц, которое было скомплектовано. В противном случае — **0** (ноль). |
| `linequantitypicked_withoutunit` | Когда используется событие **PickOrder**, число единиц, которое было скомплектовано, без единицы измерения. В противном случае — **0** (ноль). |
| `linequantitypacked`             | Когда используются события **PackOrder** и **заказ, готовый для отправки**, число упакованных единиц. В противном случае — **0** (ноль). |
| `linequantitypacked_withoutuom`  | Когда используются события **PackOrder** и **заказ, готовый для отправки**, число упакованных единиц, без единицы измерения. В противном случае — **0** (ноль). |
| `linequantityshipped`            | Всегда равно **0**, за исключением случаев, когда используются отдельные события, как описано в следующей строке. |
| `linequantityshipped_withoutuom` | Когда используется событие **ShipOrder**, число единиц, которое было скомплектовано, без единицы измерения. В противном случае — **0** (ноль). |
| `lineprice`                      | Цена для одной единицы. |
| `linenetamount`                  | Цена строки после применения числа единиц и скидки. |
| `linediscount`                   | Скидка для отдельной единицы. |
| `lineshipdate`                   | Дата отгрузки для строки. |
| `linedeliverydate`               | Дата доставки для строки. |
| `linedeliverymode`               | Режим доставки для строки. |
| `linedeliveryaddress`            | Адрес поставки для строки. |
| `linepickupdate`                 | Дата самовывоза, указанная клиентом, для заказов, в которых используется режим самовывоза. |
| `linepickuptimeslot`             | Диапазон времени самовывоза, указанный клиентом, для заказов, в которых используется режим самовывоза. |
| `giftcardnumber`                 | Номер подарочного сертификата для продуктов типа подарочного сертификата. |
| `giftcardbalance`                | Баланс подарочного сертификата для продуктов типа подарочного сертификата. |
| `giftcardmessage`                | Сообщение подарочного сертификата для продуктов типа подарочного сертификата. |
| `giftcardpin`                    | PIN-код подарочного сертификата для продуктов типа подарочного сертификата. (Этот заполнитель относится к внешним подарочным сертификатам.) |
| `giftcardexpiration`             | Дата окончания срока действия подарочного сертификата для продуктов типа подарочного сертификата. (Этот заполнитель относится к внешним подарочным сертификатам.) |
| `giftcardrecipientname`          | Имя получателя подарочного сертификата для продуктов типа подарочного сертификата. |
| `giftcardbuyername`              | Имя покупателя подарочного сертификата для продуктов типа подарочного сертификата. |

### <a name="format-of-order-line-placeholders-in-the-email-message-body"></a>Формат заполнителей для строк заказа в тексте сообщения электронной почты

При создании HTML для отдельных строк заказа в тексте сообщения электронной почты необходимо окружить повторяющийся блок HTML и заполнители для строк следующими заполнителями. Обратите внимание, что заполнители находятся внутри тегов комментариев HTML.

```html
<!--%tablebegin.salesline%-->

(Insert the repeating block of HTML and placeholders for individual lines here.)

<!--%tableend.salesline%-->
```

Рассмотрим пример:

```HTML
<table>
    <tr>
        <td>Product name</td>
        <td>Quantity</td>
        <td>Price</td>
    </tr>
    <!--%tablebegin.salesline%-->
    <tr>
        <td>%lineproductname%</td>
        <td>%linequantity_withoutunit%</td>
        <td>%lineprice%</td>
    </tr>
    <!--%tableend.salesline%-->
</table>
```

## <a name="create-a-template-for-emailed-receipts"></a>Создание шаблона для отправки чеков по электронной почте

Чеки могут быть отправлены клиентам, которые делают покупки в розничном POS-терминале (POS). Как правило, шаги для создания шаблона для отправки чеков по электронной почте совпадают с шагами создания шаблонов для других событий проводок. Однако требуются следующие изменения:

- Заполнитель **%message%** используется для вставки в текста поступления в сообщение электронной почты. Чтобы убедиться, что текст чека правильно отрисовывается, заключите заполнитель **%message%** в маркеры HTML **&lt;pre&gt;** и **&lt;/pre&gt;**.
- Заполнитель **%receiptid%** можно использовать для отображения QR-кода или штрихкода, который представляет код чека. (QR-коды и штрих-коды динамически генерируются и обслуживаются службой стороннего производителя). Дополнительные сведения о том, как отображать QR-код или штрихкод в чеке по электронной почте, см. в разделе [Добавление QR-кода или штрихкода к транзакционным письмам и сообщениям электронной почты с чеками](add-qr-code-barcode-email.md).

## <a name="upload-the-email-html"></a>Загрузите HTML-код сообщения электронной почты

После создания и проверки кода HTML для содержания сообщения необходимо загрузить его в центральный офис Commerce. В настоящее время HTML-код сообщения электронной почты нельзя экспортировать. Таким образом, необходимо поддерживать основную копию HTML-кода вне центрального офиса Commerce.

Чтобы загрузить новый или измененный HTML-код шаблона сообщения электронной почты, выполните следующие действия.

1. В центральном офисе Commerce перейдите к **Retail и Commerce \> Настройка центрального офиса \> Шаблоны сообщений электронной почты организации**.
1. Выбор строки для языка, для которого требуется добавить или заменить HTML-код. Или выберите **создать**, чтобы создать строку для нового языка.
1. Выберите **Правка**.
1. В появившемся диалоговом окне выберите **Обзор**. Перейдите к документу HTML, который необходимо загрузить, выберите его и нажмите кнопку **открыть**.
1. Выберите **Отправить**.
1. После появления HTML-кода сообщения электронной почты в окне предварительного просмотра нажмите кнопку **ОК**.
1. Убедитесь, что установлен флажок **Имеет тело** для строки.

Если для отправки сообщения электронной почты уже настроен центральный офис Commerce, новое или обновленное сообщение электронной почты будет отправляться всем клиентам, выполняющим проводку, которая вызывает событие, сопоставленное с этим шаблоном.

Дополнительные сведения о настройке сообщений электронной почты в Dynamics 365 Commerce см. в разделе [Настройка и отправка сообщений электронной почты](../fin-ops-core/fin-ops/organization-administration/configure-email.md).

## <a name="additional-resources"></a>Дополнительные ресурсы 

[Настройка профиля уведомлений по электронной почте](email-notification-profiles.md)

[Настройка и отправка электронной почты](../fin-ops-core/fin-ops/organization-administration/configure-email.md)

[Настройка приема электронной почты](/dynamicsax-2012/appuser-itpro/set-up-email-receipts)

[Отправка чеков по электронной почте из Modern POS ](email-receipts.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]

---
title: Программа проверки согласованности проводок розничной торговли
description: В этом разделе описываются функции программы проверки согласованности проводок в Dynamics 365 Commerce.
author: josaw1
ms.date: 10/07/2020
ms.topic: index-page
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: josaw
ms.custom: ''
ms.assetid: ed0f77f7-3609-4330-bebd-ca3134575216
ms.search.region: global
ms.search.industry: Retail
ms.author: josaw
ms.search.validFrom: 2019-01-15
ms.dyn365.ops.version: 10
ms.openlocfilehash: c8ba0f99743984860119deb96c889f5d62e1728c8772b9e6786d371690b61489
ms.sourcegitcommit: 42fe9790ddf0bdad911544deaa82123a396712fb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/05/2021
ms.locfileid: "6741740"
---
# <a name="retail-transaction-consistency-checker"></a>Программа проверки согласованности проводок розничной торговли

[!include [banner](includes/banner.md)]

В этом разделе описываются функции программы проверки согласованности проводок в Microsoft Dynamics 365 Commerce. Программа проверки согласованности обнаруживает и отделяет несогласованные проводки до их передачи в процесс разноски журнала операций.

При разноске журнала операций может произойти сбой из-за несогласованности данных в таблицах проводок Commerce. Ошибка данных может быть связана с непредвиденными проблемами в приложении POS или с неправильным импортом проводок из систем POS сторонних разработчиков. Ниже приведены возможные примеры несогласованности. 

- Общая сумма проводки в таблице заголовков не соответствует общей сумме проводок в строках.
- Количество строк в таблице заголовков не соответствует количеству строк в таблице проводок.
- Сумма налога в таблице заголовков не соответствует сумме налога в строках. 

Если в процесс разноски операций передаются несогласованные проводки, создаются противоречивые накладные по продажам и журналы платежей, что в результате приводит к сбою всего процесса разноски операций. Восстановление журналов операций из подобного состояния сопряжено со сложными исправлениями данных в нескольких таблицах проводок. Программа проверки согласованности проводок предотвращает подобные проблемы.

На следующей диаграмме представлен процесс разноски с использованием программы проверки согласованности проводок.

![Процесс разноски журнала операций с проверкой согласованности проводок.](./media/validchecker.png "Процесс разноски журнала операций с проверкой согласованности проводок розничной торговли")

Процесс пакетной обработки **Проверить проводки магазина** проверяет согласованность таблиц проводок Commerce для следующих сценариев.

- **Счет клиента** — проверяется, что счет клиента в таблицах проводок присутствует в справочнике клиентов в головном офисе.
- **Количество строк** — проверяется соответствие количества строк, указанного в таблице заголовков проводок, количеству строк в таблицах проводок продаж.
- **Цена включает налог** — проверяется, что параметр **Цена включает налог** единообразно задан в строках проводок, а цена в строке продаж соответствует цене с налогом и конфигурации налогового освобождения.
- **Сумма платежа** — проверяется, что записи платежа соответствуют сумме платежа в заголовке, а также факторингу в конфигурации для допустимого расхождения в главной книге.
- **Валовая сумма** — проверяется, является ли валовая сумма в заголовке суммой чистых сумм в строках плюс суммы налога с учетом факторинга в конфигурации для допустимого расхождения в главной книге.
- **Чистая сумма** — проверяется, является ли чистая сумма в заголовке суммой чистых сумм в строках с учетом факторинга в конфигурации для допустимого расхождения в главной книге.
- **Недоплата/переплата** — проверяется, что разница между валовой суммой в заголовке и суммой платежа не превышает максимальную конфигурацию недоплаты/переплаты с учетом факторинга в конфигурации для допустимых расхождений в главной книге.
- **Сумма скидки** — проверяется соответствие суммы скидки в таблицах скидок и суммы скидки в таблицах строк проводок розничной торговли, а также то, что сумма скидки в заголовке является суммой сумм скидок в строках с учетом факторинга в конфигурации для допустимых расхождений в главной книге.
- **Скидка по строке** — проверяется, что скидка по строке в строке проводки является суммой всех строк в таблице скидок, соответствующей строке проводки.
- **Номенклатура подарочной карты** — Commerce не поддерживает возврат номенклатур подарочных карт. Однако сальдо подарочной карты можно обналичить. Любая номенклатура подарочной карты, которая обрабатывается как строка возврата вместо строки обналичивания, не будет обработана в процессе разноски журнала операций. Процесс проверки номенклатур подарочных карт помогает гарантировать, что единственными номенклатурами строк подарочных карт возврата в таблицах проводок являются строки обналичивания подарочных карт.
- **Отрицательная цена** — проверяется отсутствие строк проводок с отрицательной ценой.
- **Номенклатура и вариант** — проверяется, что номенклатуры и варианты в строках проводки присутствуют в главном файле номенклатур и вариантов.
- **Сумма налога** — проверяется, что записи налогов соответствуют суммам налогов в строках.
- **Серийный номер** — проверяется, что серийный номер присутствует в строках проводок номенклатур, для управления которыми используется серийный номер.
- **Знак** — проверяется, что знаки количества и чистой суммы одинаковы в строках всех проводок.
- **Бизнес-дата** — проверяется, что финансовые периоды для всех бизнес-дат проводок открыты.
- **Расходы** — проверяется, что сумма накладных расходов заголовка и строк соответствует цене, включая конфигурацию налога и налогового освобождения.

## <a name="set-up-the-consistency-checker"></a>Настройка проверки целостности

Настройте процесс пакетной обработки "Проверить проводки магазина" в разделе **Retail и Commerce \> ИТ Retail и Commerce \> Разноска POS** для периодического выполнения. Пакетное задание можно запланировать на основе организационной иерархии магазина, аналогично тому, как настраиваются процессы "Пакетный расчет журналов операций" и "Пакетная разноска журналов операций". Рекомендует настроить этот процесс пакетной обработки таким образом, чтобы он выполнялся несколько раз в день, и запланировать его выполнение на конец каждого выполнения P-задания.

## <a name="results-of-validation-process"></a>Результаты выполнения процесса проверки

Результаты проверки, выполненной процессом пакетной обработки, отмечаются в соответствующей проводке. В поле **Статус проверки** в записи проводки отображается значение **Успешно** или **Ошибка**, а дата последнего выполнения проверки отображается в поле **Время последней проверки**.

Для просмотра более подробного описательного текста ошибки проверки выберите соответствующую запись проводки магазина и нажмите кнопку **Ошибки проверки**.

Проводки, которые не прошли проверку, и еще не проверенные проводки не передаются в журналы операций. Во время выполнения процесса "Создать строки журнала операций" пользователи будут получать уведомления о проводках, которые могли бы быть включены в журнал операций, но не были включены.

Если обнаружена ошибка проверки, ее можно исправить, только обратившись в службу поддержки Майкрософт. В будущих выпусках для пользователей будет добавлен возможность исправлять записи, вызвавшие сбой, в интерфейсе пользователя. Также будут предусмотрены возможности ведения журнала и аудита для отслеживания истории таких изменений.

> [!NOTE]
> В будущих выпусках будут добавлены дополнительные правила проверки для поддержки других сценариев.


[!INCLUDE[footer-include](../includes/footer-banner.md)]
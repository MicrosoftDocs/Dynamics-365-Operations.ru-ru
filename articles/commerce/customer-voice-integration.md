---
title: Интеграция Customer Voice на страницы сайта электронной коммерции
description: В этой статье описывается, как интегрировать Microsoft Dynamics 365 Customer Voice на страницы сайта электронной коммерции Dynamics 365 Commerce.
author: samjarawan
ms.date: 05/17/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: samjar
ms.search.validFrom: 2019-10-31
ms.openlocfilehash: c8c67ecf4950c92fc91c8d119e06e5e8afff0ddf
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2022
ms.locfileid: "8850338"
---
# <a name="integrate-customer-voice-into-e-commerce-site-pages"></a>Интеграция Customer Voice на страницы сайта электронной коммерции

[!include [banner](../includes/banner.md)]

В этой статье описывается, как интегрировать Microsoft Dynamics 365 Customer Voice на страницы сайта электронной коммерции Dynamics 365 Commerce.

Вы можете интегрировать [Customer Voice](https://dynamics.microsoft.com/customer-voice/overview/) на сайт электронной коммерции для сбора, анализа и отслеживания отзывов клиентов в реальном времени. Перед тем, как приступать к интеграции, необходимо создать учетную запись и выбрать шаблон проекта Customer Voice для типа отзывов, которые необходимо собирать.

## <a name="integrate-the-customer-voice-service"></a>Интеграция службы Customer Voice

Чтобы создать учетную запись Customer Voice, перейдите на [Customer Voice](https://dynamics.microsoft.com/customer-voice/overview/) и следуйте инструкциям.

После создания учетной записи Customer Voice и входа следующий шаг — выбор шаблона проекта для типа отзывов, которые необходимо собирать.

Чтобы выбрать шаблон проекта Customer Voice, выполните следующие действия.

1. Перейдите на [страницу шаблона проекта Customer Voice](https://customervoice.microsoft.com/Pages/ProjectPage.aspx).
1. Выберите **Начало работы**.
1. Выберите шаблон проекта, соответствующий типу отзывов, которые вы хотите собирать, а затем выберите **Далее**.
1. На вкладке **Отправить** в области **Выберите формат внедрения** выберите формат внедрения. В поле **Код внедрения** отображается код, который должен быть внедрен в конструктор сайтов Commerce.

В примерах этой статьи используется шаблон проекта **Периодический опрос клиентов** и формат внедрения **Кнопка**.

На следующей иллюстрации в качестве примера показана страница шаблона проекта **Периодический опрос клиента**, где в качестве формата внедрения выбран вариант **Кнопка**, а код внедрения для этого варианта отображается в поле **Код внедрения**. Для внедрения предоставленного кода на страницы сайта необходимо выполнить три отдельных действия, как описано в следующих разделах.

![Страница «Периодический опрос клиентов», где выбран вариант «Кнопка».](media/customer-voice-integration-1.png)

### <a name="embed-the-external-script-url"></a>Внедрение URL-адреса внешнего сценария

На все страницах сайта, где должен присутствовать опрос Customer Voice, необходимо внедрить URL-адрес внешнего сценария, предоставленный Customer Voice в качестве кода внедрения. Лучшим способом внедрения сценария на несколько страниц сайта является создание в конструкторе сайтов фрагмента, содержащего URL-адрес внешнего сценария и последующее добавление этого фрагмента к шаблонам соответствующих страниц. После публикации обновленного шаблона код внешнего сценария на затронутых страницах сайта будет похож на приведенный ниже пример.

```html
<script src=https://mfpembedcdnmsit.azureedge.net/mfpembedcontmsit/Embed.js type="text/javascript"></script>
```

Дополнительные сведения о фрагментах см. в разделе [Работа с фрагментами](work-with-fragments.md).

> [!NOTE]
> Все, что вам нужно сделать — добавить URL-адрес к фрагменту. Модуль внешнего сценария добавит остальной код сценария.

Чтобы внедрить URL-адрес внешнего сценария во фрагмент, выполните следующие действия.

1. В конструкторе сайтов создайте фрагмент, основанный на [модуле внешнего сценария](script-module.md).
1. В новом фрагменте выберите ячейку **Внешний сценарий по умолчанию**.
1. В области свойств **внешнего сценария по умолчанию** в поле **Источник сценария** введите URL-адрес внешнего сценария, как показано в следующем примере.

    ![Внешний URL-адрес сценария в поле источника сценария для нового фрагмента.](media/customer-voice-integration-2.png)

1. Выберите **Сохранить**, затем выберите **Завершить правку**.
1. Выберите **Опубликовать**, чтобы опубликовать фрагмент.

Новый фрагмент, содержащий внедренный блок внешнего сценария, теперь готов к добавлению к соответствующему шаблону страницы.

### <a name="embed-the-external-style-sheet-code"></a>Внедрение кода внешней таблицы стилей

Далее, на всех страницах сайта, где должен присутствовать опрос Customer Voice, необходимо внедрить код внешней таблицы стилей, предоставленный Customer Voice в качестве кода внедрения. Как и в предыдущем разделе, лучшим способом внедрения кода внешней таблицы стилей на несколько страниц сайта является создание в конструкторе сайтов фрагмента, содержащего код внешней таблицы стилей и последующее добавление этого фрагмента к шаблонам соответствующих страниц. Внедренный код внешней таблицы стилей будет походить на следующий пример кода.

```typescript
<link rel="stylesheet" type="text/css" href=https://mfpembedcdnmsit.azureedge.net/mfpembedcontmsit/Embed.css />
```

Чтобы внедрить код внешней таблицы стилей во фрагмент, выполните следующие действия.

1. В конструкторе сайтов создайте фрагмент, основанный на [модуле Метатеги](metatags-module.md).
1. Во фрагменте выберите ячейку **Метатеги по умолчанию**.
1. В области свойств **метатегов по умолчанию** в поле **Мета теги** введите код таблицы стилей, как показано в следующем примере.

    ![Код внешней таблицы стилей в поле Мета-теги для нового фрагмента.](media/customer-voice-integration-3.png)

1. Выберите **Сохранить**, затем выберите **Завершить правку**.
1. Выберите **Опубликовать**, чтобы опубликовать фрагмент.

Новый фрагмент, содержащий внедренный код внешней таблицы стилей, теперь готов к добавлению к соответствующему шаблону страницы.

### <a name="embed-the-inline-script-code"></a>Внедрение встроенного кода сценария 

Далее, на всех страницах сайта, где должен присутствовать опрос Customer Voice, необходимо внедрить встроенный сценарий, предоставленный Customer Voice в качестве кода внедрения. Как и в предыдущих разделах, лучшим способом внедрения встроенного сценария на несколько страниц сайта является создание в конструкторе сайтов фрагмента, содержащего код встроенного сценария и последующее добавление этого фрагмента к шаблонам соответствующих страниц.

В следующем примере кода встроенного сценария **SURVEY\_KEY** — это заполнитель. Значение **SURVEY\_KEY** должно соответствовать фактическому ключу опроса, указанному Customer Voice в коде внедрения. Последняя строка вызывает код, который через одну секунду отображает кнопку опроса, и это гарантирует наличие достаточного времени для загрузки сценариев. В зависимости от выбранного опроса может также потребоваться добавить или изменить другие метаданные, например название компании.

```html
function renderSurveyButton() {
    var se = new SurveyEmbed("SURVEY_KEY","https://customervoice.microsoft.com/","https://mfpembedcdnmsit.azureedge.net/mfpembedcontmsit/","true");

    var context = {
        "First Name":"",
        "Last Name": "",
        "locale": "en-us",
        "companyname": "Adventure Works"
    };
    se.renderButton(context);
}

setTimeout(renderSurveyButton, 4000);
```

Чтобы внедрить код встроенного сценария во фрагмент, выполните следующие действия.

1. В конструкторе сайтов создайте фрагмент, основанный на [модуле встроенного сценария](script-module.md).
1. В новом фрагменте выберите ячейку **Встроенный сценарий по умолчанию**.
1. В области свойств **встроенного сценария по умолчанию** в поле **Встроенный сценарий** введите код встроенного сценария, как показано в следующем примере.

    ![Код встроенного сценария в поле встроенного сценария для нового фрагмента.](media/customer-voice-integration-4.png)

1. Выберите **Сохранить**, затем выберите **Завершить правку**.
1. Выберите **Опубликовать**, чтобы опубликовать фрагмент.

Новый фрагмент, содержащий внедренный код встроенного сценария, теперь готов к добавлению к соответствующему шаблону страницы.

## <a name="add-fragments-to-a-template"></a>Добавление фрагментов в шаблон

По завершении создания фрагментов, содержащих внедренный код Customer Voice, их необходимо добавить в шаблоны страниц, связанные со страницами сайта, туда, где они должны использоваться. На следующей иллюстрации с примером показаны три примера фрагментов, добавленные в шаблон страницы сведений о продукте (PDP).

![Примеры фрагментов, добавленных к шаблону PDP.](media/customer-voice-integration-5.png)

После публикации обновленного шаблона опрос Customer Voice будет отображаться на всех страницах, управляемых шаблоном.

Дополнительные сведения о шаблонах см. в разделе [Работа с шаблонами](work-with-templates.md).

## <a name="configure-content-security-policy"></a>Настройка политики безопасности содержимого

По умолчанию политика безопасности содержимого (CSP) не разрешает совершать вызовы других служб без дополнительных настроек. Таким образом, после публикации обновленных шаблонов, опрос, скорее всего, не будет загружаться на соответствующих страницах сайта. Чтобы просмотреть ошибки, связанные с CSP, откройте средства разработчика в браузере (F12), а затем перейдите на страницу, на которой присутствует опрос. Ошибки, связанные с CSP, появятся в выводе консоли.

Чтобы настроить CSP в конструкторе сайтов и исправить ошибки, выполните следующие действия.

1. Перейдите к **Параметры сайта \> Расширения**.
1. На вкладке **Политика безопасности содержимого** добавьте `https://customervoice.microsoft.com/` в директиву **child-src**.
1. Добавьте `https://customervoice.microsoft.com/` в директиву **frame-src**.
1. Добавьте `https://mfpembedcdnmsit.azureedge.net` и **.azureedge.net** в директиву **img-src**.

Дополнительные сведения см. в разделе [Политика безопасности содержимого](manage-csp.md).

## <a name="additional-resources"></a>Дополнительные ресурсы

[Модуль внешнего сценария](script-module.md)

[Модуль метатегов](metatags-module.md)

[Модуль встроенного сценария](script-module.md)

[Политика безопасности содержимого](manage-csp.md)

[Работа с фрагментами](work-with-fragments.md)

[Работа с шаблонами](work-with-templates.md)

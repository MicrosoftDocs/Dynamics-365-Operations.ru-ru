---
title: Создание возвратов в POS-терминале
description: В этой статье описывается, как инициировать возвраты для кассовых проводок или заказов клиентов в приложении Microsoft Dynamics 365 Commerce POS-терминала.
author: hhainesms
ms.date: 04/27/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: hhaines
ms.search.validFrom: 2020-02-20
ms.dyn365.ops.version: Release 10.0.20
ms.openlocfilehash: a49e9abd0143d480cc1cafb05be5e995fb3cebdd
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2022
ms.locfileid: "8857006"
---
# <a name="create-returns-in-pos"></a>Создание возвратов в POS-терминале

[!include [banner](includes/banner.md)]

В этой статье описывается, как инициировать возвраты для кассовых проводок или заказов клиентов в приложении Microsoft Dynamics 365 Commerce POS-терминала.

> [!NOTE]
> В выпуске Commerce версии 10.0.20 и позднее доступна новая функция, которая называется **Унифицированная обработка возвратов в POS-терминале**. Эта функция обеспечивает более согласованную и универсальную процедуру возврата в POS-терминале, независимо от типа проводки (кассовая проводка или заказ клиента) или исходного канала, в котором был создан заказ. Мы рекомендуем всем организациям включить эту новую функцию, чтобы улучшить общую надежность обработки возвратов через POS-терминал.
>
> После включения функции ее невозможно отключить.

## <a name="process-returns-by-using-the-return-transaction-operation"></a>Обработка возвратов с использованием операции проводки возврата

Рекомендуется добавить операцию проводки возврата в [макет экрана](pos-screen-layouts.md) POS-терминала. В выпусках до выпуска Commerce версии 10.0.20 операция проводки возврата правильно поддерживает обработку возвратов только для кассовых проводок. После включения функции **единой обработки возвратов для POS-терминала** в выпуске Commerce версии 10.0.20 или более поздней операция проводки возврата также поддерживает обработку возвратов, происходящих из заказов клиентов, таких как "самовывоз" или "доставка на дом", по которым уже были выставлены накладные.

Из операции проводки возврата пользователи могут выполнять поиск кассовых проводок или заказов клиентов, для которых осуществляется возврат, вводя любые из следующих четырех критериев поиска. Пользователи могут ввести эти критерии, используя клавиатуру устройства, экранную клавиатуру или сканер штрих-кодов.

- Код прихода
- Порядковый номер
- Код ссылки на канал (также называемый кодом подтверждения заказа)
- Код накладной

Если найдена проводка или заказ, удовлетворяющий критериям поиска, отображается страница **Возвращаемые продукты**. Там пользователи могут указать возвращаемые номенклатуры. Они также могут вводить возвращаемые количества и коды причины.

Для каждой строки заказа в списке возвращаемых продуктов POS-терминал отображает информацию о первоначальном количестве покупки и количествах из всех ранее обработанных возвратов. Возвращаемое количество, вводимое пользователем для строки заказа, должно быть меньше или равно значению поля **Доступно для возврата**.

![Страница возвращаемых продуктов.](media/returnslist.png)

Если во время обработки возвратов у пользователя имеется физический продукт и этот продукт имеет штрих-код, пользователь может отсканировать штрих-код для регистрации возврата. Каждое сканирование штрих-кода увеличивает возвращаемое количество на одну номенклатуру. Однако если метка штрих-кода имеет встроенное количество, это количество будет введено в поле **Возвращается сейчас**.

Пользователи могут также вручную выбрать возвращаемые номенклатуры на странице **Возвращаемые продукты**, а затем обновить поле **Возвращается сейчас**, используя область сведений справа.

Если для проводки указывается максимальное доступное количество **Возвращается сейчас**, пользователь может выбрать операцию **Выбрать все** на панели приложения POS-терминала, чтобы задать максимальное возвращаемое количество для всех строк.

Для каждой строки, в которой указано количество **Возвращается сейчас**, пользователь должен выбрать код причины возврата с помощью панели сведений. Для возврата по кассовым проводкам коды причин возврата настраиваются как информационные коды в профиле функциональности магазина. Для возвратов по заказам клиента коды причин возврата настраиваются на странице **Коды причин возврата** в Dynamics 365 Commerce Headquarters.

После настройки возвращаемого количества и кода причины для каждой номенклатуры, которая должна быть возвращена, пользователь может выбрать операцию **Возврат** на панели приложений POS, чтобы продолжить обработку. Отображается страница проводок POS-терминала, в которой возвращаемые номенклатуры, выбранные на предыдущей странице, были добавлены в корзину. Количества **Возвращается сейчас** для номенклатур отображаются как строки с отрицательным количеством по проводке, и рассчитывается общая сумма возврата.

Пользователи могут добавлять строки в проводку возврата, если они создают заказ на обмен. Пользователи также могут добавить в проводку возврата дополнительные оперативные номенклатуры, используя операцию **Возврат продукта** для выбранной строки продаж с положительным количеством, которая была добавлена.

> [!NOTE]
> Операция **Возврат продукта** в POS-терминале не предоставляет каких-либо проверок относительно исходной проводки и позволяет вернуть любой продукт. Поэтому рекомендуется, чтобы только авторизованные пользователи имели разрешение на выполнение этой операции, или чтобы при использовании этой операции требовалось переопределение менеджера.

Если при оформлении требуется возврат денежных средств, организации могут настроить [политики платежей по возвратам](refund_policy_returns.md), ограничивающие способы оплаты, которые могут использоваться для возврата денежных средств клиентам. Если исходные проводки была оплачена с использованием кредитной карты, в зависимости от процессора оплаты и конфигурации системы, у пользователей может быть возможность [выполнить возврат денежных средств на исходную карту](dev-itpro/linked-refunds.md). В этом случае возврат денежных средств может быть обработан без необходимости повторного считывания кредитной карты клиента. Токен исходного платежа используется для выдачи возврата денежных средств.

## <a name="other-return-options-in-pos"></a>Другие параметры возврата в POS-терминале

Когда функция **Унифицированная обработка возвратов в POS** включена, пользователи могут также использовать операцию **Показать журнал** в POS-терминале, чтобы начать возврат для кассовых проводок или заказов клиентов. Затем они могут выбрать проводку в журнале, а затем выбрать операцию **Возврат** на панели приложений POS-терминала. Эта операция доступна только в том случае, если в заказе имеются строки с возвратом. Она вызывает то же взаимодействие пользователя, что и при операции **Возврат проводки**.

Пользователи также могут использовать операцию **Повторно вызвать заказ** в POS-терминале для поиска и повторного вызова заказов клиентов. (Эта операция не может использоваться для кассовых проводок.) В этом случае после выбора заказа клиента операция **Возврат** на панели приложений POS-терминала может быть использована для запуска возврата для заказа клиента. Эта операция доступна только в том случае, если в заказе имеются строки с возвратом. Она вызывает то же взаимодействие пользователя, что и при операции **Возврат проводки** или **Показать журнал**.

## <a name="return-orders-are-posted-to-commerce-headquarters-as-sales-orders"></a>Заказы на возврат разносятся в Commerce Headquarters как заказы на продажу 

Когда функция **Унифицированная обработка возвратов в POS** включена, все возвраты, созданные в POS, записываются в Commerce Headquarters как заказы на продажу, имеющие отрицательные строки. В выпусках до выпуска Commerce версии 10.0.20 пользователи могут выбрать, должны ли заказы на возврат разноситься как заказы на продажу, имеющие отрицательные строки, или же они должны быть заказами на возврат, созданными в процессе авторизации возврата товаров (RMA). 

В функции **Унифицированная обработка возвратов в POS** вариант использования процесса RMA для создания возвратов в POS-терминале была объявлена устаревшей. После включения этой функции все возвраты будут создаваться как заказы на продажу, имеющие отрицательные строки.

## <a name="offline-return-processing-improvements"></a>Улучшения автономной обработки возвратов

В большинстве случаев когда возврат обрабатывается в POS-терминале, система пытается выполнить вызов службы Real-time Service (RTS) в Commerce Headquarters для подтверждения текущих доступных для возврата количеств. Эта проверка помогает защитить от мошеннических ситуаций, в которых клиент пытается вернуть одну и ту же номенклатуру в нескольких местах.

Для обработки ситуаций, когда вызов службы RTS не может быть выполнен из-за проблем с сетью или подключением, процесс был установлен для периодической синхронизации данных о возвращенных количествах из Commerce Headquarters с базой данных канала магазина. Такое отслеживание возвратов на стороне канала позволяет гарантировать, что количества **Доступно для возврата**, отображаемые в POS-терминале, достаточно точны даже в том случае, когда POS-терминал не подключен к сети. Это также гарантирует, что POS-терминал может продолжать проверять информацию на стороне канала, чтобы предотвратить мошеннические возвраты.

Чтобы использовать процесс возврата в автономном режиме соответствующим образом, организации должны спланировать пакетное задание **Обновить количества возврата** в Commerce Headquarters, чтобы оно выполнялось часто. Рекомендуется, чтобы это задание выполнялось с той же частотой, что и P-задание, которое извлекает новые проводки из каналов Commerce в Commerce Headquarters.

Задание **Обновить количества возврата** рассчитывает количество, доступное для возврата по всем заказам на продажу, имеющимся в Commerce Headquarters. Данные, которые рассчитывает задание, должны быть отправлены в базы данных канала, чтобы можно было обновить каналы магазина. Для этой цели используется задание распределения **Количества по возврату** (1200). Поскольку данные о возвращаемом количестве синхронизируются с Commerce Headquarters, если возврат обрабатывается в POS-терминале, но не удается выполнить вызов службы RTS, POS-терминал может использовать данные о возвратах со стороны канала, чтобы проверит количества **Доступно для возврата** для данной строки продаж.

Если не удается выполнить вызовы службы RTS и POS-терминал использует данные на стороне канала для проверки возврата, предупреждающее сообщение информирует пользователей о том, что они создают "автономный" возврат. Таким образом, они знают о том, что количество **Доступно для возврата**, отображаемое в POS-терминале, может быть устаревшим и неточным, в зависимости от того, когда задание **Обновить количества возврата** было в последний раз обработано и синхронизировано с каналом.

Например, клиент недавно выполнил возврат для строки заказа в другом канале, но данные еще не были синхронизированы с базами данных канала с помощью задания **Обновить количества возврата**. Клиент затем переходит в другой магазин и пытается снова вернуть ту же номенклатуру. В этом случае, если магазин не может сделать вызов службы RTS в Commerce Headquarters, чтобы получать данные о возвратах в реальном времени, POS-терминал позволит снова вернуть номенклатуру. Однако пользователь получает предупреждение о том, что сведения, используемые для проверки возврата, могут быть устаревшими. Сообщение, которое получает пользователь, — это только предупредительное сообщение. Это не мешает пользователю продолжить обработку возврата.

Если информация на стороне канала по какой-либо причине не является актуальной, и при этом выполняется автономный возврат для количества, которое превышает фактическое значение **Доступно для возврата**, может быть сформирована ошибка при выполнении разноски журнала операций, чтобы создать проводку в Commerce Headquarters.

> [!NOTE]
> Когда функция **Унифицированная обработка возвратов в POS** включена, становятся доступными новые дополнительные функции, которые поддерживают проверку возвратов продуктов с серийными номерами. Дополнительные сведения см. в разделе [Возврат продуктов с контролируемыми серийными номерами в POS-терминале](POS-serial-returns.md).

## <a name="version-details"></a>Сведения о версии

В следующем списке приведены минимальные требования к версии для различных компонентов.
- Commerce headquarters: версия 10.0.20
- Commerce Scale Unit (CSU): версия 9.30
- POS-терминал: версия 9.30

## <a name="enable-proper-tax-calculation-for-returns-with-partial-quantity"></a>Включить надлежащий расчет налога для возвратов с частичным количеством

Эта функция гарантирует, что при возврате заказа с использованием нескольких накладных налоги в конечном итоге будут равняться первоначальной начисленной сумме налога.

1. В рабочей области **Управление функциями** найдите функцию **Включить надлежащий расчет налога для возвратов с частичным количеством**.
1. Выберите функцию **Включить надлежащий расчет налога для возвратов с частичным количеством**, затем выберите **Включить**.

## <a name="set-up-return-locations-for-retail-stores"></a>Настройка местонахождений возврата для магазинов розничной торговли

Commerce позволяет настроить местонахождение возврата на основе инфокодов розничной торговли и кодов оснований для продаж и маркетинга. Когда клиенты возвращают покупки, кассиры часто указывают причину возврата. Можно указать, чтобы возвращаемые продукты должны назначаться разным местонахождениям возврата в запасах на основании инфокодов и кодов причины, выбираемых кассирами в POS в ККМ.

Например, клиент возвращает бракованный продукт, и кассир обрабатывает проводку возврата. Когда Retail POS отображает информационный код для возвратов, кассир выбирает дополнительный код для возвратов брака. Возвращаемый продукт автоматически назначается для определенному местоположению возврата.

Расположением для возврата может быть склад, местонахождение на складе или даже определенная палета в зависимости от местонахождений запасов, настроенных в организации. Можно сопоставить каждое местонахождение возврата с одним или несколькими инфокодами розничной торговли и кодами причины продаж и маркетинга.

### <a name="prerequisites"></a>Необходимые условия

Перед настройкой местонахождений возврата необходимо настроить следующие элементы:

- **Инфокоды розничной торговли** — запросы в ККМ POS, настроенные в модуле **Розничная торговля**. Дополнительные сведения см. в разделе [Настройка инфокодов](/dynamicsax-2012/appuser-itpro/setting-up-info-codes).
- **Коды причины продаж и маркетинга** — запросы в ККМ POS, настроенные в модуле **Продажи и маркетинг**. Дополнительные сведения см. в разделе [Настройка кодов причин](/dynamicsax-2012/appuser-itpro/set-up-return-reason-codes).
- **Места хранения** — области хранения запасов. Дополнительные сведения см. в разделе [Настройка местоположений запасов](/dynamicsax-2012/appuser-itpro/about-locations).
    
### <a name="set-up-return-locations"></a>Настройка расположений для возврата

Чтобы настроить местонахождения возврата, выполните следующие действия.

1. Перейдите в раздел **Retail и Commerce \> Настройка каналов \> Склады** и выберите склад.
1. На экспресс-вкладке **Розница** в поле **Расположение возврата по умолчанию** выберите местоположение запасов, которое будет использоваться для возвратов, в которых инфокоды или коды причин не сопоставляются с расположениями возврата.
1. В поле **Палета возврата по умолчанию** выберите палету, которое будет использоваться для возвратов, в которых инфокоды или коды причин не сопоставляются с расположениями возврата.
1. Перейдите в раздел **Retail и Commerce \> Управление запасами \> Расположения для возврата**.
1. Выберите **Создать** для создания политики расположения для возврата.
1. Введите уникальное имя и описание местонахождения возврата.

    > [!NOTE]
    > Если для местонахождений возврата настроена номерная серия, имя вводится автоматически.

1. На экспресс-вкладке **Общие** задайте для параметра **Печать этикеток** значение **Да**, чтобы печатать этикетки для всех продуктов, назначенных для расположений возврата.
1. Задайте для параметра **Блокирование запасов** значение **Да**, чтобы исключить возвращенные продукты в местонахождении возврата по умолчанию из запасов и заблокировать их для продажи.
1. Для сопоставления определенных инфокодов розничной торговли и дополнительных кодов с расположениями возврата выполните следующие действия:

    1. На экспресс вкладке **Инфокоды розничной торговли** выберите **Добавить**.
    1. В поле **Инфокод** выберите инфокод для возвратов.
    1. В поле **Дополнительный код** выберите дополнительный код для причины возврата. В поле **Описание** отображается описание выбранного дополнительного кода.
    1. В поле **Магазин** выберите магазин, в котором используется инфокод.
    1. Для указания расположения возврата используются поля **Склад**, **Местоположение** и **Код палеты**. Например, чтобы указать местонахождение в магазине, выберите магазин в поле **Магазин** и местонахождение в поле **Расположение**.
    1. Установите флажок **Блокирование запасов**, чтобы исключить возвращенные продукты из запасов и заблокировать их для продажи.

1. Для сопоставления кодов оснований для продаж и маркетинга с расположениями возврата выполните следующие действия:

    1. На экспресс-вкладке **Коды оснований для продаж и маркетинга** выберите **Добавить**.
    1. В поле **Код причины** выберите код причины для возвратов. В поле **Описание** отображается описание выбранного кода причины.
    1. В поле **Магазин** выберите магазин, в котором используется код причины.
    1. Для указания расположения возврата используются поля **Склад**, **Местоположение** и **Код палеты**. Например, чтобы указать определенную палету в местонахождении на складе, выберите склад в поле **Склад**, местонахождение в поле **Расположение** и палету в поле **Код палеты**.
    1. Установите флажок **Блокирование запасов**, чтобы исключить возвращенные продукты из запасов и заблокировать их для продажи.

    > [!NOTE]
    > Если для номенклатуры используется политика местоположения возврата, но причина возврата, которую кассир выбирает, не совпадает ни с каким кодом, указанным на экспресс-вкладке **Инфокоды розничной торговли** или **Коды оснований для продаж и маркетинга**, номенклатура будет отправлена в расположение возврата по умолчанию, которое определено на странице **Склад**. Кроме того, установка флажка **Блокирование запасов** на экспресс-вкладке **Общие** на странице **Расположения для возврата** определяет, должна ли возвращенная номенклатура быть блокирована в запасах.

1. Перейдите в раздел **Retail и Commerce \> Иерархия продуктов Commerce**.
1. На экспресс-вкладке **Управление свойствами категории запасов** в поле **Местоположение возврата** выберите расположение возврата. Так как для одного и того же магазина можно определить несколько политик расположений возврата, выбранное здесь значение определяет используемую политику расположений возврата.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Возврат продуктов с контролируемыми серийными номерами в POS-терминале](POS-serial-returns.md)

[Связанные возвраты ранее утвержденных и подтвержденных проводок](dev-itpro/linked-refunds.md)

[Создание и обновление политик возврата и возмещения для канала](refund_policy_returns.md)

[Визуальные конфигурации пользовательского интерфейса POS](pos-screen-layouts.md)

---
title: Обзор омниканальных платежей
description: В этой теме представлен обзор омниканальных платежей в Dynamics 365 Commerce.
author: rubendel
manager: AnnBe
ms.date: 09/17/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
audience: Application user
ms.reviewer: josaw
ms.custom: 141393
ms.assetid: ''
ms.search.region: Global
ms.search.industry: Retail
ms.author: rubendel
ms.search.validFrom: 2019-01-01
ms.dyn365.ops.version: AX 8.1.3
ms.openlocfilehash: 6ecfd518298021e08cf73934b450d175cf699a46
ms.sourcegitcommit: 38d40c331c8894acb7b119c5073e3088b54776c1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2021
ms.locfileid: "4985869"
---
# <a name="omni-channel-payments-overview"></a><span data-ttu-id="08457-103">Обзор омниканальных платежей</span><span class="sxs-lookup"><span data-stu-id="08457-103">Omni-channel payments overview</span></span>

[!include [banner](../includes/banner.md)]

<span data-ttu-id="08457-104">В этой теме представлен обзор омниканальных платежей в Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="08457-104">This topic provides an overview of omni-channel payments in Dynamics 365 Commerce.</span></span> <span data-ttu-id="08457-105">Она содержит полный список поддерживаемых сценариев, информацию о функциях, настройке и устранении неполадок, а также описания типичных проблем.</span><span class="sxs-lookup"><span data-stu-id="08457-105">It includes a comprehensive list of supported scenarios, information about functionality, setup, and troubleshooting, and descriptions of some typical issues.</span></span>

## <a name="key-terms"></a><span data-ttu-id="08457-106">Ключевые термины</span><span class="sxs-lookup"><span data-stu-id="08457-106">Key terms</span></span>

| <span data-ttu-id="08457-107">Срок</span><span class="sxs-lookup"><span data-stu-id="08457-107">Term</span></span> | <span data-ttu-id="08457-108">Описание</span><span class="sxs-lookup"><span data-stu-id="08457-108">Description</span></span> |
|---|---|
| <span data-ttu-id="08457-109">Маркер</span><span class="sxs-lookup"><span data-stu-id="08457-109">Token</span></span> | <span data-ttu-id="08457-110">Строка данных, которую процессор платежей предоставляет в качестве ссылки.</span><span class="sxs-lookup"><span data-stu-id="08457-110">A string of data that a payment processor provides as a reference.</span></span> <span data-ttu-id="08457-111">Маркеры могут представлять номера платежных карт, авторизации платежей и предыдущие записи платежей.</span><span class="sxs-lookup"><span data-stu-id="08457-111">Tokens can represent payment card numbers, payment authorizations, and previous payment captures.</span></span> <span data-ttu-id="08457-112">Маркеры важны, потому что они помогают хранить конфиденциальные данные вне системы POS-терминалов.</span><span class="sxs-lookup"><span data-stu-id="08457-112">Tokens are important because they help keep sensitive data out of the point of sale (POS) system.</span></span> <span data-ttu-id="08457-113">Иногда они также называются *ссылками*.</span><span class="sxs-lookup"><span data-stu-id="08457-113">They are sometimes also referred to as *references*.</span></span> |
| <span data-ttu-id="08457-114">Маркер карты</span><span class="sxs-lookup"><span data-stu-id="08457-114">Card token</span></span> | <span data-ttu-id="08457-115">Маркер, предоставляемый процессором платежей для хранения в системе POS.</span><span class="sxs-lookup"><span data-stu-id="08457-115">A token that a payment processor provides for storage in the POS system.</span></span> <span data-ttu-id="08457-116">Маркер карты может использоваться только продавцом, который его получает.</span><span class="sxs-lookup"><span data-stu-id="08457-116">A card token can be used only by the merchant who receives it.</span></span> <span data-ttu-id="08457-117">Маркеры карт они называются *ссылками карт*.</span><span class="sxs-lookup"><span data-stu-id="08457-117">Card tokens are sometimes also referred to as *card references*.</span></span> |
| <span data-ttu-id="08457-118">Маркер авторизации (auth)</span><span class="sxs-lookup"><span data-stu-id="08457-118">Authorization (auth) token</span></span> | <span data-ttu-id="08457-119">Уникальный код, который процесс платежа представляет как часть отклика, который он отправляет в систему POS после того, как система POS-терминалов выполнит запрос авторизации.</span><span class="sxs-lookup"><span data-stu-id="08457-119">A unique ID that a payment process provides as part of the response that it sends to a POS system after the POS system makes an authorization request.</span></span> <span data-ttu-id="08457-120">Маркер авторизации может использоваться позднее, если процессор вызван для выполнения таких действий, как реверсирование или аннулирование авторизации.</span><span class="sxs-lookup"><span data-stu-id="08457-120">An authorization token can be used later if the processor is called to perform actions such as reversing or voiding the authorization.</span></span> <span data-ttu-id="08457-121">Однако чаще всего он используется для регистрации фондов при выполнении заказа или при завершении проводки.</span><span class="sxs-lookup"><span data-stu-id="08457-121">However, it's most often used to capture funds when an order is fulfilled or a transaction is finalized.</span></span> <span data-ttu-id="08457-122">Маркеры авторизации иногда называются *ссылками авторизации*.</span><span class="sxs-lookup"><span data-stu-id="08457-122">Authorization tokens are sometimes also referred to as *authorization references*.</span></span> |
| <span data-ttu-id="08457-123">Маркер подтверждения</span><span class="sxs-lookup"><span data-stu-id="08457-123">Capture token</span></span> | <span data-ttu-id="08457-124">Ссылка, которую процессор платежей предоставляет системе POS при завершении или подтверждении платежа.</span><span class="sxs-lookup"><span data-stu-id="08457-124">A reference that a payment processor provides to a POS system when a payment is finalized or captured.</span></span> <span data-ttu-id="08457-125">Маркер подтверждения можно затем использовать для ссылки на подтверждение платежа в последующих операциях, таких как запросы на возврат средств.</span><span class="sxs-lookup"><span data-stu-id="08457-125">The capture token can then be used to reference the payment capture in subsequent operations, such as refund requests.</span></span> | 
| <span data-ttu-id="08457-126">Карта отсутствует</span><span class="sxs-lookup"><span data-stu-id="08457-126">Card not present</span></span> | <span data-ttu-id="08457-127">Термин, который относится к платежным проводкам, в которых физическая карта не представлена.</span><span class="sxs-lookup"><span data-stu-id="08457-127">A term that refers to payment transactions where a physical card isn't presented.</span></span> <span data-ttu-id="08457-128">Например, эти проводки могут выполняться в сценариях электронной коммерции или в центре обработки вызовов.</span><span class="sxs-lookup"><span data-stu-id="08457-128">For example, these transactions can occur in e-commerce or call center scenarios.</span></span> <span data-ttu-id="08457-129">Для этих проводок информация, связанная с платежом, вручную вводится на веб-сайте электронной коммерции, в потоке центра обработки вызовов или на POS-терминале или платежном терминале.</span><span class="sxs-lookup"><span data-stu-id="08457-129">For these transactions, the payment-related information is manually entered on an e-commerce website, in a call center flow, or on the POS or payment terminal.</span></span> |
| <span data-ttu-id="08457-130">Карта присутствует</span><span class="sxs-lookup"><span data-stu-id="08457-130">Card present</span></span> | <span data-ttu-id="08457-131">Термин, который относится к проводкам платежа, в которых физическая карта представлена и используется на платежном терминале, подключенном к системе POS-терминалов Microsoft Dynamics 365.</span><span class="sxs-lookup"><span data-stu-id="08457-131">A term that refers to payment transactions where a physical card is presented and used on a payment terminal that is connected to the Microsoft Dynamics 365 POS system.</span></span> |

## <a name="overview"></a><span data-ttu-id="08457-132">Обзор</span><span class="sxs-lookup"><span data-stu-id="08457-132">Overview</span></span>

<span data-ttu-id="08457-133">В общем случае термин *омниканальные платежи* описывает возможность создания заказа в одном канале и выполнения его в другом канале.</span><span class="sxs-lookup"><span data-stu-id="08457-133">In general, the term *omni-channel payments* describes the ability to create an order in one channel and fulfill it in another channel.</span></span> <span data-ttu-id="08457-134">Ключом к поддержке омниканальных платежей является сохранение сведений об оплате вместе с остальными сведениями о заказе, а затем использование этих сведений об оплате при вызове или обработке заказа в другом канале.</span><span class="sxs-lookup"><span data-stu-id="08457-134">The key to omni-channel payment support is preserving payment details together with the rest of the order details, and then using those payment details when the order is recalled or processed in another channel.</span></span> <span data-ttu-id="08457-135">Классическим примером является сценарий "купить в Интернете, забрать в магазине".</span><span class="sxs-lookup"><span data-stu-id="08457-135">A classic example is the "Buy online, pick up in store" scenario.</span></span> <span data-ttu-id="08457-136">В этом сценарии сведения об оплате добавляются, когда заказ создается в Интернете.</span><span class="sxs-lookup"><span data-stu-id="08457-136">In this scenario, the payment details are added when the order is created online.</span></span> <span data-ttu-id="08457-137">Затем они вызываются в POS-терминале, чтобы снять средства с платежной карты клиента в момент выдачи.</span><span class="sxs-lookup"><span data-stu-id="08457-137">They are then recalled at the POS to charge the customer's payment card at the time of pickup.</span></span> 

<span data-ttu-id="08457-138">Все сценарии, описанные в этом разделе, могут быть реализованы с помощью стандартного пакета средств разработки программного обеспечения (SDK) платежей, поставляемого вместе с Commerce.</span><span class="sxs-lookup"><span data-stu-id="08457-138">All the scenarios that are described in this topic can be implemented by using the standard Payments software development kit (SDK) that is provided with Commerce.</span></span> <span data-ttu-id="08457-139">[Соединитель платежей Dynamics 365 для Adyen](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3) предоставляет готовую реализацию каждого сценария, описанного здесь.</span><span class="sxs-lookup"><span data-stu-id="08457-139">The [Dynamics 365 Payment Connector for Adyen](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3) provides an out-of-box implementation of every scenario that is described here.</span></span> 

### <a name="prerequisites"></a><span data-ttu-id="08457-140">Необходимые условия</span><span class="sxs-lookup"><span data-stu-id="08457-140">Prerequisites</span></span>

<span data-ttu-id="08457-141">Для каждого сценария, описанного в этом разделе, требуется соединитель платежей, поддерживающий омниканальные платежи.</span><span class="sxs-lookup"><span data-stu-id="08457-141">Every scenario that is described in this topic requires a payment connector that supports omni-channel payments.</span></span> <span data-ttu-id="08457-142">Готовый соединитель Adyen также можно использовать, поскольку он поддерживает сценарии, доступные через пакет SDK для платежей.</span><span class="sxs-lookup"><span data-stu-id="08457-142">The out-of-box Adyen connector can also be used, because it supports the scenarios that are made available through the Payments SDK.</span></span> <span data-ttu-id="08457-143">Для получения дополнительных сведений о том, как реализовать соединители платежей, и о пакете SDK Retail в целом см. на [домашней странице Retail для ИТ-специалистов и разработчиков](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/dev-retail-home-page#payment-connectors).</span><span class="sxs-lookup"><span data-stu-id="08457-143">For more information about how to implement payment connectors, and about the Retail SDK in general, visit the [Retail for IT pros and developers home page](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/dev-retail-home-page#payment-connectors).</span></span>

#### <a name="supported-versions"></a><span data-ttu-id="08457-144">Поддерживаемые версии</span><span class="sxs-lookup"><span data-stu-id="08457-144">Supported versions</span></span>

<span data-ttu-id="08457-145">Возможности омниканальных платежей, описанные в этом разделе, были выпущены как часть Microsoft Dynamics 365 for Retail версии 8.1.3.</span><span class="sxs-lookup"><span data-stu-id="08457-145">The omni-channel payment capabilities that are described in this topic were released as part of Microsoft Dynamics 365 for Retail version 8.1.3.</span></span> 

#### <a name="card-present-and-card-not-present-connectors"></a><span data-ttu-id="08457-146">Соединители "карта присутствует" и "карта отсутствует"</span><span class="sxs-lookup"><span data-stu-id="08457-146">"Card present" and "card not present" connectors</span></span>

<span data-ttu-id="08457-147">В пакете SDK "Платежи" для платежей используются два набора интерфейсов прикладного программирования (API).</span><span class="sxs-lookup"><span data-stu-id="08457-147">The Payments SDK relies on two sets of application programming interfaces (APIs) for payments.</span></span> <span data-ttu-id="08457-148">Первый набор интерфейсов API называется **iPaymentProcessor**.</span><span class="sxs-lookup"><span data-stu-id="08457-148">The first set of APIs is named **iPaymentProcessor**.</span></span> <span data-ttu-id="08457-149">Он используется для реализации соединителей платежа "карты нет", которые могут использоваться в центрах обработки вызовов и в платформе электронной коммерции Microsoft Dynamics.</span><span class="sxs-lookup"><span data-stu-id="08457-149">It's used to implement "card not present" payment connectors that can be used in call centers and with the Microsoft Dynamics e-Commerce platform.</span></span> <span data-ttu-id="08457-150">Дополнительные сведения об интерфейсе **iPaymentProcessor** см. в техническом документе [Реализация соединителя платежей и платежного устройства](https://download.microsoft.com/download/e/2/7/e2735c65-1e66-4b8d-8a3c-e6ef3a319137/The%20Guide%20to%20Implementing%20Payment%20Connector%20and%20Payment%20Device_update.pdf), который охватывает платежи.</span><span class="sxs-lookup"><span data-stu-id="08457-150">For more information about the **iPaymentProcessor** interface, see the [Implement a payment connector and a payment device](https://download.microsoft.com/download/e/2/7/e2735c65-1e66-4b8d-8a3c-e6ef3a319137/The%20Guide%20to%20Implementing%20Payment%20Connector%20and%20Payment%20Device_update.pdf) white paper, which covers payments.</span></span> 

<span data-ttu-id="08457-151">Второй набор интерфейсов API называется **iNamedRequestHandler**.</span><span class="sxs-lookup"><span data-stu-id="08457-151">The second set of APIs is named **iNamedRequestHandler**.</span></span> <span data-ttu-id="08457-152">Он поддерживает реализацию случаев интеграции платежей "карта присутствует", использующих платежный терминал.</span><span class="sxs-lookup"><span data-stu-id="08457-152">It supports the implementation of "card present" payment integrations that use a payment terminal.</span></span> <span data-ttu-id="08457-153">Дополнительные сведения об интерфейсе **iNamedRequestHandler** см. в разделе [Создание интеграции платежей для платежного терминала](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/end-to-end-payment-extension).</span><span class="sxs-lookup"><span data-stu-id="08457-153">For more information about the **iNamedRequestHandler** interface, see [Create a payment integration for a payment terminal](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/end-to-end-payment-extension).</span></span> 

### <a name="setup-and-configuration"></a><span data-ttu-id="08457-154">Настройка и конфигурация</span><span class="sxs-lookup"><span data-stu-id="08457-154">Setup and configuration</span></span>

<span data-ttu-id="08457-155">Следующие компоненты и шаги настройки являются обязательными:</span><span class="sxs-lookup"><span data-stu-id="08457-155">The following components and setup steps are required:</span></span>

- <span data-ttu-id="08457-156">**Интеграция электронной коммерции:** интеграция с модулем Commerce необходима для поддержки сценариев, когда заказ исходит из Интернет-магазина.</span><span class="sxs-lookup"><span data-stu-id="08457-156">**eCommerce integration:** An integration with Commerce is required to support scenarios where an order originates in an online storefront.</span></span> <span data-ttu-id="08457-157">Для получения дополнительных сведений о пакете SDK для электронной коммерции Retail см. в разделе [Пакет разработки программного обеспечения для платформы электронной коммерции (SDK)](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/ecommerce-platform-sdk).</span><span class="sxs-lookup"><span data-stu-id="08457-157">For more information about the Retail e-Commerce SDK, see [e-Commerce platform software development kit (SDK)](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/ecommerce-platform-sdk).</span></span> <span data-ttu-id="08457-158">В демонстрационной среде указанный магазин поддерживает сценарии омниканальных платежей.</span><span class="sxs-lookup"><span data-stu-id="08457-158">In a demo environment, the reference storefront supports omni-channel payment scenarios.</span></span> 
- <span data-ttu-id="08457-159">**Конфигурация интернет-платежей:** настройка интернет-канала должна включать в себя соединитель платежей, который был обновлен для поддержки многоканальных платежей.</span><span class="sxs-lookup"><span data-stu-id="08457-159">**Online payments configuration:** The setup of the online channel must include a payment connector that has been updated to support omni-channel payments.</span></span> <span data-ttu-id="08457-160">В качестве альтернативы можно использовать готовый соединитель платежей.</span><span class="sxs-lookup"><span data-stu-id="08457-160">Alternatively, the out-of-box payment connector can be used.</span></span> <span data-ttu-id="08457-161">Сведения о настройке соединителя платежей Adyen для интернет-магазинов см. в разделе [Соединитель платежей Adyen](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3#e-commerce).</span><span class="sxs-lookup"><span data-stu-id="08457-161">For information about how to configure the Adyen payment connector for online stores, see [Adyen payment connector](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3#e-commerce).</span></span> <span data-ttu-id="08457-162">В дополнение к шагам настройки электронной коммерции, описанным в этом разделе, необходимо установить для параметра **Разрешить сохранение информации о платеже в электронной коммерции** значение **True** в настройках соединителя Adyen.</span><span class="sxs-lookup"><span data-stu-id="08457-162">In addition to the eCommerce setup steps that are described in that topic, the **Allow saving payment information in e-commerce** parameter must be set to **True** in the settings for the Adyen connector.</span></span> 
- <span data-ttu-id="08457-163">**Конфигурация омниканальных платежей:** в бэк-офисе выберите **Retail и Commerce \> Настройка Headquarters \> Параметры \> Общие параметры Commerce**.</span><span class="sxs-lookup"><span data-stu-id="08457-163">**Omni-channel payments configuration:** In the back office, go to **Retail and Commerce \> Headquarters setup \> Parameters \> Commerce shared parameters**.</span></span> <span data-ttu-id="08457-164">Затем на вкладке **Омниканальные платежи** выберите значение для параметра **Использовать омниканальные платежи** значение **Да**.</span><span class="sxs-lookup"><span data-stu-id="08457-164">Then, on the **Omni-channel payments** tab, set the **Use omni-channel payments** option to **Yes**.</span></span> <span data-ttu-id="08457-165">В Commerce версии 10.0.12 и выше этот параметр находится в рабочей области **Управление функциями**.</span><span class="sxs-lookup"><span data-stu-id="08457-165">In Commerce versions 10.0.12 and later, this setting is in the **Feature Management** workspace.</span></span> <span data-ttu-id="08457-166">Выберите функцию **Многоканальные платежи** и щелкните **Включить**.</span><span class="sxs-lookup"><span data-stu-id="08457-166">Select the **Omni-channel payments** feature and click **Enable now**.</span></span> 
- <span data-ttu-id="08457-167">**Службы платежей:** центр обработки звонков использует соединитель платежей по умолчанию на странице **Службы платежей** для обработки платежей.</span><span class="sxs-lookup"><span data-stu-id="08457-167">**Payment services:** The call center uses the default payment connector on the **Payment services** page to process payments.</span></span> <span data-ttu-id="08457-168">Для поддержки таких сценариев, как "Купить в центре обработки вызовов, забрать в магазине", этот платежный соединитель по умолчанию должен быть платежным соединителем Adyen или платежным соединителем, который удовлетворяет требованиям к реализации для омниканальных платежей.</span><span class="sxs-lookup"><span data-stu-id="08457-168">To support scenarios such as "Buy in call center, pick up in store," this default payment connector must be the Adyen payment connector or a payment connector that meets the implementation requirements for omni-channel payments.</span></span>
- <span data-ttu-id="08457-169">**Услуга электронного платежа:** платежи через платежный терминал должны быть настроены на экспресс-вкладке **Услуга электронного платежа** в профиле оборудования.</span><span class="sxs-lookup"><span data-stu-id="08457-169">**EFT service:** Payments through a payment terminal must be set up on the **EFT service** FastTab of the hardware profile.</span></span> <span data-ttu-id="08457-170">Соединитель Adyen включает готовую поддержку сценариев омниканальных платежей.</span><span class="sxs-lookup"><span data-stu-id="08457-170">The Adyen connector supports omni-channel payments scenarios out of the box.</span></span> <span data-ttu-id="08457-171">Другие соединители платежей, поддерживающие интерфейс **iNamedRequestHandler**, также могут использоваться, если они поддерживают омниканальные платежи.</span><span class="sxs-lookup"><span data-stu-id="08457-171">Other payment connectors that support the **iNamedRequestHandler** interface can also be used if they support omni-channel payments.</span></span>
- <span data-ttu-id="08457-172">**Доступность платежного соединителя:** при повторном вызове заказа строки платежного средства, которые вызываются вместе с заказом, включают имя соединителя платежа, который использовался для создания авторизаций, связанных с этим заказом.</span><span class="sxs-lookup"><span data-stu-id="08457-172">**Payment connector availability:** When an order is recalled, the payment tender lines that are recalled together with the order include the name of the payment connector that was used to create the authorizations that are associated with that order.</span></span> <span data-ttu-id="08457-173">Когда заказ будет выполнен, SDK платежей предпринимает попытку использования того же соединителя, который использовался для создания исходной авторизации.</span><span class="sxs-lookup"><span data-stu-id="08457-173">When the order is fulfilled, the Payments SDK tries to use the same connector that was used to create the original authorization.</span></span> <span data-ttu-id="08457-174">Таким образом, платежный соединитель с теми же свойствами получателя платежа должен быть доступен для фиксации.</span><span class="sxs-lookup"><span data-stu-id="08457-174">Therefore, a payment connector that has the same merchant properties must be available for capture.</span></span> 
- <span data-ttu-id="08457-175">**Типы карт:** для правильной работы омниканальных сценариев каждый канал должен иметь одинаковую настройку типов платежных средств, которые могут быть использованы для омниканальной работы.</span><span class="sxs-lookup"><span data-stu-id="08457-175">**Card types:** For omni-channel scenarios to work properly, each channel must have the same setup for tender types that can be used for omni-channel.</span></span> <span data-ttu-id="08457-176">Эта настройка включает коды методов оплаты и коды типов карт.</span><span class="sxs-lookup"><span data-stu-id="08457-176">This setup includes payment method IDs and card type IDs.</span></span> <span data-ttu-id="08457-177">Например, если тип платежного средства **Карты** имеет идентификатор **2** в настройке интернет-магазина, он должен иметь такой же код в настройке розничного магазина.</span><span class="sxs-lookup"><span data-stu-id="08457-177">For example, if the **Cards** tender type has an ID of **2** in the online store setup, it should have the same ID in the retail store setup.</span></span> <span data-ttu-id="08457-178">Эти же требования относятся к кодам типов карт.</span><span class="sxs-lookup"><span data-stu-id="08457-178">The same requirement applies to card type IDs.</span></span> <span data-ttu-id="08457-179">Если в интернет-магазине для номера карт **12** установлено значение **VISA**, для розничного магазина необходимо настроить этот же код.</span><span class="sxs-lookup"><span data-stu-id="08457-179">If card number **12** is set to **VISA** in the online store, the same ID should be set up for the retail store.</span></span> 
- <span data-ttu-id="08457-180">Retail Modern POS для Windows или Android со станцией оборудования или</span><span class="sxs-lookup"><span data-stu-id="08457-180">The Retail Modern POS for Windows or Android with built-in hardware station   -or-</span></span>
- <span data-ttu-id="08457-181">Modern POS для iOS или Cloud POS с подключенной общей станцией оборудования.</span><span class="sxs-lookup"><span data-stu-id="08457-181">Modern POS for iOS or Cloud POS with connected shared hardware station.</span></span> 

### <a name="basic-principle-supporting-omni-channel-payments"></a><span data-ttu-id="08457-182">Основной принцип поддержки омниканальных платежей</span><span class="sxs-lookup"><span data-stu-id="08457-182">Basic principle supporting omni-channel payments</span></span>

<span data-ttu-id="08457-183">Соединители платежей и процессоры платежей используют маркеры, или ссылки, для ссылки на взаимодействия, которые относятся к платежам картой.</span><span class="sxs-lookup"><span data-stu-id="08457-183">Payment connectors and payment processors use tokens, or references, to reference interactions that are related to card payments.</span></span> <span data-ttu-id="08457-184">Например, при запросе авторизации платежа предоставляется ссылка на эту авторизацию.</span><span class="sxs-lookup"><span data-stu-id="08457-184">For example, when a payment authorization is requested, a reference to that authorization is provided.</span></span> <span data-ttu-id="08457-185">Таким образом, в дальнейшем можно использовать ссылку на авторизацию, когда средства фиксируются во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="08457-185">Therefore, the authorization can be referenced later, when funds are captured at the time of fulfillment.</span></span> <span data-ttu-id="08457-186">Эта авторизация является уникальной для продавца, платежного соединителя и процессора.</span><span class="sxs-lookup"><span data-stu-id="08457-186">This authorization is unique to the merchant, payment connector, and processor.</span></span> 

<span data-ttu-id="08457-187">Если заказ, созданный в Интернете, забирается в магазине, необходимо вызвать и использовать те же сведения об оплате для этого заказа.</span><span class="sxs-lookup"><span data-stu-id="08457-187">If an order that was created online is being picked up in the store, the same payment details for that order must be recalled and used.</span></span> <span data-ttu-id="08457-188">Когда исходные сведения предоставляются в рамках запроса на фиксацию платежа относительно исходной авторизации, процессор платежа сможет обработать запрос и зафиксировать платеж.</span><span class="sxs-lookup"><span data-stu-id="08457-188">When the original details are provided as part of the request to capture a payment against the original authorization, the payment processor will be able to handle the request and capture the payment.</span></span> 

<span data-ttu-id="08457-189">Чтобы правильно ссылаться на интернет-заказ, также должен быть доступен соединитель платежей "карта отсутствует", поддерживающий этот же процессор.</span><span class="sxs-lookup"><span data-stu-id="08457-189">To correctly reference the online order, a "card not present" payment connector that supports the same processor must also be available.</span></span> <span data-ttu-id="08457-190">Таким образом, система POS может иметь один процессор для платежей "карта присутствует", но она также может иметь доступ к другим соединителям платежей, чтобы выполнять заказы, созданные в других каналах, используя различные процессоры оплаты.</span><span class="sxs-lookup"><span data-stu-id="08457-190">In this way, the POS system can have one processor for "card present" payments, but it can also have access to other payment connectors so that it can fulfill orders that are created in other channels by using different payment processors.</span></span> 

## <a name="supported-scenarios"></a><span data-ttu-id="08457-191">Поддерживаемые сценарии</span><span class="sxs-lookup"><span data-stu-id="08457-191">Supported scenarios</span></span>

<span data-ttu-id="08457-192">Поддерживаются следующие сценарии омниканальных платежей:</span><span class="sxs-lookup"><span data-stu-id="08457-192">The following omni-channel payment scenarios are supported:</span></span>

- <span data-ttu-id="08457-193">Покупка в сети, получение в магазине</span><span class="sxs-lookup"><span data-stu-id="08457-193">Buy online, pick up in store</span></span>
- <span data-ttu-id="08457-194">Покупка в центре обработки вызовов, получение в магазине</span><span class="sxs-lookup"><span data-stu-id="08457-194">Buy in call center, pick up in store</span></span>
- <span data-ttu-id="08457-195">Покупка в магазине A, получение в магазине B</span><span class="sxs-lookup"><span data-stu-id="08457-195">Buy in store A, pick up in store B</span></span>
- <span data-ttu-id="08457-196">Покупка в магазине A, отгрузка клиенту</span><span class="sxs-lookup"><span data-stu-id="08457-196">Buy in store A, ship to customer</span></span>

    > [!NOTE]
    > <span data-ttu-id="08457-197">Платежи, сделанные в центре обработки вызовов, которые сопоставляются с "нормальными" функциями платежа, должны быть помечены как **Предоплата** = **Да**, чтобы быть отраженными в сумме, подлежащей оплате, при отзыве заказа в POS-терминале.</span><span class="sxs-lookup"><span data-stu-id="08457-197">Payments made in the call center that map to the "Normal" payment function must be marked as **Prepay** = **Yes** to be reflected in the amount due when recalling the order in the POS.</span></span> <span data-ttu-id="08457-198">Неоплачиваемые платежи типа "Нормальный" не опознаются при отзыве заказа в POS-терминале.</span><span class="sxs-lookup"><span data-stu-id="08457-198">Non-prepay payments of type "Normal" are not recognized when the order is recalled in POS.</span></span> 

<span data-ttu-id="08457-199">Также поддерживаются вариации этих сценариев.</span><span class="sxs-lookup"><span data-stu-id="08457-199">Variations of these scenarios are also supported.</span></span> <span data-ttu-id="08457-200">Например, заказ в Интернете может включать как строки, которые будут отгружены клиенту, так и строки, которые будут получены в магазине.</span><span class="sxs-lookup"><span data-stu-id="08457-200">For example, an online order might include both lines that will be shipped to the customer and lines that will be picked up in a store.</span></span> <span data-ttu-id="08457-201">Все варианты выполнения заказа поддерживаются через омниканальные платежи.</span><span class="sxs-lookup"><span data-stu-id="08457-201">All order fulfillment options are supported via omni-channel payments.</span></span> 

<span data-ttu-id="08457-202">В следующих разделах описываются шаги для каждого сценария и показано, как запустить сценарий, используя демонстрационные данные.</span><span class="sxs-lookup"><span data-stu-id="08457-202">The following sections describe the steps for each scenario and show how to run the scenario by using demo data.</span></span> 

### <a name="buy-online-pick-up-in-store"></a><span data-ttu-id="08457-203">Покупка в сети, получение в магазине</span><span class="sxs-lookup"><span data-stu-id="08457-203">Buy online, pick up in store</span></span>

<span data-ttu-id="08457-204">Перед началом убедитесь, что выполнены следующие предварительные условия:</span><span class="sxs-lookup"><span data-stu-id="08457-204">Before you start, make sure that the following prerequisites are in place:</span></span>

- <span data-ttu-id="08457-205">Имеется пример магазина, в котором настроен соединитель Adyen.</span><span class="sxs-lookup"><span data-stu-id="08457-205">You have a reference storefront where the Adyen connector is configured.</span></span>
- <span data-ttu-id="08457-206">Параметр **Омниканальные платежи** на странице **Общие параметры Commerce** имеет значение **True**.</span><span class="sxs-lookup"><span data-stu-id="08457-206">The **Omni-channel payments** option on the **Commerce shared parameters** page is set to **True**.</span></span> <span data-ttu-id="08457-207">В более поздних версиях этот параметр перенесен в рабочую область **управления функциями**, в которой можно выбрать функцию **Многоканальные платежи** и нажать **Включить**.</span><span class="sxs-lookup"><span data-stu-id="08457-207">In later versions this settng is moved to the **Feature Management** workspace where you can select the **Omni-channel payments** feature and click **Enable now**.</span></span> 
- <span data-ttu-id="08457-208">Соединитель платежей Adyen настроен для POS-ККМ Houston.</span><span class="sxs-lookup"><span data-stu-id="08457-208">The Adyen payment connector is configured for the Houston POS register.</span></span>
- <span data-ttu-id="08457-209">Retail Modern POS для Windows или Android со станцией оборудования или</span><span class="sxs-lookup"><span data-stu-id="08457-209">The Retail Modern POS for Windows or Android with built-in hardware station   -or-</span></span>
- <span data-ttu-id="08457-210">Modern POS для iOS или Cloud POS с подключенной общей станцией оборудования.</span><span class="sxs-lookup"><span data-stu-id="08457-210">Modern POS for iOS or Cloud POS with connected shared hardware station.</span></span> 

<span data-ttu-id="08457-211">Для выполнения этого сценария выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="08457-211">Follow these steps to run the scenario.</span></span>

1. <span data-ttu-id="08457-212">В примере магазине создайте заказ для получения в магазине.</span><span class="sxs-lookup"><span data-stu-id="08457-212">In the reference storefront, create an order for in-store pickup.</span></span> <span data-ttu-id="08457-213">Не забудьте выбрать магазин **Houston**.</span><span class="sxs-lookup"><span data-stu-id="08457-213">Be sure to select the **Houston** store.</span></span> 
2. <span data-ttu-id="08457-214">Выполните действия для оформления заказа и оплатите, используя номер тестовой кредитной карты.</span><span class="sxs-lookup"><span data-stu-id="08457-214">Go through the checkout steps, and pay by using a test credit card number.</span></span> <span data-ttu-id="08457-215">Номера тестовых кредитных карт можно найти на [странице номеров тестовых карт Adyen](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description).</span><span class="sxs-lookup"><span data-stu-id="08457-215">You can find test credit card numbers on the [Adyen test card numbers page](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description).</span></span>
3. <span data-ttu-id="08457-216">В модуле Commerce используйте пакетное задание **Синхронизация заказов** и график распределения **P-001**, чтобы создать заказы в бэк-офисе.</span><span class="sxs-lookup"><span data-stu-id="08457-216">In Commerce, use the **Synchronize orders** batch job and the **P-001** distribution schedule to create the orders in the back office.</span></span>
4. <span data-ttu-id="08457-217">В POS-терминале на странице приветствия выберите операцию **Заказы для отправки**, чтобы просмотреть заказы, которые должны быть получены в магазине.</span><span class="sxs-lookup"><span data-stu-id="08457-217">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
5. <span data-ttu-id="08457-218">Выберите одну или несколько строк из заказа, который был создан в примере магазина, затем выберите **Вывоз**.</span><span class="sxs-lookup"><span data-stu-id="08457-218">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="08457-219">Заказ извлекается из бэк-офиса.</span><span class="sxs-lookup"><span data-stu-id="08457-219">The order is retrieved from the back office.</span></span> 

6. <span data-ttu-id="08457-220">Когда сведения о строке заказа извлекаются из бэк-офиса и платеж по карте, который может использоваться для омниканального сценария обнаружен, вы получаете сведения о том, что доступен метод оплаты.</span><span class="sxs-lookup"><span data-stu-id="08457-220">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
7. <span data-ttu-id="08457-221">Выберите **Использовать доступный метод оплаты**, чтобы выполнить проводку, используя сведения о карте, которые были введены в примере магазина.</span><span class="sxs-lookup"><span data-stu-id="08457-221">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="08457-222">Строки заказа загружаются на страницу проводки, а задолженность равна 0 (нулю).</span><span class="sxs-lookup"><span data-stu-id="08457-222">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span> 

8. <span data-ttu-id="08457-223">Перейдите на вкладку **Платежи**, чтобы просмотреть строку платежного средства, которая была извлечена из заказа в Интернете.</span><span class="sxs-lookup"><span data-stu-id="08457-223">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
9. <span data-ttu-id="08457-224">Выберите любой метод оплаты, чтобы выполнить проводку.</span><span class="sxs-lookup"><span data-stu-id="08457-224">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-call-center-pick-up-in-store"></a><span data-ttu-id="08457-225">Покупка в центре обработки вызовов, получение в магазине</span><span class="sxs-lookup"><span data-stu-id="08457-225">Buy in call center, pick up in store</span></span>

1. <span data-ttu-id="08457-226">В модуле Commerce на странице **Обслуживание клиентов** введите **Карен Берг** на панели поиска, затем выберите **Поиск**.</span><span class="sxs-lookup"><span data-stu-id="08457-226">In Commerce, on the **Customer service** page, enter **Karen Berg** in the search bar, and then select **Search**.</span></span> 
3. <span data-ttu-id="08457-227">Выберите **Карен Берг** в результатах поиска.</span><span class="sxs-lookup"><span data-stu-id="08457-227">Select **Karen Berg** in the search results.</span></span>
4. <span data-ttu-id="08457-228">После загрузки Карен на страницу **Обслуживание клиентов** выберите **Новый заказ на продажу**.</span><span class="sxs-lookup"><span data-stu-id="08457-228">After Karen is loaded onto the **Customer service** page, select **New sales order**.</span></span>
5. <span data-ttu-id="08457-229">На странице нового заказа на продажу выберите **Заголовок** для просмотра заголовка заказа.</span><span class="sxs-lookup"><span data-stu-id="08457-229">On the new sales order page, select **Header** to view the order header.</span></span> 
6. <span data-ttu-id="08457-230">На странице **Заголовок заказа** задайте сайт **Центральный** и склад **Хьюстон**.</span><span class="sxs-lookup"><span data-stu-id="08457-230">On the **Order header** page, set the site to **Central** and the warehouse to **Houston**.</span></span>
7. <span data-ttu-id="08457-231">На вкладке **Доставка** задайте в поле **Способ поставки** значение **60** для отправки клиенту.</span><span class="sxs-lookup"><span data-stu-id="08457-231">On the **Deliver** tab, set the **Mode of delivery** field to **60** for customer pickup.</span></span>
8. <span data-ttu-id="08457-232">Выберите **Строки**, затем добавьте одну или несколько строк в заказ.</span><span class="sxs-lookup"><span data-stu-id="08457-232">Select **Lines**, and then add one or more lines to the order.</span></span> 
9. <span data-ttu-id="08457-233">Выберите **Завершить**, чтобы перейти в поток завершения заказа.</span><span class="sxs-lookup"><span data-stu-id="08457-233">Select **Complete** to enter the order completion flow.</span></span>
10. <span data-ttu-id="08457-234">Перейдите вниз в раздел платежей, выберите команду **Добавить**, затем выберите строку, для которой установлен тип метода платежа **Карты**.</span><span class="sxs-lookup"><span data-stu-id="08457-234">Scroll down to the payments section, select **Add**, and then select a line where the payment method type is set to **Cards**.</span></span> 
11. <span data-ttu-id="08457-235">Выберите знак "плюс" (**+**), чтобы добавить платеж по карте.</span><span class="sxs-lookup"><span data-stu-id="08457-235">Select the plus sign (**+**) to add a card payment.</span></span> 
12. <span data-ttu-id="08457-236">Введите сведения для номера пробной кредитной карты, который вы нашли на [странице номеров тестовых карт Adyen](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description), затем нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="08457-236">Enter the details for a test credit card number that you found on the [Adyen test card numbers page](https://docs.adyen.com/development-resources/test-cards/test-card-numbers/#description), and then select **OK**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="08457-237">Если бренд карты для введенного номера отличается от бренда, который был выбрана при запуске платежа, платеж все равно пройдет.</span><span class="sxs-lookup"><span data-stu-id="08457-237">If the card brand for the card number that you entered differs from the brand that was selected when the payment was initiated, the payment will still go through.</span></span> <span data-ttu-id="08457-238">Однако он будет разнесен на счета, сопоставленные с брендом карт, выбранным на шаге 10.</span><span class="sxs-lookup"><span data-stu-id="08457-238">However, it will be posted to the accounts that are mapped to the card brand that you selected in step 10.</span></span>

12. <span data-ttu-id="08457-239">Снова нажмите **ОК**, чтобы закрыть диалоговое окно **Завершение оплаты заказа**.</span><span class="sxs-lookup"><span data-stu-id="08457-239">Select **OK** again to close the **Order completion payments** dialog box.</span></span>
13. <span data-ttu-id="08457-240">На странице **Сводка заказа на продажу** выберите **Отправить**.</span><span class="sxs-lookup"><span data-stu-id="08457-240">On the **Sales order summary** page, select **Submit**.</span></span>
14. <span data-ttu-id="08457-241">В POS-терминале на странице приветствия выберите операцию **Заказы для отправки**, чтобы просмотреть заказы, которые должны быть получены в магазине.</span><span class="sxs-lookup"><span data-stu-id="08457-241">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
15. <span data-ttu-id="08457-242">Выберите одну или несколько строк из заказа, который был создан в примере магазина, затем выберите **Вывоз**.</span><span class="sxs-lookup"><span data-stu-id="08457-242">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="08457-243">Заказ извлекается из бэк-офиса.</span><span class="sxs-lookup"><span data-stu-id="08457-243">The order is retrieved from the back office.</span></span> 

16. <span data-ttu-id="08457-244">Когда сведения о строке заказа извлекаются из бэк-офиса и платеж по карте, который может использоваться для омниканального сценария обнаружен, вы получаете сведения о том, что доступен метод оплаты.</span><span class="sxs-lookup"><span data-stu-id="08457-244">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
17. <span data-ttu-id="08457-245">Выберите **Использовать доступный метод оплаты**, чтобы выполнить проводку, используя сведения о карте, которые были введены в примере магазина.</span><span class="sxs-lookup"><span data-stu-id="08457-245">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="08457-246">Строки заказа загружаются на страницу проводки, а задолженность равна 0 (нулю).</span><span class="sxs-lookup"><span data-stu-id="08457-246">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span>

18. <span data-ttu-id="08457-247">Перейдите на вкладку **Платежи**, чтобы просмотреть строку платежного средства, которая была извлечена из заказа в Интернете.</span><span class="sxs-lookup"><span data-stu-id="08457-247">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
19. <span data-ttu-id="08457-248">Выберите любой метод оплаты, чтобы выполнить проводку.</span><span class="sxs-lookup"><span data-stu-id="08457-248">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-store-a-pick-up-in-store-b"></a><span data-ttu-id="08457-249">Покупка в магазине A, получение в магазине B</span><span class="sxs-lookup"><span data-stu-id="08457-249">Buy in store A, pick up in store B</span></span>

1. <span data-ttu-id="08457-250">Запустите POS-терминал для магазина Хьюстон.</span><span class="sxs-lookup"><span data-stu-id="08457-250">Start the POS for the Houston store.</span></span>
2. <span data-ttu-id="08457-251">На странице **Проводка** добавьте Карен Берг в проводку, используя цифровую клавиатуру для ввода **2001**.</span><span class="sxs-lookup"><span data-stu-id="08457-251">On the **Transaction** page, add Karen Berg to the transaction by using the number pad to enter **2001**.</span></span>
3. <span data-ttu-id="08457-252">Добавить одну или несколько строк в проводку.</span><span class="sxs-lookup"><span data-stu-id="08457-252">Add one or more lines to the transaction.</span></span>
4. <span data-ttu-id="08457-253">Выберите **Заказы**, чтобы просмотреть параметры заказа.</span><span class="sxs-lookup"><span data-stu-id="08457-253">Select **Orders** to see the order options.</span></span>
5. <span data-ttu-id="08457-254">Выберите **Скомплектовать все**, затем, когда появится запрос, выберите **Заказ клиента**.</span><span class="sxs-lookup"><span data-stu-id="08457-254">Select **Pick up all**, and then, when you're prompted, select **Customer order**.</span></span>
6. <span data-ttu-id="08457-255">В строке поиска введите **Сиэтл**, затем выберите магазин **Сиэтл** для получения.</span><span class="sxs-lookup"><span data-stu-id="08457-255">In the search bar, enter **Seattle**, and then select the **Seattle** store for pickup.</span></span> 
7. <span data-ttu-id="08457-256">Выберите кнопку **ОК**, чтобы принять текущую дату в качестве даты получения.</span><span class="sxs-lookup"><span data-stu-id="08457-256">Select **OK** to accept the current date as the date of pickup.</span></span>
9. <span data-ttu-id="08457-257">Выберите **Платежная карта**, чтобы начать платеж.</span><span class="sxs-lookup"><span data-stu-id="08457-257">Select **Pay card** to initiate the payment.</span></span>
10. <span data-ttu-id="08457-258">Выставите в платеже по карте сумму, подлежащую оплате на депозит.</span><span class="sxs-lookup"><span data-stu-id="08457-258">Tender the card payment for the amount that is due for the deposit.</span></span> 
11. <span data-ttu-id="08457-259">Выполните платеж на депозит на платежном терминале.</span><span class="sxs-lookup"><span data-stu-id="08457-259">Complete the deposit payment on the payment terminal.</span></span> 
12. <span data-ttu-id="08457-260">После выплаты депозита выберите параметр для использования той же карты для выполнения и дождитесь завершения заказа.</span><span class="sxs-lookup"><span data-stu-id="08457-260">After the deposit is paid, select the option to use the same card for fulfillment, and wait for the order to be completed.</span></span> 
13. <span data-ttu-id="08457-261">Запустите POS-терминал для магазина Сиэтла.</span><span class="sxs-lookup"><span data-stu-id="08457-261">Start the POS for the Seattle store.</span></span>
14. <span data-ttu-id="08457-262">В POS-терминале на странице приветствия выберите операцию **Заказы для отправки**, чтобы просмотреть заказы, которые должны быть получены в магазине.</span><span class="sxs-lookup"><span data-stu-id="08457-262">In the POS, on the welcome page, select the **Orders to pickup** operation to see the orders for in-store pickup.</span></span> 
15. <span data-ttu-id="08457-263">Выберите одну или несколько строк из заказа, который был создан в примере магазина, затем выберите **Вывоз**.</span><span class="sxs-lookup"><span data-stu-id="08457-263">Select one or more lines from the order that was created in the reference storefront, and then select **Pick up**.</span></span>

    <span data-ttu-id="08457-264">Заказ извлекается из бэк-офиса.</span><span class="sxs-lookup"><span data-stu-id="08457-264">The order is retrieved from the back office.</span></span> 

16. <span data-ttu-id="08457-265">Когда сведения о строке заказа извлекаются из бэк-офиса и платеж по карте, который может использоваться для омниканального сценария обнаружен, вы получаете сведения о том, что доступен метод оплаты.</span><span class="sxs-lookup"><span data-stu-id="08457-265">When the order line details are retrieved from the back office, and a card payment that can be used for omni-channel is detected, you're informed that a payment method is available.</span></span>
17. <span data-ttu-id="08457-266">Выберите **Использовать доступный метод оплаты**, чтобы выполнить проводку, используя сведения о карте, которые были введены в примере магазина.</span><span class="sxs-lookup"><span data-stu-id="08457-266">Select **Use available payment method** to complete the transaction by using the card details that were entered in the reference storefront.</span></span>

    <span data-ttu-id="08457-267">Строки заказа загружаются на страницу проводки, а задолженность равна 0 (нулю).</span><span class="sxs-lookup"><span data-stu-id="08457-267">The order lines are loaded on the transaction page, and the balance due is 0 (zero).</span></span>

18. <span data-ttu-id="08457-268">Перейдите на вкладку **Платежи**, чтобы просмотреть строку платежного средства, которая была извлечена из заказа в Интернете.</span><span class="sxs-lookup"><span data-stu-id="08457-268">Select the **Payments** tab to view the tender line that was pulled from the online order.</span></span> 
19. <span data-ttu-id="08457-269">Выберите любой метод оплаты, чтобы выполнить проводку.</span><span class="sxs-lookup"><span data-stu-id="08457-269">Select any payment method to complete the transaction.</span></span> 

### <a name="buy-in-store-a-ship-to-customer"></a><span data-ttu-id="08457-270">Покупка в магазине A, отгрузка клиенту</span><span class="sxs-lookup"><span data-stu-id="08457-270">Buy in store A, ship to customer</span></span>

1. <span data-ttu-id="08457-271">Запустите POS-терминал для магазина Хьюстон.</span><span class="sxs-lookup"><span data-stu-id="08457-271">Start the POS for the Houston store.</span></span>
2. <span data-ttu-id="08457-272">На странице **Проводка** добавьте Карен Берг в проводку, используя цифровую клавиатуру для ввода **2001**.</span><span class="sxs-lookup"><span data-stu-id="08457-272">On the **Transaction** page, add Karen Berg to the transaction by using the number pad to enter **2001**.</span></span>
3. <span data-ttu-id="08457-273">Добавить одну или несколько строк в проводку.</span><span class="sxs-lookup"><span data-stu-id="08457-273">Add one or more lines to the transaction.</span></span>
4. <span data-ttu-id="08457-274">Выберите **Заказы**, чтобы просмотреть параметры заказа.</span><span class="sxs-lookup"><span data-stu-id="08457-274">Select **Orders** to see the order options.</span></span>
5. <span data-ttu-id="08457-275">Выберите **Отгрузить все**, затем, когда появится запрос, выберите **Заказ клиента**.</span><span class="sxs-lookup"><span data-stu-id="08457-275">Select **Ship all**, and then, when you're prompted, select **Customer order**.</span></span>
6. <span data-ttu-id="08457-276">На странице метода отгрузки выберите вариант **Стандартный на следующий рабочий день**, затем выберите **ОК**, чтобы принять сегодняшнюю дату в качестве даты отгрузки.</span><span class="sxs-lookup"><span data-stu-id="08457-276">In the shipping method page, select **Standard overnight**, and then select **OK** to accept today's date as the shipping date.</span></span> 
7. <span data-ttu-id="08457-277">Выберите кнопку **ОК**, чтобы принять текущую дату в качестве даты получения.</span><span class="sxs-lookup"><span data-stu-id="08457-277">Select **OK** to accept the current date as the date of pickup.</span></span>
8. <span data-ttu-id="08457-278">Выберите **Платежная карта**, чтобы начать платеж.</span><span class="sxs-lookup"><span data-stu-id="08457-278">Select **Pay card** to initiate the payment.</span></span>
9. <span data-ttu-id="08457-279">Выставите в платеже по карте сумму, подлежащую оплате на депозит.</span><span class="sxs-lookup"><span data-stu-id="08457-279">Tender the card payment for the amount that is due for the deposit.</span></span> 
10. <span data-ttu-id="08457-280">Выполните платеж на депозит на платежном терминале.</span><span class="sxs-lookup"><span data-stu-id="08457-280">Complete the deposit payment on the payment terminal.</span></span> 
11. <span data-ttu-id="08457-281">После выплаты депозита выберите параметр для использования той же карты для выполнения и дождитесь завершения заказа.</span><span class="sxs-lookup"><span data-stu-id="08457-281">After the deposit is paid, select the option to use the same card for fulfillment, and wait for the order to be completed.</span></span>

<span data-ttu-id="08457-282">Когда заказ скомплектован, упакован и за него выставлен счет в бэк-офисе, сведения об оплате, предоставленные в POS, будут использоваться для фиксации средств за товары, отправляемые клиенту.</span><span class="sxs-lookup"><span data-stu-id="08457-282">When the order is picked, packed, and invoiced in the back office, the payment details that are provided at the POS will be used to capture the funds for the goods that are being shipped to the customer.</span></span> 

## <a name="scenario-details"></a><span data-ttu-id="08457-283">Подробности сценария</span><span class="sxs-lookup"><span data-stu-id="08457-283">Scenario details</span></span>

<span data-ttu-id="08457-284">В дополнение к базовым сценариям, которые только что были описаны, в пакет SDK для модуля "Платежи" были внесены некоторые усовершенствования, поддерживающие омниканальные платежи.</span><span class="sxs-lookup"><span data-stu-id="08457-284">In addition to the basic scenarios that were just described, several enhancements have been made to the Payments SDK to support omni-channel payments.</span></span> 

### <a name="pos"></a><span data-ttu-id="08457-285">POS</span><span class="sxs-lookup"><span data-stu-id="08457-285">POS</span></span>

#### <a name="single-swipedip-for-customer-orders"></a><span data-ttu-id="08457-286">Однократное использование карты для заказов клиента</span><span class="sxs-lookup"><span data-stu-id="08457-286">Single swipe/dip for customer orders</span></span>

<span data-ttu-id="08457-287">До реализации функции омниканальных платежей при создании в POS-терминале заказов клиента, которые включают депозиты, клиентам было необходимо два раза предъявить карту: один раз для оплаты депозита и один раз для токенизации карты для последующего выполнения заказа.</span><span class="sxs-lookup"><span data-stu-id="08457-287">Before the omni-channel payments feature was implemented, when customer orders that included deposits were created at the POS, customers were required to swipe (or dip) their card two times: one time to pay the deposit and one time to tokenize the card for subsequent order fulfillment.</span></span> <span data-ttu-id="08457-288">Когда функция создания омниканальных маркеров включена, клиенты должны предъявить карту только один раз, чтобы оплатить депозит и авторизовать сумму, которая должна быть выплачена за товары, которые будут поставлены позже.</span><span class="sxs-lookup"><span data-stu-id="08457-288">When the omni-channel tokenization feature is turned on, customers must swipe their card only one time to both pay the deposit and authorize the amount that is due for goods that will be fulfilled later.</span></span> <span data-ttu-id="08457-289">Во время выполнения авторизированные средства списываются.</span><span class="sxs-lookup"><span data-stu-id="08457-289">At the time of fulfillment, the authorized funds are captured.</span></span> <span data-ttu-id="08457-290">До реализации функции омниканальной маркировки для последующего выполнения заказа создавался только повторяющийся маркер карты.</span><span class="sxs-lookup"><span data-stu-id="08457-290">Before the omni-channel tokenization feature was implemented, only a recurring card token was created for subsequent order fulfillment.</span></span> <span data-ttu-id="08457-291">Таким образом, средства для ожидающего выполнения не были авторизованы, и поскольку эти средства не были заблокированы для данной покупки, было менее вероятно, что они могут быть списаны позднее.</span><span class="sxs-lookup"><span data-stu-id="08457-291">Therefore, the funds for the pending fulfillment weren't authorized, and because those funds weren't being held for that specific purchase, it was less likely that they could be captured later.</span></span>

> [!NOTE]
> <span data-ttu-id="08457-292">Одно считывание не поддерживается в Retail версии 8.1.3.</span><span class="sxs-lookup"><span data-stu-id="08457-292">Single swipe isn't supported in Retail version 8.1.3.</span></span> <span data-ttu-id="08457-293">Заказы клиентов в версии 8.1.3 используют тот же поток, который использовался до реализации функции омниканальной токенизации.</span><span class="sxs-lookup"><span data-stu-id="08457-293">Customer orders in version 8.1.3 use the same flow that was used before the omni-channel tokenization feature was implemented.</span></span> 

### <a name="cards-that-cant-issue-recurring-card-tokens"></a><span data-ttu-id="08457-294">Карты, которые не могут выдавать повторяющиеся маркеры карт</span><span class="sxs-lookup"><span data-stu-id="08457-294">Cards that can't issue recurring card tokens</span></span>

<span data-ttu-id="08457-295">Некоторые карты не могут использоваться для омниканальных платежей, так как они не поддерживают выдачу повторяющихся маркеров карты.</span><span class="sxs-lookup"><span data-stu-id="08457-295">Some cards can't be used for omni-channel payments, because they don't support issuing recurring card tokens.</span></span> <span data-ttu-id="08457-296">Когда заказ создается на POS-терминале, если депозит оплачивается с помощью карты, которая не поддерживает повторяющиеся маркеры карт, используется предыдущий процесс токенизации карты.</span><span class="sxs-lookup"><span data-stu-id="08457-296">When an order is created at the POS, if the deposit is paid by using a card that doesn't support recurring card tokens, the previous card tokenization flow is used.</span></span> <span data-ttu-id="08457-297">Поэтому клиент, который хочет предоставить платеж, который будет использоваться для последующего выполнения заказа, должен предоставить вторую карту.</span><span class="sxs-lookup"><span data-stu-id="08457-297">Therefore, a customer who wants to provide a payment that will be used for subsequent order fulfillment must present a second card.</span></span> <span data-ttu-id="08457-298">Если вторая карта не поддерживает повторяющиеся маркеры карт, действие токенизации будет отклонено, и кассиру будет предложено попросить клиента предоставить другую карту.</span><span class="sxs-lookup"><span data-stu-id="08457-298">If the second card doesn't support recurring card tokens, the tokenization action will be declined, and the cashier will be prompted to ask the customer to provide a different card.</span></span> 

### <a name="using-a-different-card"></a><span data-ttu-id="08457-299">Использование другой карты</span><span class="sxs-lookup"><span data-stu-id="08457-299">Using a different card</span></span>

<span data-ttu-id="08457-300">Клиент, который пришел в магазин, чтобы забрать заказ, имеет возможность использовать другую карту.</span><span class="sxs-lookup"><span data-stu-id="08457-300">A customer who comes to the store for order pickup has the option to use a different card.</span></span> <span data-ttu-id="08457-301">Когда кассир получает запрос **Использование доступного способа платежа** при получении заказа, он может спросить, хочет ли клиент использовать ту же карту.</span><span class="sxs-lookup"><span data-stu-id="08457-301">When the cashier receives the **Use available payment method** prompt at the time of order pickup, he or she can ask whether the customer wants to use the same card.</span></span> <span data-ttu-id="08457-302">Если клиент потерял карту, которая использовалась для создания заказа, и хочет заплатить за заказ с помощью другой карты, кассир может выбрать разрешается **Использовать другой способ платежа**.</span><span class="sxs-lookup"><span data-stu-id="08457-302">If the customer has lost the card that was used to create the order and wants to pay for the order by using a different card, the cashier can select **Use a different payment method**.</span></span> <span data-ttu-id="08457-303">Если позже клиент придет, чтобы забрать дополнительные номенклатуры из того же заказа, если исходная авторизация карты все еще действительна, кассир может снова спросить, хочет ли клиент использовать эту карту.</span><span class="sxs-lookup"><span data-stu-id="08457-303">If the customer comes back later to pick up more items for the same order, if the original card authorization is still valid, the cashier can again ask whether the customer wants to use that card.</span></span>

### <a name="invalid-authorizations"></a><span data-ttu-id="08457-304">Недействительные авторизации</span><span class="sxs-lookup"><span data-stu-id="08457-304">Invalid authorizations</span></span>

<span data-ttu-id="08457-305">Если карта, которая использовалась для создания заказа, больше не действительна, то при выборе продуктов для получения запрос на списание платежа будет неудачным.</span><span class="sxs-lookup"><span data-stu-id="08457-305">If the card that was used to create an order is no longer valid, when products are selected for pickup, the payment capture request will fail.</span></span> <span data-ttu-id="08457-306">После этого соединитель платежей POS попытается создать новую авторизацию и выполнить списание с использованием тех же сведений карты.</span><span class="sxs-lookup"><span data-stu-id="08457-306">The POS payment connector will then try to create a new authorization and capture by using the same card details.</span></span> <span data-ttu-id="08457-307">Если произойдет сбой новой авторизации или списания, кассиру будет сообщено, что платеж не может быть обработан.</span><span class="sxs-lookup"><span data-stu-id="08457-307">If the new authorization or capture fails, the cashier will be informed that the payment could not be processed.</span></span> <span data-ttu-id="08457-308">Затем кассир должен получить новый платеж от клиента.</span><span class="sxs-lookup"><span data-stu-id="08457-308">The cashier must then get a new payment from the customer.</span></span> 

### <a name="multiple-available-payments"></a><span data-ttu-id="08457-309">Несколько доступных платежей</span><span class="sxs-lookup"><span data-stu-id="08457-309">Multiple available payments</span></span>

<span data-ttu-id="08457-310">При получении заказа, в котором имеется несколько платежных средств и несколько строк, кассир сначала получает запрос **Использование доступного способа платежа**.</span><span class="sxs-lookup"><span data-stu-id="08457-310">When an order that has multiple tenders and multiple lines is picked up, the cashier first receives the **Use available payment method** prompt.</span></span> <span data-ttu-id="08457-311">Если есть несколько карт, когда кассир выбирает вариант **Использование доступного способа платежа**, существующие строки карточного платежного средства списываются до тех пор, пока сальдо не будет достигнуто для текущих забираемых товаров.</span><span class="sxs-lookup"><span data-stu-id="08457-311">If there are multiple cards, when the cashier selects **Use available payment method**, existing card tender lines will be captured until the balance is met for the goods that are currently being picked up.</span></span> <span data-ttu-id="08457-312">У кассира нет возможности выбора карты, которая должна использоваться для забираемых товаров.</span><span class="sxs-lookup"><span data-stu-id="08457-312">The cashier won't have the option to select the card that should be used for the goods that are being picked up.</span></span> 

## <a name="related-topics"></a><span data-ttu-id="08457-313">Связанные разделы</span><span class="sxs-lookup"><span data-stu-id="08457-313">Related topics</span></span>

- [<span data-ttu-id="08457-314">Вопросы и ответы по платежам</span><span class="sxs-lookup"><span data-stu-id="08457-314">Payments FAQ</span></span>](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/payments-retail)
- [<span data-ttu-id="08457-315">Соединитель платежей Dynamics 365 для Adyen</span><span class="sxs-lookup"><span data-stu-id="08457-315">Dynamics 365 Payment Connector for Adyen</span></span>](https://docs.microsoft.com/dynamics365/unified-operations/retail/dev-itpro/adyen-connector?tabs=8-1-3)
- [<span data-ttu-id="08457-316">Настройка BOPIS в ознакомительной среде Dynamics 365 Commerce</span><span class="sxs-lookup"><span data-stu-id="08457-316">Configure BOPIS in a Dynamics 365 Commerce evaluation environment</span></span>](https://docs.microsoft.com/dynamics365/commerce/cpe-bopis)


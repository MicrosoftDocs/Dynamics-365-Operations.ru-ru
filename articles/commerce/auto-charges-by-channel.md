---
title: Включение и настройка автоматических накладных расходов по каналам
description: В этой теме объясняется, как включить и настроить автоматические накладные расходы по каналам в Microsoft Dynamics 365 Commerce.
author: gvrmohanreddy
manager: annbe
ms.date: 03/30/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-commerce
ms.technology: ''
audience: Application User
ms.reviewer: v-chgri
ms.search.scope: Retail, Core, Operations
ms.search.region: Global
ms.author: gmohanv
ms.search.validFrom: 2020-03-01
ms.dyn365.ops.version: 10.0.10
ms.openlocfilehash: 1be07c754e563298d82f6ca54f09ae3aa9118602
ms.sourcegitcommit: 199848e78df5cb7c439b001bdbe1ece963593cdb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2020
ms.locfileid: "4415216"
---
# <a name="enable-and-configure-auto-charges-by-channel"></a>Включение и настройка автоматических накладных расходов по каналам

В этой теме объясняется, как включить и настроить автоматические накладные расходы (авторасходы) по каналам в Microsoft Dynamics 365 Commerce.

## <a name="overview"></a>Обзор

Могут существовать сценарии, в которых сборы за утилизацию или другие сборы должны быть применены к группе продуктов, которые продаются во всех или некоторых магазинах в определенном штате (например, в Калифорнии). Функция **Включить фильтрацию автоматических расходов по каналам** в модуле Commerce позволяет задавать автоматические накладные расходы по каналам (например, конкретный физический канал). Эта функция доступна в Dynamics 365 Commerce версии 10.0.10 и выше.

Чтобы включить и настроить автоматические накладные расходы по каналам, необходимо выполнить следующие задачи:

- Включите функцию **Включить фильтрацию автоматических расходов по каналам**.
- Настройте цель организационной иерархии.
- Определите автоматические накладные расходы по каналам.

> [!NOTE]
> Функция **Включить фильтрацию автоматических расходов по каналам** работает только в том случае, если включена также функция расширенных автоматических накладных расходов. Сведения о порядке включении функции расширенных автоматических накладных расходов см. в разделе [Омниканальные расширенные автоматические накладные расходы](omni-auto-charges.md).

## <a name="turn-on-the-enable-filter-auto-charges-by-channel-feature"></a>Включение функции "Включить фильтрацию автоматических расходов по каналам"

Чтобы включить автоматические накладные расходы по каналам в модуле Commerce, выполните следующие действия.

1. Перейдите в раздел **Системный администратор \> Рабочие области \> Управление функциями**.
1. На вкладке **Не включено** в списке **Имя функции** найдите и выберите **Включить фильтрацию автоматических расходов по каналам**.
1. В правом нижнем углу установите флажок **Включить сейчас**. После включения функции она появится в списке на вкладке **Все**.
1. Перейдите в раздел **Retail и Commerce \> ИТ Retail и Commerce \> График распределения**.
1. В левой области найдите и выберите задание **1110** (**Глобальная конфигурация**).
1. На панели операций выберите **Выполнить сейчас**, чтобы распространить изменения конфигурации.

> [!WARNING]
> Если выключить функцию **Включить фильтрацию автоматических расходов по каналам** после того, как она уже была использована, поле **Связь канала розничной торговли** в разделе **Автоматические затраты** больше не будет отображаться, и все существующие конфигурации будут утрачены. Если удаление конфигураций **Связь канала розничной торговли** приведет к дублированию правил автоматических накладных расходов, попытка отключения функции будет невозможна. Прежде чем отключить функцию, просмотрите все правила автоматических накладных расходов и внесите необходимые изменения.

## <a name="configure-the-organization-hierarchy-purpose"></a>Настройка цели организационной иерархии

Для управления иерархией автоматических накладных расходов по каналам была создана новая цель организационной иерархии, именуемая **Автоматические накладные расходы розничной торговли**.

Чтобы назначить иерархию по умолчанию цели организационной иерархии в модуле Commerce, выполните следующие действия.
        
1. Перейдите в раздел **Управление организацией \> Организации \> Цели организационной иерархии**.
1. В левой области выберите **Автоматические накладные расходы розничной торговли**.
1. В области **Назначенные иерархии** выберите **Добавить**.
1. В диалоговом окне **Организационные иерархии** выберите организационную иерархию (например, **Розничные магазины по регионам**), затем выберите **ОК**.
1. В области **Назначенные иерархии** выберите **Установить по умолчанию**.
1. Перейдите в раздел **Retail и Commerce \> ИТ Retail и Commerce \> График распределения**.
1. В левой области найдите и выберите задание **1040** (**Продукты**).
1. В области действий выберите **Выполнить сейчас**.
1. Повторите предыдущие два шага, чтобы выполнить задания **1070** (**Конфигурация канала**) и **1110** (**Глобальная конфигурация**).

![Конфигурация цели организационной иерархии автоматических накладных расходов для розничной торговли](media/Auto-charges-org-hierarchy-purpose.png)

## <a name="define-auto-charges-by-channel"></a>Определение автоматических накладных расходов по каналам

После включения функции **Включить фильтрацию автоматических расходов по каналам** и настройки цели организационной иерархии **Автоматические накладные расходы розничной торговли** автоматические накладные расходы по каналам можно определить на уровне заголовка заказа или на уровне строки заказа.

Чтобы определить автоматические накладные расходы по каналам в модуле Commerce, выполните следующие действия.

1. Перейдите в раздел **Расчеты с клиентами \> Настройка накладных расходов \> Автоматические затраты**.
1. В левой области в поле **Уровень** выберите **Заголовок** или **Строка**, в зависимости от бизнес-требований.
1. В поле **Код канала розничной торговли** выберите соответствующий код канала (например, **Таблица** или **Группа**). Если используется настройка по умолчанию **Все**, правила накладных расходов применяются ко всем каналам.

    - Если выбрано значение **Группа**, убедитесь, что группа накладных расходов розничной торговли создана в пункте **Retail и Commerce \> Настройка канала \> Накладные расходы \> Группы накладных расходов каналов розничной торговли**.
    - Если выбрано значение **Таблица**, можно выбрать конкретный канал (например, **Сан-Франциско**) в поле **Связь канала розничной торговли**.

1. Перейдите в раздел **Retail и Commerce \> ИТ Retail и Commerce \> График распределения**.
1. В левой области найдите и выберите задание **1040** (**Продукты**).
1. В области действий выберите **Выполнить сейчас**.
1. Повторите предыдущие два шага, чтобы выполнить задания **1070** (**Конфигурация канала**) и **1110** (**Глобальная конфигурация**).
    
![Автоматические накладные расходы, определенные по каналам](media/Auto-charges-line-charge-by-channel.png)

## <a name="example-scenario"></a>Пример сценария

В следующем примере описываются шаги, необходимые для настройки продукта таким образом, чтобы сборы за утилизацию начисляются при продаже продукта через физический канал в Сан-Франциско. В примере также показано, как автоматические накладные расходы появляются в POS-приложении Commerce.

Организация определяет код накладных расходов под названием **УТИЛИЗАЦИЯ**, как показано на следующем рисунке.

![Код накладных расходов УТИЛИЗАЦИЯ](media/Auto-charges-charge-code.png)

Автоматические накладные расходы созданы на уровне строки. Они имеют следующую конфигурацию:

- В поле **Код счета** задано значение **Все**.
- В поле **Код номенклатуры** задано значение **Таблица**.
- В поле **Связь номенклатуры** задан код продукта **91001**.
- В поле **Код режима доставки** задано значение **Все**.
- В поле **Код канала розничной торговли** задано значение **Таблица**.
- В поле **Связь канала розничной торговли** задан магазин **Сан-Франциско**.

Создается строка с автоматическими накладными расходами. Они имеют следующую конфигурацию:

- В поле **Валюта** установлено значение **Доллары США**.
- В поле **Код накладных расходов** задано значение **УТИЛИЗАЦИЯ**.
- В поле **Категория** задано значение **Фиксированные**.
- В поле **Расходы** установлено значение **6,25 долл. США**.

![Конфигурация автоматических накладных расходов уровня строки и строка автоматических накладных расходов](media/Auto-charges-recyclingfee-line-fee.png)

В POS-приложении заказ на продажу создается в канале магазина **Сан-Франциско**. В строке **Расходы** отображается сбор на утилизацию **6,25 долл. США**.

Выбрав **Параметры проводок \> Накладные расходы \> Управление накладными расходами** в приложении POS, можно просмотреть код и описание накладных расходов для сборов за утилизацию.

![Сбор за утилизацию в приложении для POS-терминала](media/pos-auto-charges-recyclingfee-line-fee.png)

## <a name="additional-resources"></a>Дополнительные ресурсы

[Омниканальные расширенные автоматические накладные расходы](omni-auto-charges.md)

[Пропорциональное распределение накладных расходов из заголовка по соответствующим строкам продаж](pro-rate-charges-matching-lines.md)

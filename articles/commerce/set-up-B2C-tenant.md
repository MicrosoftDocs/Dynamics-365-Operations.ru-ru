---
title: Настройка клиента B2C в Commerce
description: В этом разделе описывается, как настроить клиенты "бизнес-потребитель" (B2C) Azure Active Directory (Azure AD) для проверки подлинности сайта пользователя в Dynamics 365 Commerce.
author: BrianShook
ms.date: 03/17/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: v-chgri
ms.search.region: Global
ms.search.industry: retail
ms.author: brshoo
ms.search.validFrom: 2020-02-13
ms.dyn365.ops.version: ''
ms.openlocfilehash: 1351b9f22416e8ce6d90022997f0a15e9eb4042a
ms.sourcegitcommit: c08a9d19eed1df03f32442ddb65a2adf1473d3b6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/06/2021
ms.locfileid: "6344379"
---
# <a name="set-up-a-b2c-tenant-in-commerce"></a>Настройка клиента B2C в Commerce

[!include [banner](includes/banner.md)]

В этом разделе описывается, как настроить клиенты "бизнес-потребитель" (B2C) Azure Active Directory (Azure AD) для проверки подлинности сайта пользователя в Dynamics 365 Commerce.

Dynamics 365 Commerce использует Azure AD B2C для поддержки учетных данных пользователей и потоков проверки подлинности. Пользователь может регистрировать, выполнять вход и сбрасывать свои пароли в этих потоках. Azure AD B2C хранит конфиденциальные сведения о проверке подлинности пользователя, такие как имя пользователя и пароль. Запись пользователя в клиенте B2C хранит либо запись локальной учетной записи B2C, либо запись поставщика удостоверений социальных сетей B2C. Эти записи B2C будут связываться обратно с записью клиента в среде Commerce.

> [!WARNING] 
> Azure AD B2C выведет из использования старые пользовательские потоки 1 августа 2021 года. Поэтому необходимо запланировать миграцию ваших потоков пользователей на новую рекомендуемую версию. Новая версия обеспечивает равенство функций и новые функции. Библиотека модулей для Commerce версии 10.0.15 или выше должна использоваться с рекомендованными потоками пользователей B2C. Дополнительные сведения см. в разделе [Потоки пользователей в Azure Active Directory B2C](/azure/active-directory-b2c/user-flow-overview).
 
 > [!NOTE]
 > Ознакомительные среды Commerce поставляются с предварительно загруженным клиентом Azure AD B2C для демонстрационных целей. Загрузка собственного клиента Azure AD B2C с помощью описанных ниже шагов не является необходимым для ознакомительных сред.

## <a name="create-or-link-to-an-existing-aad-b2c-tenant-in-the-azure-portal"></a>Создание или связывание существующего клиента AAD B2C с порталом Azure

1. Выполните вход на [портал Azure](https://portal.azure.com/).
1. В меню портала Azure выберите **Создать ресурс**. Убедитесь в том, что используется подписка и каталог, которые будут связаны с вашей средой Commerce.

    ![Создание ресурса на портале Azure.](./media/B2CImage_1.png)

1. Перейдите в пункт **Удостоверение \> Azure Active Directory B2C**.
1. После перехода на страницу **Создание нового клиента B2C или связывание с существующим клиентом** используйте один из следующих вариантов, который наилучшим образом отвечают потребностям компании:

    - **Создание нового клиента Azure AD B2C**: используйте этот параметр, чтобы создать новый клиент AAD B2C.
        1. Выберите **Создать новый клиент Azure AD B2C**.
        1. В поле **Название организации** введите название организации.
        1. В поле **Имя исходного домена** введите имя исходного домена.
        1. В поле **Страна или регион** выберите страну или регион.
        1. Выберите **Создать**, чтобы создать клиент.

     ![Создание нового клиента Azure AD.](./media/B2CImage_2.png)

     - **Связать существующий клиент Azure AD B2C с моей подпиской Azure**: этот параметр используется, если у вас уже есть клиент Azure AD B2C, с которым необходимо установить связь.
        1. Выберите **Связать существующий клиент Azure AD B2C с моей подпиской Azure**.
        1. В поле **Клиент Azure AD B2C** выберите соответствующий клиент B2C. Если в поле выбора появляется сообщение "Нет подходящих клиентов B2C", у вас нет подходящего клиента B2C и потребуется создать новый клиент.
        1. В поле **Группа ресурсов** выберите **Создать новую**. Введите **Имя** для группы ресурсов, которая будет содержать клиент, выберите **Местоположение группы ресурсов**, затем выберите **Создать**.

    ![Связывание существующего клиента Azure AD B2C с подпиской Azure.](./media/B2CImage_3.png)

1. После создания нового каталога Azure AD B2C (это может занять некоторое время) на панели мониторинга появится ссылка на новый каталог. Эта ссылка направляет вас на страницу "Добро пожаловать в Azure Active Directory B2C".

    ![Ссылка на новый каталог AAD.](./media/B2CImage_4.png)

> [!NOTE]
> Если в учетной записи Azure имеется несколько подписок или настроен клиент B2C, не связанный с активной подпиской, баннер **Устранение неполадок** направит вас, чтобы связать клиент с подпиской. Выберите сообщение об устранении неполадок и выполните указания по устранению проблемы с подпиской.

На следующем рисунке показан пример баннера **Устранение неполадок** для Azure AD B2C.

![Предупреждение, показывающее, что каталог не имеет активной подписки.](./media/B2CImage_5.png)

## <a name="create-the-b2c-application"></a>Создание приложения B2C

После создания клиента B2C вы создадите приложение B2C в рамках вашего нового клиента Azure AD B2C, чтобы взаимодействовать с Commerce.

Для создания приложения B2C выполните следующие действия.

1. На портале Azure выберите **Регистрации приложений**, затем выберите **Создать регистрацию**.
1. В поле **Имя** введите имя, которое будет присвоено этому приложению Azure AD B2C.
1. В области **Поддерживаемые типы учетных записей** выберите **Учетные записи в любом поставщике удостоверений или в организационном каталоге (для аутентификации пользователей с помощью потока пользователей)**.
1. Для **URI перенаправления** введите ваши выделенные URL-адреса для ответа в качестве типа **Интернет**. Информацию об URL-адресах ответа и порядке форматирования их см. в разделе [URL-адреса ответа](#reply-urls) ниже.
1. Для параметра **Разрешения** выберите **Предоставить согласие администратора для разрешений OpenID и автономного доступа**.
1. Выберите **Регистр**.
1. Выберите вновь созданное приложение и перейдите в меню **Проверка подлинности**. Здесь можно добавить дополнительные **URI перенаправления**, если это необходимо (сейчас или позже). Переходите к следующему шагу, если в данный момент не требуется.
1. В области **Неявное предоставление разрешения** выберите **Токены доступа** и **Токены идентификации**, чтобы включить их для приложения. Нажмите **Сохранить**.
1. Перейдите в меню **Обзор** портала Azure и скопируйте **ИД приложения (клиента)**. Запишите этот идентификатор для последующих шагов настройки (который позднее упоминается как **Идентификатор GUID клиента**).

Дополнительные справочные сведения о регистрации приложений в Azure AD B2C см. в разделе [Новый интерфейс регистрации приложений для Azure Active Directory B2C](/azure/active-directory-b2c/app-registrations-training-guide)

### <a name="reply-urls"></a>URL-адреса ответов

URL-адреса ответа важны, поскольку они позволяют создать список разрешений доменов возврата, когда ваш сайт вызывает Azure AD B2C для проверки подлинности пользователя. Это позволяет вернуть пользователя, прошедшего проверку подлинности, в домен, с которого он выполняет вход (домен вашего сайта). 

В поле **URL-адрес ответа** на экране **Azure AD B2c - Приложения \> Новое приложение** необходимо добавить отдельные строки для домена узла и (после подготовки среды) URL-адрес, созданный в Commerce. Эти URL-адреса должны всегда использовать допустимый формат URL-адреса и должны быть только базовыми URL-адресами (без завершающих символов прямой косой черты или путей). Затем строка ``/_msdyn365/authresp`` должна быть добавлена к базовым URL-адресам, как показано в следующих примерах.

- ``https://www.fabrikam.com/_msdyn365/authresp`` (Домен должен полностью совпадать с доменом электронной коммерции. Если имеется несколько доменов, необходимо добавить этот URL-адрес для каждого домена.)
- ``https://fabrikam-prod.commerce.dynamics.com/_msdyn365/authresp``

## <a name="create-user-flow-policies"></a>Создание политик потока пользователей

Потоки пользователей — это политики, которые Azure AD B2C использует для обеспечения безопасности входа в систему, регистрации, редактирования профиля и функции забытого пароля пользователя. Dynamics 365 Commerce использует эти потоки для выполнения действий политики по взаимодействию с клиентом Azure AD B2C. Когда пользователь взаимодействует с этими политиками, он перенаправляется на клиент Azure AD B2C для выполнения этих действий.

Azure AD B2C предоставляет три основных типа потоков пользователей:
- Регистрация и вход
- Изменение профиля
- Сброс пароля

Можно использовать потоки пользователей по умолчанию, предоставляемые Azure AD, которые будут показывать страницу, размещенную в AAD B2C. Кроме того, можно создать HTML-страницу для управления внешним видом этих потоков пользователей. 

Чтобы настроить страницы политики пользователя со страницами, созданными для Dynamics 365 Commerce, см. раздел [Настройка пользовательских страниц для учетных записей пользователей](custom-pages-user-logins.md). Дополнительные сведения см. в разделе [Настройка интерфейса взаимодействия с пользователями в Azure Active Directory B2C](/azure/active-directory-b2c/tutorial-customize-ui).

### <a name="create-a-sign-up-and-sign-in-user-flow-policy"></a>Создание политику потока пользователей для регистрации и входа в систему

Чтобы создать регистрацию и вход в политике потока пользователя, выполните следующие действия.

1. На портале Azure выберите **Потоки пользователей (политики)** в левой области переходов.
1. На странице **Azure AD B2C – Потоки пользователей (политики)** выберите пункт **Создать поток пользователей**.
1. Выберите политику **Регистрация и вход**, затем выберите версию **Рекомендуемая**.
1. В поле **Имя** введите имя политики. Это имя впоследствии будет отображаться с префиксом, назначенным порталом (например, "B2C_1_").
1. В разделе **Поставщики удостоверений** установите соответствующий флажок.
1. В группе **Многофакторная проверка подлинности** выберите подходящий вариант для вашей компании. 
1. В разделе **Атрибуты и заявки пользователей** выберите параметры для сбора атрибутов или возврата заявок, если необходимо. Для Commerce требуются следующие параметры по умолчанию:

    | **Собрать атрибут** | **Заявка на возврат** |
    | ---------------------- | ----------------- |
    | Адрес электронной почты          | Адреса электронной почты   |
    | Данное имя             | Данное имя        |
    |                        | Поставщик удостоверений |
    | Фамилия                | Фамилия           |
    |                        | Код объекта пользователя  |

1. Выберите **Создать**.

На следующем рисунке показан пример потока пользователей Azure AD B2C для регистрации и входа.

![Настройки политики регистрации и входа.](./media/B2CImage_11.png)

На следующем рисунке показан параметр **Выполнить поток пользователя** в потоке пользователя Azure AD B2C для регистрации и входа.

![Параметр выполнения потока пользователей в потоке политик.](./media/B2CImage_23.png)
   
### <a name="create-a-profile-editing-user-flow-policy"></a>Создание политики потока пользователей для редактирования профиля

Чтобы создать политику потока пользователя для редактирования профиля, выполните следующие действия.

1. На портале Azure выберите **Потоки пользователей (политики)** в левой области переходов.
1. На странице **Azure AD B2C – Потоки пользователей (политики)** выберите пункт **Создать поток пользователей**.
1. Выберите **Редактирование профиля**, затем выберите версию **Рекомендуемая**.
1. В поле **Имя** введите поток пользователя для редактирования профиля. Это имя впоследствии будет отображаться с префиксом, назначенным порталом (например, "B2C_1_").
1. В области **Поставщики удостоверений** выберите **Вход по электронной почте**.
1. В разделе **Атрибуты пользователя** установите следующие флажки:
    - **Адреса электронной почты** (только **Заявка на возврат**)
    - **Данное имя** (**Сбор атрибутов** и **Заявка на возврат**)
    - **Поставщик удостоверений** (только **Заявка на возврат**)
    - **Фамилия** (**Сбор атрибутов** и **Заявка на возврат**)
    - **Код объекта пользователя** (только **Заявка на возврат**)
1. Выберите **Создать**.

На следующем рисунке показан пример потока пользователя Azure AD B2C для редактирования профиля.

![Создание потока пользователей для редактирования профиля.](./media/B2CImage_12.png)

### <a name="create-a-password-reset-user-flow-policy"></a>Создание политики потока пользователей для сброса пароля

Чтобы создать политику потока пользователя для сброса пароля, выполните следующие действия.

1. На портале Azure выберите **Потоки пользователей (политики)** в левой области переходов.
1. На странице **Azure AD B2C – Потоки пользователей (политики)** выберите пункт **Создать поток пользователей**.
1. Выберите **Сброс пароля**, затем выберите версию **Рекомендуемая**.
1. В поле **Имя** введите имя потока пользователей для сброса пароля.
1. В разделе **Поставщики удостоверений** выберите **Сбросить пароль, используя адрес электронной почты**.
1. Выберите **Создать**.
1. В разделе **Заявки приложений** установите следующие флажки:
    - **Адреса электронной почты**
    - **Данное имя**
    - **Фамилия**
    - **Код объекта пользователя**
1. Выберите **Создать**.

На следующем рисунке показано, где можно установить **Сброс пароля с помощью адреса электронной почты** в потоке пользователя Azure AD B2C для сброса пароля.

![Установка значения "Сброс пароль с помощью адреса электронной почты" в политике сброса пароля](./media/B2CImage_13.png)

## <a name="add-social-identity-providers-optional"></a>Добавление поставщиков удостоверений в социальных сетях (дополнительно)

Поставщики удостоверений в социальных сетях позволяют пользователям использовать учетные записи социальных сетей для проверки подлинности. Добавление проверки подлинности поставщика удостоверений социальных сетей не является обязательным в Dynamics 365 Commerce. 

Если проверка подлинности поставщика удостоверений социальных сетей не добавлена, профили Azure AD B2C по умолчанию будут основными профилями для вашей базы пользователей. Пользователи будут выбирать собственные имена пользователей (их предпочтительные адреса электронной почты) и устанавливать пароль. Azure AD B2C будет выполнять проверку подлинности пользователей напрямую. 

Если добавлена проверка подлинности поставщика удостоверений социальных сетей и пользователь выбрал одного из предлагаемых поставщиков удостоверений социальных сетей, сущность все равно создается в клиенте Azure AD B2C. Azure AD B2C будет проверять подлинность учетных данных пользователя с помощью поставщика удостоверений социальных сетей.

> [!NOTE]
> Вход через поставщика удостоверений создает запись в клиенте B2C, но в формате, отличном от локальных учетных записей, так как он будет вызывать ссылку на внешнего поставщика удостоверений социальной сети для проверки подлинности. Пользователь может использовать тот же адрес электронной почты для поставщиков удостоверений социальной сети, то есть имя пользователя электронной почты, используемое для проверки подлинности, может не быть уникальным для клиента. Azure AD B2C обеспечивает только то, чтобы пользователи имели уникальный адрес электронной почты в локальных учетных записях B2C.

Прежде чем можно будет добавить поставщика удостоверений социальных сетей для проверки подлинности, необходимо перейти на портал поставщика удостоверений и настроить приложение поставщика удостоверений в соответствии с инструкциями из документации по Azure AD B2C. Список ссылок на документацию приведен ниже.

- [Amazon](/azure/active-directory-b2c/active-directory-b2c-setup-amzn-app)
- [Azure AD (один клиент)](/azure/active-directory-b2c/active-directory-b2c-setup-oidc-azure-active-directory)
- [Учетная запись Майкрософт](/azure/active-directory-b2c/active-directory-b2c-setup-msa-app)
- [Facebook](/azure/active-directory-b2c/active-directory-b2c-setup-fb-app)
- [GitHub](/azure/active-directory-b2c/active-directory-b2c-setup-github-app)
- [Google](/azure/active-directory-b2c/active-directory-b2c-setup-goog-app)
- [LinkedIn](/azure/active-directory-b2c/active-directory-b2c-setup-li-app)
- [OpenID Connect](/azure/active-directory-b2c/active-directory-b2c-setup-oidc-idp)
- [Twitter](/azure/active-directory-b2c/active-directory-b2c-setup-twitter-app)

### <a name="add-and-set-up-a-social-identity-provider"></a>Добавление и настройка поставщика удостоверений социальных сетей

Чтобы добавить и настроить поставщика удостоверений социальных сетей, выполните следующие действия.  

1. На портале Azure перейдите к пункту **Поставщики удостоверений**.
1. Выберите **Добавить**. Появится экран **Добавление поставщика удостоверений**.
1. В поле **Имя** введите имя, которое будет отображаться пользователям на экране входа.
1. В разделе **Тип поставщика удостоверений** выберите поставщика удостоверений из списка.
1. Нажмите **ОК**.
1. Выберите **Настройка поставщика удостоверений** для доступа к экрану **Настройка поставщика удостоверений социальных сетей**.
1. В поле **Код клиента** введите код клиента, полученный от установки приложения поставщика удостоверений.
1. В поле **Секрет клиента** введите секрет клиента, полученный от установки приложения поставщика удостоверений.
1. Прикрепите поток пользователей для политик входа в систему:
1. Перейдите к пункту **Azure AD B2C — пользовательские потоки (политики) \> {ваша политика входа и регистрации} \> Поставщики удостоверений**.
1. Чтобы привязать политику потока пользователей входа/регистрации, выберите каждого поставщика удостоверений, настроенного для вашей организации. Чтобы проверить их, выберите **Выполнить поток пользователя** для каждого поставщика удостоверений. На новой вкладке будет отображена страница регистрация, в которой отображается новое поле выбора поставщика удостоверений.

На следующем рисунке показаны примеры экранов **Добавление поставщика удостоверений** и **Настройка поставщика удостоверений социальных сетей** в Azure AD B2C.

![Добавление поставщика удостоверений социальных сетей в приложение.](./media/B2CImage_14.png)

На следующем рисунке показан пример выбора поставщиков удостоверений на странице Azure AD B2C **Поставщики удостоверений**.

![Выберите каждого поставщика удостоверений социальных сетей, который будет включен в политику.](./media/B2CImage_16.png)

На следующем рисунке показан пример экранного входа по умолчанию с отображением кнопки входа в систему через поставщика удостоверений социальных сетей.

> [!NOTE]
> При использовании настраиваемых страниц, построенных в модуле Commerce для потоков пользователей необходимо добавить кнопки для поставщиков удостоверений социальных сетей с использованием функций расширяемости библиотеки модуля Commerce. Кроме того, при настройке приложений с конкретным поставщиком удостоверений социальных сетей в некоторых случаях URL-адреса или строки конфигурации могут быть чувствительны к регистру. Дополнительные сведения см. в инструкциях по подключениям поставщика удостоверений социальных сетей.
 
![Пример экран входа по умолчанию с отображением кнопки входа через поставщика удостоверений социальной сети.](./media/B2CImage_17.png)

## <a name="update-commerce-headquarters-with-the-new-azure-ad-b2c-information"></a>Обновление центрального офиса Commerce с учетом новой информации Azure AD B2C

После завершения приведенных выше шагов по подготовке Azure AD B2C, приложение Azure AD B2C должно быть зарегистрировано в вашей среде Dynamics 365 Commerce.

Чтобы обновить штаб-квартиру с новыми сведениями Azure AD B2C, выполните следующие действия.

1. В модуле Commerce перейдите на страницу **Общие параметры Commerce** и выберите пункт **Поставщики удостоверений** в меню слева.
1. В разделе **Поставщики удостоверений** выполните следующие действия:
    1. В поле **Издатель** введите URL-адрес издателя поставщика удостоверений. Сведения о том, как найти URL-адрес издателя, см. в разделе [Получение URL-адреса издателя](#obtain-issuer-url).
    1. В поле **Имя** введите имя для записи издателя.
    1. В поле **Тип** введите **Azure AD B2C (id_token)**.
1. В разделе **Зависимые стороны** с выбранным выше пунктом поставщика удостоверений B2C выполните следующие действия:
    1. В поле **ClientID** введите код приложения B2C. Можно найти это в поле **Код приложения** страницы свойств приложения B2C.
    1. В поле **Тип** введите **Общий**.
    1. В поле **Тип пользователя** введите **Клиент**.
1. На панели операций выберите **Сохранить**.
1. В поле поиска Commerce выполните поиск **График распределения**
1. В левом меню навигации на странице **Графики распределения** выберите задание **1110 Глобальная конфигурация**.
1. В области действий выберите **Выполнить сейчас**.

### <a name="obtain-issuer-url"></a>Получение URL-адреса издателя

Чтобы получить URL-адрес издателя поставщика удостоверений, выполните следующие действия.
1. На странице Azure AD B2C портала Azure перейдите к потоку пользователей **Регистрация и вход**.
1. Выберите **Макеты страниц** в левом меню переходов, в разделе **Имя макета** выберите **Унифицированная страница регистрации или входа**, затем выберите **Выполнить поток пользователей**.
1. Убедитесь, что ваше приложение настроено на требуемое приложение Azure AD B2C, созданное выше, затем выберите ссылку в заголовке **Выполнить поток пользователей**, которая включает ``.../.well-known/openid-configuration?p=<B2CSIGN-INPOLICY>``.
1. Страница метаданных отображается на вкладке обозревателя. Скопируйте URL-адрес поставщика удостоверений (значение для **"issuer"**).
   - Пример: ``https://login.fabrikam.com/011115c3-0113-4f43-b5e2-df01266e24ae/v2.0/``.
 
**ИЛИ**: чтобы создать тот же URL-адрес метаданных вручную, выполните следующие действия.

1. Создайте URL-адрес метаданных в следующем формате, используя клиент B2C и политику: ``https://<B2CTENANTNAME>.b2clogin.com/<B2CTENANTNAME>.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=<B2CSIGN-INPOLICY>``
    - Пример: ``https://d365plc.b2clogin.com/d365plc.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=B2C_1_signinup``.
1. Введите URL-адрес метаданных в адресную строку браузера.
1. В метаданных скопируйте URL-адрес издателя поставщика удостоверений (значение для **"издатель"**).
    - Пример: ``https://login.fabrikam.com/011115c3-0113-4f43-b5e2-df01266e24ae/v2.0/``.

## <a name="configure-your-b2c-tenant-in-commerce-site-builder"></a>Настройка клиента B2C в конфигураторе сайта Commerce

После завершения настройки клиента Azure AD B2C необходимо настроить клиент B2C в конфигураторе сайта Commerce. Этапы настройки включают сбор информации о приложении B2C с портала Azure, ввод этих сведений о приложении B2C в конфигуратор сайта, затем связывание приложения B2C с сайтом и каналом.

### <a name="collect-the-required-application-information"></a>Сбор необходимой информации о приложении

Чтобы собрать необходимые сведения о приложении, выполните следующие действия.

1. На портале Azure перейдите к пункту **Домашняя страница \> Azure AD B2C — приложения**.
1. Выберите приложение, затем в левой области навигации выберите **Свойства** для получения сведений о приложении.
1. В поле **Код приложения** соберите идентификатор приложения B2C, созданный в вашем клиенте B2C. Впоследствии он будет введено как идентификатор **GUID клиента** в конфигураторе сайта.
1. В разделе **URL-адрес ответа** соберите URL-адрес ответа.
1. Перейдите в пункт **Домашняя страница \> Azure AD B2C — потоки пользователей (политики)**, затем соберите имена каждой политики потока пользователей.

На следующем рисунке показан пример страницы **Azure AD B2C — приложения**.

![Перейдите к приложению B2C в своем клиенте.](./media/B2CImage_19.png)

На следующем рисунке показан пример страницы **Свойства** приложения в Azure AD B2C. 

![Копирование кода приложения из свойств приложения B2C.](./media/B2CImage_21.png)

На следующем рисунке показан пример политик потока пользователей на странице **Azure AD B2C — потоки пользователей (политики)**.

![Сбор имен каждого потока политик B2C.](./media/B2CImage_22.png)

### <a name="enter-your-aad-b2c-tenant-application-information-into-commerce"></a>Ввод данных приложения клиента AAD B2C в Commerce

Перед сопоставлением клиента B2C с вашими сайтами необходимо ввести сведения о клиенте Azure AD B2C в конфигураторе сайта Commerce.

Чтобы добавить данные приложения клиента AAD B2C в Commerce, выполните следующие действия.

1. Войдите в систему в качестве администратора конфигуратора сайта Commerce для вашей среды.
1. На левом панели навигации выберите **Настройки клиента**, чтобы развернуть их.
1. В поле **Настройки клиента** выберите **Параметры B2C**. 
1. В главном окне рядом с пунктом **Приложения B2C** выберите **Управление**. (Если клиент отображается в списке приложений B2C, то он уже добавлен администратором. Убедитесь, что элементы на шаге 6 ниже соответствуют вашему приложению B2C.)
1. Выберите пункт **Добавить приложение B2C**.
1. Введите следующие необходимые пункты в отображаемой форме, используя значения из клиента B2C и приложения. Поля, которые не являются обязательными (без звездочки), могут быть оставлены пустыми.

    - **Имя приложения**: имя вашего приложения B2C, например "Fabrikam B2C".
    - **Имя клиента**: имя вашего B2C-клиента (например, "Fabrikam", если домен отображается как "fabrikam.onmicrosoft.com" для клиента B2C). 
    - **Код политики сброса пароля**: идентификатор политики потока пользователей для сброса пароля, например "B2C_1_PasswordReset".
    - **Идентификатор политики регистрации или входа**: идентификатор политики потока пользователей для входа и регистрации, например "B2C_1_signup_signin".
    - **Идентификатор GUID клиента**: идентификатор приложения B2C, например "22290eb2-c52e-42e9-8b35-a2b0a3bcb9e6".
    - **Идентификатор политики изменения профиля**: идентификатор политики потока пользователя для редактирования профиля, например "B2C_1A_ProfileEdit".

1. Нажмите **ОК**. Теперь в списке должно отображаться имя приложения B2C.
1. Выберите **Сохранить** для сохранения изменений.

### <a name="associate-the-b2c-application-to-your-site-and-channel"></a>Связь приложения B2C с сайтом и каналом

> [!WARNING]
> Если сайт уже связан с приложением B2C, при переходе к другому приложению B2C будут удалены текущие ссылки, установленные для пользователей, уже зарегистрированных в этой среде. При изменении все учетные данные, связанные с назначенным в данный момент приложением B2C, будут недоступны пользователям. 
> 
> Обновляйте приложение B2C только в том случае, если выполняется первая настройка приложения B2C канала или если требуется, чтобы пользователи повторно зарегистрировались с новыми учетными данными в этом канале с новым приложением B2C. Соблюдайте осторожность при связывании каналов с приложениями B2C и давайте приложениям понятные названия. Если канал не связан с приложением B2C в приведенных ниже шагах, пользователи, вошедшие в этот канал для вашего сайта, будут входить в приложение B2C, которое отображается как **по умолчанию** в списке **Параметры клиента \> Параметры B2C** приложений B2C.

Чтобы связать приложение B2C с сайтом и каналом, выполните следующие действия.

1. Перейдите на свой сайт в конфигураторе сайта Commerce.
1. На левом панели навигации выберите **Настройки сайта**, чтобы развернуть.
1. В разделе **Параметры сайта** выберите **Каналы**.
1. В главном окне в разделе **Каналы** выберите свой канал.
1. В правой панели свойств канала выберите имя приложения B2C в раскрывающемся меню **Выбор приложения B2C**.
1. Выберите **Закрыть**, затем выберите **Сохранить и опубликовать**.

## <a name="additional-b2c-information"></a>Дополнительные сведения B2C

### <a name="customer-migration"></a>Миграция клиентов

Если вы собираетесь выполнить миграцию записей клиентов из предыдущей платформы поставщика удостоверений, работайте с рабочей группой Dynamics 365 Commerce, чтобы проверить свои потребности по миграции клиентов.

Дополнительную документацию Azure AD B2C по миграции клиентов см. в разделе [Миграция пользователей в Azure Active Directory B2C](/azure/active-directory-b2c/active-directory-b2c-user-migration).

### <a name="custom-policies"></a>Пользовательские политики

Дополнительные сведения о настройке взаимодействий Azure AD B2C и лежащих в основе потоках политик, предлагаемых стандартными политиками B2C, см. раздел [Пользовательские политики в Azure Active Directory B2C](/azure/active-directory-b2c/active-directory-b2c-overview-custom). 

### <a name="secondary-admin"></a>Дополнительный администратор

При необходимости учетная запись дополнительного администратора может быть добавлена в разделе **Пользователи** вашего клиента B2C. Это может быть прямая учетная запись или общая учетная запись. Если необходимо сделать учетную запись общей для нескольких ресурсов группы, также может быть создана общая учетная запись. В связи с чувствительностью данных, хранящихся в Azure AD B2C, следует внимательно отслеживать общую учетную запись в соответствии с политиками безопасности компании.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Настройка доменного имени](configure-your-domain-name.md)

[Развертывание нового клиента электронной коммерции](deploy-ecommerce-site.md)

[Создание сайта электронной коммерции](create-ecommerce-site.md)

[Связывание сайта Dynamics 365 Commerce с интернет-каналом](associate-site-online-store.md)

[Управление файлами robots.txt](manage-robots-txt-files.md)

[Пакетная отправка перенаправлений URL-адресов](upload-bulk-redirects.md)

[Настройка специальных страниц для входа пользователей](custom-pages-user-logins.md)

[Настройка нескольких клиентов B2C в среде Commerce](configure-multi-B2C-tenants.md)

[Добавление поддержки сети доставки контента (CDN)](add-cdn-support.md)

[Включение обнаружения магазинов на основе местоположения](enable-store-detection.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]
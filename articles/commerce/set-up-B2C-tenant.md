---
title: Настройка клиента B2C в Commerce
description: В этом разделе описывается, как настроить клиенты "бизнес-потребитель" (B2C) Azure Active Directory (Azure AD) для проверки подлинности сайта пользователя в Dynamics 365 Commerce.
author: BrianShook
manager: annbe
ms.date: 06/22/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-commerce
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: v-chgri
ms.search.region: Global
ms.search.industry: retail
ms.author: brshoo
ms.search.validFrom: 2020-02-13
ms.dyn365.ops.version: ''
ms.openlocfilehash: 4ee667bb49e70e0c881a2db1248b3f0c7fc017ce
ms.sourcegitcommit: c88b54ba13a4dfe39b844ffaced4dc435560c47d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2021
ms.locfileid: "5478148"
---
# <a name="set-up-a-b2c-tenant-in-commerce"></a><span data-ttu-id="4dedc-103">Настройка клиента B2C в Commerce</span><span class="sxs-lookup"><span data-stu-id="4dedc-103">Set up a B2C tenant in Commerce</span></span>

[!include [banner](includes/banner.md)]

<span data-ttu-id="4dedc-104">В этом разделе описывается, как настроить клиенты "бизнес-потребитель" (B2C) Azure Active Directory (Azure AD) для проверки подлинности сайта пользователя в Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="4dedc-104">This topic describes how to set up your Azure Active Directory (Azure AD) business-to-consumer (B2C) tenants for user site authentication in Dynamics 365 Commerce.</span></span>

<span data-ttu-id="4dedc-105">Dynamics 365 Commerce использует Azure AD B2C для поддержки учетных данных пользователей и потоков проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="4dedc-105">Dynamics 365 Commerce uses Azure AD B2C to support user credential and authentication flows.</span></span> <span data-ttu-id="4dedc-106">Пользователь может регистрировать, выполнять вход и сбрасывать свои пароли в этих потоках.</span><span class="sxs-lookup"><span data-stu-id="4dedc-106">A user can sign up, sign in, and reset their password through these flows.</span></span> <span data-ttu-id="4dedc-107">Azure AD B2C хранит конфиденциальные сведения о проверке подлинности пользователя, такие как имя пользователя и пароль.</span><span class="sxs-lookup"><span data-stu-id="4dedc-107">Azure AD B2C stores sensitive user authentication information, such as username and password.</span></span> <span data-ttu-id="4dedc-108">Запись пользователя в клиенте B2C хранит либо запись локальной учетной записи B2C, либо запись поставщика удостоверений социальных сетей B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-108">The user record in the B2C tenant will store either a B2C local account record or a B2C social identity provider record.</span></span> <span data-ttu-id="4dedc-109">Эти записи B2C будут связываться обратно с записью клиента в среде Commerce.</span><span class="sxs-lookup"><span data-stu-id="4dedc-109">These B2C records will link back to the customer record in the Commerce environment.</span></span>

## <a name="create-or-link-to-an-existing-aad-b2c-tenant-in-the-azure-portal"></a><span data-ttu-id="4dedc-110">Создание или связывание существующего клиента AAD B2C с порталом Azure</span><span class="sxs-lookup"><span data-stu-id="4dedc-110">Create or link to an existing AAD B2C tenant in the Azure portal</span></span>

1. <span data-ttu-id="4dedc-111">Выполните вход на [портал Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="4dedc-111">Sign in to the [Azure portal](https://portal.azure.com/).</span></span>
1. <span data-ttu-id="4dedc-112">В меню портала Azure выберите **Создать ресурс**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-112">From the Azure portal menu, select **Create a resource**.</span></span> <span data-ttu-id="4dedc-113">Убедитесь в том, что используется подписка и каталог, которые будут связаны с вашей средой Commerce.</span><span class="sxs-lookup"><span data-stu-id="4dedc-113">Be sure to use the subscription and directory that will be connected with your Commerce environment.</span></span>

    ![Создание ресурса на портале Azure](./media/B2CImage_1.png)

1. <span data-ttu-id="4dedc-115">Перейдите в пункт **Удостоверение \> Azure Active Directory B2C**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-115">Go to **Identity \> Azure Active Directory B2C**.</span></span>
1. <span data-ttu-id="4dedc-116">После перехода на страницу **Создание нового клиента B2C или связывание с существующим клиентом** используйте один из следующих вариантов, который наилучшим образом отвечают потребностям компании:</span><span class="sxs-lookup"><span data-stu-id="4dedc-116">Once on the **Create New B2C Tenant or Link to existing Tenant** page, use one of the options below that best suits your company's needs:</span></span>

    - <span data-ttu-id="4dedc-117">**Создание нового клиента Azure AD B2C**: используйте этот параметр, чтобы создать новый клиент AAD B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-117">**Create a new Azure AD B2C Tenant**: Use this option to create a new AAD B2C tenant.</span></span>
        1. <span data-ttu-id="4dedc-118">Выберите **Создать новый клиент Azure AD B2C**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-118">Select **Create a new Azure AD B2C Tenant**.</span></span>
        1. <span data-ttu-id="4dedc-119">В поле **Название организации** введите название организации.</span><span class="sxs-lookup"><span data-stu-id="4dedc-119">Under **Organization name**, enter the organization name.</span></span>
        1. <span data-ttu-id="4dedc-120">В поле **Имя исходного домена** введите имя исходного домена.</span><span class="sxs-lookup"><span data-stu-id="4dedc-120">Under **Initial domain name**, enter the initial domain name.</span></span>
        1. <span data-ttu-id="4dedc-121">В поле **Страна или регион** выберите страну или регион.</span><span class="sxs-lookup"><span data-stu-id="4dedc-121">For **Country or region**, select the country or region.</span></span>
        1. <span data-ttu-id="4dedc-122">Выберите **Создать**, чтобы создать клиент.</span><span class="sxs-lookup"><span data-stu-id="4dedc-122">Select **Create** to create the tenant.</span></span>

     ![Создание нового клиента Azure AD](./media/B2CImage_2.png)

     - <span data-ttu-id="4dedc-124">**Связать существующий клиент Azure AD B2C с моей подпиской Azure**: этот параметр используется, если у вас уже есть клиент Azure AD B2C, с которым необходимо установить связь.</span><span class="sxs-lookup"><span data-stu-id="4dedc-124">**Link an existing Azure AD B2C Tenant to my Azure subscription**: Use this option if you already have an Azure AD B2C tenant you want to link to.</span></span>
        1. <span data-ttu-id="4dedc-125">Выберите **Связать существующий клиент Azure AD B2C с моей подпиской Azure**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-125">Select **Link an existing Azure AD B2C Tenant to my Azure subscription**.</span></span>
        1. <span data-ttu-id="4dedc-126">В поле **Клиент Azure AD B2C** выберите соответствующий клиент B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-126">For **Azure AD B2C Tenant**, select the appropriate B2C tenant.</span></span> <span data-ttu-id="4dedc-127">Если в поле выбора появляется сообщение "Нет подходящих клиентов B2C", у вас нет подходящего клиента B2C и потребуется создать новый клиент.</span><span class="sxs-lookup"><span data-stu-id="4dedc-127">If the message "No eligible B2C Tenants found" appears in the selection box, you do not have an existing eligible B2C tenant and will need to create a new one.</span></span>
        1. <span data-ttu-id="4dedc-128">В поле **Группа ресурсов** выберите **Создать новую**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-128">For **Resource group**, select **Create new**.</span></span> <span data-ttu-id="4dedc-129">Введите **Имя** для группы ресурсов, которая будет содержать клиент, выберите **Местоположение группы ресурсов**, затем выберите **Создать**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-129">Enter a **Name** for the resource group that will contain the tenant, select the **Resource group location**, and then select **Create**.</span></span>

    ![Связывание существующего клиента Azure AD B2C с подпиской Azure](./media/B2CImage_3.png)

1. <span data-ttu-id="4dedc-131">После создания нового каталога Azure AD B2C (это может занять некоторое время) на панели мониторинга появится ссылка на новый каталог.</span><span class="sxs-lookup"><span data-stu-id="4dedc-131">Once the new Azure AD B2C directory is created (this may take a few moments), a link to the new directory will appear on the dashboard.</span></span> <span data-ttu-id="4dedc-132">Эта ссылка направляет вас на страницу "Добро пожаловать в Azure Active Directory B2C".</span><span class="sxs-lookup"><span data-stu-id="4dedc-132">This link will direct you to the "Welcome to Azure Active Directory B2C" page.</span></span>

    ![Ссылка на новый каталог AAD](./media/B2CImage_4.png)

> [!NOTE]
> <span data-ttu-id="4dedc-134">Если в учетной записи Azure имеется несколько подписок или настроен клиент B2C, не связанный с активной подпиской, баннер **Устранение неполадок** направит вас, чтобы связать клиент с подпиской.</span><span class="sxs-lookup"><span data-stu-id="4dedc-134">If you have multiple subscriptions within your Azure account or have set up the B2C tenant without linking to an active subscription, a **Troubleshoot** banner will direct you to link the tenant to a subscription.</span></span> <span data-ttu-id="4dedc-135">Выберите сообщение об устранении неполадок и выполните указания по устранению проблемы с подпиской.</span><span class="sxs-lookup"><span data-stu-id="4dedc-135">Select the troubleshooting message and follow the instructions to resolve the subscription issue.</span></span>

<span data-ttu-id="4dedc-136">На следующем рисунке показан пример баннера **Устранение неполадок** для Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-136">The following image shows an example of an Azure AD B2C **Troubleshoot** banner.</span></span>

![Предупреждение, показывающее, что каталог не имеет активной подписки](./media/B2CImage_5.png)

## <a name="create-the-b2c-application"></a><span data-ttu-id="4dedc-138">Создание приложения B2C</span><span class="sxs-lookup"><span data-stu-id="4dedc-138">Create the B2C application</span></span>

<span data-ttu-id="4dedc-139">После создания клиента B2C вы создадите приложение B2C в рамках клиента, чтобы взаимодействовать с действиями Commerce.</span><span class="sxs-lookup"><span data-stu-id="4dedc-139">Once the B2C tenant has been created, you will create a B2C application within the tenant to interact with the Commerce actions.</span></span>

<span data-ttu-id="4dedc-140">Для создания приложения B2C выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4dedc-140">To create the B2C application, follow these steps.</span></span>

1. <span data-ttu-id="4dedc-141">На портале Azure выберите **Приложения(устаревшие)**, затем выберите **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-141">In the Azure portal, select **Applications(Legacy)** and then select **Add**.</span></span>
1. <span data-ttu-id="4dedc-142">В поле **Имя** введите имя нужного приложения AAD B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-142">Under **Name**, enter the name of the desired AAD B2C application.</span></span>
1. <span data-ttu-id="4dedc-143">В разделе **Веб-приложение/веб-интерфейс** для параметра **Включить веб-приложение/веб-интерфейс API** выберите **Да**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-143">Under **Web App/Web API**, for **Include web app / web API**, select **Yes**.</span></span>
1. <span data-ttu-id="4dedc-144">Для параметра **Разрешить неявный поток** выберите значение **Да** (значение по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="4dedc-144">For **Allow implicit flow**, select **Yes** (the default value).</span></span>
1. <span data-ttu-id="4dedc-145">В разделе **URL-адрес ответа** введите выделенные URL-адреса ответа.</span><span class="sxs-lookup"><span data-stu-id="4dedc-145">Under **Reply URL**, enter your dedicated reply URLs.</span></span> <span data-ttu-id="4dedc-146">Информацию об URL-адресах ответа и порядке форматирования их здесь см. в разделе [URL-адреса ответа](#reply-urls).</span><span class="sxs-lookup"><span data-stu-id="4dedc-146">See [Reply URLs](#reply-urls) below for information on reply URLs and how to format them here.</span></span>
1. <span data-ttu-id="4dedc-147">Для параметра **Включить собственный клиент** выберите значение **Нет** (значение по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="4dedc-147">For **Include native client**, select **No** (the default value).</span></span>
1. <span data-ttu-id="4dedc-148">Выберите **Создать**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-148">Select **Create**.</span></span>

### <a name="reply-urls"></a><span data-ttu-id="4dedc-149">URL-адреса ответов</span><span class="sxs-lookup"><span data-stu-id="4dedc-149">Reply URLs</span></span>

<span data-ttu-id="4dedc-150">URL-адреса ответа важны, поскольку они позволяют создать список разрешений доменов возврата, когда ваш сайт вызывает Azure AD B2C для проверки подлинности пользователя.</span><span class="sxs-lookup"><span data-stu-id="4dedc-150">Reply URLs are important as they provide an allow list of the return domains when your site calls Azure AD B2C to authenticate a user.</span></span> <span data-ttu-id="4dedc-151">Это позволяет вернуть пользователя, прошедшего проверку подлинности, в домен, с которого он выполняет вход (домен вашего сайта).</span><span class="sxs-lookup"><span data-stu-id="4dedc-151">This permits the return of the authenticated user back to the domain from which they are signing into (your site domain).</span></span> 

<span data-ttu-id="4dedc-152">В поле **URL-адрес ответа** на экране **Azure AD B2c - Приложения \> Новое приложение** необходимо добавить отдельные строки для домена узла и (после подготовки среды) URL-адрес, созданный в Commerce.</span><span class="sxs-lookup"><span data-stu-id="4dedc-152">In the **Reply URL** box on the **Azure AD B2c - Applications \> New application** screen, you need to add separate lines for both your site domain and (once your environment is provisioned) the Commerce-generated URL.</span></span> <span data-ttu-id="4dedc-153">Эти URL-адреса должны всегда использовать допустимый формат URL-адреса и должны быть только базовыми URL-адресами (без завершающих символов прямой косой черты или путей).</span><span class="sxs-lookup"><span data-stu-id="4dedc-153">These URLs must always use a valid URL format and must be base URLs only (no trailing forward slashes or paths).</span></span> <span data-ttu-id="4dedc-154">Затем строка ``/_msdyn365/authresp`` должна быть добавлена к базовым URL-адресам, как показано в следующих примерах.</span><span class="sxs-lookup"><span data-stu-id="4dedc-154">The string ``/_msdyn365/authresp`` then needs to be appended to the base URLs, as in the following examples.</span></span>

- <span data-ttu-id="4dedc-155">``https://www.fabrikam.com/_msdyn365/authresp`` (Домен должен полностью совпадать с доменом электронной коммерции.</span><span class="sxs-lookup"><span data-stu-id="4dedc-155">``https://www.fabrikam.com/_msdyn365/authresp`` (The domain should match the e-commerce domain completely.</span></span> <span data-ttu-id="4dedc-156">Если имеется несколько доменов, необходимо добавить этот URL-адрес для каждого домена.)</span><span class="sxs-lookup"><span data-stu-id="4dedc-156">If you have multiple domains, you need to add this URL for each domain.)</span></span>
- ``https://fabrikam-prod.commerce.dynamics.com/_msdyn365/authresp``

## <a name="create-user-flow-policies"></a><span data-ttu-id="4dedc-157">Создание политик потока пользователей</span><span class="sxs-lookup"><span data-stu-id="4dedc-157">Create user flow policies</span></span>

<span data-ttu-id="4dedc-158">Потоки пользователей — это политики, которые Azure AD B2C использует для обеспечения безопасности входа в систему, регистрации, редактирования профиля и функции забытого пароля пользователя.</span><span class="sxs-lookup"><span data-stu-id="4dedc-158">User flows are the policies Azure AD B2C uses to provide secure sign in, sign up, edit profile, and forget password user experiences.</span></span> <span data-ttu-id="4dedc-159">Dynamics 365 Commerce использует эти потоки для выполнения действий политики по взаимодействию с клиентом Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-159">Dynamics 365 Commerce uses these flows to perform the policy actions to interact with the Azure AD B2C tenant.</span></span> <span data-ttu-id="4dedc-160">Когда пользователь взаимодействует с этими политиками, он перенаправляется на клиент Azure AD B2C для выполнения этих действий.</span><span class="sxs-lookup"><span data-stu-id="4dedc-160">When a user interacts with these policies, they are redirected to the Azure AD B2C tenant to perform the actions.</span></span>

<span data-ttu-id="4dedc-161">Azure AD B2C предоставляет три основных типа потоков пользователей:</span><span class="sxs-lookup"><span data-stu-id="4dedc-161">Azure AD B2C provides three basic user flow types:</span></span>
- <span data-ttu-id="4dedc-162">Регистрация и вход</span><span class="sxs-lookup"><span data-stu-id="4dedc-162">Sign up and sign in</span></span>
- <span data-ttu-id="4dedc-163">Изменение профиля</span><span class="sxs-lookup"><span data-stu-id="4dedc-163">Profile editing</span></span>
- <span data-ttu-id="4dedc-164">Сброс пароля</span><span class="sxs-lookup"><span data-stu-id="4dedc-164">Password reset</span></span>

<span data-ttu-id="4dedc-165">Можно использовать потоки пользователей по умолчанию, предоставляемые Azure AD, которые будут показывать страницу, размещенную в AAD B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-165">You can choose to use the default user flows provided by Azure AD, which will display a page hosted by AAD B2C.</span></span> <span data-ttu-id="4dedc-166">Кроме того, можно создать HTML-страницу для управления внешним видом этих потоков пользователей.</span><span class="sxs-lookup"><span data-stu-id="4dedc-166">Alternately, you can create an HTML page to control the look and feel of these user flow experiences.</span></span> 

<span data-ttu-id="4dedc-167">Чтобы настроить страницы политики пользователя для Dynamics 365 Commerce, см. раздел [Настройка пользовательских страниц для учетных записей пользователей](custom-pages-user-logins.md).</span><span class="sxs-lookup"><span data-stu-id="4dedc-167">To customize the user policy pages for Dynamics 365 Commerce, see [Set up custom pages for user logins](custom-pages-user-logins.md).</span></span> <span data-ttu-id="4dedc-168">Дополнительные сведения см. в разделе [Настройка интерфейса взаимодействия с пользователями в Azure Active Directory B2C](https://docs.microsoft.com/azure/active-directory-b2c/tutorial-customize-ui).</span><span class="sxs-lookup"><span data-stu-id="4dedc-168">For additional information, see [Customize the interface of user experiences in Azure Active Directory B2C](https://docs.microsoft.com/azure/active-directory-b2c/tutorial-customize-ui).</span></span>

### <a name="create-a-sign-up-and-sign-in-user-flow-policy"></a><span data-ttu-id="4dedc-169">Создание политику потока пользователей для регистрации и входа в систему</span><span class="sxs-lookup"><span data-stu-id="4dedc-169">Create a sign up and sign in user flow policy</span></span>

<span data-ttu-id="4dedc-170">Чтобы создать регистрацию и вход в политике потока пользователя, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4dedc-170">To create a sign up and sign in user flow policy, follow these steps.</span></span>

1. <span data-ttu-id="4dedc-171">На портале Azure выберите **Потоки пользователей (политики)** в левой области переходов.</span><span class="sxs-lookup"><span data-stu-id="4dedc-171">In the Azure portal, select **User flows (policies)** in the left navigation pane.</span></span>
1. <span data-ttu-id="4dedc-172">На странице **Azure AD B2C – Потоки пользователей (политики)** выберите пункт **Создать поток пользователей**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-172">On the **Azure AD B2C – User flows (policies)** page, select **New User Flow**.</span></span>
1. <span data-ttu-id="4dedc-173">На вкладке **Рекомендовано** выберите **Регистрация и вход**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-173">On the **Recommended** tab, select **Sign up and sign in**.</span></span>
1. <span data-ttu-id="4dedc-174">В поле **Имя** введите имя политики.</span><span class="sxs-lookup"><span data-stu-id="4dedc-174">Under **Name**, enter a policy name.</span></span> <span data-ttu-id="4dedc-175">Это имя впоследствии будет отображаться с префиксом, назначенным порталом (например, "B2C_1_").</span><span class="sxs-lookup"><span data-stu-id="4dedc-175">This name will display afterwards with a prefix the portal assigns (for example, "B2C_1_").</span></span>
1. <span data-ttu-id="4dedc-176">В разделе **Поставщики удостоверений** установите соответствующий флажок.</span><span class="sxs-lookup"><span data-stu-id="4dedc-176">Under **Identity providers**, select the appropriate check box.</span></span>
1. <span data-ttu-id="4dedc-177">В группе **Многофакторная проверка подлинности** выберите подходящий вариант для вашей компании.</span><span class="sxs-lookup"><span data-stu-id="4dedc-177">Under **Multifactor Authentication**, select the appropriate choice for your company.</span></span> 
1. <span data-ttu-id="4dedc-178">В разделе **Атрибуты и заявки пользователей** выберите параметры для сбора атрибутов или возврата заявок, если необходимо.</span><span class="sxs-lookup"><span data-stu-id="4dedc-178">Under **User attributes and claims**, select options to collect attributes or return claims as appropriate.</span></span> <span data-ttu-id="4dedc-179">Для Commerce требуются следующие параметры по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="4dedc-179">Commerce requires the following default options:</span></span>

    | <span data-ttu-id="4dedc-180">**Собрать атрибут**</span><span class="sxs-lookup"><span data-stu-id="4dedc-180">**Collect  attribute**</span></span> | <span data-ttu-id="4dedc-181">**Заявка на возврат**</span><span class="sxs-lookup"><span data-stu-id="4dedc-181">**Return  claim**</span></span> |
    | ---------------------- | ----------------- |
    | <span data-ttu-id="4dedc-182">Адрес электронной почты</span><span class="sxs-lookup"><span data-stu-id="4dedc-182">Email Address</span></span>          | <span data-ttu-id="4dedc-183">Адреса электронной почты</span><span class="sxs-lookup"><span data-stu-id="4dedc-183">Email Addresses</span></span>   |
    | <span data-ttu-id="4dedc-184">Данное имя</span><span class="sxs-lookup"><span data-stu-id="4dedc-184">Given Name</span></span>             | <span data-ttu-id="4dedc-185">Данное имя</span><span class="sxs-lookup"><span data-stu-id="4dedc-185">Given Name</span></span>        |
    |                        | <span data-ttu-id="4dedc-186">Поставщик удостоверений</span><span class="sxs-lookup"><span data-stu-id="4dedc-186">Identity Provider</span></span> |
    | <span data-ttu-id="4dedc-187">Фамилия</span><span class="sxs-lookup"><span data-stu-id="4dedc-187">Surname</span></span>                | <span data-ttu-id="4dedc-188">Фамилия</span><span class="sxs-lookup"><span data-stu-id="4dedc-188">Surname</span></span>           |
    |                        | <span data-ttu-id="4dedc-189">Код объекта пользователя</span><span class="sxs-lookup"><span data-stu-id="4dedc-189">User’s Object ID</span></span>  |

1. <span data-ttu-id="4dedc-190">Выберите **Создать**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-190">Select **Create**.</span></span>

<span data-ttu-id="4dedc-191">На следующем рисунке показан пример потока пользователей Azure AD B2C для регистрации и входа.</span><span class="sxs-lookup"><span data-stu-id="4dedc-191">The following image is an example of the Azure AD B2C sign up and sign in user flow.</span></span>

![Настройки политики регистрации и входа](./media/B2CImage_11.png)

<span data-ttu-id="4dedc-193">На следующем рисунке показан параметр **Выполнить поток пользователя** в потоке пользователя Azure AD B2C для регистрации и входа.</span><span class="sxs-lookup"><span data-stu-id="4dedc-193">The following image shows the **Run user flow** option in the Azure AD B2C sign up and sign in user flow.</span></span>

![Параметр выполнения потока пользователей в потоке политик](./media/B2CImage_23.png)
   
### <a name="create-a-profile-editing-user-flow-policy"></a><span data-ttu-id="4dedc-195">Создание политики потока пользователей для редактирования профиля</span><span class="sxs-lookup"><span data-stu-id="4dedc-195">Create a profile editing user flow policy</span></span>

<span data-ttu-id="4dedc-196">Чтобы создать политику потока пользователя для редактирования профиля, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4dedc-196">To create a profile editing user flow policy, follow these steps.</span></span>

1. <span data-ttu-id="4dedc-197">На портале Azure выберите **Потоки пользователей (политики)** в левой области переходов.</span><span class="sxs-lookup"><span data-stu-id="4dedc-197">In the Azure portal, select **User flows (policies)** in the left navigation pane.</span></span>
1. <span data-ttu-id="4dedc-198">На странице **Azure AD B2C – Потоки пользователей (политики)** выберите пункт **Создать поток пользователей**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-198">On the **Azure AD B2C – User flows (policies)** page, select **New User Flow**.</span></span>
1. <span data-ttu-id="4dedc-199">На вкладке **Рекомендовано** выберите **Редактирование профиля**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-199">On the **Recommended** tab, select **Profile editing**.</span></span>
1. <span data-ttu-id="4dedc-200">В поле **Имя** введите поток пользователя для редактирования профиля.</span><span class="sxs-lookup"><span data-stu-id="4dedc-200">Under **Name**, enter the profile editing user flow.</span></span> <span data-ttu-id="4dedc-201">Это имя впоследствии будет отображаться с префиксом, назначенным порталом (например, "B2C_1_").</span><span class="sxs-lookup"><span data-stu-id="4dedc-201">This name will display afterwards with a prefix the portal assigns (for example, "B2C_1_").</span></span>
1. <span data-ttu-id="4dedc-202">В области **Поставщики удостоверений** выберите **Вход в локальную учетную запись**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-202">Under **Identity providers**, select **Local Account SignIn**.</span></span>
1. <span data-ttu-id="4dedc-203">В разделе **Атрибуты пользователя** установите следующие флажки:</span><span class="sxs-lookup"><span data-stu-id="4dedc-203">Under **User attributes**, select the following check boxes:</span></span>
    - <span data-ttu-id="4dedc-204">**Адреса электронной почты** (только **Заявка на возврат**)</span><span class="sxs-lookup"><span data-stu-id="4dedc-204">**Email Addresses** (**Return claim** only)</span></span>
    - <span data-ttu-id="4dedc-205">**Данное имя** (**Сбор атрибутов** и **Заявка на возврат**)</span><span class="sxs-lookup"><span data-stu-id="4dedc-205">**Given Name** (**Collect attribute** and **Return claim**)</span></span>
    - <span data-ttu-id="4dedc-206">**Поставщик удостоверений** (только **Заявка на возврат**)</span><span class="sxs-lookup"><span data-stu-id="4dedc-206">**Identity Provider** (**Return claim** only)</span></span>
    - <span data-ttu-id="4dedc-207">**Фамилия** (**Сбор атрибутов** и **Заявка на возврат**)</span><span class="sxs-lookup"><span data-stu-id="4dedc-207">**Surname** (**Collect attribute** and **Return claim**)</span></span>
    - <span data-ttu-id="4dedc-208">**Код объекта пользователя** (только **Заявка на возврат**)</span><span class="sxs-lookup"><span data-stu-id="4dedc-208">**User's Object ID** (**Return claim** only)</span></span>
1. <span data-ttu-id="4dedc-209">Выберите **Создать**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-209">Select **Create**.</span></span>

<span data-ttu-id="4dedc-210">На следующем рисунке показан пример потока пользователя Azure AD B2C для редактирования профиля.</span><span class="sxs-lookup"><span data-stu-id="4dedc-210">The following image shows an example of the Azure AD B2C profile editing user flow.</span></span>

![Создание потока пользователей для редактирования профиля](./media/B2CImage_12.png)

### <a name="create-a-password-reset-user-flow-policy"></a><span data-ttu-id="4dedc-212">Создание политики потока пользователей для сброса пароля</span><span class="sxs-lookup"><span data-stu-id="4dedc-212">Create a password reset user flow policy</span></span>

<span data-ttu-id="4dedc-213">Чтобы создать политику потока пользователя для сброса пароля, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4dedc-213">To create a password reset user flow policy, follow these steps.</span></span>

1. <span data-ttu-id="4dedc-214">На портале Azure выберите **Потоки пользователей (политики)** в левой области переходов.</span><span class="sxs-lookup"><span data-stu-id="4dedc-214">In the Azure portal, select **User flows (policies)** in the left navigation pane.</span></span>
1. <span data-ttu-id="4dedc-215">На странице **Azure AD B2C – Потоки пользователей (политики)** выберите пункт **Создать поток пользователей**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-215">On the **Azure AD B2C – User flows (policies)** page, select **New User Flow**.</span></span>
1. <span data-ttu-id="4dedc-216">На вкладке **Рекомендовано** выберите **Сброс пароля**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-216">On the **Recommended** tab, select **Password Reset**.</span></span>
1. <span data-ttu-id="4dedc-217">В поле **Имя** введите имя потока пользователей для сброса пароля.</span><span class="sxs-lookup"><span data-stu-id="4dedc-217">Under **Name**, enter a name for the password reset user flow.</span></span>
1. <span data-ttu-id="4dedc-218">В разделе **Поставщики удостоверений** выберите **Сбросить пароль, используя адрес электронной почты**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-218">Under **Identity providers**, select **Reset password using email address**.</span></span>
1. <span data-ttu-id="4dedc-219">Выберите **Создать**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-219">Select **Create**.</span></span>
1. <span data-ttu-id="4dedc-220">В разделе **Заявки приложений** установите следующие флажки:</span><span class="sxs-lookup"><span data-stu-id="4dedc-220">Under **Application claims**, select the following check boxes:</span></span>
    - <span data-ttu-id="4dedc-221">**Адреса электронной почты**</span><span class="sxs-lookup"><span data-stu-id="4dedc-221">**Email addresses**</span></span>
    - <span data-ttu-id="4dedc-222">**Данное имя**</span><span class="sxs-lookup"><span data-stu-id="4dedc-222">**Given Name**</span></span>
    - <span data-ttu-id="4dedc-223">**Фамилия**</span><span class="sxs-lookup"><span data-stu-id="4dedc-223">**Surname**</span></span>
    - <span data-ttu-id="4dedc-224">**Код объекта пользователя**</span><span class="sxs-lookup"><span data-stu-id="4dedc-224">**User's Object ID**</span></span>
1. <span data-ttu-id="4dedc-225">Выберите **Создать**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-225">Select **Create**.</span></span>

<span data-ttu-id="4dedc-226">На следующем рисунке показано, где можно установить **Сброс пароля с помощью адреса электронной почты** в потоке пользователя Azure AD B2C для сброса пароля.</span><span class="sxs-lookup"><span data-stu-id="4dedc-226">The following image shows where to set **Reset Password using mail address** in the Azure AD B2C password reset user flow.</span></span>

![Установка значения "Сброс пароль с помощью адреса электронной почты" в политике сброса пароля](./media/B2CImage_13.png)

## <a name="add-social-identity-providers-optional"></a><span data-ttu-id="4dedc-228">Добавление поставщиков удостоверений в социальных сетях (дополнительно)</span><span class="sxs-lookup"><span data-stu-id="4dedc-228">Add social identity providers (Optional)</span></span>

<span data-ttu-id="4dedc-229">Поставщики удостоверений в социальных сетях позволяют пользователям использовать учетные записи социальных сетей для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="4dedc-229">Social identity providers allow users to use their social accounts for authentication.</span></span> <span data-ttu-id="4dedc-230">Добавление проверки подлинности поставщика удостоверений социальных сетей не является обязательным в Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="4dedc-230">Adding social identity provider authentication is optional in Dynamics 365 Commerce.</span></span> 

<span data-ttu-id="4dedc-231">Если проверка подлинности поставщика удостоверений социальных сетей не добавлена, профили Azure AD B2C по умолчанию будут основными профилями для вашей базы пользователей.</span><span class="sxs-lookup"><span data-stu-id="4dedc-231">If social identity provider authentication is not added, the default Azure AD B2C profiles will be the main profiles for your user base.</span></span> <span data-ttu-id="4dedc-232">Пользователи будут выбирать собственные имена пользователей (их предпочтительные адреса электронной почты) и устанавливать пароль.</span><span class="sxs-lookup"><span data-stu-id="4dedc-232">Users will select their own username (their preferred email address) and set a password.</span></span> <span data-ttu-id="4dedc-233">Azure AD B2C будет выполнять проверку подлинности пользователей напрямую.</span><span class="sxs-lookup"><span data-stu-id="4dedc-233">Azure AD B2C will authenticate users directly.</span></span> 

<span data-ttu-id="4dedc-234">Если добавлена проверка подлинности поставщика удостоверений социальных сетей и пользователь выбрал одного из предлагаемых поставщиков удостоверений социальных сетей, сущность все равно создается в клиенте Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-234">If social identity provider authentication is added and a user chooses one of the social identity providers offered, an entity is still created in the Azure AD B2C tenant.</span></span> <span data-ttu-id="4dedc-235">Azure AD B2C будет проверять подлинность учетных данных пользователя с помощью поставщика удостоверений социальных сетей.</span><span class="sxs-lookup"><span data-stu-id="4dedc-235">Azure AD B2C will then authenticate the user's credentials with the social identity provider.</span></span>

> [!NOTE]
> <span data-ttu-id="4dedc-236">Вход через поставщика удостоверений создает запись в клиенте B2C, но в формате, отличном от локальных учетных записей, так как он будет вызывать ссылку на внешнего поставщика удостоверений социальной сети для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="4dedc-236">The identity provider sign in creates a record in the B2C tenant, but in a different format than local accounts since it will call the external social identity provider reference for authentication.</span></span> <span data-ttu-id="4dedc-237">Пользователь может использовать тот же адрес электронной почты для поставщиков удостоверений социальной сети, то есть имя пользователя электронной почты, используемое для проверки подлинности, может не быть уникальным для клиента.</span><span class="sxs-lookup"><span data-stu-id="4dedc-237">The user can use the same email address across social identity providers, meaning that the email username used for authentication may not be unique to the tenant.</span></span> <span data-ttu-id="4dedc-238">Azure AD B2C обеспечивает только то, чтобы пользователи имели уникальный адрес электронной почты в локальных учетных записях B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-238">Azure AD B2C will only enforce that users have a unique email address on local B2C accounts.</span></span>

<span data-ttu-id="4dedc-239">Прежде чем можно будет добавить поставщика удостоверений социальных сетей для проверки подлинности, необходимо перейти на портал поставщика удостоверений и настроить приложение поставщика удостоверений в соответствии с инструкциями из документации по Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-239">Before you can add a social identity provider for authentication, you must go to the identity provider's portal and set up an identity provider application as instructed in the Azure AD B2C documentation.</span></span> <span data-ttu-id="4dedc-240">Список ссылок на документацию приведен ниже.</span><span class="sxs-lookup"><span data-stu-id="4dedc-240">A list of links to the documentation is provided below.</span></span>

- [<span data-ttu-id="4dedc-241">Amazon</span><span class="sxs-lookup"><span data-stu-id="4dedc-241">Amazon</span></span>](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-setup-amzn-app)
- [<span data-ttu-id="4dedc-242">Azure AD (один клиент)</span><span class="sxs-lookup"><span data-stu-id="4dedc-242">Azure AD (Single Tenant)</span></span>](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-setup-oidc-azure-active-directory)
- [<span data-ttu-id="4dedc-243">Учетная запись Майкрософт</span><span class="sxs-lookup"><span data-stu-id="4dedc-243">Microsoft Account</span></span>](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-setup-msa-app)
- [<span data-ttu-id="4dedc-244">Facebook</span><span class="sxs-lookup"><span data-stu-id="4dedc-244">Facebook</span></span>](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-setup-fb-app)
- [<span data-ttu-id="4dedc-245">GitHub</span><span class="sxs-lookup"><span data-stu-id="4dedc-245">GitHub</span></span>](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-setup-github-app)
- [<span data-ttu-id="4dedc-246">Google</span><span class="sxs-lookup"><span data-stu-id="4dedc-246">Google</span></span>](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-setup-goog-app)
- [<span data-ttu-id="4dedc-247">LinkedIn</span><span class="sxs-lookup"><span data-stu-id="4dedc-247">LinkedIn</span></span>](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-setup-li-app)
- [<span data-ttu-id="4dedc-248">OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="4dedc-248">OpenID Connect</span></span>](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-setup-oidc-idp)
- [<span data-ttu-id="4dedc-249">Twitter</span><span class="sxs-lookup"><span data-stu-id="4dedc-249">Twitter</span></span>](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-setup-twitter-app)

### <a name="add-and-set-up-a-social-identity-provider"></a><span data-ttu-id="4dedc-250">Добавление и настройка поставщика удостоверений социальных сетей</span><span class="sxs-lookup"><span data-stu-id="4dedc-250">Add and set up a social identity provider</span></span>

<span data-ttu-id="4dedc-251">Чтобы добавить и настроить поставщика удостоверений социальных сетей, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4dedc-251">To add and set up a social identity provider, follow these steps.</span></span>  

1. <span data-ttu-id="4dedc-252">На портале Azure перейдите к пункту **Поставщики удостоверений**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-252">In the Azure portal, navigate to **Identity Providers**.</span></span>
1. <span data-ttu-id="4dedc-253">Выберите **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-253">Select **Add**.</span></span> <span data-ttu-id="4dedc-254">Появится экран **Добавление поставщика удостоверений**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-254">The **Add identity provider** screen appears.</span></span>
1. <span data-ttu-id="4dedc-255">В поле **Имя** введите имя, которое будет отображаться пользователям на экране входа.</span><span class="sxs-lookup"><span data-stu-id="4dedc-255">Under **Name**, enter the name to be displayed to users on your sign in screen.</span></span>
1. <span data-ttu-id="4dedc-256">В разделе **Тип поставщика удостоверений** выберите поставщика удостоверений из списка.</span><span class="sxs-lookup"><span data-stu-id="4dedc-256">Under **Identity provider type**, select an identity provider from the list.</span></span>
1. <span data-ttu-id="4dedc-257">Нажмите **ОК**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-257">Select **OK**.</span></span>
1. <span data-ttu-id="4dedc-258">Выберите **Настройка поставщика удостоверений** для доступа к экрану **Настройка поставщика удостоверений социальных сетей**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-258">Select **Set up this identity provider** to access the **Set up the social identity provider** screen.</span></span>
1. <span data-ttu-id="4dedc-259">В поле **Код клиента** введите код клиента, полученный от установки приложения поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="4dedc-259">Under **Client ID**, enter the client ID as obtained from the identity provider application setup.</span></span>
1. <span data-ttu-id="4dedc-260">В поле **Секрет клиента** введите секрет клиента, полученный от установки приложения поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="4dedc-260">Under **Client secret**, enter the client secret as obtained from the identity provider application setup.</span></span>
1. <span data-ttu-id="4dedc-261">Прикрепите поток пользователей для политик входа в систему:</span><span class="sxs-lookup"><span data-stu-id="4dedc-261">Attach user flow for sign in sign up policies:</span></span>
1. <span data-ttu-id="4dedc-262">Перейдите к пункту **Azure AD B2C — пользовательские потоки (политики) \> {ваша политика входа и регистрации} \> Поставщики удостоверений**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-262">Go to **Azure AD B2C – User flows (policies) \> {your sign-in sign-up policy} \> Identity providers**.</span></span>
1. <span data-ttu-id="4dedc-263">Чтобы привязать политику потока пользователей входа/регистрации, выберите каждого поставщика удостоверений, настроенного для вашей организации.</span><span class="sxs-lookup"><span data-stu-id="4dedc-263">To attach the sign in/sign up user flow policy, select each identity provider you have set up for your account.</span></span> <span data-ttu-id="4dedc-264">Чтобы проверить их, выберите **Выполнить поток пользователя** для каждого поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="4dedc-264">To test these, select **Run user flow** for each identity provider.</span></span> <span data-ttu-id="4dedc-265">На новой вкладке будет отображена страница регистрация, в которой отображается новое поле выбора поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="4dedc-265">A new tab will display the sign-in page displaying the new identity provider selection box.</span></span>

<span data-ttu-id="4dedc-266">На следующем рисунке показаны примеры экранов **Добавление поставщика удостоверений** и **Настройка поставщика удостоверений социальных сетей** в Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-266">The following image shows examples of the **Add identity provider** and **Set up the social identity provider** screens in Azure AD B2C.</span></span>

![Добавление поставщика удостоверений социальных сетей в приложение](./media/B2CImage_14.png)

<span data-ttu-id="4dedc-268">На следующем рисунке показан пример выбора поставщиков удостоверений на странице Azure AD B2C **Поставщики удостоверений**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-268">The following image shows an example of how to select identity providers on the Azure AD B2C **Identity Providers** page.</span></span>

![Выберите каждого поставщика удостоверений социальных сетей, который будет включен в политику](./media/B2CImage_16.png)

<span data-ttu-id="4dedc-270">На следующем рисунке показан пример экранного входа по умолчанию с отображением кнопки входа в систему через поставщика удостоверений социальных сетей.</span><span class="sxs-lookup"><span data-stu-id="4dedc-270">The following image shows an example of a default sign-in screen with a social identity provider sign-in button displayed.</span></span>

![Пример экран входа по умолчанию с отображением кнопки входа через поставщика удостоверений социальной сети](./media/B2CImage_17.png)

## <a name="update-commerce-headquarters-with-the-new-azure-ad-b2c-information"></a><span data-ttu-id="4dedc-272">Обновление центрального офиса Commerce с учетом новой информации Azure AD B2C</span><span class="sxs-lookup"><span data-stu-id="4dedc-272">Update Commerce headquarters with the new Azure AD B2C information</span></span>

<span data-ttu-id="4dedc-273">После завершения приведенных выше шагов по подготовке Azure AD B2C, приложение Azure AD B2C должно быть зарегистрировано в вашей среде Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="4dedc-273">Once the Azure AD B2C provisioning steps above are completed, the Azure AD B2C application must be registered in your Dynamics 365 Commerce environment.</span></span>

<span data-ttu-id="4dedc-274">Чтобы обновить штаб-квартиру с новыми сведениями Azure AD B2C, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4dedc-274">To update headquarters with the new Azure AD B2C information, follow these steps.</span></span>

1. <span data-ttu-id="4dedc-275">В модуле Commerce перейдите на страницу **Общие параметры Commerce** и выберите пункт **Поставщики удостоверений** в меню слева.</span><span class="sxs-lookup"><span data-stu-id="4dedc-275">In Commerce, go to **Commerce Shared Parameters** and select **Identity Providers** in the left menu.</span></span>
1. <span data-ttu-id="4dedc-276">В разделе **Поставщики удостоверений** выполните следующие действия:</span><span class="sxs-lookup"><span data-stu-id="4dedc-276">Under **Identity Providers**, do the following:</span></span>
    1. <span data-ttu-id="4dedc-277">В поле **Издатель** введите URL-адрес издателя поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="4dedc-277">In the **Issuer** box, enter the identity provider issuer URL.</span></span> <span data-ttu-id="4dedc-278">Сведения о том, как найти URL-адрес издателя, см. в разделе [Получение URL-адреса издателя](#obtain-issuer-url).</span><span class="sxs-lookup"><span data-stu-id="4dedc-278">To find your issuer URL, see [Obtain issuer URL](#obtain-issuer-url) below.</span></span>
    1. <span data-ttu-id="4dedc-279">В поле **Имя** введите имя для записи издателя.</span><span class="sxs-lookup"><span data-stu-id="4dedc-279">In the **Name** box, enter a name for your issuer record.</span></span>
    1. <span data-ttu-id="4dedc-280">В поле **Тип** введите **Azure AD B2C (id_token)**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-280">In the **Type** box, enter **Azure AD B2C (id_token)**.</span></span>
1. <span data-ttu-id="4dedc-281">В разделе **Зависимые стороны** с выбранным выше пунктом поставщика удостоверений B2C выполните следующие действия:</span><span class="sxs-lookup"><span data-stu-id="4dedc-281">Under **Relying Parties**, with the above B2C identity provider item selected, do the following:</span></span>
    1. <span data-ttu-id="4dedc-282">В поле **ClientID** введите код приложения B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-282">In the **ClientID** box, enter your B2C application ID.</span></span> <span data-ttu-id="4dedc-283">Можно найти это в поле **Код приложения** страницы свойств приложения B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-283">You can find this in the **Application ID** box of your B2C application's properties page.</span></span>
    1. <span data-ttu-id="4dedc-284">В поле **Тип** введите **Общий**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-284">In the **Type** box, enter **Public**.</span></span>
    1. <span data-ttu-id="4dedc-285">В поле **Тип пользователя** введите **Клиент**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-285">In the **User Type** box, enter **Customer**.</span></span>
1. <span data-ttu-id="4dedc-286">На панели операций выберите **Сохранить**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-286">On the action pane, select **Save**.</span></span>
1. <span data-ttu-id="4dedc-287">В поле поиска Commerce выполните поиск **График распределения**</span><span class="sxs-lookup"><span data-stu-id="4dedc-287">In the Commerce search box, search for **Distribution schedule**</span></span>
1. <span data-ttu-id="4dedc-288">В левом меню навигации на странице **Графики распределения** выберите задание **1110 Глобальная конфигурация**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-288">In the left navigation menu of the **Distribution schedules** page, select job **1110 Global configuration**.</span></span>
1. <span data-ttu-id="4dedc-289">В области действий выберите **Выполнить сейчас**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-289">On the action pane, select **Run Now**.</span></span>

### <a name="obtain-issuer-url"></a><span data-ttu-id="4dedc-290">Получение URL-адреса издателя</span><span class="sxs-lookup"><span data-stu-id="4dedc-290">Obtain issuer URL</span></span>

<span data-ttu-id="4dedc-291">Чтобы получить URL-адрес издателя поставщика удостоверений, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4dedc-291">To obtain your identity provider issuer URL, follow these steps.</span></span>

1. <span data-ttu-id="4dedc-292">Создайте URL-адрес метаданных в следующем формате, используя клиент B2C и политику: ``https://<B2CTENANTNAME>.b2clogin.com/<B2CTENANTNAME>.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=<B2CSIGN-INPOLICY>``</span><span class="sxs-lookup"><span data-stu-id="4dedc-292">Create a metadata address URL in the following format using your B2C tenant and policy: ``https://<B2CTENANTNAME>.b2clogin.com/<B2CTENANTNAME>.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=<B2CSIGN-INPOLICY>``</span></span>
    - <span data-ttu-id="4dedc-293">Пример: ``https://d365plc.b2clogin.com/d365plc.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=B2C_1_signinup``.</span><span class="sxs-lookup"><span data-stu-id="4dedc-293">Example: ``https://d365plc.b2clogin.com/d365plc.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=B2C_1_signinup``.</span></span>
1. <span data-ttu-id="4dedc-294">Введите URL-адрес метаданных в адресную строку браузера.</span><span class="sxs-lookup"><span data-stu-id="4dedc-294">Enter the metadata address URL into a browser address bar.</span></span>
1. <span data-ttu-id="4dedc-295">В метаданных скопируйте URL-адрес издателя поставщика удостоверений (значение для **"издатель"**).</span><span class="sxs-lookup"><span data-stu-id="4dedc-295">In the metadata, copy the identity provider issuer URL (the value for **"issuer"**).</span></span>
    - <span data-ttu-id="4dedc-296">Пример: ``https://login.fabrikam.com/073405c3-0113-4f43-b5e2-df01266e24ae/v2.0/``.</span><span class="sxs-lookup"><span data-stu-id="4dedc-296">Example: ``https://login.fabrikam.com/073405c3-0113-4f43-b5e2-df01266e24ae/v2.0/``.</span></span>

## <a name="configure-your-b2c-tenant-in-commerce-site-builder"></a><span data-ttu-id="4dedc-297">Настройка клиента B2C в конфигураторе сайта Commerce</span><span class="sxs-lookup"><span data-stu-id="4dedc-297">Configure your B2C tenant in Commerce site builder</span></span>

<span data-ttu-id="4dedc-298">После завершения настройки клиента Azure AD B2C необходимо настроить клиент B2C в конфигураторе сайта Commerce.</span><span class="sxs-lookup"><span data-stu-id="4dedc-298">Once setup of your Azure AD B2C tenant is completed, you must configure the B2C tenant in Commerce site builder.</span></span> <span data-ttu-id="4dedc-299">Этапы настройки включают сбор информации о приложении B2C с портала Azure, ввод этих сведений о приложении B2C в конфигуратор сайта, затем связывание приложения B2C с сайтом и каналом.</span><span class="sxs-lookup"><span data-stu-id="4dedc-299">Configuration steps include collecting B2C application information from the Azure portal, entering that B2C application information into site builder, and then associating the B2C application with your site and channel.</span></span>

### <a name="collect-the-required-application-information"></a><span data-ttu-id="4dedc-300">Сбор необходимой информации о приложении</span><span class="sxs-lookup"><span data-stu-id="4dedc-300">Collect the required application information</span></span>

<span data-ttu-id="4dedc-301">Чтобы собрать необходимые сведения о приложении, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4dedc-301">To collect the required application information, follow these steps.</span></span>

1. <span data-ttu-id="4dedc-302">На портале Azure перейдите к пункту **Домашняя страница \> Azure AD B2C — приложения**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-302">In the Azure portal, go to **Home \> Azure AD B2C - Applications**.</span></span>
1. <span data-ttu-id="4dedc-303">Выберите приложение, затем в левой области навигации выберите **Свойства** для получения сведений о приложении.</span><span class="sxs-lookup"><span data-stu-id="4dedc-303">Select your application, and then in the left navigation pane select **Properties** to obtain the application details.</span></span>
1. <span data-ttu-id="4dedc-304">В поле **Код приложения** соберите идентификатор приложения B2C, созданный в вашем клиенте B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-304">From the **Application ID** box, collect the application ID of the B2C application created in your B2C tenant.</span></span> <span data-ttu-id="4dedc-305">Впоследствии он будет введено как идентификатор **GUID клиента** в конфигураторе сайта.</span><span class="sxs-lookup"><span data-stu-id="4dedc-305">This will later be entered as the **Client GUID** in site builder.</span></span>
1. <span data-ttu-id="4dedc-306">В разделе **URL-адрес ответа** соберите URL-адрес ответа.</span><span class="sxs-lookup"><span data-stu-id="4dedc-306">Under **Reply URL**, collect the reply URL.</span></span>
1. <span data-ttu-id="4dedc-307">Перейдите в пункт **Домашняя страница \> Azure AD B2C — потоки пользователей (политики)**, затем соберите имена каждой политики потока пользователей.</span><span class="sxs-lookup"><span data-stu-id="4dedc-307">Go to **Home \> Azure AD B2C – User flows (policies)**, and then collect the names of each user flow policy.</span></span>

<span data-ttu-id="4dedc-308">На следующем рисунке показан пример страницы **Azure AD B2C — приложения**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-308">The following image shows an example of the **Azure AD B2C - Applications** page.</span></span>

![Перейдите к приложению B2C в своем клиенте](./media/B2CImage_19.png)

<span data-ttu-id="4dedc-310">На следующем рисунке показан пример страницы **Свойства** приложения в Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-310">The following image shows an example of an application **Properties** page in Azure AD B2C.</span></span> 

![Копирование кода приложения из свойств приложения B2C](./media/B2CImage_21.png)

<span data-ttu-id="4dedc-312">На следующем рисунке показан пример политик потока пользователей на странице **Azure AD B2C — потоки пользователей (политики)**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-312">The following image shows an example of user flow policies on the **Azure AD B2C – User flows (policies)** page.</span></span>

![Сбор имен каждого потока политик B2C](./media/B2CImage_22.png)

### <a name="enter-your-aad-b2c-tenant-application-information-into-commerce"></a><span data-ttu-id="4dedc-314">Ввод данных приложения клиента AAD B2C в Commerce</span><span class="sxs-lookup"><span data-stu-id="4dedc-314">Enter your AAD B2C tenant application information into Commerce</span></span>

<span data-ttu-id="4dedc-315">Перед сопоставлением клиента B2C с вашими сайтами необходимо ввести сведения о клиенте Azure AD B2C в конфигураторе сайта Commerce.</span><span class="sxs-lookup"><span data-stu-id="4dedc-315">You must enter details of the Azure AD B2C tenant into Commerce site builder before associating the B2C tenant with your site(s).</span></span>

<span data-ttu-id="4dedc-316">Чтобы добавить данные приложения клиента AAD B2C в Commerce, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4dedc-316">To add your AAD B2C tenant application information to Commerce, follow these steps.</span></span>

1. <span data-ttu-id="4dedc-317">Войдите в систему в качестве администратора конфигуратора сайта Commerce для вашей среды.</span><span class="sxs-lookup"><span data-stu-id="4dedc-317">Sign in as an administrator to Commerce site builder for your environment.</span></span>
1. <span data-ttu-id="4dedc-318">На левом панели навигации выберите **Настройки клиента**, чтобы развернуть их.</span><span class="sxs-lookup"><span data-stu-id="4dedc-318">In the left navigation pane, select **Tenant Settings**  to expand it.</span></span>
1. <span data-ttu-id="4dedc-319">В поле **Настройки клиента** выберите **Параметры B2C**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-319">Under **Tenant Settings**, select **B2C Settings**.</span></span> 
1. <span data-ttu-id="4dedc-320">В главном окне рядом с пунктом **Приложения B2C** выберите **Управление**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-320">In the main window next **B2C Applications**, select **Manage**.</span></span> <span data-ttu-id="4dedc-321">(Если клиент отображается в списке приложений B2C, то он уже добавлен администратором.</span><span class="sxs-lookup"><span data-stu-id="4dedc-321">(If your tenant appears in the B2C Applications list, then it was already added by an administrator.</span></span> <span data-ttu-id="4dedc-322">Убедитесь, что элементы на шаге 6 ниже соответствуют вашему приложению B2C.)</span><span class="sxs-lookup"><span data-stu-id="4dedc-322">Verify that the items in step 6 below match your B2C Application.)</span></span>
1. <span data-ttu-id="4dedc-323">Выберите пункт **Добавить приложение B2C**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-323">Select **Add B2C Application**.</span></span>
1. <span data-ttu-id="4dedc-324">Введите следующие необходимые пункты в отображаемой форме, используя значения из клиента B2C и приложения.</span><span class="sxs-lookup"><span data-stu-id="4dedc-324">Enter the following required items in the form displayed, using values from your B2C tenant and application.</span></span> <span data-ttu-id="4dedc-325">Поля, которые не являются обязательными (без звездочки), могут быть оставлены пустыми.</span><span class="sxs-lookup"><span data-stu-id="4dedc-325">Fields that are not required (those without an asterisk) may be left blank.</span></span>

    - <span data-ttu-id="4dedc-326">**Имя приложения**: имя вашего приложения B2C, например "Fabrikam B2C".</span><span class="sxs-lookup"><span data-stu-id="4dedc-326">**Application Name**: The name for your B2C Application, for example "Fabrikam B2C".</span></span>
    - <span data-ttu-id="4dedc-327">**Имя клиента**: имя вашего B2C-клиента (например, "Fabrikam", если домен отображается как "fabrikam.onmicrosoft.com" для клиента B2C).</span><span class="sxs-lookup"><span data-stu-id="4dedc-327">**Tenant Name**: The name of your B2C tenant (for example, use "fabrikam" if the domain appears as "fabrikam.onmicrosoft.com" for the B2C tenant).</span></span> 
    - <span data-ttu-id="4dedc-328">**Код политики сброса пароля**: идентификатор политики потока пользователей для сброса пароля, например "B2C_1_PasswordReset".</span><span class="sxs-lookup"><span data-stu-id="4dedc-328">**Forget Password Policy ID**: The forget password user flow policy ID, for example "B2C_1_PasswordReset".</span></span>
    - <span data-ttu-id="4dedc-329">**Идентификатор политики регистрации или входа**: идентификатор политики потока пользователей для входа и регистрации, например "B2C_1_signup_signin".</span><span class="sxs-lookup"><span data-stu-id="4dedc-329">**Signup Signin Policy ID**: The sign up and sign in user flow policy ID, for example "B2C_1_signup_signin".</span></span>
    - <span data-ttu-id="4dedc-330">**Идентификатор GUID клиента**: идентификатор приложения B2C, например "22290eb2-c52e-42e9-8b35-a2b0a3bcb9e6".</span><span class="sxs-lookup"><span data-stu-id="4dedc-330">**Client GUID**: The B2C application ID, for example "22290eb2-c52e-42e9-8b35-a2b0a3bcb9e6".</span></span>
    - <span data-ttu-id="4dedc-331">**Идентификатор политики изменения профиля**: идентификатор политики потока пользователя для редактирования профиля, например "B2C_1A_ProfileEdit".</span><span class="sxs-lookup"><span data-stu-id="4dedc-331">**Edit Profile Policy ID**: The profile editing user flow policy ID, for example "B2C_1A_ProfileEdit".</span></span>

1. <span data-ttu-id="4dedc-332">Нажмите **ОК**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-332">Select **OK**.</span></span> <span data-ttu-id="4dedc-333">Теперь в списке должно отображаться имя приложения B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-333">You should now see the name of your B2C application appear in the list.</span></span>
1. <span data-ttu-id="4dedc-334">Выберите **Сохранить** для сохранения изменений.</span><span class="sxs-lookup"><span data-stu-id="4dedc-334">Select **Save** to save your changes.</span></span>

### <a name="associate-the-b2c-application-to-your-site-and-channel"></a><span data-ttu-id="4dedc-335">Связь приложения B2C с сайтом и каналом</span><span class="sxs-lookup"><span data-stu-id="4dedc-335">Associate the B2C application to your site and channel</span></span>

> [!WARNING]
> <span data-ttu-id="4dedc-336">Если сайт уже связан с приложением B2C, при переходе к другому приложению B2C будут удалены текущие ссылки, установленные для пользователей, уже зарегистрированных в этой среде.</span><span class="sxs-lookup"><span data-stu-id="4dedc-336">If your site is already associated with a B2C application, changing to a different B2C application will remove the current references established for users already signed up in this environment.</span></span> <span data-ttu-id="4dedc-337">При изменении все учетные данные, связанные с назначенным в данный момент приложением B2C, будут недоступны пользователям.</span><span class="sxs-lookup"><span data-stu-id="4dedc-337">If changed, any credentials associated with the currently-assigned B2C application will not be available to users.</span></span> 
> 
> <span data-ttu-id="4dedc-338">Обновляйте приложение B2C только в том случае, если выполняется первая настройка приложения B2C канала или если требуется, чтобы пользователи повторно зарегистрировались с новыми учетными данными в этом канале с новым приложением B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-338">Only update the B2C application if you are setting up the channel's B2C application for the first time or if you intend to have users re-sign up with new credentials to this channel with the new B2C application.</span></span> <span data-ttu-id="4dedc-339">Соблюдайте осторожность при связывании каналов с приложениями B2C и давайте приложениям понятные названия.</span><span class="sxs-lookup"><span data-stu-id="4dedc-339">Take caution when associating channels to B2C applications, and name applications clearly.</span></span> <span data-ttu-id="4dedc-340">Если канал не связан с приложением B2C в приведенных ниже шагах, пользователи, вошедшие в этот канал для вашего сайта, будут входить в приложение B2C, которое отображается как **по умолчанию** в списке **Параметры клиента \> Параметры B2C** приложений B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-340">If a channel is not associated to a B2C application in the steps below, users signing into that channel for your site will be entered into the B2C application showing as **default** in the **Tenant Settings \> B2C Settings** list of B2C applications.</span></span>

<span data-ttu-id="4dedc-341">Чтобы связать приложение B2C с сайтом и каналом, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="4dedc-341">To associate the B2C application to your site and channel, follow these steps.</span></span>

1. <span data-ttu-id="4dedc-342">Перейдите на свой сайт в конфигураторе сайта Commerce.</span><span class="sxs-lookup"><span data-stu-id="4dedc-342">Navigate to your site in Commerce site builder.</span></span>
1. <span data-ttu-id="4dedc-343">На левом панели навигации выберите **Настройки сайта**, чтобы развернуть.</span><span class="sxs-lookup"><span data-stu-id="4dedc-343">In the left navigation pane, select **Site Settings** to expand it.</span></span>
1. <span data-ttu-id="4dedc-344">В разделе **Параметры сайта** выберите **Каналы**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-344">Below **Site Settings**, select **Channels**.</span></span>
1. <span data-ttu-id="4dedc-345">В главном окне в разделе **Каналы** выберите свой канал.</span><span class="sxs-lookup"><span data-stu-id="4dedc-345">In the main window under **Channels**, select your channel.</span></span>
1. <span data-ttu-id="4dedc-346">В правой панели свойств канала выберите имя приложения B2C в раскрывающемся меню **Выбор приложения B2C**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-346">In the channel properties pane on the right, select your B2C application name from the **Select B2C Application** drop down menu.</span></span>
1. <span data-ttu-id="4dedc-347">Выберите **Закрыть**, затем выберите **Сохранить и опубликовать**.</span><span class="sxs-lookup"><span data-stu-id="4dedc-347">Select **Close**, and then select **Save and Publish**.</span></span>

## <a name="additional-b2c-information"></a><span data-ttu-id="4dedc-348">Дополнительные сведения B2C</span><span class="sxs-lookup"><span data-stu-id="4dedc-348">Additional B2C information</span></span>

### <a name="customer-migration"></a><span data-ttu-id="4dedc-349">Миграция клиентов</span><span class="sxs-lookup"><span data-stu-id="4dedc-349">Customer migration</span></span>

<span data-ttu-id="4dedc-350">Если вы собираетесь выполнить миграцию записей клиентов из предыдущей платформы поставщика удостоверений, работайте с рабочей группой Dynamics 365 Commerce, чтобы проверить свои потребности по миграции клиентов.</span><span class="sxs-lookup"><span data-stu-id="4dedc-350">If you are considering migrating customer records from a previous identity provider platform, please work with the Dynamics 365 Commerce team to review your customer migration needs.</span></span>

<span data-ttu-id="4dedc-351">Дополнительную документацию Azure AD B2C по миграции клиентов см. в разделе [Миграция пользователей в Azure Active Directory B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-user-migration).</span><span class="sxs-lookup"><span data-stu-id="4dedc-351">For additional Azure AD B2C documentation on customer migration, see [Migrate users to Azure Active Directory B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-user-migration).</span></span>

### <a name="custom-policies"></a><span data-ttu-id="4dedc-352">Пользовательские политики</span><span class="sxs-lookup"><span data-stu-id="4dedc-352">Custom policies</span></span>

<span data-ttu-id="4dedc-353">Дополнительные сведения о настройке взаимодействий Azure AD B2C и лежащих в основе потоках политик, предлагаемых стандартными политиками B2C, см. раздел [Пользовательские политики в Azure Active Directory B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-overview-custom).</span><span class="sxs-lookup"><span data-stu-id="4dedc-353">For additional information regarding customizing Azure AD B2C interactions and policy flows beyond what is offered by B2C standard policies, see [Custom policies in Azure Active Directory B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-overview-custom).</span></span> 

### <a name="secondary-admin"></a><span data-ttu-id="4dedc-354">Дополнительный администратор</span><span class="sxs-lookup"><span data-stu-id="4dedc-354">Secondary admin</span></span>

<span data-ttu-id="4dedc-355">При необходимости учетная запись дополнительного администратора может быть добавлена в разделе **Пользователи** вашего клиента B2C.</span><span class="sxs-lookup"><span data-stu-id="4dedc-355">An optional, secondary administrator account can be added in the **Users** section of your B2C tenant.</span></span> <span data-ttu-id="4dedc-356">Это может быть прямая учетная запись или общая учетная запись.</span><span class="sxs-lookup"><span data-stu-id="4dedc-356">This can be a direct account or a general account.</span></span> <span data-ttu-id="4dedc-357">Если необходимо сделать учетную запись общей для нескольких ресурсов группы, также может быть создана общая учетная запись.</span><span class="sxs-lookup"><span data-stu-id="4dedc-357">If you need to share an account across team resources, a common account can also be created.</span></span> <span data-ttu-id="4dedc-358">В связи с чувствительностью данных, хранящихся в Azure AD B2C, следует внимательно отслеживать общую учетную запись в соответствии с политиками безопасности компании.</span><span class="sxs-lookup"><span data-stu-id="4dedc-358">Due to the sensitivity of the data stored in Azure AD B2C, a common account should be monitored closely per your company's security practices.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="4dedc-359">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="4dedc-359">Additional resources</span></span>

[<span data-ttu-id="4dedc-360">Настройка доменного имени</span><span class="sxs-lookup"><span data-stu-id="4dedc-360">Configure your domain name</span></span>](configure-your-domain-name.md)

[<span data-ttu-id="4dedc-361">Развертывание нового клиента электронной коммерции</span><span class="sxs-lookup"><span data-stu-id="4dedc-361">Deploy a new e-commerce tenant</span></span>](deploy-ecommerce-site.md)

[<span data-ttu-id="4dedc-362">Создание сайта электронной коммерции</span><span class="sxs-lookup"><span data-stu-id="4dedc-362">Create an e-commerce site</span></span>](create-ecommerce-site.md)

[<span data-ttu-id="4dedc-363">Связывание сайта Dynamics 365 Commerce с интернет-каналом</span><span class="sxs-lookup"><span data-stu-id="4dedc-363">Associate a Dynamics 365 Commerce site with an online channel</span></span>](associate-site-online-store.md)

[<span data-ttu-id="4dedc-364">Управление файлами robots.txt</span><span class="sxs-lookup"><span data-stu-id="4dedc-364">Manage robots.txt files</span></span>](manage-robots-txt-files.md)

<span data-ttu-id="4dedc-365">[Пакетная отправка перенаправлений URL-адресов](upload-bulk-redirects.md)Связывание сайта Dynamics 365 Commerce с интернет-каналом</span><span class="sxs-lookup"><span data-stu-id="4dedc-365">[Upload URL redirects in bulk](upload-bulk-redirects.md)Associate a Dynamics 365 Commerce site with an online channel</span></span>

[<span data-ttu-id="4dedc-366">Настройка специальных страниц для входа пользователей</span><span class="sxs-lookup"><span data-stu-id="4dedc-366">Set up custom pages for user logins</span></span>](custom-pages-user-logins.md)

[<span data-ttu-id="4dedc-367">Настройка нескольких клиентов B2C в среде Commerce</span><span class="sxs-lookup"><span data-stu-id="4dedc-367">Configure multiple B2C tenants in a Commerce environment</span></span>](configure-multi-B2C-tenants.md)

[<span data-ttu-id="4dedc-368">Добавление поддержки сети доставки контента (CDN)</span><span class="sxs-lookup"><span data-stu-id="4dedc-368">Add support for a content delivery network (CDN)</span></span>](add-cdn-support.md)

[<span data-ttu-id="4dedc-369">Включение обнаружения магазинов на основе местоположения</span><span class="sxs-lookup"><span data-stu-id="4dedc-369">Enable location-based store detection</span></span>](enable-store-detection.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]

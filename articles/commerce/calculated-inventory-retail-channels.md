---
title: Расчет наличия запасов для розничных каналов
description: В этой теме описывается, как компания может использовать Microsoft Dynamics 365 Commerce для просмотра оценки доступности продуктов в наличии в интерактивном режиме и в каналах магазина.
author: hhainesms
ms.date: 04/23/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: v-chgri
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: hhaines
ms.search.validFrom: 2020-02-11
ms.dyn365.ops.version: Release 10.0.10
ms.openlocfilehash: fdf6df7e393bcc401e770bd1b8afcaedcadc2660
ms.sourcegitcommit: 593438a145672c55ff6a910eabce2939300b40ad
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2021
ms.locfileid: "5937442"
---
# <a name="calculate-inventory-availability-for-retail-channels"></a><span data-ttu-id="233d5-103">Расчет наличия запасов для розничных каналов</span><span class="sxs-lookup"><span data-stu-id="233d5-103">Calculate inventory availability for retail channels</span></span>

[!include [banner](../includes/banner.md)]
[!include [banner](includes/preview-banner.md)]

<span data-ttu-id="233d5-104">В этой теме описывается, как компания может использовать Microsoft Dynamics 365 Commerce для просмотра оценки доступности продуктов в наличии в интерактивном режиме и в каналах магазина.</span><span class="sxs-lookup"><span data-stu-id="233d5-104">This topic describes how a company can use Microsoft Dynamics 365 Commerce to view estimated on-hand availability for products in the online and store channels.</span></span>

## <a name="accuracy-of-inventory-availability"></a><span data-ttu-id="233d5-105">Точность наличия запасов</span><span class="sxs-lookup"><span data-stu-id="233d5-105">Accuracy of inventory availability</span></span>

<span data-ttu-id="233d5-106">Для обеспечения масштабируемости и производительности Commerce использует несколько серверов и баз данных.</span><span class="sxs-lookup"><span data-stu-id="233d5-106">Commerce uses multiple servers and databases to ensure scalability and performance.</span></span> <span data-ttu-id="233d5-107">Таким образом, важно понимать, что доступные значения запасов, предоставляемые в приложении POS, интерфейсе прикладного программирования (API) доступности запасов электронной коммерции и на страницах запасов в наличии в Commerce Headquarters могут не быть точным на 100 процентов в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="233d5-107">Therefore, it's important that you understand that the available inventory values that are provided through the point of sale (POS) application, the e-commerce inventory availability application programming interfaces (APIs), and the on-hand inventory pages in Commerce headquarters might not be 100 percent accurate in real time.</span></span> <span data-ttu-id="233d5-108">Если транзакции, созданные для продуктов в интерактивном режиме или в канале магазина, еще не были синхронизованы с центральным офисом, то страницы запасов в наличии в центральном офисе могут не содержать точных значений запасов этих продуктов в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="233d5-108">If transactions that are created for products in the online or store channel haven't yet been synced to headquarters, the on-hand inventory pages in headquarters might not show an accurate real-time inventory value for those products.</span></span> <span data-ttu-id="233d5-109">И наоборот, если ваша компания настроена таким образом, что пользователи в центральном офисе или другие интегрированные приложения смогут продавать, получать, возвращать или иным образом корректировать складской запас из магазина или интерактивного склада, на POS-терминале или в интерактивном канале могут отсутствовать все сведения, необходимые для отображения точных значений для номенклатур в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="233d5-109">Conversely, if you configured your company so that users in headquarters or other integrated applications can sell, receive, return, or otherwise adjust inventory out of a store or online warehouse, the POS or online channel might not have all the information that is required to show accurate real-time values for items.</span></span>

<span data-ttu-id="233d5-110">Важно понимать, что все данные о доступности в наличии, предоставляемые в ходе рабочего дня, считаются оцененным значением.</span><span class="sxs-lookup"><span data-stu-id="233d5-110">It's critical to understand that all on-hand availability data that is provided during the operational day is considered an estimated value.</span></span> <span data-ttu-id="233d5-111">Таким образом, при попытке сравнить сведения о запасах в наличии, предоставляемые приложением, с фактическими физическими запасами на полках, или при попытке сравнить значения в наличии, которые отображаются в POS, с данными о запасах в наличии, которые вы нашли для того же склада в центральном офисе, значения могут отличаться.</span><span class="sxs-lookup"><span data-stu-id="233d5-111">Therefore, if you try to compare the on-hand inventory information that the application provides with actual physical inventory on the shelves, or if you try to compare the on-hand values that are shown in POS with the on-hand data that you find for the same warehouse in headquarters, the values might differ.</span></span> <span data-ttu-id="233d5-112">Эта разница в ходе рабочего дня является ожидаемой и не должна рассматриваться проблемой.</span><span class="sxs-lookup"><span data-stu-id="233d5-112">This difference during the operational day is expected and should not be considered an issue.</span></span> <span data-ttu-id="233d5-113">Если требуется проводить аудит данных и гарантировать, что значения, указанные в POS, интерфейсах API и центральном офисе, соответствуют реальным физическим единицам, находящимся на полках в магазинах или складах, то лучше всего сделать это после того, как операции канала будут остановлены в течение дня, и все транзакции были правильно синхронизированы между центральным офисом и каналами.</span><span class="sxs-lookup"><span data-stu-id="233d5-113">If you want to audit data and make sure that the values provided in POS, APIs, and headquarters match the actual physical units that you find on your store or warehouse shelves, the best time to do it is after channel operations have stopped for the day and all transactions have been correctly synced between headquarters and the channels.</span></span>

## <a name="channel-side-inventory-calculation"></a><span data-ttu-id="233d5-114">Расчет запасов на стороне канала</span><span class="sxs-lookup"><span data-stu-id="233d5-114">Channel-side inventory calculation</span></span>

<span data-ttu-id="233d5-115">Расчет запасов на стороне канала — это механизм, который принимает последние известные данные о запасах по каналам в Commerce Headquarters в качестве базового прогноза, а затем факторы в дополнительных изменениях запасов, произошедших на стороне канала, которые не включены в этот базовый прогноз для расчета оцененных запасов в наличии практически в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="233d5-115">The channel-side inventory calculation is a mechanism that takes the last-known channel inventory data in Commerce headquarters as a baseline, and then factors in additional inventory changes that occurred on the channel side that aren't included in that baseline to calculate a near-real-time estimated on-hand inventory.</span></span> 

<span data-ttu-id="233d5-116">Следующие изменения запасов в настоящее время учтены в логике расчета запасов на стороне канала:</span><span class="sxs-lookup"><span data-stu-id="233d5-116">The following inventory changes are currently considered in the channel-side inventory calculation logic:</span></span>

- <span data-ttu-id="233d5-117">Запасы, проданные через кассовые проводки в магазине</span><span class="sxs-lookup"><span data-stu-id="233d5-117">Inventory sold through cash-and-carry orders in store</span></span>
- <span data-ttu-id="233d5-118">Запасы, проданные через заказы клиентов в магазине или через интерактивный канал</span><span class="sxs-lookup"><span data-stu-id="233d5-118">Inventory sold through customer orders in store or online channel</span></span>
- <span data-ttu-id="233d5-119">Запасы, возвращенные в магазин</span><span class="sxs-lookup"><span data-stu-id="233d5-119">Inventory returned to store</span></span>
- <span data-ttu-id="233d5-120">Выполненные запасы (комплектация, упаковка, отгрузка) со склада магазина</span><span class="sxs-lookup"><span data-stu-id="233d5-120">Inventory fulfilled (pick, pack, ship) from store warehouse</span></span>

<span data-ttu-id="233d5-121">Чтобы использовать расчет запасов на стороне канала, в качестве необходимого компонента периодический моментальный снимок данных о запасах из центрального офиса, созданный заданием **Доступность продукта**, должен быть отправлен в базы данных канала.</span><span class="sxs-lookup"><span data-stu-id="233d5-121">To use the channel-side inventory calculation, as a prerequisite a periodic snapshot of inventory data from headquarters created by the **Product availability** job must be sent to the channel databases.</span></span> <span data-ttu-id="233d5-122">Моментальный снимок представляет сведения, которыми центральный офис обладает о доступности запасов для определенной комбинации продукта или варианта продукта и склада.</span><span class="sxs-lookup"><span data-stu-id="233d5-122">The snapshot represents the information that headquarters has about inventory availability for a specific combination of a product or product variant and a warehouse.</span></span> <span data-ttu-id="233d5-123">Он включает только проводки по запасам, которые были обработаны и разнесены в центральном офисе в момент создания моментального снимка, и в реальном времени может быть не на 100% точным из-за постоянной обработки продаж, которая происходит на распределенных серверах.</span><span class="sxs-lookup"><span data-stu-id="233d5-123">It includes only the inventory transactions that were processed and posted in headquarters at the time when the snapshot was taken, and it might not be 100 percent accurate in real time because of the constant sales processing that occurs across distributed servers.</span></span>

- <span data-ttu-id="233d5-124">Если запасы были проданы для продукта в магазине с помощью кассовой или асинхронной продажи по заказу клиента в приложении POS, в центральном офисе сразу не появятся сведения о соответствующей проводке отпуска запасов для данной продажи.</span><span class="sxs-lookup"><span data-stu-id="233d5-124">If inventory was sold for a product in a store through a cash-and-carry or asynchronous customer order sale in the POS application, headquarters won't immediately have information about the related inventory issue transaction for the sale.</span></span> <span data-ttu-id="233d5-125">Центральный офис будет содержать информацию о запасе, который продается для этих типов продаж магазина только после того, как P-задание загружает связанную проводку из базы данных канала магазина в центральный офис, а соответствующие заказы на продажу создаются с помощью разноски журнала операций или процессов поточной разноски.</span><span class="sxs-lookup"><span data-stu-id="233d5-125">Headquarters will have information about the inventory that is sold for these types of store sales only after the P-job uploads the related transaction from the store's channel database into headquarters and the related sales orders are created through statement posting or the trickle feed posting processes.</span></span> <span data-ttu-id="233d5-126">Процесс создания заказа в центральном офисе создает соответствующие проводки по запасам.</span><span class="sxs-lookup"><span data-stu-id="233d5-126">The process of creating the orders in headquarters creates the related inventory transactions.</span></span> 
- <span data-ttu-id="233d5-127">Для заказов каналов электронной коммерции центральный офис содержит сведения о проводках по запасам только после того, как проводки отправлены в центральный офис через P-задание и процесс синхронизации заказов завершен.</span><span class="sxs-lookup"><span data-stu-id="233d5-127">For e-commerce channel orders, headquarters has information about the inventory transactions only after the transactions are sent to headquarters through the P-job and the order synchronization process is completed.</span></span>

<span data-ttu-id="233d5-128">Чтобы создать моментальный снимок запасов в центральном офисе, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="233d5-128">To take a snapshot of inventory in Commerce headquarters, follow these steps.</span></span>

1. <span data-ttu-id="233d5-129">Перейдите в **Retail и Commerce \> ИТ Retail и Commerce \> Продукты и запасы \> Доступность продукта**.</span><span class="sxs-lookup"><span data-stu-id="233d5-129">Go to **Retail and Commerce \> Retail and Commerce IT \> Products and inventory \> Product availability**.</span></span>
1. <span data-ttu-id="233d5-130">Нажмите кнопку **ОК**, чтобы выполнить задание **Доступность продукта**.</span><span class="sxs-lookup"><span data-stu-id="233d5-130">Select **OK** to run the **Product availability** job.</span></span> <span data-ttu-id="233d5-131">Можно также запланировать выполнение этого задания в пакетном режиме.</span><span class="sxs-lookup"><span data-stu-id="233d5-131">You can also schedule this job to run in batch.</span></span>

<span data-ttu-id="233d5-132">После завершения выполнения задания **Доступность продукта** собранные данные должны быть отправлены в базы данных канала, чтобы при расчете оцененных запасов в наличии со стороны канала учитывался последний моментальный снимок запасов центрального офиса.</span><span class="sxs-lookup"><span data-stu-id="233d5-132">After the **Product availability** job has finished running, the data that was captured must be pushed to the channel databases, so that the latest headquarters inventory snapshot can be considered in the channel-side calculation of estimated on-hand inventory.</span></span>

<span data-ttu-id="233d5-133">Чтобы синхронизировать данные моментального снимка из центрального офиса с базами данных канала, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="233d5-133">To sync snapshot data from headquarters to your channel databases, follow these steps.</span></span>

1. <span data-ttu-id="233d5-134">Перейдите в раздел **Retail и Commerce \> ИТ Retail и Commerce \> График распределения**.</span><span class="sxs-lookup"><span data-stu-id="233d5-134">Go to **Retail and Commerce \> Retail and Commerce IT \> Distribution schedule**.</span></span>
1. <span data-ttu-id="233d5-135">Выполните задание **1130** (**Доступность продукта**) для синхронизации данных моментального снимка, которые задание **Доступность продукта** создало из центрального офиса в базах данных канала.</span><span class="sxs-lookup"><span data-stu-id="233d5-135">Run the **1130** (**Product availability**) job to sync the snapshot data that the **Product availability** job has created from headquarters to your channel databases.</span></span>

## <a name="inventory-availability-apis-for-e-commerce"></a><span data-ttu-id="233d5-136">API доступности запасов для электронной коммерции</span><span class="sxs-lookup"><span data-stu-id="233d5-136">Inventory availability APIs for e-commerce</span></span>

<span data-ttu-id="233d5-137">Commerce предоставляет следующие интерфейсы API для сценариев электронной коммерции для запроса доступности продукта в запасах:</span><span class="sxs-lookup"><span data-stu-id="233d5-137">Commerce provides the following APIs for e-commerce scenarios to query inventory availability of a product:</span></span>

- <span data-ttu-id="233d5-138">**GetEstimatedAvailability** — этот API используется для запроса запасов для продукта или варианта продукта на складе или складах интернет-канала, связанных с группой выполнения интернет-канала.</span><span class="sxs-lookup"><span data-stu-id="233d5-138">**GetEstimatedAvailability** – Use this API to query inventory for a product or product variant in the online channel warehouse or warehouses that are linked to the online channel's fulfillment group.</span></span>
- <span data-ttu-id="233d5-139">**GetEstimatedProductWarehouseAvailability** — этот API используется для запроса запасов для продукта или варианта продукта с конкретного склада.</span><span class="sxs-lookup"><span data-stu-id="233d5-139">**GetEstimatedProductWarehouseAvailability** – Use this API to query inventory for a product or product variant from a specific warehouse.</span></span>

> [!NOTE]
> <span data-ttu-id="233d5-140">Эти API-интерфейсы заменяют API-интерфейсы **GetProductAvailabilities** и **GetAvailableInventoryNearby** в Commerce версии 10.0.7 и более ранних версиях.</span><span class="sxs-lookup"><span data-stu-id="233d5-140">These APIs replace the **GetProductAvailabilities** and **GetAvailableInventoryNearby** APIs in Commerce release 10.0.7 and earlier.</span></span>

<span data-ttu-id="233d5-141">Оба интерфейса API служат для внутреннего использования логики вычисления на стороне канала и возвращают расчетное **физически доступное** количество, **общее доступное** количество, **единицу измерения** и **уровень запасов** для запрошенного продукта и склада.</span><span class="sxs-lookup"><span data-stu-id="233d5-141">Both APIs internally use the channel-side calculation logic and return estimated **physical available** quantity, **total available** quantity, **unit of measure (UoM)**, and **inventory level** for the requested product and warehouse.</span></span> <span data-ttu-id="233d5-142">Возвращенные значения могут отображаться на сайте электронной коммерции, если это необходимо, или они могут использоваться для запуска другой бизнес-логики на сайте электронной коммерции.</span><span class="sxs-lookup"><span data-stu-id="233d5-142">The returned values can be shown on your e-commerce site if you want, or they can be used to trigger other business logic on your e-commerce site.</span></span> <span data-ttu-id="233d5-143">Например, можно отменить покупку продуктов на уровне запасов "нет в наличии".</span><span class="sxs-lookup"><span data-stu-id="233d5-143">For example, you can prevent the purchase of products with an "out of stock" inventory level.</span></span>

<span data-ttu-id="233d5-144">Хотя другие API-интерфейсы, доступные в Commerce, могут переходить непосредственно в центральный офис для извлечения количества в наличии для продуктов, мы не рекомендуем использовать их в среде электронной коммерции, поскольку имеются потенциальные проблемы с производительностью и связанного с этим влияния, которое эти частые запросы могут оказывать на ваши серверы центрального офиса.</span><span class="sxs-lookup"><span data-stu-id="233d5-144">Although other APIs that are available in Commerce can go directly to headquarters to fetch on-hand quantities for products, we don't recommend that they be used in an e-commerce environment because of potential performance issues and the impact that these frequent requests can have on your headquarters servers.</span></span> <span data-ttu-id="233d5-145">Кроме того, при расчете на стороне канала два упомянутых выше интерфейса API могут обеспечить более точную оценку доступности продукта, принимая во внимание проводки, созданные в каналах, которые еще не были известны в центральном офисе.</span><span class="sxs-lookup"><span data-stu-id="233d5-145">Additionally, with channel-side calculation, the two APIs mentioned above can provide a more accurate estimate of a product's availability by taking into account the transactions created in the channels that aren’t yet known to headquarters.</span></span>

<span data-ttu-id="233d5-146">Перед использованием двух API-интерфейсов, упомянутых ранее, необходимо включить функцию **оптимизированный расчет доступности продукта** в рабочей области **Управление функциями** в центральном офисе.</span><span class="sxs-lookup"><span data-stu-id="233d5-146">To use the two APIs, you must enable the **Optimized product availability calculation** feature through the **Feature management** workspace in headquarters.</span></span> <span data-ttu-id="233d5-147">Если в Интернете и в магазинах используются одни и те же склады выполнения, необходимо также включить функцию **Расширенная логика расчета запасов на стороне канала в электронной коммерции**, чтобы использовать логику расчета на стороне канала в двух интерфейсах API для коэффициента в неразнесенных проводках (кассовые проводки, клиентские заказы, возвраты), созданные в канале магазина.</span><span class="sxs-lookup"><span data-stu-id="233d5-147">If your online and store channels use the same fulfillment warehouses, you must also enable the **Enhanced e-Commerce channel-side inventory calculation logic** feature to have the channel-side calculation logic within the two APIs to factor in the unposted transactions (cash-and-carry, customer orders, returns) created in the store channel.</span></span> <span data-ttu-id="233d5-148">После включения этих функций необходимо выполнить задание **1070** (**Конфигурация канала**).</span><span class="sxs-lookup"><span data-stu-id="233d5-148">You will need to run the **1070** (**Channel configuration**) job after enabling these features.</span></span>

<span data-ttu-id="233d5-149">Чтобы определить, как должно возвращаться количество продукции в выходных данных API, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="233d5-149">To define how product quantity should be returned in the API output, follow these steps.</span></span>

1. <span data-ttu-id="233d5-150">Перейдите в раздел **Retail и Commerce \> Настройка центрального офиса \> Параметры \> Параметры Commerce**.</span><span class="sxs-lookup"><span data-stu-id="233d5-150">Go to **Retail and Commerce \> Headquarters setup \> Parameters \> Commerce parameters**.</span></span>
1. <span data-ttu-id="233d5-151">Выберите вкладку **Запасы**, а затем на экспресс-вкладке **API доступности запасов для электронной торговли** настройте значение в параметрах **Количество в выходных данных API**.</span><span class="sxs-lookup"><span data-stu-id="233d5-151">Select the **Inventory** tab, and then on the **Inventory availability APIs for e-Commerce** FastTab configure the value of the **Quantity in API output** setting.</span></span>
1. <span data-ttu-id="233d5-152">Запустите задание **1070** (**Конфигурация канала**) для синхронизации последнего параметра с каналами.</span><span class="sxs-lookup"><span data-stu-id="233d5-152">Run the **1070** (**Channel configuration**) job to sync the latest setting to channels.</span></span>

<span data-ttu-id="233d5-153">Параметр **Количество в выходных данных API** имеет три варианта:</span><span class="sxs-lookup"><span data-stu-id="233d5-153">The **Quantity in API output** setting provides three options:</span></span>

- <span data-ttu-id="233d5-154">**Возврат количества запасов** — физически доступное и общее доступное количество запрошенного продукта, возвращаемые в выходных данных API.</span><span class="sxs-lookup"><span data-stu-id="233d5-154">**Return inventory quantity** - Physical available and total available quantity of a requested product are returned in API output.</span></span>
- <span data-ttu-id="233d5-155">**Возврат количества запасов минус буфер запасов** — количество, возвращенное в выходных данных API, корректируется путем вычитания значения буфера запасов.</span><span class="sxs-lookup"><span data-stu-id="233d5-155">**Return inventory quantity subtracting inventory buffer** - The quantity returned in the API output is adjusted by subtracting the inventory buffer value.</span></span> <span data-ttu-id="233d5-156">Дополнительные сведения о буфере запасов см. в разделе [Настройка буферов запасов и уровней запасов](inventory-buffers-levels.md).</span><span class="sxs-lookup"><span data-stu-id="233d5-156">For more information about the inventory buffer, see [Configure inventory buffers and inventory levels](inventory-buffers-levels.md).</span></span>
- <span data-ttu-id="233d5-157">**Не возвращать количество запасов** — в выходных данных API возвращается только уровень запасов.</span><span class="sxs-lookup"><span data-stu-id="233d5-157">**Not return inventory quantity** - Only the inventory level is returned in the API output.</span></span> <span data-ttu-id="233d5-158">Дополнительные сведения об уровнях запасов см. в разделе [Настройка буферов запасов и уровней запасов](inventory-buffers-levels.md).</span><span class="sxs-lookup"><span data-stu-id="233d5-158">For more information about inventory levels, see [Configure inventory buffers and inventory levels](inventory-buffers-levels.md).</span></span>

<span data-ttu-id="233d5-159">Можно использовать параметр API `QuantityUnitTypeValue` для указания типа единицы, в которой API должны вернуть количество.</span><span class="sxs-lookup"><span data-stu-id="233d5-159">You can use the `QuantityUnitTypeValue` API parameter to specify the unit type in which you would like the APIs to return quantity.</span></span> <span data-ttu-id="233d5-160">Этот параметр поддерживает значения **единица измерения складского учета** (по умолчанию), **единица покупки** и **единица продажи**.</span><span class="sxs-lookup"><span data-stu-id="233d5-160">This parameter supports the **inventory unit** (default), **purchase unit**, and **sell unit** options.</span></span> <span data-ttu-id="233d5-161">Возвращенное количество округляется до определенной точности соответствующей единицы измерения в центральном офисе.</span><span class="sxs-lookup"><span data-stu-id="233d5-161">The returned quantity is rounded to the defined precision of the corresponding unit of measure (UOM) in headquarters.</span></span>

<span data-ttu-id="233d5-162">API **GetEstimatedAvailability** предлагает следующие входные параметры для поддержки других сценариев запросов:</span><span class="sxs-lookup"><span data-stu-id="233d5-162">The **GetEstimatedAvailability** API offers the following input parameters to support different query scenarios:</span></span>

- <span data-ttu-id="233d5-163">`DefaultWarehouseOnly` — этот параметр используется для запроса запасов для продукта на складе по умолчанию для интернет-канала.</span><span class="sxs-lookup"><span data-stu-id="233d5-163">`DefaultWarehouseOnly` - Use this parameter to query inventory for a product in the online channel's default warehouse.</span></span> 
- <span data-ttu-id="233d5-164">`FilterByChannelFulfillmentGroup` и `SearchArea` — эти два параметра используются для запроса запасов для продукта из всех местоположений отправки в определенной области поиска на основе `longitude`, `latitude` и `radius`.</span><span class="sxs-lookup"><span data-stu-id="233d5-164">`FilterByChannelFulfillmentGroup` and `SearchArea` - Use these two parameters to query inventory for a product from all pickup locations within a specific search area, based on `longitude`, `latitude`, and `radius`.</span></span> 
- <span data-ttu-id="233d5-165">`FilterByChannelFulfillmentGroup` и `DeliveryModeTypeFilterValue` — эти два параметра используются для запроса запасов продукта с определенных складов, связанных с группой выполнения интернет-канала, и настроены на поддержку определенных режимов доставки.</span><span class="sxs-lookup"><span data-stu-id="233d5-165">`FilterByChannelFulfillmentGroup` and `DeliveryModeTypeFilterValue` - Use these two parameters to query inventory for a product from specific warehouses that are linked to an online channel's fulfillment group and are configured to support certain modes of delivery.</span></span> <span data-ttu-id="233d5-166">Параметр `DeliveryModeTypeFilterValue` поддерживает значения **все** (по умолчанию), **отгрузка** и **отправка**.</span><span class="sxs-lookup"><span data-stu-id="233d5-166">The `DeliveryModeTypeFilterValue` parameter supports the **all** (default), **shipping**, and **pickup** options.</span></span> <span data-ttu-id="233d5-167">Например, в ситуации, когда интернет-заказ может быть выполнен из нескольких складов отгрузки, можно использовать эти два параметра для запроса доступности продукта на всех складах отгрузки.</span><span class="sxs-lookup"><span data-stu-id="233d5-167">For example, in a scenario where an online order can be fulfilled from multiple shipping warehouses, you can use these two parameters to query a product's inventory availability in all of those shipping warehouses.</span></span> <span data-ttu-id="233d5-168">В этом случае в интерфейсе API возвращается количество продукта в наличии и уровень запасов в наличии для каждого склада отгрузки, а также агрегированное количество и суммарный уровень запасов со всех складов отгрузки в области запроса.</span><span class="sxs-lookup"><span data-stu-id="233d5-168">The API in this case returns the product's on-hand quantity and inventory level in each of the shipping warehouses, plus an aggregated quantity and an aggregated inventory level from all shipping warehouses in the query scope.</span></span>
 
<span data-ttu-id="233d5-169">Модули Commerce поля покупки, выбора магазина, списка желаемого, корзины и значка корзины используют API и параметры, упомянутые выше, для отображения сообщений об уровне запасов на сайте электронной коммерции.</span><span class="sxs-lookup"><span data-stu-id="233d5-169">The Commerce buy box, store selector, wishlist, cart, and cart icon modules consume the APIs and parameters mentioned above to display inventory level messages across the e-commerce site.</span></span> <span data-ttu-id="233d5-170">Конструктор сайтов Commerce предоставляет различные параметры запасов для управления сбытом и покупками.</span><span class="sxs-lookup"><span data-stu-id="233d5-170">Commerce site builder provides various inventory settings to control merchandising and purchase behavior.</span></span> <span data-ttu-id="233d5-171">Для получения дополнительной информации о см. раздел [Применение настроек запасов](inventory-settings.md).</span><span class="sxs-lookup"><span data-stu-id="233d5-171">For more information, see [Apply inventory settings](inventory-settings.md).</span></span>

## <a name="pos-inventory-lookup-with-channel-side-calculation"></a><span data-ttu-id="233d5-172">Поиск запасов POS с расчетом на стороне канала</span><span class="sxs-lookup"><span data-stu-id="233d5-172">POS inventory lookup with channel-side calculation</span></span>

<span data-ttu-id="233d5-173">В Commerce версии 10.0.9 и более ранних, операция **Поиск запасов** в POS использовала вызов службы в реальном времени в центральном офисе для получения сведений о запасах для выбранного продукта, для текущего магазина пользователя и других магазинов, настроенных для группы выполнения в рамках конфигурации канала магазина.</span><span class="sxs-lookup"><span data-stu-id="233d5-173">In the Commerce release 10.0.9 and earlier, the **Inventory lookup** operation in POS used a real-time service call to headquarters to get inventory information for the selected product for both the user's current store and any other stores that are configured for the fulfillment group as part of the channel configuration for the store.</span></span> <span data-ttu-id="233d5-174">В Commerce версии 10.0.10 и более поздних версиях можно выключить вызовы службы в реальном времени для центрального офиса и вместо этого использовать расчет на стороне каналов на сервере Commerce, чтобы определить запасы в наличии, которые физически доступны для магазина и всех остальных местоположений, которые заданы в группе выполнения.</span><span class="sxs-lookup"><span data-stu-id="233d5-174">In Commerce release 10.0.10 and later, you can turn off real-time service calls to headquarters and instead use channel-side calculation on the Commerce server to determine the on-hand inventory that is physically available for the store and any other locations that are defined in the fulfillment group.</span></span> <span data-ttu-id="233d5-175">Эта конфигурация запасов, рассчитанная по каналам, также полезна для тех местоположений, в которых подключение к Интернету ненадежно, так как нет необходимости в интерактивном режиме получать поиск запасов из центрального офиса.</span><span class="sxs-lookup"><span data-stu-id="233d5-175">This channel-calculated inventory configuration is also useful for locations where internet connectivity is unreliable, because you don't have to be online to get inventory lookups headquarters.</span></span>

<span data-ttu-id="233d5-176">Когда расчет на стороне канала правильно настроен и управляется, он может обеспечить более надежную оценку текущих запасов магазина, так как в нем используются данные о проводках, которые находятся в базе данных канала Commerce, но в центральном офисе еще могут отсутствовать сведения об этом.</span><span class="sxs-lookup"><span data-stu-id="233d5-176">When channel-side calculation is correctly configured and managed, it can provide a more reliable estimate of the current store inventory because it uses the transactional data that is in the Commerce channel database but that headquarters might not yet have information about.</span></span> <span data-ttu-id="233d5-177">Например, если вы используете существующий вызов службы в реальном времени для поиска запасов в POS, центральный офис, вероятно, не будет содержать сведений о кассовых продажах, которые были только что выполнены для продукта.</span><span class="sxs-lookup"><span data-stu-id="233d5-177">For example, if you use the existing real-time service call for inventory lookups in POS, headquarters probably won't yet have information about a cash-and-carry sale that just occurred for a product.</span></span> <span data-ttu-id="233d5-178">Таким образом, стоимость запасов в наличии, которую центральный офисе возвращает для этого продукта, скорее всего превысит фактические запасы в наличии для магазина на одну единицу.</span><span class="sxs-lookup"><span data-stu-id="233d5-178">Therefore, the on-hand inventory value that headquarters returns for that product will probably exceed the store's actual on-hand inventory by one unit.</span></span> <span data-ttu-id="233d5-179">Однако при использовании расчета на стороне канала, кассовая продажа может быть учтена в расчете и вычтена из отображаемого значения в наличии.</span><span class="sxs-lookup"><span data-stu-id="233d5-179">However, if you use channel-side calculation, the cash-and-carry sale can be factored into the calculation and deducted from the on-hand value that is shown.</span></span> <span data-ttu-id="233d5-180">Несмотря на то что значения, которые предоставляют как вычисления на стороне канала, так и вызов службы в реальном времени, являются только оценками запасов в наличии, значение, предоставляемое при вычислении на стороне канала, с большей вероятностью будет точным для текущего магазина.</span><span class="sxs-lookup"><span data-stu-id="233d5-180">Although the values that both the channel-side calculation and the real-time service call provide are only estimates of on-hand inventory, the value that the channel-side calculation provides is much more likely to be accurate for the current store.</span></span>

<span data-ttu-id="233d5-181">Чтобы настроить операцию **поиска запасов** POS в центральном офисе для использования логики вычисления на стороне канала и выключить вызов службы в реальном времени, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="233d5-181">To configure the POS **Inventory lookup** operation in headquarters to use the channel-side calculation logic and turn off real-time service call, follow these steps.</span></span>

1. <span data-ttu-id="233d5-182">Перейдите в раздел **Retail и Commerce \> Настройка канала \> Настройка POS \> Профили POS \> Профили функциональности**.</span><span class="sxs-lookup"><span data-stu-id="233d5-182">Go to **Retail and Commerce \> Channel setup \> POS setup \> POS profiles \> Functionality profiles**.</span></span>
1. <span data-ttu-id="233d5-183">Выберите профиль функциональности.</span><span class="sxs-lookup"><span data-stu-id="233d5-183">Select a functionality profile.</span></span>
1. <span data-ttu-id="233d5-184">На экспресс-вкладке **функции** в разделе **Расчет наличия запасов** измените значение поля **Режим расчета наличия запасов** с **Служба реального времени** на **Канал**.</span><span class="sxs-lookup"><span data-stu-id="233d5-184">On the **Functions** FastTab, in the **Inventory availability calculation** section, change the value of **Inventory availability calculation mode** from **Real time service** to **Channel**.</span></span> <span data-ttu-id="233d5-185">По умолчанию все профили функциональности используют вызовы службы в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="233d5-185">By default, all functionality profiles use real-time service calls.</span></span> <span data-ttu-id="233d5-186">Необходимо изменить значение этого поля, если необходимо использовать логику расчета на стороне канала.</span><span class="sxs-lookup"><span data-stu-id="233d5-186">You must change the value of this field if you want to use channel-side calculation logic.</span></span> <span data-ttu-id="233d5-187">Данное изменение повлияет на все розничные магазины, связанные с выбранным профилем функциональности.</span><span class="sxs-lookup"><span data-stu-id="233d5-187">Every retail store that is linked to the selected functionality profile will be affected by this change.</span></span>

<span data-ttu-id="233d5-188">Затем необходимо синхронизировать изменения в каналах в рамках процесса графика распределения в центральном офисе, выполнив следующие шаги.</span><span class="sxs-lookup"><span data-stu-id="233d5-188">You must then sync the changes to the channels through the distribution schedule process in headquarters by following these steps.</span></span>

1. <span data-ttu-id="233d5-189">Перейдите в раздел **Retail и Commerce \> ИТ Retail и Commerce \> График распределения**.</span><span class="sxs-lookup"><span data-stu-id="233d5-189">Go to **Retail and Commerce \> Retail and Commerce IT \> Distribution schedule**.</span></span>
1. <span data-ttu-id="233d5-190">Выполните задание **1070** (**конфигурация канала**).</span><span class="sxs-lookup"><span data-stu-id="233d5-190">Run the **1070** (**Channel configuration**) job.</span></span>

<span data-ttu-id="233d5-191">После завершения настройки сведения, предоставляемые о физически доступных запасах, больше не используют вызов службы в реальном времени, когда пользователь в приложении POS использует операцию **Поиск запасов** (стандартное и матричное представление).</span><span class="sxs-lookup"><span data-stu-id="233d5-191">After the configuration is completed, the information that is provided about physically available inventory no longer uses a real-time service call when a user in the POS application uses the **Inventory lookup** operation (standard and matrix views).</span></span> <span data-ttu-id="233d5-192">Вместо этого данные о физически доступных запасах для текущего магазина и всех магазинов в группе выполнения рассчитываются на основе последнего известного снимка, который был доставлен в базу данных канала из Commerce Headquarters.</span><span class="sxs-lookup"><span data-stu-id="233d5-192">Instead, data about physically available inventory for the current store and all the stores in the fulfillment group is calculated based on the last-known snapshot that was delivered to the channel database from Commerce Headquarters.</span></span> <span data-ttu-id="233d5-193">Значение моментального снимка в дальнейшем будет уточнено с помощью расчета на стороне канала для корректировки физически доступного значения на основе дополнительных проводок по продажам или возвратам, которые существуют для выбранного продукта в базе данных канала, которые не были включены в последний синхронизированный моментальный снимок из задания 1130.</span><span class="sxs-lookup"><span data-stu-id="233d5-193">The snapshot value is further refined by the channel-side calculation to adjust the physically available value, based on additional sales or return transactions that exist for the selected product in the channel database that were not included in the last synchronized snapshot from the 1130 job.</span></span> <span data-ttu-id="233d5-194">Если база данных канала не содержит транзакционных данных для каких-либо складов или магазинов в группе выполнения, она не содержит дополнительных транзакций, которые могут быть учтены в пересчете значения.</span><span class="sxs-lookup"><span data-stu-id="233d5-194">If the channel database doesn't contain transactional data for any of the warehouses or stores in the fulfillment group, it contains no additional transactions that can be factored into a recalculation of the value.</span></span> <span data-ttu-id="233d5-195">Таким образом, наилучшей оценкой запасов в наличии, которые могут быть показаны для складов или магазинов, являются данные из последнего моментального снимка Commerce Headquarters.</span><span class="sxs-lookup"><span data-stu-id="233d5-195">Therefore, the best estimate of on-hand inventory that can be shown for those warehouses or stores is the data from the last-known Commerce Headquarters snapshot.</span></span>

<span data-ttu-id="233d5-196">Экраны **Выполнение заказов** в POS также используют расчет на стороне канала для отображения запасов в наличии для номенклатур, когда выбрана строка выполнения заказа, и пользователь просматривает панель **Подробно** для запасов в наличии для выбранной номенклатуры.</span><span class="sxs-lookup"><span data-stu-id="233d5-196">The **Order fulfillment** screens of POS also leverage the channel side calculation to show on-hand inventory for items when an order fulfillment line is selected and a user views the **Details** panel for on-hand inventory for the selected item.</span></span>

## <a name="optimize-your-inventory-data"></a><span data-ttu-id="233d5-197">Оптимизируйте данные по запасам</span><span class="sxs-lookup"><span data-stu-id="233d5-197">Optimize your inventory data</span></span>

<span data-ttu-id="233d5-198">Для обеспечения наилучшей оценки запасов важно использовать следующие пакетные задания Commerce и выполнять их часто:</span><span class="sxs-lookup"><span data-stu-id="233d5-198">To ensure the best possible estimate of inventory, it's critical that you use the following Commerce batch jobs and run them frequently:</span></span>

- <span data-ttu-id="233d5-199">**P-задание** — P-задание находится на странице **Планы распределения** и должно запускаться часто.</span><span class="sxs-lookup"><span data-stu-id="233d5-199">**P-job** – The P-job is found on the **Distribution schedules** page and should be run frequently.</span></span> <span data-ttu-id="233d5-200">В этом задании отображаются заказы электронной коммерции, асинхронные заказы клиентов, созданные POS, а также кассовые заказы, которые были созданы POS из баз данных канала в Commerce Headquarters, чтобы их можно было обработать в дальнейшем.</span><span class="sxs-lookup"><span data-stu-id="233d5-200">This job brings e-Commerce orders, asynchronous customer orders that POS created, and cash-and-carry orders that POS created from the channel databases into Commerce Headquarters, so that they can be processed further.</span></span> <span data-ttu-id="233d5-201">До тех пор, пока эти данные не будут синхронизированы из канала в Commerce Headquarters, в Commerce Headquarters нет сведений о корректировках запасов для продуктов на складах, которые являются результатом этих транзакций.</span><span class="sxs-lookup"><span data-stu-id="233d5-201">Until this data is synced from the channel to Commerce Headquarters, Commerce Headquarters has no information about inventory adjustments to products in the warehouses that result from those transactions.</span></span>
- <span data-ttu-id="233d5-202">**Синхронизация заказов** — это задание обрабатывает необработанные транзакционные данные в Commerce Headquarters о том, которые обеспечивает P-задание и конвертирует проводки заказов электронной коммерции и асинхронных заказов клиентов в заказы на продажу в Commerce Headquarters.</span><span class="sxs-lookup"><span data-stu-id="233d5-202">**Synchronize orders** – This job processes the raw transactional data in Commerce Headquarters that the P-job provides and converts e-Commerce and asynchronous customer order transactions into sales orders in Commerce Headquarters.</span></span> <span data-ttu-id="233d5-203">Пока это задание не будет обработано, а заказы на продажу созданы, проводки по запасам создаваться не будут.</span><span class="sxs-lookup"><span data-stu-id="233d5-203">Until this job is processed and the sales orders are created, no inventory transactions are created.</span></span> <span data-ttu-id="233d5-204">Таким образом, запасы в наличии в Commerce Headquarters не будут учитывать проводки.</span><span class="sxs-lookup"><span data-stu-id="233d5-204">Therefore, on-hand inventory in Commerce Headquarters won't consider the transactions.</span></span>
- <span data-ttu-id="233d5-205">**Пакетный расчет журналов проводок** — для кассовых проводок, созданных в магазине, процесс поточной разноски обеспечивает эффективное обновление запасов, относящихся к продажам.</span><span class="sxs-lookup"><span data-stu-id="233d5-205">**Calculate transactional statements in batch** – For cash-and-carry transactions that are created in the store, the trickle feed posting process ensures that inventory that is related to the sales is updated efficiently.</span></span> <span data-ttu-id="233d5-206">Чтобы наиболее эффективно обрабатывать проводки по запасам для кассовых заказов, убедитесь, что ваша система настроена на использование [потоковой разноски](./trickle-feed.md).</span><span class="sxs-lookup"><span data-stu-id="233d5-206">To get the most efficient processing of inventory transactions for cash-and-carry orders, make sure that you configure your system to use [trickle feed posting](./trickle-feed.md).</span></span>
- <span data-ttu-id="233d5-207">**Пакетная разноска журналов проводок** — это задание также необходимо для пакетной разноски.</span><span class="sxs-lookup"><span data-stu-id="233d5-207">**Post transactional statements in batch** – This job is also required for trickle feed posting.</span></span> <span data-ttu-id="233d5-208">Далее следует задание **Пакетный расчет журналов проводок**.</span><span class="sxs-lookup"><span data-stu-id="233d5-208">It follows the **Calculate transactional statements in batch** job.</span></span> <span data-ttu-id="233d5-209">Это задание систематически разносит рассчитанные выписки, так что заказы на продажу для кассовых продаж создаются в Commerce Headquarters, а Commerce Headquarters более точно отражает запасы магазина.</span><span class="sxs-lookup"><span data-stu-id="233d5-209">This job systematically posts the calculated statements, so that sales orders for cash-and-carry sales are created in Commerce Headquarters and Commerce Headquarters more accurately reflects your store's inventory.</span></span>
- <span data-ttu-id="233d5-210">**Доступность продукта** — это задание создает моментальный снимок запасов из Commerce Headquarters.</span><span class="sxs-lookup"><span data-stu-id="233d5-210">**Product availability** – This job creates the snapshot of inventory from Commerce Headquarters.</span></span>
- <span data-ttu-id="233d5-211">**1130 (Доступность продукта)** — это задание находится на странице **Планы распределения** и должно запускаться сразу после задания **Доступность продукта**.</span><span class="sxs-lookup"><span data-stu-id="233d5-211">**1130 (Product availability)** – This job is found on the **Distribution schedules** page and should be run immediately after the **Product availability** job.</span></span> <span data-ttu-id="233d5-212">Это задание позволяет переносить данные моментального снимка запасов из Commerce Headquarters в базы данных канала.</span><span class="sxs-lookup"><span data-stu-id="233d5-212">This job transports the inventory snapshot data from Commerce Headquarters to the channel databases.</span></span>

> [!NOTE]
> - <span data-ttu-id="233d5-213">Рекомендуется выполнять задания **Доступность продукта** и **1130** каждый час, а также планировать P-задания, синхронизировать заказы и задания потоковой разноски, с такой же или более высокой частотой.</span><span class="sxs-lookup"><span data-stu-id="233d5-213">It is a best practice to run the **Product availability** and **1130** jobs on an hourly basis, and to schedule P-job, synchronize orders, and trickle feed posting-related jobs with the same or higher frequency.</span></span>
> - <span data-ttu-id="233d5-214">Для повышения производительности при использовании расчета наличия запасов на стороне канала для создания запроса доступности запасов с помощью API-интерфейса электронной коммерции или логики запасов канала POS в расчете используется кэш, чтобы определить, прошло ли достаточно времени, чтобы оправдать повторное выполнение логики расчета.</span><span class="sxs-lookup"><span data-stu-id="233d5-214">For performance reasons, when channel-side inventory availability calculations are used to make an inventory availability request using the e-Commerce API's or the POS channel-side inventory logic, the calculation uses a cache to determine whether enough time has passed to justify running the calculation logic again.</span></span> <span data-ttu-id="233d5-215">В качестве значения кэша по умолчанию задано 60.</span><span class="sxs-lookup"><span data-stu-id="233d5-215">The default cache is set to 60 seconds.</span></span> <span data-ttu-id="233d5-216">Например, вы включили расчет на стороне канала для магазина и просмотрели запасы в наличии для продукта на странице **Поиск запасов**.</span><span class="sxs-lookup"><span data-stu-id="233d5-216">For example, you turned on channel-side calculation for your store and viewed the on-hand inventory for a product on the **Inventory lookup** page.</span></span> <span data-ttu-id="233d5-217">Если одна единица продукта будет продана, на странице **Поиск запасов** не будет отображаться сокращенный запас до тех пор, пока не будет очищен кэш.</span><span class="sxs-lookup"><span data-stu-id="233d5-217">If one unit of the product is then sold, the **Inventory lookup** page won't show the reduced inventory until the cache has been cleared.</span></span> <span data-ttu-id="233d5-218">После разноски проводок пользователями в POS, они должны подождать 60 секунд, прежде чем убедиться в том, что запасы в наличии были сокращены.</span><span class="sxs-lookup"><span data-stu-id="233d5-218">After users post transactions in POS, they should wait 60 seconds before they verify that the on-hand inventory has been reduced.</span></span>

<span data-ttu-id="233d5-219">Если бизнес-сценарий требует меньшее время кэширования, обратитесь за помощью к представителю службы поддержки продукта.</span><span class="sxs-lookup"><span data-stu-id="233d5-219">If your business scenario requires a smaller cache time, contact your product support representative for assistance.</span></span>


[!INCLUDE[footer-include](../includes/footer-banner.md)]

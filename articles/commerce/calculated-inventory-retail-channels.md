---
title: Расчет доступности запасов для каналов розничной торговли
description: В этой теме описываются параметры, доступные для отображения запасов в наличии для магазина и интерактивных каналов.
author: hhainesms
ms.date: 08/13/2020
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: v-chgri
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: hhaines
ms.search.validFrom: 2020-02-11
ms.dyn365.ops.version: Release 10.0.10
ms.openlocfilehash: 29efccab017d9dff98872871bfe953fba19d2c30
ms.sourcegitcommit: 3cdc42346bb653c13ab33a7142dbb7969f1f6dda
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2021
ms.locfileid: "5799693"
---
# <a name="calculate-inventory-availability-for-retail-channels"></a>Расчет наличия запасов для розничных каналов

[!include [banner](../includes/banner.md)]

В этой теме описывается, как компания может использовать Microsoft Dynamics 365 Commerce для просмотра оценки доступности продуктов в наличии в интерактивном режиме и в каналах магазина.

## <a name="accuracy-of-calculation"></a>Точность расчета

Для обеспечения масштабируемости и производительности Commerce использует несколько серверов и баз данных. Таким образом, важно понимать, что доступные значения запасов, предоставляемые в приложении POS, интерфейсе прикладного программирования (API) доступности запасов электронной коммерции и на страницах запасов в наличии в Commerce Headquarters могут не быть точным на 100 процентов в реальном времени. Если транзакции, созданные для продуктов в интерактивном режиме или в канале магазина, еще не были синхронизованы с сервером и базой данных Commerce Headquarters, то страницы запасов в наличии в Commerce Headquarters могут не содержать точных значений запасов этих продуктов в реальном времени. И наоборот, если ваша компания настроена таким образом, что пользователи в Commerce Headquarters или другие интегрированные приложения смогут продавать, получать, возвращать или иным образом корректировать складской запас из магазина или интерактивного склада, на POS-терминале или в интерактивном канале могут отсутствовать все сведения, необходимые для отображения точных значений для номенклатур в реальном времени.

В этом разделе описываются процессы синхронизации данных, которые могут выполняться часто, чтобы ограничить задержку данных между приложениями или каналами. Однако важно понимать, что все данные о доступности в наличии, предоставляемые в ходе рабочего дня, считаются оцененным значением. Таким образом, при попытке сравнить сведения о запасах в наличии, предоставляемые приложением, с фактическими физическими запасами на полках, или при попытке сравнить значения в наличии, которые отображаются в POS, с данными о запасах в наличии, которые вы нашли для того же склада в Commerce Headquarters, значения могут отличаться. Эта разница в ходе рабочего дня является ожидаемой и не должна рассматриваться проблемой. Если требуется проводить аудит данных и гарантировать, что значения, указанные в интерфейсах API для доступности запасов и в Commerce Headquarters, соответствуют реальным физическим единицам, находящимся на полках в магазинах или складах, то лучше всего сделать это после того, как операции канала будут остановлены в течение дня, и все транзакции были правильно синхронизированы между Commerce headquarters и каналом.

## <a name="use-inventory-lookup-apis-for-e-commerce-inventory-availability-requests"></a>Использование API-интерфейсов поиска запасов для запросов доступности запасов в электронной коммерции

Можно использовать следующие API-интерфейсы для отображения доступности запасов для продукта, когда клиенты делают покупки на сайте электронной коммерции.

- **GetEstimatedAvailability** — этот API используется для того, чтобы получить доступность запасов для номенклатуры на складе канала электронной коммерции или всех складах, связанные с конфигурацией группы выполнения для канала электронной коммерции. Этот интерфейс API можно также использовать для складов в определенной области или в радиусе поиска на основе данных долготы и широты.
- **GetEstimatedProductWarehouseAvailability** — этот API используется для запроса запасов для номенклатуры с конкретного склада. Например, его можно использовать для отображения наличия запасов в сценариях, включающих получение заказа.

> [!NOTE]
> Эти API-интерфейсы заменяют API-интерфейсы **GetProductAvailabilities** и **GetAvailableInventoryNearby** в Dynamics 365 Retail версии 10.0.7 и более ранних версиях.

Оба API-интерфейса извлекают данные с сервера Commerce и обеспечивают оценку запасов в наличии для определенной комбинации продукта или варианта продукта и склада. Хотя другие API-интерфейсы, доступные на Commerce Server, могут переходить непосредственно в Commerce Headquarters для извлечения количества в наличии для продуктов, мы не рекомендуем использовать их в среде электронной коммерции, поскольку имеются потенциальные проблемы с производительностью и связанного с этим влияния, которое эти частые запросы могут оказывать на ваши серверы Commerce Headquarters. Кроме того, если запасы в наличии рассчитываются с помощью сервера Commerce, расчет скорее всего включает запасы, проданные в последних транзакциях электронной коммерции, которые еще не были синхронизированы в Commerce Headquarters. Хотя в Commerce Headquarters могут отсутствовать сведения об этих транзакциях, база данных сервера Commerce и канала имеет данные. Таким образом, данные будут разделены и могут помочь более точно оценить доступные запасы продукта.

### <a name="get-started-with-e-commerce-calculated-inventory-availability"></a>Приступая к работе с рассчитанной доступностью запасов в электронной коммерции

Перед использованием двух API-интерфейсов, упомянутых ранее, необходимо включить функцию **оптимизированный расчет доступности продукта** в рабочей области **Управление функциями** в Commerce Headquarters.

Прежде чем API-интерфейсы смогут рассчитать наилучшую оценку доступности запасов для номенклатуры, периодический моментальный снимок доступности запасов из Commerce Headquarters должен быть обработан и отправлен в базу данных канала, используемую в Commerce Scale Unit для электронной коммерции. Моментальный снимок представляет сведения, которыми Commerce Headquarters обладает о доступности запасов для определенной комбинации продукта или варианта продукта и склада. Он может включать в себя корректировки запасов или перемещения, вызванные поступлениями на склад, или отгрузками или другими процессами, которые выполняются в Commerce Headquarters, и о которых канал электронной коммерции имеет информацию только в связи с процессом синхронизации.

Моментальный снимок базы данных , создаваемый заданием **Доступность продукта**, рассчитывает только проводки по запасам, которые были обработаны и разнесены в Commerce Headquarters на момент времени, когда выполнялся моментальный снимок. Если запасы были проданы для продукта на складе магазина с помощью кассовой или асинхронной продажи по заказу клиента в приложении POS, в Commerce Headquarters сразу не появятся сведения о соответствующей проводке отпуска запасов для данной продажи. Он будет содержать информацию о запасе, который продается для этих типов продаж магазина только после того, как P-задание загружает связанную проводку из базы данных канала магазина в Commerce Headquarters, а соответствующий заказ на продажу создается с помощью разноски журнала операций или процессов поточной разноски. Процесс создания заказа в модуле Commerce Headquarters создает соответствующие проводки по запасам. Для заказов каналов электронной коммерции Commerce Headquarters содержит сведения о проводках по запасам только после того, как проводки отправлены в Commerce Headquarters через P-задание и процесс синхронизации заказов завершен. Таким образом, важно понимать, что значение моментального снимка запасов, предоставляемое в задании **Доступность продукта**, может не быть точным на 100 процентов в реальном времени из-за постоянной обработки продаж на распределенных серверах.

Чтобы создать моментальный снимок запасов в Commerce Headquarters, выполните следующие действия.

1. Перейдите в **Retail и Commerce \> ИТ Retail и Commerce \> Продукты и запасы \> Доступность продукта**.
1. Нажмите кнопку **ОК**, чтобы выполнить задание **Доступность продукта**. Можно также запланировать выполнение этого задания в пакетном режиме.

После завершения выполнения задания **Доступность продукта** собранные данные должны быть отправлены в электронные базы данных канала электронной коммерции, чтобы при расчете оцененных запасов в наличии учитывался последний моментальный снимок запасов Commerce Headquarters.

1. Перейдите в раздел **Retail и Commerce \> ИТ Retail и Commerce \> График распределения**.
1. Выполните задание **1130** (**Доступность продукта**) для синхронизации данных моментального снимка, которые задание **Доступность продукта** создало из Commerce Headquarters в базе данных канала.

Когда доступность запасов запрашивается из API-интерфейсов **GetEstimatedAvailability** или **GetEstimatedProductWarehouseAvailability**, выполняется расчет, чтобы попытаться получить максимально возможную оценку запасов для продукта. Вычисление ссылается на заказы клиента электронной коммерции, которые находятся в базе данных канала, но не были включены в данные моментального снимка, указанные в задании 1130. Эта логика выполняется путем отслеживания последней обработанной проводки по запасам из Commerce Headquarters и сравнения ее с проводками в базе данных канала. Он предоставляет базу для логики вычисления на стороне канала, так что дополнительные складские перемещения, произошедшие для проводок продаж по заказам клиентов в базе данных канала электронной коммерции, можно разделить на оцененную стоимость запасов, которую API-интерфейс шагов.

Логика вычисления на стороне канала возвращает оцененное физически доступное значение и общее доступное значение для запрошенного продукта и склада. Эти значения могут отображаться на сайте электронной коммерции, если это необходимо, или они могут использоваться для запуска другой бизнес-логики на сайте электронной коммерции. Например, можно отобразить сообщение "нет на складе" вместо фактического количества в наличии, переданного API.

Логика вычислений, которую API-интерфейсы электронной коммерции на стороне канала используют для оценки стоимости запаса, может оценивать запасы только на основе заказов клиентов, созданных в базе данных канала, но еще не синхронизированных и не разнесенных в Commerce Headquarters. Если база данных канала содержит также данные о проводках для кассовых продаж для складов для конкретного магазина, то кассовые продажи не будут учитываться в расчете электронной коммерции со стороны канала для этих складов.

## <a name="configure-the-inventory-lookup-operation-in-the-pos-channel"></a>Настройка операции поиска запасов в канале POS

В Retail версии 10.0.9 и более ранних, операция **Поиск запасов** из POS использовала вызов службы в реальном времени в Commerce Headquarters для получения сведений о запасах для выбранного продукта, для текущего магазина пользователя и других магазинов, настроенных для группы выполнения в рамках конфигурации канала магазина. В Commerce версии 10.0.10 и более поздних можно отключить вызовы службы реального времени в Commerce Headquarters. Вместо этого можно использовать расчет на стороне канала на сервере Commerce, чтобы определить запасы в наличии, которые физически доступны для магазина и любых других местоположений, определенных в группе выполнения. Эта конфигурация запасов, рассчитанная по каналам, также полезна для тех местоположений, в которых подключение к Интернету ненадежно, так как нет необходимости в интерактивном режиме получать поиск запасов из Commerce Headquarters.

Когда расчет на стороне канала правильно настроен и управляется, он может обеспечить более надежную оценку текущих запасов магазина, так как в нем используются данные о проводках, которые находятся в базе данных канала Commerce, но в Commerce Headquarters еще могут отсутствовать сведения об этом. Например, если вы используете существующий вызов службы в реальном времени для поиска запасов в POS, Commerce Headquarters, вероятно, не будет содержать сведений о кассовых продажах, которые были только что выполнены для продукта. Таким образом, стоимость запасов в наличии, которую Commerce Headquarters возвращает для этого продукта, скорее всего превысит фактические запасы в наличии для магазина на одну единицу. Однако при использовании расчета на стороне канала, кассовая продажа может быть учтена в расчете и вычтена из отображаемого значения в наличии. Несмотря на то что значения, которые предоставляют как вычисления на стороне канала, так и вызов службы в реальном времени, являются только оценками запасов в наличии, значение, предоставляемое при вычислении на стороне канала, с большей вероятностью будет точным для текущего магазина.

### <a name="get-started-with-pos-channel-side-calculated-inventory-availability"></a>Приступая к работе с рассчитанной доступностью запасов на стороне канала в POS

Чтобы использовать логику расчета на стороне канала и отключить вызовы службы в реальном времени для поиска запасов из POS-приложения, необходимо сначала включить функцию **оптимизированный расчет доступности продукта** в рабочей области **Управление функциями** в Commerce Headquarters. Кроме включения функции необходимо внести изменения в **профиль функциональности**.

Чтобы изменить **профиль функциональности**, выполните следующие действия:

1. Перейдите в раздел **Retail и Commerce \> Настройка канала \> Настройка POS \> Профили POS \> Профили функциональности**.
1. Выберите профиль функциональности.
1. На экспресс-вкладке **функции** в разделе **расчет наличия запасов** измените значение поля **режим расчета наличия запасов** с **служба реального времени** на **канал**. По умолчанию все профили функциональности используют вызовы службы в реальном времени. Поэтому необходимо изменить значение этого поля, если необходимо использовать логику расчета на стороне канала. Данное изменение повлияет на все розничные магазины, связанные с выбранным профилем функциональности.

Затем необходимо синхронизировать изменения в канале в рамках процесса графика распределения, выполнив следующие шаги:

1. Перейдите в раздел **Retail и Commerce \> ИТ Retail и Commerce \> График распределения**.
1. Выполните задание **1070** (**конфигурация канала**).

После завершения настройки сведения, предоставляемые о физически доступных запасах, больше не используют вызов службы в реальном времени, когда пользователь в приложении POS использует операцию **Поиск запасов** (стандартное и матричное представление). Вместо этого данные о физически доступных запасах для текущего магазина и всех магазинов в группе выполнения рассчитываются на основе последнего известного снимка, который был доставлен в базу данных канала из Commerce Headquarters. Значение моментального снимка в дальнейшем будет уточнено с помощью расчета на стороне канала для корректировки физически доступного значения на основе дополнительных проводок по продажам или возвратам, которые существуют для выбранного продукта в базе данных канала, которые не были включены в последний синхронизированный моментальный снимок из задания 1130. Если база данных канала не содержит транзакционных данных для каких-либо складов или магазинов в группе выполнения, она не содержит дополнительных транзакций, которые могут быть учтены в пересчете значения. Таким образом, наилучшей оценкой запасов в наличии, которые могут быть показаны для складов или магазинов, являются данные из последнего моментального снимка Commerce Headquarters.

Экраны **Выполнение заказов** в POS также используют расчет на стороне канала для отображения запасов в наличии для номенклатур, когда выбрана строка выполнения заказа, и пользователь просматривает панель **Подробно** для запасов в наличии для выбранной номенклатуры.

## <a name="optimize-your-inventory-data"></a>Оптимизируйте данные по запасам

Для обеспечения наилучшей оценки запасов важно использовать следующие пакетные задания Commerce и выполнять их часто:

- **P-задание** — P-задание находится на странице **Планы распределения** и должно запускаться часто. В этом задании отображаются заказы электронной коммерции, асинхронные заказы клиентов, созданные POS, а также кассовые заказы, которые были созданы POS из баз данных канала в Commerce Headquarters, чтобы их можно было обработать в дальнейшем. До тех пор, пока эти данные не будут синхронизированы из канала в Commerce Headquarters, в Commerce Headquarters нет сведений о корректировках запасов для продуктов на складах, которые являются результатом этих транзакций.
- **Синхронизация заказов** — это задание обрабатывает необработанные транзакционные данные в Commerce Headquarters о том, которые обеспечивает P-задание и конвертирует проводки заказов электронной коммерции и асинхронных заказов клиентов в заказы на продажу в Commerce Headquarters. Пока это задание не будет обработано, а заказы на продажу созданы, проводки по запасам создаваться не будут. Таким образом, запасы в наличии в Commerce Headquarters не будут учитывать проводки.
- **Пакетный расчет журналов проводок** — для кассовых проводок, созданных в магазине, процесс поточной разноски обеспечивает эффективное обновление запасов, относящихся к продажам. Чтобы наиболее эффективно обрабатывать проводки по запасам для кассовых заказов, убедитесь, что ваша система настроена на использование [потоковой разноски](https://docs.microsoft.com/dynamics365/commerce/trickle-feed).
- **Пакетная разноска журналов проводок** — это задание также необходимо для пакетной разноски. Далее следует задание **Пакетный расчет журналов проводок**. Это задание систематически разносит рассчитанные выписки, так что заказы на продажу для кассовых продаж создаются в Commerce Headquarters, а Commerce Headquarters более точно отражает запасы магазина.
- **Доступность продукта** — это задание создает моментальный снимок запасов из Commerce Headquarters.
- **1130 (Доступность продукта)** — это задание находится на странице **Планы распределения** и должно запускаться сразу после задания **Доступность продукта**. Это задание позволяет переносить данные моментального снимка запасов из Commerce Headquarters в базы данных канала.

Не рекомендуется выполнять эти пакетные задания слишком часто (каждые несколько минут). При частых запусках перегружаются Commerce Headquarters (HQ), что может привести к снижению производительности. В общем случае рекомендуется выполнять доступность продукта и по задания 1130 каждый час, а также планировать P-задания, синхронизировать заказы и задания потоковой разноски, с такой же или более высокой частотой.

> [!NOTE]
> Для повышения производительности при использовании расчета наличия запасов на стороне канала для создания запроса доступности запасов с помощью API-интерфейса электронной коммерции или новой логики запасов канала POS в расчете используется кэш, чтобы определить, прошло ли достаточно времени, чтобы оправдать повторное выполнение логики расчета. В качестве значения кэша по умолчанию задано 60. Например, вы включили расчет на стороне канала для магазина и просмотрели запасы в наличии для продукта на странице **Поиск запасов**. Если одна единица продукта будет продана, на странице **Поиск запасов** не будет отображаться сокращенный запас до тех пор, пока не будет очищен кэш. После разноски проводок пользователями в POS, они должны подождать 60 секунд, прежде чем убедиться в том, что запасы в наличии были сокращены.

Если бизнес-сценарий требует меньшее время кэширования, обратитесь за помощью к представителю службы поддержки продукта.


[!INCLUDE[footer-include](../includes/footer-banner.md)]
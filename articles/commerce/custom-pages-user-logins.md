---
title: Настройка пользовательских страниц для входа пользователей
description: В этом разделе описывается создание пользовательских страниц в Microsoft Dynamics 365 Commerce, которые обрабатывают настраиваемый вход для пользователей Azure Active Directory (Azure AD) клиентов "предприятие-покупатель" (B2C).
author: brianshook
ms.date: 03/17/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application user
ms.reviewer: v-chgri
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: brshoo
ms.search.validFrom: 2019-10-31
ms.dyn365.ops.version: Release 10.0.5
ms.openlocfilehash: 0318814f421ab862559965bb4b003308d6279812
ms.sourcegitcommit: 3cdc42346bb653c13ab33a7142dbb7969f1f6dda
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2021
ms.locfileid: "5799453"
---
# <a name="set-up-custom-pages-for-user-sign-ins"></a>Настройка пользовательских страниц для входа пользователей

[!include [banner](includes/banner.md)]

В этом разделе описывается создание пользовательских страниц в Microsoft Dynamics 365 Commerce, которые обрабатывают настраиваемый вход для пользователей Azure Active Directory (Azure AD) клиентов "предприятие-покупатель" (B2C).

Для использования настраиваемых страниц, созданных в Dynamics 365 Commerce для управления потоками входа пользователей в систему, необходимо настроить политики Azure AD, на которые будут ссылаться в Commerce Environment. Можно настроить политики Azure AD B2C "Регистрация и вход", "Редактирование профиля" и "Сброс пароля" с помощью приложения Azure AD B2C. На клиент и имена политик Azure AD B2C затем можно ссылаться в процессе подготовки, которая выполняется для среды Commerce с использованием Microsoft Dynamics Lifecycle Services (LCS).

Пользовательские страницы Commerce можно создавать с помощью модулей входа, регистрации, изменения профиля учетной записи, сброса пароля или модулей AAD общего назначения. URL-адреса страниц, опубликованные для этих пользовательских страниц, затем должны указываться в конфигурациях политик Azure AD B2C на портале Azure.

> [!WARNING] 
> Azure AD B2C выведет из использования старые пользовательские потоки 1 августа 2021 года. Поэтому необходимо запланировать миграцию ваших потоков пользователей на новую рекомендуемую версию. Новая версия обеспечивает равенство функций и новые функции. Дополнительные сведения см. в разделе [Потоки пользователей в Azure Active Directory B2C](https://docs.microsoft.com/azure/active-directory-b2c/user-flow-overview).

>Библиотека модулей для Commerce версии 10.0.15 или выше должна использоваться с рекомендованными потоками пользователей B2C. Можно также использовать страницы политики пользователя по умолчанию, предлагаемые в Azure AD B2C, и разрешить изменение добавленного фонового изображения, эмблемы и фонового цвета в соответствии с требованиями торговой марки компании. Хотя возможности разработки более ограничены, страницы политики пользователя по умолчанию обеспечивают функциональность политик Azure AD B2C без создания и настройки выделенных пользовательских страниц. 

## <a name="set-up-b2c-policies"></a>Настройка политик B2C

После настройки клиента Azure AD B2C и связывания его со средой Commerce перейдите на страницу **Azure AD B2C** на портале Azure, затем в меню в разделе **Политики** выберите пункт **Потоки пользователей (политики)**.

![Команда "Потоки пользователей (политики)" в меню](./media/B2C_CustomPage_PoliciesMenu.png)

Теперь можно настроить потоки входа пользователей "Регистрация и вход", "Изменение профиля" и "Сброс пароля".

### <a name="configure-the-sign-up-and-sign-in-policy"></a>Настройка политику "Регистрация и вход"

Чтобы настроить политику "Регистрация и вход", выполните следующие действия.

1. Выберите **Создать поток пользователей**, выберите **Регистрация и вход**, выберите вкладку **Рекомендуется**, затем выберите **Создать**.
1. Введите имя политики (например, **B2C\_1\_SignInSignUp**).
1. В разделе **Поставщики удостоверений** выберите поставщиков удостоверений, которые будут использоваться для этой политики. Как минимум должна быть выбрана **Регистрация по электронной почте**.
1. В столбце **Собрать атрибут** установите флажки для **Адрес электронной почты**, **Имя** и **Фамилия**.
1. В столбце **Вернуть утверждение** установите флажки для **Адреса электронной почты**, **Имя**, **Поставщик удостоверений**, **Фамилия** и **Идентификаторов объектов пользователей**.

    ![Выбранные атрибуты и утверждения](./media/B2C_SignInSignUp_Attributes.png)

1. Выберите **ОК**, чтобы создать политику.
1. Дважды щелкните имя новой политики, затем в области переходов выберите **Свойства**.
1. Установите для параметра **Включить JavaScript с принудительным применением макета страницы (предварительная версия)** значение **Вкл.**

    ![Страница свойств для новой политики](./media/B2C_SignInSignUp_EnableJavascript.png)

> [!NOTE]
> В среде Commerce будет полностью указана ссылка на имя политики. (В ссылку будет включен префикс **B2C\_1\_**.) После создания политик они не могут быть переименованы. Если вы заменяете существующую политику для среды Commerce, вы можете удалить исходную политику и построить новую политику с тем же именем. В качестве альтернативы, если среда уже была подготовлена, можно представить новое имя политики с помощью запроса на обслуживание.

Вы вернетесь к этой политике, чтобы завершить настройку после создания пользовательских страници Пока закройте политику, чтобы вернуться на страницу **Потоки пользователей (политики)** на портале Azure.

### <a name="configure-the-profile-editing-policy"></a>Настройка политики "Изменение профиля"

Чтобы настроить политику "Изменение профиля", выполните следующие действия.

1. Выберите **Создать поток пользователей**, выберите **Изменение профиля**, выберите вкладку **Рекомендуется**, затем выберите **Создать**.
1. Введите имя политики (например, **B2C\_1\_EditProfile**).
1. В разделе **Поставщики удостоверений** выберите поставщиков удостоверений, которые будут использоваться для этой политики. Необходимо выбрать, по меньшей мере, **Локальная учетная запись для входа**.
1. В столбце **Собрать атрибут** установите флажки для **Имя** и **Фамилия**.
1. В столбце **Вернуть утверждение** установите флажки для **Адреса электронной почты**, **Имя**, **Поставщик удостоверений**, **Фамилия** и **Идентификаторов объектов пользователей**.
1. Выберите **ОК**, чтобы создать политику.
1. Дважды щелкните имя новой политики, затем в области переходов выберите **Свойства**.
1. Установите для параметра **Включить JavaScript с принудительным применением макета страницы (предварительная версия)** значение **Вкл.**

Вы вернетесь к этой политике, чтобы завершить настройку после создания пользовательских страници Пока закройте политику, чтобы вернуться на страницу **Потоки пользователей (политики)** на портале Azure.

### <a name="configure-the-password-reset-policy"></a>Настройте политику "Сброс пароля"

Чтобы настроить политику "Сброс пароля", выполните следующие действия.

1. Выберите **Создать поток пользователей**, затем выберите параметр **Сброс пароля** и перейдите на вкладку **Рекомендуется**, затем нажмите кнопку **Создать**.
1. Введите имя политики (например, **B2C\_1\_ForgetPassword**).
1. В разделе **Поставщики удостоверений** выберите **Сбросить пароль, используя адрес электронной почты**.
1. В столбце **Вернуть утверждение** установите флажки для **Адреса электронной почты**, **Имя**, **Фамилия** и **Идентификаторов объектов пользователей**.
1. Выберите **ОК**, чтобы создать политику.
1. Дважды щелкните имя новой политики, затем в области переходов выберите **Свойства**.
1. Установите для параметра **Включить JavaScript с принудительным применением макета страницы (предварительная версия)** значение **Вкл.**

Вы вернетесь к этой политике, чтобы завершить настройку после создания пользовательских страници Пока закройте политику, чтобы вернуться на страницу **Потоки пользователей (политики)** на портале Azure.

## <a name="build-the-custom-pages"></a>Создание пользовательских страниц

Выделенные модули Azure AD включаются в Commerce для создания пользовательских страниц для политик пользователя Azure AD B2C. Страницы могут быть созданы специально для каждого макета страницы политики пользователя с помощью основных модулей Azure AD B2C, описанных далее. Кроме того, модуль **Универсальный AAD** может использоваться для всех макетов страниц и политик в Azure AD B2C (даже для параметров макетов страниц в политиках, не перечисленных ниже). 

- Модули Azure AD, связанные со страницей, привязаны к элементам ввода данных, отображаемым Azure AD B2C. Эти модули обеспечивают больший контроль над положением элементов на страницах. Однако может потребоваться построить большее количество страниц и расширений модулей для учета вариантов, помимо настроек по умолчанию, описанных ниже.
- Модуль **Универсальный AAD** создает элемент "div" для Azure AD B2C, чтобы отобразить все элементы в макете страницы политики пользователя, обеспечивая большую гибкость для функций B2C страницы, но меньший контроль позиционирования и стилизации (хотя CSS может использоваться для обеспечения соответствия внешнего вида и оформления сайта).

Можно создать одну страницу с модулем **Универсальный AAD** и использовать его для всех страниц политики пользователя, либо создать определенные страницы, используя отдельные модули Azure AD для входа, регистрации, изменения профиля, сброса пароля и проверки сброса пароля. Также можно использовать сочетание обоих подходов, используя конкретные страницы Azure AD для макетов страниц, приведенных ниже, и страницу универсального модуля AAD для макетов оставшихся страниц на этих или других страницах политик пользователя.

Для получения дополнительных сведений о модулях Azure AD, поставляемых с библиотекой модулей, ознакомьтесь с дополнительными сведениями в разделе [Страницы и модули управления идентификацией](identity-mgmt-modules.md).

Чтобы создать пользовательские страницы с конкретными модулями идентификации для обработки входа пользователей, выполните следующие действия.

1. В конфигураторе сайта Commerce перейдите на свой сайт.
1. Создайте следующие пять шаблонов и страниц (если они еще отсутствуют на сайте):
    - Шаблон и страница **Вход**, использующие модуль входа.
    - Шаблон и страница **Регистрация**, использующие модуль регистрации.
    - Шаблон и страница **Сброс пароля**, использующие модуль сброса пароля.
    - Шаблон и страница **Проверка сброса пароля**, использующие модуль проверки сброса пароля.
    - Шаблон и страница **Изменение профиля**, использующие модуль изменения профиля учетной записи.

При создании страниц необходимо следовать следующим указаниям:

- Для каждой страницы или модуля используйте макет и стиль, которые наилучшим образом подходят для требований бизнеса.
- Опубликуйте все страницы и URL-адреса, которые должны использоваться в настройке Azure AD B2C.
- После публикации страниц и URL-адресов необходимо собрать URL-адреса, которые должны использоваться для конфигураций политик Azure AD B2C. Суффикс **?preloadscripts=true** добавляется к каждому URL-адресу, когда он используется.

> [!IMPORTANT]
> Страницы, построенные для ссылок в Azure AD B2C, обслуживаются непосредственно из домена клиента Azure AD B2C. Не используйте повторно универсальные верхние и нижние колонтитулы, имеющие относительные ссылки. Так как эти страницы будут размещаться в домене Azure AD B2C при их использовании, для всех ссылок должны использоваться только абсолютные URL-адреса. Рекомендуется создавать конкретный верхний и нижний колонтитулы с абсолютными URL-адресами для пользовательских страниц, связанных с Azure AD, с удаленными любыми модулями, специфичными для Commerce, для которых требуется подключение к серверу Retail Server. Например, модули избранного, панели поиска, ссылки на вход и корзины не должны включаться в страницы, которые будут использоваться в потоках пользователей Azure AD B2C.

## <a name="configure-azure-ad-b2c-policies-with-custom-page-information"></a>Настройка политик Azure AD B2C со сведениями настраиваемой страницы 

На портале Azure вернитесь на страницу **Azure AD B2C**, затем в меню в разделе **Политики** выберите **Потоки пользователей (политики)**.

### <a name="update-the-sign-up-and-sign-in-policy-with-custom-page-information"></a>Обновление политики "Регистрация и вход" со сведениями настраиваемой страницы

Чтобы обновить политику "Регистрация и вход" со сведениями настраиваемой страницы, выполните следующие действия.

1. В политике **Вход и регистрация**, настроенной ранее, в области переходов выберите **Макеты страниц**.
1. Выберите макет **Единая страница регистрации или входа**.
1. Установите для параметра **Использовать пользовательское содержимое страницы** значение **Да**.
1. В поле **URI пользовательской страницы** введите полный URL-адрес входа. Включите суффикс **?preloadscripts=true**. Например, введите ``www.<my domain>.com/sign-in?preloadscripts=true``.
1. В поле **Версия макета страницы** выберите версию **2.1.0** или более позднюю (требуется библиотека модулей для Commerce версии 10.0.15 или более поздней версии).
1. Нажмите **Сохранить**.
1. Выберите макет **Страница регистрации локальной учетной записи**.
1. Установите для параметра **Использовать пользовательское содержимое страницы** значение **Да**.
1. В поле **URI пользовательской страницы** введите полный URL-адрес регистрации. Включите суффикс **?preloadscripts=true**. Например, введите ``www.<my domain>.com/sign-up?preloadscripts=true``.
1. В поле **Версия макета страницы** выберите версию **2.1.0** или более позднюю (требуется библиотека модулей для Commerce версии 10.0.15 или более поздней версии).
1. В разделе **Атрибуты пользователя** выполните следующие действия:
    1. Для атрибутов **Имя** и **Фамилия** выберите **Нет** в столбце **Требуется проверка**.
    1. Для атрибута **Адрес электронной почты** рекомендуется оставить значение по умолчанию **Да**, выбранное в столбце **Требуется проверка**. Этот параметр гарантирует, что пользователи, регистрирующиеся с указанным адресом электронной почты, подтвердят, что этот адрес электронной почты принадлежит им.
    1. Для атрибутов **Адреса электронной почты**, **Имя** и **Фамилия** выберите **Нет** в столбце **Необязательно**.
1. Нажмите **Сохранить**.

    ![Конфигурация политики страницы регистрации локальной учетной записи](./media/B2C_SignInSignUp_Recommended_PageLayoutExample.png)

### <a name="update-the-profile-editing-policy-with-custom-page-information"></a>Обновление политики "Изменение профиля" со сведениями настраиваемой страницы

Чтобы обновить политику "Изменение профиля" со сведениями настраиваемой страницы, выполните следующие действия.

1. В политике **Изменение профиля**, настроенной ранее, в области переходов выберите **Макеты страниц**.
1. Выберите макет **Страница редактирования профиля** (в зависимости от экрана, для этого может потребоваться прокрутка вниз после других параметров макета).
1. Установите для параметра **Использовать пользовательское содержимое страницы** значение **Да**.
1. В поле **URI пользовательской страницы** введите полный URL-адрес редактирования профиля. Включите суффикс **?preloadscripts=true**. Например, введите ``www.<my domain>.com/profile-edit?preloadscripts=true``.
1. Для параметра **Версия макета страницы** выберите версию **2.1.0** или выше (требуется библиотека модулей для Commerce версии 10.0.15 или более поздней версии).
1. В разделе **Атрибуты пользователя** выполните следующие действия:
    1. Для атрибутов **Имя** и **Фамилия** выберите **Нет** в столбце **Необязательно**.
    1. Для атрибутов **Имя** и **Фамилия** выберите **Нет** в столбце **Требуется проверка**.
1. Нажмите **Сохранить**.

### <a name="update-the-password-reset-policy-with-custom-page-information"></a>Обновление политики "Сброс пароля" со сведениями настраиваемой страницы

Чтобы обновить политику "Сброс пароля" со сведениями настраиваемой страницы, выполните следующие действия.

1. В политике **Сброс пароля**, настроенной ранее, в области переходов выберите **Макеты страниц**.
1. Выберите макет **Страница "Забыли пароль?"**.
1. Установите для параметра **Использовать пользовательское содержимое страницы** значение **Да**.
1. В поле **URI пользовательской страницы** введите полный URL-адрес проверки сброса пароля. Включите суффикс **?preloadscripts=true**. Например, введите ``www.<my domain>.com/password-reset-verification?preloadscripts=true``.
1. В поле **Версия макета страницы** выберите версию **2.1.0** или выше (требуется библиотека модулей для Commerce версии 10.0.15 или более поздней версии).
2. Нажмите **Сохранить**.
3. Выберите макет **Страница "Изменить пароль"**.
4. Установите для параметра **Использовать пользовательское содержимое страницы** значение **Да**.
5. В поле **URI пользовательской страницы** введите полный URL-адрес сброса пароля. Включите суффикс **?preloadscripts=true**. Например, введите ``www.<my domain>.com/password-reset?preloadscripts=true``.
6. В поле **Версия макета страницы** выберите версию **2.1.0** или выше (требуется библиотека модулей для Commerce версии 10.0.15 или более поздней версии).
7. Нажмите **Сохранить**.

## <a name="customize-default-text-strings-for-labels-and-descriptions"></a>Настройка текстовых строк по умолчанию для подписей и описаний

В библиотеке модулей модули входа предварительно заполнены текстовыми строками по умолчанию для подписей и описаний. Строки можно настроить на панели свойств модуля, с которым вы работаете. Дополнительные строки на странице (например, текст ссылки **Забыли пароль?** или текст призыва к действию **Создайте учетную запись**) потребуют использования пакета SDK для Commerce и обновления значений в файле global.json для модуля входа.

Например, текст по умолчанию для ссылки забытого пароля — **Забыли пароль?**. Ниже показан этот текст по умолчанию на странице входа.

![Текст по умолчанию для ссылки забытого пароля на странице входа](./media/B2C_SignUp_ModuleFace.png)

Однако в файле global.json для библиотеке модулей в модуле входа можно изменить текст на **Не помните пароль?**, как показано на следующем рисунке.

![Обновленный текст ссылки в файле global.json модуля входа](./media/B2C_CustomizingStringsForModule.png)

После обновления файла global.json и публикации изменений новый текст ссылки появляется в модуле входа как в Commerce, так и на опубликованной странице входа.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Настройка доменного имени](configure-your-domain-name.md)

[Развертывание нового клиента электронной коммерции](deploy-ecommerce-site.md)

[Создание сайта электронной коммерции](create-ecommerce-site.md)

[Связывание сайта Dynamics 365 Commerce с интернет-каналом](associate-site-online-store.md)

[Управление файлами robots.txt](manage-robots-txt-files.md)

[Пакетная отправка перенаправлений URL-адресов](upload-bulk-redirects.md)

[Настройка клиента B2C в Commerce](set-up-B2C-tenant.md)

[Настройка нескольких клиентов B2C в среде Commerce](configure-multi-B2C-tenants.md)

[Добавление поддержки сети доставки контента (CDN)](add-cdn-support.md)

[Включение обнаружения магазинов на основе местоположения](enable-store-detection.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]

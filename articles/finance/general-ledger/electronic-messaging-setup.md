---
title: Настройка электронных сообщений
description: В этой теме приводятся сведения о настройке функций электронных сообщений (EM).
author: liza-golub
ms.date: 11/18/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application User
ms.reviewer: kfend
ms.search.region: Global
ms.author: elgolu
ms.search.validFrom: 2021-06-23
ms.dyn365.ops.version: 8.0999999999999996
ms.openlocfilehash: 652d8684473d1c1505a80eb1d860c57a214b9488
ms.sourcegitcommit: 5d1772bdeb21a9bec6dc49e64550aaf34127a4e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/10/2022
ms.locfileid: "8734229"
---
# <a name="set-up-electronic-messages"></a>Настройка электронных сообщений

[!include [banner](../includes/banner.md)]

Функции **электронных сообщений** (EM) помогают поддерживать различные процессы электронной отчетности для различных типов документов. В сложных сценариях, поддерживающих [функции отчетности для определенной страны/региона](electronic-messaging.md#country-specific-regulatory-features-supported-by-the-em-functionality), функция EM настраивается таким образом, чтобы у нее было сочетание множества статусов сообщений, элементов сообщений, действий, дополнительных полей и исполняемых классов. Для этих сценариев пакеты информационных объектов доступны для импорта. Если вы используете эти пакеты информационных объектов, их следует импортировать в юридическое лицо при помощи средства управления данными. Дополнительные сведения о том, как использовать средство управления данными, см. в разделе [Управление данными](../../fin-ops-core/dev-itpro/data-entities/data-entities-data-packages.md).

Если не импортировать пакет информационных объектов, можно вручную настроить функцию электронных сообщений. В этом случае необходимо настроить следующие элементы:

- [Номерные серии](#sequences)
- [Типы элементов сообщения](#types)
- [Статусы элемента сообщения](#item)
- [Статусы сообщения](#statuses)
- [Дополнительные поля](#additional)
- [Параметры исполняемого класса](#executable)
- [Действия заполнения записей](#populate)
- [Заполнение записей из нескольких компаний](#multiple-companies-populate)
- [Веб-приложения](#applications)
- [Параметры веб-службы](#settings)
- [Действия обработки сообщения](#actions)
- [Обработка электронного сообщения](#processing)

В следующих разделах приведены дополнительные сведения о каждом из этих элементов.

## <a name="number-sequences"></a><a id="sequences"></a>Номерные серии

Настройте номерные серии для сообщений и элементов сообщений. Номерные серии используются для автоматической нумерации сообщений и элементов сообщений. Номера, которые назначены, будут служить уникальными кодами для сообщений и элементов сообщений в системе. Можно настроить номерные серии для электронных сообщений на странице **Главная книга** \> **Настройка главной книги** \> **Параметры главной книги**.

## <a name="message-item-types"></a><a id="types"></a>Типы элементов сообщения

Типы элементов сообщений определяют типы записей, которые будут использоваться в электронных сообщениях. Типы элементов сообщений можно настроить на странице **Налог** \> **Настройка** \> **Электронные сообщения** \> **Типы элементов сообщения**.

## <a name="message-item-statuses"></a><a id="item"></a>Статусы элемента сообщения

Статусы элементов сообщений указывают статусы, которые применяются к элементам сообщений в обработке, которую вы настраиваете. Статусы элементов сообщений можно настроить на странице **Налог** \> **Настройка** \> **Электронные сообщения** \> **Статусы элементов сообщения**.

Параметр **Разрешено удаление** статуса элемента сообщения определяет, могут ли пользователи удалять элементы сообщения с этим статусом на странице **Электронные сообщения** или странице **Элементы электронного сообщения**.

## <a name="message-statuses"></a><a id="statuses"></a>Статусы сообщения

Настройте статусы сообщений, которые должны быть доступны при обработке сообщений. Статусы сообщений можно настроить на странице **Налог** \> **Настройка** \> **Электронные сообщения** \> **Статусы сообщений**.

В следующей таблице описаны поля на странице **Статусы сообщения**.

| Имя поля          | Описание |
|---------------------|-------------|
| Состояние сообщения      | Введите уникальное имя для статуса сообщения. Статусы сообщения используются для задания характеристики состояния электронного сообщения в каждый момент. Введенное название отображается на странице **Электронные сообщения** и в журнале, который относится к электронным сообщениям. |
| Описание         | Введите описание статуса сообщения. |
| Тип отклика       | Выберите тип ответа для статуса сообщений. Некоторые действия в обработке могут давать более одного типа отклика. Например, действия типа **Веб-служба** могут приводить к откликам типа **Выполнено успешно** или **Техническая ошибка**, в зависимости от результатов их выполнения. В этом случае задайте статусы сообщения для обоих типов откликов. Дополнительные сведения о типах действий и связанных с ними типах ответов см. в разделе [Типы действий обработки сообщений](#action-types) далее в этой теме. |
| Статус элемента сообщения | В некоторых случаях статус электронного сообщения должен влиять на статус связанных элементов сообщения. Выберите статус элемента сообщения в этом поле, чтобы связать его со статусом сообщения. |
| Разрешено удаление        | Этот флажок следует установить, если пользователи должны иметь возможность удалять электронные сообщения с этим статусом на странице **Электронные сообщения**. |

## <a name="additional-fields"></a><a id="additional"></a>Дополнительные поля

Функция EM позволяет собирать записи из таблиц проводок в Microsoft Dynamics 365 Finance как элементы сообщений. Таким образом, можно подготовить эти записи для отчетности, а затем сообщить их. Тем не менее таблицы проводок иногда не имеют достаточно сведений для заполнения записей в соответствии с требованиями отчетности. Чтобы заполнить всю информацию, которая должна сообщаться для записи, необходимо настроить дополнительные поля. Дополнительные поля можно связать как с сообщениями, так и с элементами сообщений. Дополнительны поля можно настроить на странице **Налог** \> **Настройка** \> **Электронные сообщения** \> **Дополнительные поля**.

В следующей таблице описаны общие поля на странице **Дополнительные поля**.

| Поле       | описание |
|-------------|-------------|
| Имя поля  | Введите имя дополнительного поля для электронных сообщений, которые относятся к процессу. Это имя отображается в пользовательском интерфейсе (UI) во время работы с процессом. Это имя также можно использовать в конфигурациях электронной отчетности (ER), которые связаны с процессом. |
| описание | Введите описание дополнительного поля. |
| Изменение пользователя   | Установите для этого параметра значение **Да**, если пользователи должны иметь возможность изменить значение дополнительного поля в пользовательском интерфейсе. |
| Счетчик     | Установите для этого параметра значение **Да**, если дополнительное поле должно содержать номерную серию в электронном сообщении. Значение дополнительного поля заполняется автоматически при выполнении действия типа **Экспорт электронной отчетности**. |
| Скрыто      | Установите для этого параметра значение **Да**, если дополнительное поле должно быть скрыто в пользовательском интерфейсе на странице **Электронные сообщения** или на странице **Элементы электронного сообщения**. |

На экспресс-вкладке **Значения** можно заранее определить значения, которые может иметь дополнительное поле. Эти значения затем доступны пользователям для выбора. Таким образом, они необязательно должны быть заполнены вручную во время обработки. В следующей таблице приводится описание полей.

| Поле                | описание |
|----------------------|-------------|
| Значение поля          | Введите значение поля для использования для сообщения или элемента сообщения во время отчетности. |
| Описание          | Введите описание значения поля. |
| Тип счета         | Некоторые значения поля могут быть ограничены определенными типами счетов. Выберите одно из следующих значений: **Все**, **Клиент** или **Поставщик**. |
| Код счета         | Если выбрано значение **Клиент** или **Поставщик** в поле **Тип счета**, можно дополнительно ограничить использование значения поля до определенной группы или таблицы. |
| Номер счета/группы | Если выбрано значение **Клиент** или **Поставщик** в поле **Тип счета** и введена группа или таблица в поле **Код счета**, в это поле можно ввести определенную группу или контрагента. |
| Действует            | Укажите дату, с которой это значение будет учитываться. |
| Истечение срока           | Укажите дату, с которой это значение перестанет учитываться. |

По умолчанию сочетания условий, определенных в полях **Номер счета/группы**, **Код счета**, **Действует** и **Истечение срока** не влияет на выбор значений для дополнительных полей. Тем не менее эти комбинации могут использоваться в исполняемом классе для реализации определенной логики, которая вычисляет значения дополнительных полей.

## <a name="executable-class-settings"></a><a id="executable"></a>Параметры исполняемого класса

Исполняемый класс — это метод или класс X++, который обработка электронных сообщений может вызывать в отношении действия, если некоторая оценка требуется для процесса.

Можно настроить исполняемый класс вручную, который должен вызываться во время обработки, путем перехода к **Налог** \> **Настройка** \> **Электронные сообщения** \> **Параметры выполняемого класса**. На странице **Параметры исполняемого класса** создайте строку и задайте следующие поля.

| Поле                 | описание |
|-----------------------|-------------|
| Исполняемый класс      | Введите имя, которое будет использоваться при настройке действия обработки сообщений, в отношении которого вызывается этот класс. |
| описание           | Введите описание исполняемого класса. |
| Имя исполняемого класса | Выберите исполняемый класс X++. |
| Уровень выполнения       | Это поле устанавливается автоматически, потому что значение заранее определено для выбранного используемого класса. Это поле ограничивает уровень, для которого выполняется соответствующая оценка. |
| Описание класса     | Это поле устанавливается автоматически, потому что значение заранее определено для выбранного используемого класса. |
| Тип действия           | Это поле доступно, если функция **\[EM\] Тип действия исполняемого класса** включена в рабочей области **Управление функциями**. Это поле используется для указания типа действия выполняемого класса. Это поле позволяет более точно контролировать следующие действия, доступные для электронного сообщения на странице **Электронные сообщения**. |

Некоторые исполняемые классы могут иметь обязательные параметры, которые должны быть определены до первого запуска исполняемого класса. Чтобы определить эти параметры, в области действий выберите **Параметры**. В появившемся диалоговом окне задайте поля, затем выберите **ОК**. Важно выбрать **ОК**. В противном случае параметры не сохраняются в базе данных, и исполняемый класс не будет вызываться правильно.

## <a name="populate-records-actions"></a><a id="populate"></a>Действия заполнения записей

Действия заполнения записей используется для настройки действий, которые добавляют записи в таблицу элементов сообщений, чтобы их можно было добавить в электронное сообщение. Например, если электронное сообщение должно содержать отчет о накладных клиента, необходимо настроить действие заполнения записей, которое связано с полем **Источник данных** в таблице журнала накладных клиента.

Можно настроить действия заполнения записей на странице **Налог** \> **Настройка** \> **Электронные сообщения** \> **Действие заполнения записей**. Создайте новую запись для каждого действия, которое должно добавлять записи в таблицу, и задайте следующие поля.

| Поле       | Описание |
|-------------|-------------|
| Название        | Введите имя для действия, которое заполняет записи в процессе. |
| Описание | Введите описание действия заполнения записей. |

На экспресс-вкладке **Настройка источников данных** добавьте строку для каждого источника данных, который используется для обработки, и настройте следующие поля.

| Поле                  | описание |
|------------------------|-------------|
| Наименование                   | Введите имя источника данных. |
| Тип элемента сообщения      | Выберите тип элементов сообщений, который должен использоваться при создании записей для источника данных. |
| Тип счета           | Выберите тип счета, который должен быть связан с записями из источника данных. |
| Имя главной таблицы      | Выберите таблицу, которая будет источником данных. |
| Поле номера документа  | Выберите поле, из которого должен браться номер документа, в выбранной главной таблице. Значение этого поля используется как значение поля **Номер документа** для элемента сообщения. |
| Поле даты документа    | Выберите поле, из которого должна браться дата документа, в выбранной главной таблице. Значение этого поля используется как значение поля **Дата элемента сообщения** для элемента сообщения. |
| Поле счета документа | Выберите поле, из которого должен браться счет документа, в выбранной главной таблице. Значение этого поля используется как значение поля **Номер счета** для элемента сообщения. |
| Организация                | Это поле доступно, если в рабочей области **управления функциями** включены **запросы между компаниями для действий заполнения записей**. Эта функция предназначена для настройки источников данных между компаниями для действий по заполнению записей. Данные могут быть получены из нескольких компаний. |
| Пользовательский запрос             | <p>Если запрос настраивается путем выбора **Изменить запрос** над сеткой, и указан критерий, который должен применяться к выбранной главной таблице, из которой заполнены данные, этот флажок устанавливается автоматически. В противном случае все записи будут заполнены из выбранного источника главной таблицы.</p><p>Когда функция **Запросы между компаниями для действий заполнения записей** в рабочей области **управления функциями** включена и записи должны быть собраны из нескольких компаний, добавьте строку для каждого дополнительного юридического лица, которое должно быть включено в отчетность. Для каждой новой строки выберите **Изменить запрос** и укажите связанный критерий, который относится к юридическому лицу, указанному в поле **Компания** в строке. По завершении сетка **Настройка источников данных** будет содержать строки для всех юридических лиц, которые должны быть включены в отчетность.</p> |

## <a name="populate-records-from-multiple-companies"></a><a id="multiple-companies-populate"></a>Заполнение записей из нескольких компаний

Если ваша компания должна отчитываться о нескольких юридических лицах в одной базе данных Finance, настройте [действия по заполнению записей](#populate) для всех юридических лиц, данные из которых должны быть включены в отчетность.

Для включения этой возможности в среде Finance выполните следующие шаги. 

1. Перейдите в раздел **Рабочие области** \> **Управление функциями**.
2. Найдите и выберите функцию **Запросы между компаниями для действий заполнения записей** в списке.
3. Выберите **Включить**. 

Чтобы настроить [действия заполнения записей](#populate) для нескольких компаний, данные которых должны быть включены в отчетность, выполните следующие действия.

1. Перейдите в раздел **Налог** \> **Настройка** \> **Электронные сообщения** \> **Действия заполнения записей**.

    Когда функция **Запросы между компаниями для действий заполнения записей** включена, сетка **Настройка источников данных** на странице **Действие заполнения записей** включает в себя поле **Компания**. Для существующих записей, созданных во время общей настройки [действий заполнения записей](#populate), в этом поле отображается идентификатор текущего юридического лица.

2. В сетке **Настройка источников данных** добавьте строку для каждого дочернего юридического лица, которое должно быть включено в отчетность, и задайте следующие поля.

    | Имя поля             | Значение |
    |------------------------|-------|
    | Имя                   | Введите текстовое значение, которое поможет понять, откуда берется данная запись. Например, введите **Имя источника данных — Дочерняя компания 1**. |
    | Тип элемента сообщения      | Выберите тип элемента сообщения, который должен использоваться для обработки EM. |
    | Тип счета           | Укажите тип счета, который необходим для обработки EM. Если в обработке EM отсутствуют какие-либо конкретные типы счетов, выберите **Все**. |
    | Имя главной таблицы      | Укажите имя основной таблицы, которая необходима для обработки EM. |
    | Поле номера документа  | Укажите поле, содержащее номер документа в записях обработки EM. |
    | Поле даты документа    | Укажите поле, содержащее дату документа в записях обработки EM. |
    | Поле счета документа | Укажите поле, содержащее счет документа в записях обработки EM. |
    | Компания                | Выберите идентификатор дочернего юридического лица. |
    | Пользовательский запрос             | Этот флажок выбирает автоматически при определении критериев путем выбора команды **Изменить запрос**. |

3. Для каждой новой строки выберите **Изменить запрос** и укажите связанные критерии для юридического лица, указанного в поле **Компания** в строке.

## <a name="web-applications"></a><a id="applications"></a>Веб-приложения

Используйте параметры веб-приложения, чтобы настроить веб-приложение таким образом, чтобы оно поддерживало открытую авторизацию (OAuth) 2.0. OAuth является открытым стандартом, который позволяет пользователям предоставлять "безопасный делегированный доступ" в приложение от их имени без совместного использования своих учетных данных для доступа. Можно также выполнить процесс авторизации путем получения кода авторизации и маркера доступа. Можно настроить параметры веб-приложения на странице **Налог** \> **Настройка** \> **Электронные сообщения** \> **Веб-приложения**.

В следующей таблице описаны поля на странице **Веб-приложения**.

| Поле                        | Описание |
|------------------------------|-------------|
| Имя приложения             | Введите имя для веб-приложения. |
| Описание                  | Введите описание веб-приложения. |
| Базовый URL-адрес                     | Введите базовый интернет-адрес веб-приложения. |
| URL-путь авторизации       | Укажите путь, который используется для составления URL-адреса для авторизации. |
| URL-путь маркера               | Укажите путь, который используется для составления URL-адреса для токена. |
| URL-адрес перенаправления                 | Введите URL-адрес перенаправления. |
| Код клиента                    | Введите идентификатор клиента веб-приложения. |
| Секрет клиента                | Введите секрет клиента веб-приложения. |
| Маркер сервера                 | Введите маркер сервера веб-приложения. |
| Сопоставление формата авторизации | Выберите формат электронной отчетности, который используется для создания запроса для авторизации. |
| Сопоставление модели маркера импорта   | Выберите сопоставление модели импорта электронной отчетности, которое используется для хранения маркера доступа. |
| Предоставленная область                | Область, которая предоставляется для запросов к приложению. Это поле обновляется автоматически. |
| Маркер доступа истекает через  | Оставшееся время до истечения срока действия маркер доступа. Это поле обновляется автоматически. | 
| Принять                       | Укажите свойство **Принять** веб-запроса. Например, введите **application/vnd.hmrc.1.0+json**. |
| Тип содержимого                 | Укажите тип содержимого. Например, введите **application/json**. |

Кроме того, доступны следующие кнопки на панели операций страницы **Веб-приложения** для поддержки процесса авторизации:

- **Получить код авторизации** — инициализация авторизации веб-приложения. Эта функция использует формат ER, указанный в поле **Сопоставление формата авторизации** для создания запроса на авторизацию.
- **Получить маркер доступа** — инициализация процесса получения маркера доступа.
- **Обновить маркер доступа** — обновление маркера доступа. Эта функция использует формат ER, указанный в поле **Сопоставление модели маркера импорта** для импорта сведений о полученном маркере доступа.

Если маркер доступа к веб-приложению хранится в базе данных системы в зашифрованном формате, он может использоваться для запросов к веб-службе. Для целей безопасности доступ к маркеру должен быть ограничен ролями безопасности, которым разрешено обрабатывать эти запросы. Если пользователи, находящиеся вне группы безопасности, пытаются обработать запрос, они получат сообщение об ошибке с извещением, что они не могут взаимодействовать через выбранное веб-приложение. Чтобы настроить роли безопасности, которые должны иметь доступ к маркеру доступа, используйте экспресс-вкладку **Роли безопасности** на странице **Веб-приложения**. Если роли безопасности для веб-приложения не определены, только системный администратор может взаимодействовать через это веб-приложение.

Для каждого действия с выбранным веб-приложением на экспресс-вкладке **Журнал действий** сохраняются сведения о пользователе, а также дата и время.

Некоторые веб-службы могут требовать включения в запросы различного заголовка. Системный администратор может настроить дополнительные заголовки и их значения на экспресс-вкладке **Дополнительные заголовки**, а затем использовать их в процессе создания запроса.

## <a name="web-service-settings"></a><a id="settings"></a>Параметры веб-службы

Используйте параметры веб-службы для настройки прямой передачи данных к веб-службу. Можно настроить параметры веб-службы на странице **Налог** \> **Настройка** \> **Электронные сообщения** \> **Параметры веб-службы**.

В следующей таблице описаны поля на странице **Параметры веб-службы**.

| Поле                          | описание |
|--------------------------------|-------------|
| Веб-служба                    | Введите имя для веб-службы. |
| описание                    | Введите описание веб-службы. |
| Веб-адрес               | <p>Введите интернет-адрес веб-службы. Если указано веб-приложение для веб-службы и если интернет-адрес веб-службы должен быть такой же, как интернет-адрес, который определен для этого веб-приложения, выберите **Копировать базовый URL-адрес**. В это поле будет скопирован базовый URL-адрес веб-приложения.</p><p>**Внимание!** Сторонние службы или другие службы, которые вы настраиваете здесь, не требуют сертификации и могут не соблюдать стандарты конфиденциальности корпорации Майкрософт. Ознакомьтесь с документацией по конфиденциальности каждой службы и работайте с каждым поставщиком услуг для получения дополнительных сведений об уровне соответствия требованиям. Вы несете ответственность за обеспечение соответствия этих услуг требованиям безопасности, конфиденциальности и законов. Риски, связанные с использованием службы, возлагаются на вас. Майкрософт не предоставляет никаких прямо выраженных гарантий или условий. Настоятельно рекомендуется использовать только те службы, которые предоставляют защищенные и авторизованные подключения, такие как HTTPS.</p> |
| Сертификат                    | Выберите сертификат Azure Key Vault, который ранее был настроен. |
| Веб-приложение                | Выберите веб-приложение, которое ранее было настроено. |
| Тип отклика — XML        | Установите для этого параметра значение **Да** в случае типа отклика XML. |
| Метод запроса                 | Укажите способ запроса. HTTP определяет набор методов запроса, который указывает действие, которое должно быть выполнено для определенного ресурса. Этот метод запроса может быть **GET**, **POST** или другой метод HTTP. |
| Заголовки запроса                | Укажите заголовки запросов. Заголовок запроса — это заголовок НТТР, который может использоваться в HTTP-запросе. Это не связано с содержимым сообщения. |
| Принять                         | Укажите свойство принятия веб-запроса. |
| Принять кодирование                | Укажите значение Accept-Encoding. Заголовок запроса HTTP Accept-Encoding объявляет кодировку содержимого, которую клиент может понять. Эта кодировка содержимого обычно является алгоритмом сжатия. |
| Тип содержимого                   | Укажите тип содержимого. HTTP-заголовок объекта Content-Type указывает тип носителя для ресурса. |
| Код успешного ответа       | Укажите код статуса HTTP, который указывает, что запрос выполнен успешно. |
| Сопоставление формата заголовков запроса | Выберите формат электронной отчетности, который используется для создания заголовков веб-запросов. |

## <a name="message-processing-actions"></a><a id="actions"></a>Действия обработки сообщения

Действия обработки сообщений используются для создания действий для процессов и настройки их параметров. Можно настроить действия обработки сообщений на странице **Налог** \> **Настройка** \> **Электронные сообщения** \> **Действие обработки сообщений**.

В следующей таблице описаны поля на странице **Действия обработки сообщения**.

### <a name="general-fasttab"></a>Экспресс-вкладка "Общее"

| Поле                                     | описание |
|-------------------------------------------|-------------|
| Тип действия                               | Выберите тип действия. Сведения о доступных параметрах см. в разделе [Типы действий обработки сообщений](#action-types) далее в этой теме. |
| Сопоставление формата                            | Выберите формат электронной отчетности, который должен вызываться для действия. Это поле доступно только для действий типов **Экспорт электронной отчетности**, **Импорт электронной отчетности** и **Сообщение экспорта электронной отчетности**. |
| Сопоставление формата для URL-пути               | Выберите формат электронной отчетности, который должен вызываться для действия. Этот формат используется для составления пути URL-адреса, который будет добавляться к базовому интернет-адресу, указанному для выбранного веб-сервера. Это поле доступно только для действий типа **Веб-служба**. |
| Тип элемента сообщения                         | Выберите тип записей, для которых должно оцениваться это действие. Это поле доступно для действий типов **Уровень выполнения элемента сообщения**, **Экспорт электронной отчетности**, **Импорт электронной отчетности** и **Веб-служба**, а также для других типов. Если оставить это поле пустым, вычисляются все типы элементов сообщений, определенные для обработки сообщений. |
| Исполняемый класс                          | Выберите существующий параметр исполняемого класса. Это поле доступно только для действий типов **Уровень выполнения элемента сообщения** и **Уровень выполнения элемента сообщения**. |
| Действие заполнения записей                   | Выберите существующее действие заполнения записей. Это поле доступно только для действий типа **Заполнить записи**. |
| Веб-служба                               | Выберите существующую веб-службу. Это поле доступно только для действий типа **Веб-служба**. |
| Имя файла для отправки                         | Введите имя вложения в электронное сообщение, которое должно быть отправлено этим действием. Если несколько вложений имеют одинаковое имя исходного файла, будет отправлено последнее из них. Если вложение с заданным исходным именем файла не найдено, запрос будет отправлен без содержимого. Это поле доступно только для действий типа **Веб-служба**. |
| Имя файла                                 | Укажите имя файла, который будет результатом действия. Этот файл может быть ответом от веб-сервера или отчетом, который генерируется. Это поле доступно только для действий типов **Веб-служба** и **Сообщение экспорта электронной отчетности**. |
| Вложить файлы в документы-источники          | Установите этот флажок, чтобы приложить созданные файлы к записям в главной таблице, на которую имеется ссылка, для элементов EM. Это поле доступно только для действий типов **Экспорт электронной отчетности** и **Веб-служба**. |
| Вкладывать файлы из выходного архива в элементы | Установите этот флажок, чтобы извлечь отдельные файлы XML из выходного файла архива и присоединить их к соответствующим элементам электронного сообщения. Это поле доступно только для действий типа **Экспорт электронной отчетности**. |
| Число элементов сообщения на экспорт        | Укажите предельное число элементов сообщения, которые должны быть включены в один файл (сообщение). Это поле доступно только для действий типа **Экспорт электронной отчетности**. |
| Использование источника ER                             | Установите этот флажок, чтобы использовать для импорта параметры источника ER. В противном случае используется вложение из электронного сообщения. Это поле доступно только для действий типа **Импорт электронной отчетности**. |
| Показать диалоговое окно                               | Установите для этого параметра значение **Да**, если необходимо показывать диалоговое окно пользователям перед созданием отчета. Это поле доступно только для действий типа **Сообщение экспорта электронной отчетности**. |

#### <a name="message-processing-action-types"></a><a id="action-types"></a>Типы действий обработки сообщений

В поле **Тип действия** доступны следующие варианты:

- **Создать сообщение** — используйте этот тип действия, чтобы пользователи могли вручную создавать сообщения на странице **Электронное сообщение**. Исходный статус не может быть настроен для данного типа действия.
- **Заполнение записей** — этот тип действия должен быть уже настроен. Свяжите его с действием заполнения записей, чтобы включить его в обработку. Предполагается, что этот тип действия используется либо для первого действия в обработке сообщения (когда электронные сообщения не были созданы заранее) или для действие, добавляющего элементы сообщения в сообщение, созданное ранее действием типа **Создать сообщение**. Таким образом, для действий этого типа статус результата может быть настроен только для элементов сообщения. Начальный статус можно настроить только для сообщений.
- **Уровень выполнения сообщения** — этот тип действий используется для настройки исполняемого класса, который должен вычисляться на уровне сообщений.
- **Уровень выполнения элемента сообщения** — этот тип действий используется для настройки исполняемого класса, который должен вычисляться на уровне элементов сообщений.
- **Экспорт электронной отчетности** — этот тип действия используется для действий, которые должны создавать отчет, основанный на конфигурации экспорта электронной отчетности на уровне элементов сообщений.
- **Сообщение экспорта электронной отчетности** — этот тип действий используется для действий, которые должны создавать отчет, основанный на конфигурации экспорта электронной отчетности на уровне сообщений (например, когда сообщение не содержит никаких элементов сообщений).
- **Импорт электронной отчетности** — этот тип действий используется для действий, которые должны создавать отчет, основанный на конфигурации импорта электронной отчетности.
- **Пользовательская обработка на уровне сообщения** — этот тип действий используется для действий, которые предполагают некоторое действие, выполняемые пользователем вручную на уровне сообщения. Например, пользователь может обновлять статус сообщений.
- **Пользовательская обработка** — этот тип действий используется для действий, которые предполагают некоторое действие, выполняемые пользователем вручную на уровне элемента сообщения. Например, пользователь может обновлять статус элементов сообщений.
- **Веб-служба** — этот тип действий используется для действий, которые должны передавать формируемый отчет в веб-службу. Этот тип действия не используется для отчетности сообщения о счетах продажи и покупки для Италии. Для действий этого типа страница **Действия обработки сообщения** включает экспресс-вкладку **Прочие подробные сведения**, где можно указать текст подтверждения. Этот текст подтверждения показан пользователям перед тем, как запросы будут направлены в выбранную веб-службу.
- **Запрос проверки** — используйте этот тип действий для запроса проверки от сервера.

### <a name="initial-statuses-fasttab"></a>Экспресс-вкладка "Начальные статусы"

> [!NOTE]
> Экспресс-вкладка **Начальные статусы** недоступна для действий, которые имеют начальный тип действий **Создать сообщение**.

| Поле               | Описание |
|---------------------|-------------|
| Статус элемента сообщения | Выберите статус элемента сообщения, для которого должно вычисляться выбранное действие обработки сообщения. |
| описание         | Описание выбранного статуса элемента сообщения. |

### <a name="result-statuses-fasttab"></a>Экспресс-вкладка "Полученные статусы"

| Поле               | описание |
|---------------------|-------------|
| Статус сообщения      | Выберите статус сообщения, для которого должно вычисляться выбранное действие обработки сообщения. Это поле доступно только для действий обработки сообщений, которые вычисляются на уровне сообщений. Например, оно доступно для действий типов **Экспорт электронной отчетности** и **Импорт электронной отчетности**, но недоступно для действий типов **Обработка пользователя** и **Уровень выполнения элемента сообщения**. |
| описание         | Описание выбранного статуса сообщения. |
| Тип отклика       | Тип ответа выбранного статуса сообщений. |
| Статус элемента сообщения | Выберите полученные статусы, которые должны быть доступны после вычисления выбранного действия обработки сообщения. Это поле доступно только для действий обработки сообщений, которые вычисляются на уровне элементов сообщений. Например, оно доступно для действий типов **Обработка пользователя** и **Уровень выполнения элемента сообщения**. Для действий обработки сообщений, которые вычисляются на уровне сообщений, это поле показывает статус элемента сообщения, который был настроен для статуса выбранного сообщения. |

В следующей таблице показаны статусы результатов, которые необходимо настроить для различных типов действий и типов откликов.

| Тип действия электронного сообщения/Тип отклика | Выполнено успешно | Бизнес-ошибка | Техническая ошибка | Определено пользователем | Отменить |
|----------------------------------------------|-----------------------|----------------|-----------------|--------------|--------|
| Создать сообщение                               | Х                     |                |                 |              |        |
| Экспорт электронной отчетности                  | Х                     |                |                 |              |        |
| Импорт электронной отчетности                  |                       |                |                 |              |        |
| Веб-служба                                  | Х                     |                | Х               |              |        |
| Обработка пользователя                              |                       |                |                 |              |        |
| Уровень выполнения сообщения                      |                       |                |                 |              |        |
| Заполнить записи                             |                       |                |                 |              |        |
| Уровень выполнения элемента сообщения                 |                       |                |                 |              |        |
| Запрос проверки                         | Х                     | Х              | Х               |              |        |
| Сообщение экспорта электронной отчетности          | Х                     |                |                 |              |        |
| Пользовательская обработка на уровне сообщения                |                       |                |                 |              |        |

## <a name="electronic-message-processing"></a><a id="processing"></a>Обработка электронного сообщения

Обработка электронных сообщений является основным принципом функции EM. Она объединяет действия, которые должны вычисляться для электронного сообщения. Действия могут быть связаны через начальный статус и статус результата. Кроме того, действия типа **Обработка пользователя** могут запускаться независимо. Чтобы настроить обработку электронных сообщений, перейдите на страницу **Налог** \> **Настройка** \> **Электронные сообщения** \> **Обработка электронных сообщений**.

Экспресс-вкладка **Действие** позволяет добавлять предопределенные действия к обработке. Можно указать, должно ли действие выполняться отдельно или оно может быть запущено обработкой. Чтобы указать, что действие в обработке может быть инициализировано только пользователем, установите в поле **Выполнить отдельно** значение **Да** для этого действия. Если требуется, чтобы действие запускалось путем обработки для сообщений или элементов сообщений, имеющих статус, который определен как начальный статус для этого действия, задайте для параметра **Выполнить отдельно** значение **Нет**. Действия типа **Действие пользователя** должны всегда выполняться отдельно.

В некоторых случаях несколько действий должны быть агрегированы в последовательность, несмотря на то, что первое действие настроено для выполнения отдельно. Например, пользователь должен инициализировать создание отчета. Однако сразу же после создания отчета он должен отправляться в веб-службу, и ответ от веб-службы должен быть отражен в системе. В этом случае можно создать неделимую последовательность действий, которые должны всегда выполняться вместе. На экспресс-вкладке **Действие** выберите **Неделимые последовательности** над сеткой и создайте последовательность. Затем для всех действий, которые должны выполняться одновременно, выберите последовательность в поле **Неделимая последовательность**. В этом примере в поле **Выполнить отдельно** должно быть задано значение **Да** для первого действия в последовательности, но значение **Нет** для всех других действий.

Действия типа **Экспорт электронной отчетности** и **Сообщение экспорта электронной отчетности** выполняются в формате ER, который имеет входные параметры. Если обработка электронного сообщения включает в себя действия любого из этих типов, необходимо указать значения для входных параметров перед созданием отчета. Таким образом, система может использовать пакетный режим для создания отчета. Можно выбрать **Параметры** выше сетки для настройки параметров для выбранного типа действия (**Экспорт электронной отчетности** или **Сообщение экспорта электронной отчетности**). Установите флажок **Использовать параметры** для действия, которое должно выполняться с указанными параметрами в пакетном режиме.

На экспресс-вкладке **Дополнительные поля элемента сообщения** добавьте предварительно определенные дополнительные поля, которые относятся к элементам сообщений. Необходимо добавить дополнительные поля для каждого типа элемента сообщений, с которыми связаны эти поля. Можно указать значение по умолчанию, которое будет присвоено дополнительному полю во время обработки.

На экспресс-вкладке **Дополнительные поля сообщения** можно добавить предварительно определенные дополнительные поля, которые относятся к сообщениям. Можно указать значение по умолчанию, которое будет присвоено дополнительному полю во время обработки.

Экспресс-вкладка **Роли безопасности** позволяет настроить роли безопасности, которые заранее определены в системе для определенной обработки. Пользователи, имеющие определенную роль, будут видеть только обработку, определенную для этой роли.

Экспресс-вкладка **Пакет** позволяет настроить обработку для работы в пакетном режиме. Рекомендуется настроить пакетный режим для обработки непосредственно на странице **Электронные сообщения** или **Элементы электронного сообщения**, выбрав на панели операций **Выполнить обработку**, чтобы начать обработку.

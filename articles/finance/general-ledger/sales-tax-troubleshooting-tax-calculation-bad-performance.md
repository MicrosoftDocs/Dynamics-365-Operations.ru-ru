---
title: Производительность при расчете налога влияет на проводки
description: В этой теме содержатся сведения об устранении неполадок, связанных с производительностью расчета налогов и его влиянием на проводки.
author: shtao
ms.date: 04/07/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application user
ms.reviewer: kfend
ms.search.region: Global
ms.author: wangchen
ms.search.validFrom: 2021-04-01
ms.dyn365.ops.version: 10.0.1
ms.openlocfilehash: 1902017a7a00d4cc068f17e23aa21cd1d2b547a7
ms.sourcegitcommit: a58dfb892e43921157014f0784bd411f5c40e454
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/04/2022
ms.locfileid: "8695228"
---
# <a name="tax-calculation-performance-affects-transactions"></a>Производительность при расчете налога влияет на проводки

[!include [banner](../includes/banner.md)]

Иногда на проводку влияют вопросы производительности, связанные с расчетом налога. Для решения проблемы выполните действия, указанные в следующих разделах.

## <a name="review-the-transaction-line-count"></a>Просмотр количества строк проводок

Определите, есть ли у проводки большое количество строк (например, более нескольких сотен). Если нет, перейдите к следующему разделу. Если проводка содержит несколько сотен строк, следует отложить расчет налога. Дополнительные сведения см. в разделе [Включение отсроченного расчета налога для журналов](enable-delayed-tax-calculation.md). 

Затем можно определить, удовлетворяются ли какие-либо из следующих условий:

- Имеются проводки импорта из больших файлов.
- Несколько сеансов обрабатывают один и тот же расчет налога на проводку одновременно.
- Проводка имеет несколько строк, и представления обновляются в реальном времени. Например, поле **Рассчитанная сумма налога** на странице **Общий журнал** обновляется в реальном времени при изменении полей строки.

   [![Поле рассчитанной суммы налога на странице ваучера журнала.](./media/tax-calculation-bad-performance-impacts-transaction-Picture1.png)](./media/tax-calculation-bad-performance-impacts-transaction-Picture1.png)

Если какое-либо из этих условий выполнено, отложите расчет налога.

## <a name="review-the-call-stack"></a>Проверка стека вызова

Проверьте стек вызовов, чтобы определить, вызывается ли расчет налога несколько раз. Если нет, перейдите к следующему разделу. Если стек вызова вызван несколько раз, выполните следующие действия, чтобы уменьшить время расчета налога.

1. Если журнал изучал проводку, задержите расчет налога. Дополнительные сведения см. в разделе [Включение отсроченного расчета налога для журналов](enable-delayed-tax-calculation.md).
2. Если проводка является заказом на покупку, а версия приложения позже 10.0.15, можно отложить расчет налога до окончательного расчета путем включения фокус-тестирования для **PurchTableChangeMgmtDistributionUpdateOnToggle_KillSwitch**.

## <a name="review-the-call-stack-timeline"></a>Проверка временной шкалы стека вызова

Проверьте временную шкалу стека вызова, чтобы определить, имеются ли следующие проблемы. Если они есть, включите фокус-тестирование рейс для **TaxUncommittedDoIsolateScopeFlighting**, чтобы устранить проблему.

- Проводка приводит к тому, что система перестает отвечать на запросы до окончания сеанса. Поэтому проводка не может рассчитать результат налога. На следующем рисунке показано полученное окно сообщения "Сеанс завершен".

    [![Сообщение о завершении сеанса.](./media/tax-calculation-bad-performance-impacts-transaction-Picture2.png)](./media/tax-calculation-bad-performance-impacts-transaction-Picture2.png)

- Методы **TaxUncommitted** занимают больше времени, чем другие методы. Например, на следующем рисунке метод **TaxUncommitted::updateTaxUncommitted()** занимает 43 347,42 секунды, но другие методы занимают 0,09 секунды.

    [![Продолжительность метода.](./media/tax-calculation-bad-performance-impacts-transaction-Picture3.png)](./media/tax-calculation-bad-performance-impacts-transaction-Picture3.png)

## <a name="customizing-and-calling-tax-calculation"></a>Настройка и вызов расчета налогов

При настройке не вызывайте расчет налогов метода **insert()** или **update()** для каждой строки. Расчет налога должен вызываться на уровне проводки.

## <a name="determine-whether-customization-exists"></a>Определение существования настройки

Если вы выполнили шаги в предыдущих разделах, но не смогли решить проблему, определите, существует ли настройка. Если настройки не существует, создайте запрос в службу поддержки Майкрософт для получения дополнительной поддержки.

[!INCLUDE[footer-include](../../includes/footer-banner.md)]

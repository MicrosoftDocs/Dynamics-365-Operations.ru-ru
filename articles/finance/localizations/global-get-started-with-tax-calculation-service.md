---
title: Начало работы с расчетом налогов
description: В этой статье описывается, как настроить расчет налогов.
author: EricWangChen
ms.date: 03/25/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application user
ms.reviewer: kfend
ms.search.region: Global
ms.author: wangchen
ms.search.validFrom: 2021-04-01
ms.dyn365.ops.version: 10.0.18
ms.custom: intro-internal
ms.search.form: TaxIntegrationTaxServiceParameters
ms.openlocfilehash: 0f005352970ec3dadb178dfafeaf4f7e36f8c18d
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/12/2022
ms.locfileid: "9279821"
---
# <a name="get-started-with-tax-calculation"></a>Начало работы с расчетом налогов

[!include [banner](../includes/banner.md)]

В этой статье содержится информация о том, как начать работу с расчетом налогов. Разделы в этой статье познакомят вас с шагами разработки и настройки высокого уровня в службах Microsoft Dynamics Lifecycle Services (LCS), Regulatory Configuration Service (RCS), Dynamics 365 Finance и Dynamics 365 Supply Chain Management. 

Настройка состоит из трех основных шагов.

1. В LCS установите надстройку расчета налога.
2. В RCS настройте функцию Расчет налогов. Эта настройка не является специфичной для юридического лица. Она может использоваться для всех юридических лиц в модулях Finance и Supply Chain Management.
3. В Финансы и Supply Chain Management настройте параметры надстройки Расчет налогов по юридическим лицам.

## <a name="high-level-design"></a>Разработка высокого уровня

### <a name="runtime-design"></a><a name="runtime"></a> Разработка среды выполнения

На следующем рисунке показана высокоуровневая разработка времени выполнения в расчете налога. Поскольку расчет налога может быть интегрирован с несколькими приложениями Dynamics 365, иллюстрация использует в качестве примера интеграцию с приложением Finance.

1. Проводка, например заказ на продажу или заказ на покупку, создается в Finance.
2. Finance автоматически использует значения по умолчанию для налоговой группы и налоговой группы номенклатур.
3. При выборе в проводке кнопки **Налог** запускается расчет налога. Затем Finance отсылает полезные данные в службу расчета налогов.
4. Служба расчета налогов сопоставляет полезные данные с предопределенными правилами в функции налогов, чтобы найти более точную налоговую группу и налоговую группу номенклатур одновременно.

    - Если полезные данные могут быть сопоставлены с матрицей **Применимость налоговой группы**, она переопределяет значение налоговой группы на значение соответствующей налогового группы в правиле применимости. В противном случае значение налоговой группы будет использоваться из приложения Finance.
    - Если полезные данные могут быть сопоставлены с матрицей **Применимость налоговой группы номенклатуры**, она переопределяет значение налоговой группы номенклатуры на значение соответствующей налогового группы номенклатуры в правиле применимости. В противном случае будет использоваться значение налоговой группы номенклатуры из приложения Finance.

5. Служба расчета налога определяет окончательные налоговые коды, используя пересечение налоговой группы и налоговой группы номенклатур.
6. Служба расчета налогов рассчитывает налог на основе определенных окончательных налоговых кодов.
7. Служба расчета налогов возвращает результат расчета налога в Finance.

![Разработка расчета налога в среде выполнения.](media/tax-calculation-runtime-logic.png)

### <a name="high-level-configuration"></a>Конфигурация высокого уровня

Следующие шаги предоставляют общий обзор процесса настройки для службы расчета налогов.

1. В LCS установите надстройку **Расчет налога** в ваш проект LCS.
2. В RCS создайте функцию **Расчет налогов**.
3. В RCS настройте функцию **Расчет налогов**:

    1. Выберите версию конфигурации налогов.
    2. Создайте налоговые коды.
    3. Создайте налоговую группу.
    4. Создайте налоговую группу номенклатур.
    5. Необязательно: создайте применимость налоговой группы, если хотите переопределить налоговую группу по умолчанию, которая вводится из справочника клиента или поставщика.
    6. Необязательно: создайте применимость налоговой группы номенклатур, если хотите переопределить налоговую группу номенклатур по умолчанию, которая вводится из справочника номенклатур.

4. В RCS выполните и опубликуйте функцию **Расчет налога**.
5. В приложении Finance выберите опубликованную функцию **Расчет налога**.

После выполнения этих шагов выполняется автоматическая синхронизация следующих настроек из RCS в Finance.

- Налоговые коды
- Налоговые группы
- Налоговые группы номенклатур

В остальных разделах этой статьи приведены более подробные шаги настройки.

## <a name="prerequisites"></a>Необходимые условия

Чтобы можно было выполнить оставшиеся процедуры из данной статьи, необходимо выполнить следующие предварительные требования:<!--TO HERE-->

- У вас должен быть доступ к вашей учетной записи LCS и вы уже развернули проект LCS со средой уровня 2 (или выше), в котором работает Dynamics 365 версии 10.0.21 или новее.
- Необходимо создать среду RCS для вашей организации, и вы должны иметь доступ к вашей учетной записи. Дополнительные сведения о создании среды RCS см. в разделе [Обзор Regulatory Configuration Service](rcs-overview.md).
- В рабочей области **Управление функциями** развернутой среды Finance или Supply Chain Management — в зависимости от потребностей бизнеса — должны быть включены следующие функции:

    - Служба расчета налогов
    - Поддержка нескольких регистрационных номеров НДС
    - Налог в заказе на перемещение

- В рабочей области **Управление функциями** развернутой среды RCS должны быть включены следующие функции.

    - Функции глобализации

- Ниже перечислены роли, которые должны быть назначены пользователям в среде RCS:

    - Разработчик электронной отчетности
    - Разработчик функций глобализации
    - Разработчик механизма начисления налога
    - Консультант по функциональным возможностям механизма начисления налога
    - Разработчик налоговой службы

## <a name="set-up-tax-calculation-in-lcs"></a>Настройте Расчет налогов в LCS

1. Вход в [LCS](https://lcs.dynamics.com)
2. Выполните настройку для интеграции Microsoft Power Platform. Дополнительные сведения см. в разделе [Обзор надстроек](../../fin-ops-core/dev-itpro/power-platform/add-ins-overview.md).
3. Выберите одну из развернутых сред, затем выберите **Установить новую надстройку**.
4. Выберите **Расчет налогов**.
5. Прочитайте и примите условия, затем выберите **Установить**.

## <a name="set-up-tax-calculation-in-rcs"></a>Настройте Расчет налогов в RCS

Шаги данного раздела не относятся к конкретному юридическому лицу. Эту процедуру необходимо выполнить только один раз, и ее можно выполнить в любом юридическом лице в RCS.

1. Войдите в [RCS](https://marketing.configure.global.dynamics.com/).
2. В рабочей области **Электронная отчетность** добавьте нового поставщика конфигурации. В качестве имени поставщика используйте название своей компании. Дополнительные сведения см. в [Создание поставщиков конфигураций и пометка их как активных](../../fin-ops-core/dev-itpro/analytics/tasks/er-configuration-provider-mark-it-active-2016-11.md).
3. Выберите только что созданного поставщика конфигурации, затем выберите **Установить активной**.
4. Выберите поставщика конфигурации **Microsoft**, затем выберите **Репозитории**.
5. В поле **Тип** выберите **Глобальный**.
6. Выберите **Открыть**.
7. Перейдите в **Модель налоговых данных**, разверните дерево файлов, затем выберите **Налоговая конфигурация**.
8. Выберите правильную [версию конфигурации налога](global-tax-calcuation-service-overview.md#versions) на основе вашей версии Finance, затем выберите **Импорт**.
9. В рабочей области **Функции глобализации**, выберите **Функции**, выберите плитку **Расчет налога**, затем выберите **Добавить**.
10. Выбор один из следующих типов функции:

    - **Создать функцию** — создание настройки функции с пустым содержимым.
    - **На основе существующей функции** — создание функции из существующей функции и копирование содержимого из существующей настройки функции.

11. Введите название и описание новой функции, затем выберите **Создать функцию**.

    После создания функции черновая версия создается автоматически. Можно выбрать **Получить эту версию**, чтобы пересоздать версию черновика для любой выполненной версии.

12. Выберите черновую версию функции, затем выберите **Изменить**. Будет заполнена страница **Настройка Расчет налогов**.
13. Выберите **Версия конфигурации**. Должна отобразиться версия конфигурации, которая была импортирована на шаге 8.

    Майкрософт предоставляет конфигурацию налога по умолчанию для расчета налога. Эта конфигурация охватывает большинство требований к поведению при расчете налогов. Она будет обновлена в соответствии с обратной связью от рынка. Если необходимо расширить конфигурацию, чтобы она удовлетворяла определенным требованиям, см. раздел [Как построить расширение в налоговой службе](./tax-service-add-data-fields-tax-integration-by-extension.md) для получения сведений о том, как создавать и выбирать собственную конфигурацию налога.

14. После выбора пункта **Версия конфигурации** появятся несколько дополнительных вкладок. Выполните описанный здесь порядок, чтобы выполнить обязательную настройку вкладки.

    **Обязательная настройка**

    - **Налоговые коды** — используется для ведения основных данных для налоговых кодов. Все налоговые коды, созданные на этой вкладке, автоматически синхронизируются с Finance при включении текущей версии.
    - **Налоговая группа** — определите справочник налоговой группы и налоговые коды в группе.
    - **Налоговая группа номенклатуры** — определите справочник налоговой группы номенклатуры и налоговые коды в группе.

    **Дополнительная настройка**

    - **Применимость налоговой группы** – определение матрицы, определяющей налоговую группу. Если правила применимости в этой таблице не соответствуют налогооблагаемому документу из Dynamics 365, в расчете налога используется значение по умолчанию в строке налогооблагаемого документа.
    - **Применимость налоговой группы номенклатуры** – определение матрицы, определяющей налоговую группу номенклатуры. Если правила применимости в этой таблице не соответствуют налогооблагаемому документу из Dynamics 365, в расчете налога используется значение по умолчанию в строке налогооблагаемого документа.
    - **Применимость номера налоговой регистрации клиента** — при наличии нескольких налоговых регистрационных номеров для одного клиента расчет налога может автоматически определить правильный налоговый регистрационный номер. В матрице на этой вкладке определяются правила, используемые для выполнения определения. В противном случае Finance и Supply Chain Management продолжат использовать налоговый регистрационный номер по умолчанию в налогооблагаемых документах для проводок по продажам.
    - **Применимость номера налоговой регистрации поставщика** — при наличии нескольких налоговых регистрационных номеров для одного поставщика расчет налога может автоматически определить правильный налоговый регистрационный номер. В матрице на этой вкладке определяются правила, используемые для выполнения определения. В противном случае Finance и Supply Chain Management продолжат использовать налоговый регистрационный номер по умолчанию в налогооблагаемых документах для проводок по покупкам.
    - **Применимость кода списка** — можно автоматически определить значение поля **Код списка** с помощью более гибких и настраиваемых правил. В матрице на этой вкладке определяются правила, используемые для выполнения определения. В противном случае Finance и Supply Chain Management продолжат использовать код по умолчанию в налогооблагаемых документах.

14. На вкладке **Коды налога** выберите **Добавить** и введите налоговый код и описание.
15. Выберите **Налоговый компонент**. Налоговый компонент — это группа методов, которая была определена в предыдущей версии выбранной налоговой конфигурации. Доступны следующие налоговые компоненты:

    - По чистой сумме
    - По валовой сумме
    - По количеству
    - По марже
    - Налог на налог

16. Нажмите **Сохранить**. В зависимости от выбранного налогового компонента становятся доступны дополнительные поля.
17. Используйте следующие параметры для определения природы налогового кода:

    - Не облагается
    - Является налогом за пользование
    - Является удержанием с покупателя
    - Исключить из расчета базовой суммы

    Для сценария налога на использование настройте один налоговый код, который имеет положительную налоговую ставку, и пометьте его как **Налог за пользование**.

    Для сценария с возмещением расходов настройте два налоговых кода, один из которых имеет положительную налоговую ставку, а второй имеет отрицательную ставку налога, но одинаковое значение ставки. Отметьте отрицательный налоговый код как **Является возмещением расходов**. Дополнительные сведения о решении налога с покупателя в модуле Finance см. в разделе [Механизм возмещения расходов для схемы НДС/GST](emea-reverse-charge.md).

    Для некоторых типов налогов, которые должны быть исключены из расчета суммы налоговой базы для проводок с инклюзивными ценами (например, таможенный налог в некоторых странах/регионах), установите флажок **Исключить из расчета базовой суммы**. Дополнительные сведения об этом параметре см. в разделе [Расчет налога в дополнение к цене, когда активировано включение налога в цену](global-exclude-from-tax-base-amount-calculation.md).

    Поддерживайте ставки налога и лимиты сумм налога для этого налогового кода.

18. Повторите шаги с 14 по 17 для добавления всех остальных требуемых налоговых кодов.
19. На вкладке **Налоговая группа** выберите столбец **Налоговая группа**, добавьте его в матрицу в качестве входного условия, а затем добавьте строки для ведения справочника налоговой группы.

    Рассмотрим пример:

    | Налоговая группа    | Налоговые коды           |
    | ------------ | ------------------- |
    | DEU_Domestic | DEU_VAT19; DEU_VAT7 |
    | DEU_EU       | DEU_Exempt          |
    | BEL_Domestic | BEL_VAT21; BEL_VAT6 |
    | BEL_EU       | BEL_Exempt          |

20. На вкладке **Налоговая группа номенклатуры** выберите столбец **Налоговая группа номенклатуры**, добавьте его в матрицу в качестве входного условия, а затем добавьте строки для ведения справочника налоговой группы номенклатуры.

    Рассмотрим пример:

    | Налоговая группа номенклатуры | Налоговые коды                                    |
    | -------------- | -------------------------------------------- |
    | Полный           | DEU_VAT19; BEL_VAT21; DEU_Exempt; BEL_Exempt |
    | Пониженная        | DEU_VAT7; BEL_VAT6; DEU_Exempt; BEL_Exempt   |

21. На вкладке **Применимость налоговой группы** выберите столбцы, необходимые для определения правильного налоговой группы, затем выберите **Добавить**. Введите или выберите значения для каждого столбца. Поле **Налоговая группа** будет выходным результатом данной матрицы. Если эта вкладка не настроена, будет использована налоговая группа в строке проводки.

    Рассмотрим пример:

    | Бизнес-процесс | Отправитель | Получатель | Налоговая группа    |
    | ---------------- | --------- | ------- | ------------ |
    | Прод.            | DEU       | DEU     | DEU_Domestic |
    | Прод.            | DEU       | FRA     | DEU_EU       |
    | Продажи            | BEL       | BEL     | BEL_Domestic |
    | Продажи            | BEL       | FRA     | BEL_EU       |
    
    > [!NOTE]
    > Если налоговая группа по умолчанию в строках налогооблагаемого документа указана правильно, оставьте эту матрицу пустой. Дополнительные сведения см. в разделе [Разработка среды выполнения](#runtime) в этой статье.

22. На вкладке **Применимость налоговой группы номенклатуры** выберите столбцы, необходимые для определения правильного налогового кода, затем выберите **Добавить**. Введите или выберите значения для каждого столбца. Поле **Налоговая группа номенклатуры** будет выходным результатом данной матрицы. Если эта вкладка не настроена, будет использована налоговая группа номенклатуры в строке проводки.

    Рассмотрим пример:

    | Код номенклатуры | Налоговая группа номенклатур |
    | --------- | -------------- |
    | D0001     | Полный           |
    | D0003     | Пониженная        |

    > [!NOTE]
    > Если налоговая группа номенклатуры по умолчанию в строках налогооблагаемого документа указана правильно, оставьте эту матрицу пустой. Дополнительные сведения см. в разделе [Разработка среды выполнения](#runtime) в этой статье.

    Для получения дополнительных сведений о порядке определения налоговых кодов в расчете налога см. [Логика определения налоговой группы и налоговой группы номенклатур](global-sales-tax-group-determination.md).

23. Настройте применимость номеров налоговой регистрации клиентов, номеров налоговой регистрации поставщиков и кодов списка на основе своих бизнес-требований.
24. Выберите **Сохранить** и закройте страницу.
25. Выберите **Изменить статус** \> **Завершить**. После того как статус изменится на **Завершено**, версию нельзя будет изменить.
26. Выберите **Изменить статус** \> **Опубликовано**. Эта версия настройки налоговых функций будет отправлена в глобальный репозиторий и будет видна для каждого юридического лица в Finance.

## <a name="set-up-tax-calculation-in-dynamics-365"></a>Настройте Расчет налогов в Dynamics 365

После завершения настройки в RCS будет опубликована версия функции налога. Выполните следующие действия, чтобы настроить Расчет налогов в Финансы.

Настройка в этом разделе выполняется по юридическим лицам. Необходимо настроить ее для каждого юридического лица, для которого требуется включить Расчет налогов в Финансы.

1. В Finance перейдите к пункту **Налог** \> **Настройка** \> **Конфигурация налога** \> **Параметры расчета налогов**.
2. На вкладке **Общие** установите следующие поля:

    - **Включить службу расчета налогов** — установите этот флажок, чтобы включить расчет налогов для юридического лица. Если это не активировано для текущего юридического лица, юридическое лицо будет продолжать использовать существующий налоговый модуль для определения и расчета налога.
    - **Настройка функции** — выберите для юридического лица опубликованную настройку и версию функции налога. Дополнительные сведения о порядке настройки и выполнения опубликованной функции налога см. в предыдущем разделе данной статьи.
    - **Бизнес-процесс** — выберите бизнес-процессы, которые требуется включить.

3. На вкладке **Расчет** определите ожидаемое правило округления для юридического лица. Дополнительные сведения о логике округления см. в разделе [Правила округления при расчете налога](https://go.microsoft.com/fwlink/?linkid=2166988).
4. На вкладке **Обработка ошибок** определите ожидаемый метод обработки ошибок для юридического лица. Доступно три варианта:

    - Нет
    - Предупреждение
    - Ошибка

    Для каждого кода результата в разделе **Подробно** можно настроить метод обработки ошибок. Кроме того, если некоторые коды результатов не синхронизованы со службой расчета налогов, можно настроить метод по умолчанию в разделе **Общие**.

5. На вкладке **Несколько регистрационных номеров НДС** можно включить отдельно декларацию по НДС, отчет ЕС по НДС и Интрастат раздельно для работы в случае нескольких регистрационных номеров НДС. Дополнительные сведения о налоговой отчетности по нескольким регистрационным номерам НДС см. в разделе [Отчетность по нескольким регистрационным номерам НДС](emea-reporting-for-multiple-vat-registrations.md).
6. Сохраните настройку и повторите предыдущие шаги для каждого дополнительного юридического лица. Когда публикуется новая версия и ее необходимо применить, задайте поле **Настройка функции** на вкладке **Общие** на странице **Параметры расчета налогов** (см. шаг 2).

---
title: Настройка подключения SharePoint
description: В этой статье объясняется, как настроить подключение так, чтобы при электронном выставлении накладных был возможен доступ к сайту Microsoft SharePoint.
author: dkalyuzh
ms.date: 12/15/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: kfend
ms.custom: ''
ms.assetid: ''
ms.search.region: Global
ms.author: dkalyuzh
ms.search.validFrom: ''
ms.dyn365.ops.version: ''
ms.openlocfilehash: fb4258190b9480c1302060dd7b75145f80bb7f18
ms.sourcegitcommit: 52b7225350daa29b1263d8e29c54ac9e20bcca70
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2022
ms.locfileid: "8856590"
---
# <a name="configure-a-sharepoint-connection"></a>Настройка подключения SharePoint

[!include [banner](../includes/banner.md)]

Служба электронного выставления накладных может читать файла из папок Microsoft SharePoint и отправки файлов в SharePoint. Чтобы электронное выставление накладных могло получить доступ к конкретному сайту SharePoint, необходимо предоставить учетные данные сайта для службы электронного выставления накладных. Кроме того, чтобы гарантировать безопасное хранение учетных данных, их не следует предоставлять напрямую. Вместо этого храните их в Azure Key Vault и предоставьте секрет Azure Key Vault.

## <a name="grant-access-to-a-sharepoint-folder"></a>Предоставление доступа к папке SharePoint

1. Создайте регистрацию приложения в клиенте, где установлена служба Regulatory Configuration Service (RCS).

    1. Выполните вход на [портал Azure](https://portal.azure.com/).
    2. Перейдите в пункт **Регистрации приложений**.
    3. Выберите **Создать регистрацию**.
    4. Введите имя, например **Приложение SharePoint для электронного выставления накладных**, и выполните регистрацию
    5. Выберите регистрацию нового приложения.
    6. На вкладке **Аутентификация** включите параметр **Разрешить потоки общих клиентов**.
    4. На вкладке **Сертификаты и секреты** выберите **Создать секрет клиента**, чтобы создать секрет клиента.
    5. Скопируйте созданное значение секрета.

    Следуйте приведенным ниже рекомендациям:

    - Не используйте одинаковую регистрацию приложений для разных служб.
    - Следуйте [рекомендациям по политике паролей](/microsoft-365/admin/misc/password-policy-recommendations?view=o365-worldwide).
    - Настройка смены паролей. Во время смены создайте новый секрет клиента для регистрации приложения, обновите хранилище ключей, затем удалите старый секрет.

2. Сохраните значения **Секрет регистрации приложения** и **Код приложения (клиента)** в виде двух новых секретов в хранилище ключей в настройке среды электронного выставления накладных.
3. Добавьте секреты, созданные в параметрах Key Vault в настройке среды электронного выставления накладных в RCS.
4. На портале Azure предоставьте доступ к SharePoint. Этот шаг должен выполняться администратором клиента.

    1. Выберите созданную регистрацию приложения.
    2. На вкладке **Разрешения API** выберите **Добавить разрешение**.
    3. Выберите **Microsoft Graph (разрешения приложения)** \> **Sites.Selected**.
    4. Выберите **Предоставить согласие администратора для \<user&nbsp;name\>**.
    5. Проверьте поле **Статус**, чтобы убедиться, что предоставлены разрешения.

        ![Разрешения, предоставляемые на вкладке разрешений API.](media/configured-permissions.jpg)

    6. Откройте [песочницу Graph - Microsoft Graph](https://developer.microsoft.com/graph/graph-explorer) и выполните вход.
    7. В левой области на вкладке **Примеры запросов** в области **Сайты SharePoint** выберите пункт **получить сайт SharePoint на основе относительного пути к сайту**.
    8. Заполните параметры **\{host-name\}** и **\{server-relative-path\}**. Например, заполните `<domain>.sharepoint.com` для **\{host-name\}** и `sites/<siteName>` для **\{server-relative-path\}**.

        > [!NOTE]
        > Для веб-сайта по умолчанию оставьте параметр **\{server-relative-path\}** пустым.

    9. Выберите **Выполнить запрос** и сохраните результат.
    10. Настройте следующий запрос.

        `POST https://graph.microsoft.com/v1.0/sites/{site-id}/permissions`

        В этом запросе **\{site-id\}** — это значение узла **id** из предыдущего ответа на запрос.

        Вот тело запроса.

        ```json
        {
            "roles": [
                "read",
                "write"
            ],
            "grantedToIdentities": [
                {
                    "application": {
                        "id": "{app-id}",
                        "displayName": "{app-name}"
                    }
                }
            ]
        }
        ```

        В этом тексте запроса **\{app-id\}** — это **Код приложения (клиента)**, а **\{app-name\}** — это значение **Имя приложения**.

        ![Запрос POST.](media/app-id-query.jpg)

    11. На вкладке **Изменение разрешений** выберите пункт **Открыть панель разрешений**, затем выберите **Сайты** \> **Sites.FullControl.All** \> **Согласие**.
    12. Выберите **Запустить запрос**.

Служба электронного выставления накладных теперь имеет доступ к сайту SharePoint.
